(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PNoise = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ChainsafeLibp2PNoise=(()=>{var gn=Object.defineProperty;var Va=Object.getOwnPropertyDescriptor;var Fa=Object.getOwnPropertyNames;var za=Object.prototype.hasOwnProperty;var yt=(r,t)=>{for(var e in t)gn(r,e,{get:t[e],enumerable:!0})},Ga=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Fa(t))!za.call(r,o)&&o!==e&&gn(r,o,{get:()=>t[o],enumerable:!(n=Va(t,o))||n.enumerable});return r};var Za=r=>Ga(gn({},"__esModule",{value:!0}),r);var uh={};yt(uh,{noise:()=>fh,pureJsCrypto:()=>ln});var xn=Symbol.for("@libp2p/peer-id");var yr=class extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}},gr=class extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}},gt=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},be=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var we=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Ss=Symbol.for("@libp2p/service-capabilities"),ph=Symbol.for("@libp2p/service-dependencies");var An={};yt(An,{base58btc:()=>nt,base58flickr:()=>Ja});var Mh=new Uint8Array(0);function As(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function Pt(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Bs(r){return new TextEncoder().encode(r)}function vs(r){return new TextDecoder().decode(r)}function Xa(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=o}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var y=0,h=0,g=0,w=b.length;g!==w&&b[g]===0;)g++,y++;for(var d=(w-g)*f+1>>>0,L=new Uint8Array(d);g!==w;){for(var R=b[g],U=0,_=d-1;(R!==0||U<h)&&_!==-1;_--,U++)R+=256*L[_]>>>0,L[_]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");h=U,g++}for(var T=d-h;T!==d&&L[T]===0;)T++;for(var v=c.repeat(y);T<d;++T)v+=r.charAt(L[T]);return v}function p(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var y=0;if(b[y]!==" "){for(var h=0,g=0;b[y]===c;)h++,y++;for(var w=(b.length-y)*u+1>>>0,d=new Uint8Array(w);b[y];){var L=e[b.charCodeAt(y)];if(L===255)return;for(var R=0,U=w-1;(L!==0||R<g)&&U!==-1;U--,R++)L+=a*d[U]>>>0,d[U]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");g=R,y++}if(b[y]!==" "){for(var _=w-g;_!==w&&d[_]===0;)_++;for(var T=new Uint8Array(h+(w-_)),v=h;_!==w;)T[v++]=d[_++];return T}}}function S(b){var y=p(b);if(y)return y;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:p,decode:S}}var Ya=Xa,ja=Ya,Is=ja;var bn=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},wn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let o=e.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return _s(this,t)}},En=class{decoders;constructor(t){this.decoders=t}or(t){return _s(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function _s(r,t){return new En({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var Sn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,o){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=o,this.encoder=new bn(t,e,n),this.decoder=new wn(t,e,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Ee({name:r,prefix:t,encode:e,decode:n}){return new Sn(r,t,e,n)}function Xt({name:r,prefix:t,alphabet:e}){let{encode:n,decode:o}=Is(e,r);return Ee({prefix:t,name:r,encode:n,decode:s=>Pt(o(s))})}function Wa(r,t,e,n){let o={};for(let f=0;f<t.length;++f)o[t[f]]=f;let s=r.length;for(;r[s-1]==="=";)--s;let i=new Uint8Array(s*e/8|0),a=0,c=0,u=0;for(let f=0;f<s;++f){let l=o[r[f]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<e|l,a+=e,a>=8&&(a-=8,i[u++]=255&c>>a)}if(a>=e||(255&c<<8-a)!==0)throw new SyntaxError("Unexpected end of data");return i}function $a(r,t,e){let n=t[t.length-1]==="=",o=(1<<e)-1,s="",i=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],i+=8;i>e;)i-=e,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<e-i]),n)for(;(s.length*e&7)!==0;)s+="=";return s}function rt({name:r,prefix:t,bitsPerChar:e,alphabet:n}){return Ee({prefix:t,name:r,encode(o){return $a(o,n,e)},decode(o){return Wa(o,n,e,r)}})}var nt=Xt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ja=Xt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Bn={};yt(Bn,{base32:()=>Se,base32hex:()=>rc,base32hexpad:()=>oc,base32hexpadupper:()=>sc,base32hexupper:()=>nc,base32pad:()=>tc,base32padupper:()=>ec,base32upper:()=>Qa,base32z:()=>ic});var Se=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Qa=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),tc=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ec=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rc=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),nc=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oc=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sc=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ic=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var vn={};yt(vn,{base36:()=>ze,base36upper:()=>ac});var ze=Xt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ac=Xt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var cc=Rs,Ts=128,fc=127,uc=~fc,hc=Math.pow(2,31);function Rs(r,t,e){t=t||[],e=e||0;for(var n=e;r>=hc;)t[e++]=r&255|Ts,r/=128;for(;r&uc;)t[e++]=r&255|Ts,r>>>=7;return t[e]=r|0,Rs.bytes=e-n+1,t}var lc=Ln,dc=128,Us=127;function Ln(r,n){var e=0,n=n||0,o=0,s=n,i,a=r.length;do{if(s>=a)throw Ln.bytes=0,new RangeError("Could not decode varint");i=r[s++],e+=o<28?(i&Us)<<o:(i&Us)*Math.pow(2,o),o+=7}while(i>=dc);return Ln.bytes=s-n,e}var pc=Math.pow(2,7),mc=Math.pow(2,14),yc=Math.pow(2,21),gc=Math.pow(2,28),xc=Math.pow(2,35),bc=Math.pow(2,42),wc=Math.pow(2,49),Ec=Math.pow(2,56),Sc=Math.pow(2,63),Ac=function(r){return r<pc?1:r<mc?2:r<yc?3:r<gc?4:r<xc?5:r<bc?6:r<wc?7:r<Ec?8:r<Sc?9:10},Bc={encode:cc,decode:lc,encodingLength:Ac},vc=Bc,Ge=vc;function Ze(r,t=0){return[Ge.decode(r,t),Ge.decode.bytes]}function Ae(r,t,e=0){return Ge.encode(r,t,e),t}function Be(r){return Ge.encodingLength(r)}function Lt(r,t){let e=t.byteLength,n=Be(r),o=n+Be(e),s=new Uint8Array(o+e);return Ae(r,s,0),Ae(e,s,n),s.set(t,o),new ve(r,e,t,s)}function In(r){let t=Pt(r),[e,n]=Ze(t),[o,s]=Ze(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new ve(e,o,i,t)}function Cs(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&As(r.bytes,e.bytes)}}var ve=class{code;size;digest;bytes;constructor(t,e,n,o){this.code=t,this.size=e,this.digest=n,this.bytes=o}};function Ns(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return Ic(e,_n(r),t??nt.encoder);default:return _c(e,_n(r),t??Se.encoder)}}var Ks=new WeakMap;function _n(r){let t=Ks.get(r);if(t==null){let e=new Map;return Ks.set(r,e),e}return t}var wt=class r{code;version;multihash;bytes;"/";constructor(t,e,n,o){this.code=e,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==Xe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==Tc)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=Lt(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&Cs(t.multihash,n.multihash)}toString(t){return Ns(this,t)}toJSON(){return{"/":Ns(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:o,multihash:s,bytes:i}=e;return new r(n,o,s,i??Ds(n,o,s.bytes))}else if(e[Uc]===!0){let{version:n,multihash:o,code:s}=e,i=In(o);return r.create(n,s,i)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==Xe)throw new Error(`Version 0 CID must use dag-pb (code: ${Xe}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let o=Ds(t,e,n.bytes);return new r(t,e,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,Xe,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,o=Pt(t.subarray(n,n+e.multihashSize));if(o.byteLength!==e.multihashSize)throw new Error("Incorrect length");let s=o.subarray(e.multihashSize-e.digestSize),i=new ve(e.multihashCode,e.digestSize,s,o);return[e.version===0?r.createV0(i):r.createV1(e.codec,i),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[l,p]=Ze(t.subarray(e));return e+=p,l},o=n(),s=Xe;if(o===18?(o=0,e=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=e,a=n(),c=n(),u=e+c,f=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:u}}static parse(t,e){let[n,o]=Lc(t,e),s=r.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return _n(s).set(n,t),s}};function Lc(r,t){switch(r[0]){case"Q":{let e=t??nt;return[nt.prefix,e.decode(`${nt.prefix}${r}`)]}case nt.prefix:{let e=t??nt;return[nt.prefix,e.decode(r)]}case Se.prefix:{let e=t??Se;return[Se.prefix,e.decode(r)]}case ze.prefix:{let e=t??ze;return[ze.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function Ic(r,t,e){let{prefix:n}=e;if(n!==nt.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let o=t.get(n);if(o==null){let s=e.encode(r).slice(1);return t.set(n,s),s}else return o}function _c(r,t,e){let{prefix:n}=e,o=t.get(n);if(o==null){let s=e.encode(r);return t.set(n,s),s}else return o}var Xe=112,Tc=18;function Ds(r,t,e){let n=Be(r),o=n+Be(t),s=new Uint8Array(o+e.byteLength);return Ae(r,s,0),Ae(t,s,n),s.set(e,o),s}var Uc=Symbol.for("@ipld/js-cid/CID");var Tn={};yt(Tn,{identity:()=>Yt});var Ps=0,Rc="identity",Ms=Pt;function Cc(r){return Lt(Ps,Ms(r))}var Yt={code:Ps,name:Rc,encode:Ms,digest:Cc};function Et(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function br(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Nc(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ie(r,...t){if(!Nc(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function Ye(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");br(r.outputLen),br(r.blockLen)}function _e(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function ks(r,t){Ie(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}var se=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function wr(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function It(r,t){return r<<32-t|r>>>t}function Os(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function jt(r){return typeof r=="string"&&(r=Os(r)),Ie(r),r}function Un(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ie(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}var Te=class{clone(){return this._cloneInto()}};function Er(r){let t=n=>r().update(jt(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function je(r=32){if(se&&typeof se.getRandomValues=="function")return se.getRandomValues(new Uint8Array(r));if(se&&typeof se.randomBytes=="function")return se.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function Kc(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,u=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+u,a,n)}function Hs(r,t,e){return r&t^~r&e}function qs(r,t,e){return r&t^r&e^t&e}var Ue=class extends Te{constructor(t,e,n,o){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=wr(this.buffer)}update(t){_e(this);let{view:e,buffer:n,blockLen:o}=this;t=jt(t);let s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=wr(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){_e(this),ks(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)e[l]=0;Kc(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=wr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],s)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=s,t.destroyed=i,o%e&&t.buffer.set(n),t}};var Sr=BigInt(4294967295),Rn=BigInt(32);function Vs(r,t=!1){return t?{h:Number(r&Sr),l:Number(r>>Rn&Sr)}:{h:Number(r>>Rn&Sr)|0,l:Number(r&Sr)|0}}function Dc(r,t=!1){let e=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let o=0;o<r.length;o++){let{h:s,l:i}=Vs(r[o],t);[e[o],n[o]]=[s,i]}return[e,n]}var Pc=(r,t)=>BigInt(r>>>0)<<Rn|BigInt(t>>>0),Mc=(r,t,e)=>r>>>e,kc=(r,t,e)=>r<<32-e|t>>>e,Oc=(r,t,e)=>r>>>e|t<<32-e,Hc=(r,t,e)=>r<<32-e|t>>>e,qc=(r,t,e)=>r<<64-e|t>>>e-32,Vc=(r,t,e)=>r>>>e-32|t<<64-e,Fc=(r,t)=>t,zc=(r,t)=>r,Gc=(r,t,e)=>r<<e|t>>>32-e,Zc=(r,t,e)=>t<<e|r>>>32-e,Xc=(r,t,e)=>t<<e-32|r>>>64-e,Yc=(r,t,e)=>r<<e-32|t>>>64-e;function jc(r,t,e,n){let o=(t>>>0)+(n>>>0);return{h:r+e+(o/2**32|0)|0,l:o|0}}var Wc=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),$c=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,Jc=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),Qc=(r,t,e,n,o)=>t+e+n+o+(r/2**32|0)|0,tf=(r,t,e,n,o)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(o>>>0),ef=(r,t,e,n,o,s)=>t+e+n+o+s+(r/2**32|0)|0;var rf={fromBig:Vs,split:Dc,toBig:Pc,shrSH:Mc,shrSL:kc,rotrSH:Oc,rotrSL:Hc,rotrBH:qc,rotrBL:Vc,rotr32H:Fc,rotr32L:zc,rotlSH:Gc,rotlSL:Zc,rotlBH:Xc,rotlBL:Yc,add:jc,add3L:Wc,add3H:$c,add4L:Jc,add4H:Qc,add5H:ef,add5L:tf},V=rf;var[nf,of]=V.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Wt=new Uint32Array(80),$t=new Uint32Array(80),Cn=class extends Ue{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:e,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:f,Fh:l,Fl:p,Gh:S,Gl:b,Hh:y,Hl:h}=this;return[t,e,n,o,s,i,a,c,u,f,l,p,S,b,y,h]}set(t,e,n,o,s,i,a,c,u,f,l,p,S,b,y,h){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=l|0,this.Fl=p|0,this.Gh=S|0,this.Gl=b|0,this.Hh=y|0,this.Hl=h|0}process(t,e){for(let d=0;d<16;d++,e+=4)Wt[d]=t.getUint32(e),$t[d]=t.getUint32(e+=4);for(let d=16;d<80;d++){let L=Wt[d-15]|0,R=$t[d-15]|0,U=V.rotrSH(L,R,1)^V.rotrSH(L,R,8)^V.shrSH(L,R,7),_=V.rotrSL(L,R,1)^V.rotrSL(L,R,8)^V.shrSL(L,R,7),T=Wt[d-2]|0,v=$t[d-2]|0,k=V.rotrSH(T,v,19)^V.rotrBH(T,v,61)^V.shrSH(T,v,6),K=V.rotrSL(T,v,19)^V.rotrBL(T,v,61)^V.shrSL(T,v,6),M=V.add4L(_,K,$t[d-7],$t[d-16]),H=V.add4H(M,U,k,Wt[d-7],Wt[d-16]);Wt[d]=H|0,$t[d]=M|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:f,Eh:l,El:p,Fh:S,Fl:b,Gh:y,Gl:h,Hh:g,Hl:w}=this;for(let d=0;d<80;d++){let L=V.rotrSH(l,p,14)^V.rotrSH(l,p,18)^V.rotrBH(l,p,41),R=V.rotrSL(l,p,14)^V.rotrSL(l,p,18)^V.rotrBL(l,p,41),U=l&S^~l&y,_=p&b^~p&h,T=V.add5L(w,R,_,of[d],$t[d]),v=V.add5H(T,g,L,U,nf[d],Wt[d]),k=T|0,K=V.rotrSH(n,o,28)^V.rotrBH(n,o,34)^V.rotrBH(n,o,39),M=V.rotrSL(n,o,28)^V.rotrBL(n,o,34)^V.rotrBL(n,o,39),H=n&s^n&a^s&a,B=o&i^o&c^i&c;g=y|0,w=h|0,y=S|0,h=b|0,S=l|0,b=p|0,{h:l,l:p}=V.add(u|0,f|0,v|0,k|0),u=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let I=V.add3L(k,M,B);n=V.add3H(I,v,K,H),o=I|0}({h:n,l:o}=V.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=V.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=V.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=V.add(this.Dh|0,this.Dl|0,u|0,f|0),{h:l,l:p}=V.add(this.Eh|0,this.El|0,l|0,p|0),{h:S,l:b}=V.add(this.Fh|0,this.Fl|0,S|0,b|0),{h:y,l:h}=V.add(this.Gh|0,this.Gl|0,y|0,h|0),{h:g,l:w}=V.add(this.Hh|0,this.Hl|0,g|0,w|0),this.set(n,o,s,i,a,c,u,f,l,p,S,b,y,h,g,w)}roundClean(){Wt.fill(0),$t.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Fs=Er(()=>new Cn);var vr={};yt(vr,{aInRange:()=>ct,abool:()=>_t,abytes:()=>Re,bitGet:()=>hf,bitLen:()=>Pn,bitMask:()=>$e,bitSet:()=>lf,bytesToHex:()=>kt,bytesToNumberBE:()=>Ot,bytesToNumberLE:()=>Tt,concatBytes:()=>qt,createHmacDrbg:()=>Mn,ensureBytes:()=>Y,equalBytes:()=>ff,hexToBytes:()=>ae,hexToNumber:()=>Dn,inRange:()=>We,isBytes:()=>Jt,memoized:()=>ce,notImplemented:()=>pf,numberToBytesBE:()=>Qt,numberToBytesLE:()=>Ht,numberToHexUnpadded:()=>ie,numberToVarBytesBE:()=>cf,utf8ToBytes:()=>uf,validateObject:()=>Bt});var Ar=BigInt(0),Br=BigInt(1),sf=BigInt(2);function Jt(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Re(r){if(!Jt(r))throw new Error("Uint8Array expected")}function _t(r,t){if(typeof t!="boolean")throw new Error(r+" boolean expected, got "+t)}var af=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function kt(r){Re(r);let t="";for(let e=0;e<r.length;e++)t+=af[r[e]];return t}function ie(r){let t=r.toString(16);return t.length&1?"0"+t:t}function Dn(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Ar:BigInt("0x"+r)}var Mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function zs(r){if(r>=Mt._0&&r<=Mt._9)return r-Mt._0;if(r>=Mt.A&&r<=Mt.F)return r-(Mt.A-10);if(r>=Mt.a&&r<=Mt.f)return r-(Mt.a-10)}function ae(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let t=r.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let o=0,s=0;o<e;o++,s+=2){let i=zs(r.charCodeAt(s)),a=zs(r.charCodeAt(s+1));if(i===void 0||a===void 0){let c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function Ot(r){return Dn(kt(r))}function Tt(r){return Re(r),Dn(kt(Uint8Array.from(r).reverse()))}function Qt(r,t){return ae(r.toString(16).padStart(t*2,"0"))}function Ht(r,t){return Qt(r,t).reverse()}function cf(r){return ae(ie(r))}function Y(r,t,e){let n;if(typeof t=="string")try{n=ae(t)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(Jt(t))n=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof e=="number"&&o!==e)throw new Error(r+" of length "+e+" expected, got "+o);return n}function qt(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Re(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}function ff(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}function uf(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}var Nn=r=>typeof r=="bigint"&&Ar<=r;function We(r,t,e){return Nn(r)&&Nn(t)&&Nn(e)&&t<=r&&r<e}function ct(r,t,e,n){if(!We(t,e,n))throw new Error("expected valid "+r+": "+e+" <= n < "+n+", got "+t)}function Pn(r){let t;for(t=0;r>Ar;r>>=Br,t+=1);return t}function hf(r,t){return r>>BigInt(t)&Br}function lf(r,t,e){return r|(e?Br:Ar)<<BigInt(t)}var $e=r=>(sf<<BigInt(r-1))-Br,Kn=r=>new Uint8Array(r),Gs=r=>Uint8Array.from(r);function Mn(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=Kn(r),o=Kn(r),s=0,i=()=>{n.fill(1),o.fill(0),s=0},a=(...l)=>e(o,n,...l),c=(l=Kn())=>{o=a(Gs([0]),l),n=a(),l.length!==0&&(o=a(Gs([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,p=[];for(;l<t;){n=a();let S=n.slice();p.push(S),l+=n.length}return qt(...p)};return(l,p)=>{i(),c(l);let S;for(;!(S=p(u()));)c();return i(),S}}var df={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Jt(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Bt(r,t,e={}){let n=(o,s,i)=>{let a=df[s];if(typeof a!="function")throw new Error("invalid validator function");let c=r[o];if(!(i&&c===void 0)&&!a(c,r))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+c)};for(let[o,s]of Object.entries(t))n(o,s,!1);for(let[o,s]of Object.entries(e))n(o,s,!0);return r}var pf=()=>{throw new Error("not implemented")};function ce(r){let t=new WeakMap;return(e,...n)=>{let o=t.get(e);if(o!==void 0)return o;let s=r(e,...n);return t.set(e,s),s}}var ot=BigInt(0),Q=BigInt(1),fe=BigInt(2),mf=BigInt(3),kn=BigInt(4),Zs=BigInt(5),Xs=BigInt(8),yf=BigInt(9),gf=BigInt(16);function G(r,t){let e=r%t;return e>=ot?e:t+e}function On(r,t,e){if(t<ot)throw new Error("invalid exponent, negatives unsupported");if(e<=ot)throw new Error("invalid modulus");if(e===Q)return ot;let n=Q;for(;t>ot;)t&Q&&(n=n*r%e),r=r*r%e,t>>=Q;return n}function $(r,t,e){let n=r;for(;t-- >ot;)n*=n,n%=e;return n}function Lr(r,t){if(r===ot)throw new Error("invert: expected non-zero number");if(t<=ot)throw new Error("invert: expected positive modulus, got "+t);let e=G(r,t),n=t,o=ot,s=Q,i=Q,a=ot;for(;e!==ot;){let u=n/e,f=n%e,l=o-i*u,p=s-a*u;n=e,e=f,o=i,s=a,i=l,a=p}if(n!==Q)throw new Error("invert: does not exist");return G(o,t)}function xf(r){let t=(r-Q)/fe,e,n,o;for(e=r-Q,n=0;e%fe===ot;e/=fe,n++);for(o=fe;o<r&&On(o,t,r)!==r-Q;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let i=(r+Q)/kn;return function(c,u){let f=c.pow(u,i);if(!c.eql(c.sqr(f),u))throw new Error("Cannot find square root");return f}}let s=(e+Q)/fe;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,f=a.pow(a.mul(a.ONE,o),e),l=a.pow(c,s),p=a.pow(c,e);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let S=1;for(let y=a.sqr(p);S<u&&!a.eql(y,a.ONE);S++)y=a.sqr(y);let b=a.pow(f,Q<<BigInt(u-S-1));f=a.sqr(b),l=a.mul(l,b),p=a.mul(p,f),u=S}return l}}function bf(r){if(r%kn===mf){let t=(r+Q)/kn;return function(n,o){let s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(r%Xs===Zs){let t=(r-Zs)/Xs;return function(n,o){let s=n.mul(o,fe),i=n.pow(s,t),a=n.mul(o,i),c=n.mul(n.mul(a,fe),i),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return r%gf,xf(r)}var Ys=(r,t)=>(G(r,t)&Q)===Q,wf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Hn(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=wf.reduce((n,o)=>(n[o]="function",n),t);return Bt(r,e)}function Ef(r,t,e){if(e<ot)throw new Error("invalid exponent, negatives unsupported");if(e===ot)return r.ONE;if(e===Q)return t;let n=r.ONE,o=t;for(;e>ot;)e&Q&&(n=r.mul(n,o)),o=r.sqr(o),e>>=Q;return n}function Sf(r,t){let e=new Array(t.length),n=t.reduce((s,i,a)=>r.is0(i)?s:(e[a]=s,r.mul(s,i)),r.ONE),o=r.inv(n);return t.reduceRight((s,i,a)=>r.is0(i)?s:(e[a]=r.mul(s,e[a]),r.mul(s,i)),o),e}function qn(r,t){let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function te(r,t,e=!1,n={}){if(r<=ot)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:s}=qn(r,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let i,a=Object.freeze({ORDER:r,isLE:e,BITS:o,BYTES:s,MASK:$e(o),ZERO:ot,ONE:Q,create:c=>G(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ot<=c&&c<r},is0:c=>c===ot,isOdd:c=>(c&Q)===Q,neg:c=>G(-c,r),eql:(c,u)=>c===u,sqr:c=>G(c*c,r),add:(c,u)=>G(c+u,r),sub:(c,u)=>G(c-u,r),mul:(c,u)=>G(c*u,r),pow:(c,u)=>Ef(a,c,u),div:(c,u)=>G(c*Lr(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Lr(c,r),sqrt:n.sqrt||(c=>(i||(i=bf(r)),i(a,c))),invertBatch:c=>Sf(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>e?Ht(c,s):Qt(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return e?Tt(c):Ot(c)}});return Object.freeze(a)}function js(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function Vn(r){let t=js(r);return t+Math.ceil(t/2)}function Ws(r,t,e=!1){let n=r.length,o=js(t),s=Vn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=e?Tt(r):Ot(r),a=G(i,t-Q)+Q;return e?Ht(a,o):Qt(a,o)}var $s=BigInt(0),Ir=BigInt(1);function Fn(r,t){let e=t.negate();return r?e:t}function Js(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function zn(r,t){Js(r,t);let e=Math.ceil(t/r)+1,n=2**(r-1);return{windows:e,windowSize:n}}function Af(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function Bf(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}var Gn=new WeakMap,Qs=new WeakMap;function Zn(r){return Qs.get(r)||1}function _r(r,t){return{constTimeNegate:Fn,hasPrecomputes(e){return Zn(e)!==1},unsafeLadder(e,n,o=r.ZERO){let s=e;for(;n>$s;)n&Ir&&(o=o.add(s)),s=s.double(),n>>=Ir;return o},precomputeWindow(e,n){let{windows:o,windowSize:s}=zn(n,t),i=[],a=e,c=a;for(let u=0;u<o;u++){c=a,i.push(c);for(let f=1;f<s;f++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(e,n,o){let{windows:s,windowSize:i}=zn(e,t),a=r.ZERO,c=r.BASE,u=BigInt(2**e-1),f=2**e,l=BigInt(e);for(let p=0;p<s;p++){let S=p*i,b=Number(o&u);o>>=l,b>i&&(b-=f,o+=Ir);let y=S,h=S+Math.abs(b)-1,g=p%2!==0,w=b<0;b===0?c=c.add(Fn(g,n[y])):a=a.add(Fn(w,n[h]))}return{p:a,f:c}},wNAFUnsafe(e,n,o,s=r.ZERO){let{windows:i,windowSize:a}=zn(e,t),c=BigInt(2**e-1),u=2**e,f=BigInt(e);for(let l=0;l<i;l++){let p=l*a;if(o===$s)break;let S=Number(o&c);if(o>>=f,S>a&&(S-=u,o+=Ir),S===0)continue;let b=n[p+Math.abs(S)-1];S<0&&(b=b.negate()),s=s.add(b)}return s},getPrecomputes(e,n,o){let s=Gn.get(n);return s||(s=this.precomputeWindow(n,e),e!==1&&Gn.set(n,o(s))),s},wNAFCached(e,n,o){let s=Zn(e);return this.wNAF(s,this.getPrecomputes(s,e,o),n)},wNAFCachedUnsafe(e,n,o,s){let i=Zn(e);return i===1?this.unsafeLadder(e,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,o),n,s)},setWindowSize(e,n){Js(n,t),Qs.set(e,n),Gn.delete(e)}}}function Tr(r,t,e,n){if(Af(e,r),Bf(n,t),e.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,s=Pn(BigInt(e.length)),i=s>12?s-3:s>4?s-2:s?2:1,a=(1<<i)-1,c=new Array(a+1).fill(o),u=Math.floor((t.BITS-1)/i)*i,f=o;for(let l=u;l>=0;l-=i){c.fill(o);for(let S=0;S<n.length;S++){let b=n[S],y=Number(b>>BigInt(l)&BigInt(a));c[y]=c[y].add(e[S])}let p=o;for(let S=c.length-1,b=o;S>0;S--)b=b.add(c[S]),p=p.add(b);if(f=f.add(p),l!==0)for(let S=0;S<i;S++)f=f.double()}return f}function Je(r){return Hn(r.Fp),Bt(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...qn(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Ut=BigInt(0),bt=BigInt(1),Ur=BigInt(2),vf=BigInt(8),Lf={zip215:!0};function If(r){let t=Je(r);return Bt(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function ti(r){let t=If(r),{Fp:e,n,prehash:o,hash:s,randomBytes:i,nByteLength:a,h:c}=t,u=Ur<<BigInt(a*8)-bt,f=e.create,l=te(t.n,t.nBitLength),p=t.uvRatio||((x,m)=>{try{return{isValid:!0,value:e.sqrt(x*e.inv(m))}}catch{return{isValid:!1,value:Ut}}}),S=t.adjustScalarBytes||(x=>x),b=t.domain||((x,m,A)=>{if(_t("phflag",A),m.length||A)throw new Error("Contexts/pre-hash are not supported");return x});function y(x,m){ct("coordinate "+x,m,Ut,u)}function h(x){if(!(x instanceof d))throw new Error("ExtendedPoint expected")}let g=ce((x,m)=>{let{ex:A,ey:E,ez:C}=x,N=x.is0();m==null&&(m=N?vf:e.inv(C));let P=f(A*m),q=f(E*m),O=f(C*m);if(N)return{x:Ut,y:bt};if(O!==bt)throw new Error("invZ was invalid");return{x:P,y:q}}),w=ce(x=>{let{a:m,d:A}=t;if(x.is0())throw new Error("bad point: ZERO");let{ex:E,ey:C,ez:N,et:P}=x,q=f(E*E),O=f(C*C),F=f(N*N),z=f(F*F),j=f(q*m),W=f(F*f(j+O)),J=f(z+f(A*f(q*O)));if(W!==J)throw new Error("bad point: equation left != right (1)");let ht=f(E*C),xt=f(N*P);if(ht!==xt)throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(m,A,E,C){this.ex=m,this.ey=A,this.ez=E,this.et=C,y("x",m),y("y",A),y("z",E),y("t",C),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof d)throw new Error("extended point not allowed");let{x:A,y:E}=m||{};return y("x",A),y("y",E),new d(A,E,bt,f(A*E))}static normalizeZ(m){let A=e.invertBatch(m.map(E=>E.ez));return m.map((E,C)=>E.toAffine(A[C])).map(d.fromAffine)}static msm(m,A){return Tr(d,l,m,A)}_setWindowSize(m){U.setWindowSize(this,m)}assertValidity(){w(this)}equals(m){h(m);let{ex:A,ey:E,ez:C}=this,{ex:N,ey:P,ez:q}=m,O=f(A*q),F=f(N*C),z=f(E*q),j=f(P*C);return O===F&&z===j}is0(){return this.equals(d.ZERO)}negate(){return new d(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){let{a:m}=t,{ex:A,ey:E,ez:C}=this,N=f(A*A),P=f(E*E),q=f(Ur*f(C*C)),O=f(m*N),F=A+E,z=f(f(F*F)-N-P),j=O+P,W=j-q,J=O-P,ht=f(z*W),xt=f(j*J),mt=f(z*J),Nt=f(W*j);return new d(ht,xt,Nt,mt)}add(m){h(m);let{a:A,d:E}=t,{ex:C,ey:N,ez:P,et:q}=this,{ex:O,ey:F,ez:z,et:j}=m;if(A===BigInt(-1)){let ms=f((N-C)*(F+O)),ys=f((N+C)*(F-O)),yn=f(ys-ms);if(yn===Ut)return this.double();let gs=f(P*Ur*j),xs=f(q*Ur*z),bs=xs+gs,ws=ys+ms,Es=xs-gs,ka=f(bs*yn),Oa=f(ws*Es),Ha=f(bs*Es),qa=f(yn*ws);return new d(ka,Oa,qa,Ha)}let W=f(C*O),J=f(N*F),ht=f(q*E*j),xt=f(P*z),mt=f((C+N)*(O+F)-W-J),Nt=xt-ht,Dt=xt+ht,Fe=f(J-A*W),Ka=f(mt*Nt),Da=f(Dt*Fe),Pa=f(mt*Fe),Ma=f(Nt*Dt);return new d(Ka,Da,Ma,Pa)}subtract(m){return this.add(m.negate())}wNAF(m){return U.wNAFCached(this,m,d.normalizeZ)}multiply(m){let A=m;ct("scalar",A,bt,n);let{p:E,f:C}=this.wNAF(A);return d.normalizeZ([E,C])[0]}multiplyUnsafe(m,A=d.ZERO){let E=m;return ct("scalar",E,Ut,n),E===Ut?R:this.is0()||E===bt?this:U.wNAFCachedUnsafe(this,E,d.normalizeZ,A)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return U.unsafeLadder(this,n).is0()}toAffine(m){return g(this,m)}clearCofactor(){let{h:m}=t;return m===bt?this:this.multiplyUnsafe(m)}static fromHex(m,A=!1){let{d:E,a:C}=t,N=e.BYTES;m=Y("pointHex",m,N),_t("zip215",A);let P=m.slice(),q=m[N-1];P[N-1]=q&-129;let O=Tt(P),F=A?u:e.ORDER;ct("pointHex.y",O,Ut,F);let z=f(O*O),j=f(z-bt),W=f(E*z-C),{isValid:J,value:ht}=p(j,W);if(!J)throw new Error("Point.fromHex: invalid y coordinate");let xt=(ht&bt)===bt,mt=(q&128)!==0;if(!A&&ht===Ut&&mt)throw new Error("Point.fromHex: x=0 and x_0=1");return mt!==xt&&(ht=f(-ht)),d.fromAffine({x:ht,y:O})}static fromPrivateKey(m){return v(m).point}toRawBytes(){let{x:m,y:A}=this.toAffine(),E=Ht(A,e.BYTES);return E[E.length-1]|=m&bt?128:0,E}toHex(){return kt(this.toRawBytes())}}d.BASE=new d(t.Gx,t.Gy,bt,f(t.Gx*t.Gy)),d.ZERO=new d(Ut,bt,bt,Ut);let{BASE:L,ZERO:R}=d,U=_r(d,a*8);function _(x){return G(x,n)}function T(x){return _(Tt(x))}function v(x){let m=e.BYTES;x=Y("private key",x,m);let A=Y("hashed private key",s(x),2*m),E=S(A.slice(0,m)),C=A.slice(m,2*m),N=T(E),P=L.multiply(N),q=P.toRawBytes();return{head:E,prefix:C,scalar:N,point:P,pointBytes:q}}function k(x){return v(x).pointBytes}function K(x=new Uint8Array,...m){let A=qt(...m);return T(s(b(A,Y("context",x),!!o)))}function M(x,m,A={}){x=Y("message",x),o&&(x=o(x));let{prefix:E,scalar:C,pointBytes:N}=v(m),P=K(A.context,E,x),q=L.multiply(P).toRawBytes(),O=K(A.context,q,N,x),F=_(P+O*C);ct("signature.s",F,Ut,n);let z=qt(q,Ht(F,e.BYTES));return Y("result",z,e.BYTES*2)}let H=Lf;function B(x,m,A,E=H){let{context:C,zip215:N}=E,P=e.BYTES;x=Y("signature",x,2*P),m=Y("message",m),A=Y("publicKey",A,P),N!==void 0&&_t("zip215",N),o&&(m=o(m));let q=Tt(x.slice(P,2*P)),O,F,z;try{O=d.fromHex(A,N),F=d.fromHex(x.slice(0,P),N),z=L.multiplyUnsafe(q)}catch{return!1}if(!N&&O.isSmallOrder())return!1;let j=K(C,F.toRawBytes(),O.toRawBytes(),m);return F.add(O.multiplyUnsafe(j)).subtract(z).clearCofactor().equals(d.ZERO)}return L._setWindowSize(8),{CURVE:t,getPublicKey:k,sign:M,verify:B,ExtendedPoint:d,utils:{getExtendedPublicKey:v,randomPrivateKey:()=>i(e.BYTES),precompute(x=8,m=d.BASE){return m._setWindowSize(x),m.multiply(BigInt(3)),m}}}}var Ce=BigInt(0),Xn=BigInt(1);function _f(r){return Bt(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function ei(r){let t=_f(r),{P:e}=t,n=w=>G(w,e),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,a=t.adjustScalarBytes||(w=>w),c=t.powPminus2||(w=>On(w,e-BigInt(2),e));function u(w,d,L){let R=n(w*(d-L));return d=n(d-R),L=n(L+R),[d,L]}let f=(t.a-BigInt(2))/BigInt(4);function l(w,d){ct("u",w,Ce,e),ct("scalar",d,Ce,e);let L=d,R=w,U=Xn,_=Ce,T=w,v=Xn,k=Ce,K;for(let H=BigInt(o-1);H>=Ce;H--){let B=L>>H&Xn;k^=B,K=u(k,U,T),U=K[0],T=K[1],K=u(k,_,v),_=K[0],v=K[1],k=B;let I=U+_,x=n(I*I),m=U-_,A=n(m*m),E=x-A,C=T+v,N=T-v,P=n(N*I),q=n(C*m),O=P+q,F=P-q;T=n(O*O),v=n(R*n(F*F)),U=n(x*A),_=n(E*(x+n(f*E)))}K=u(k,U,T),U=K[0],T=K[1],K=u(k,_,v),_=K[0],v=K[1];let M=c(_);return n(U*M)}function p(w){return Ht(n(w),s)}function S(w){let d=Y("u coordinate",w,s);return i===32&&(d[31]&=127),Tt(d)}function b(w){let d=Y("scalar",w),L=d.length;if(L!==s&&L!==i){let R=""+s+" or "+i;throw new Error("invalid scalar, expected "+R+" bytes, got "+L)}return Tt(a(d))}function y(w,d){let L=S(d),R=b(w),U=l(L,R);if(U===Ce)throw new Error("invalid private or public key received");return p(U)}let h=p(t.Gu);function g(w){return y(w,h)}return{scalarMult:y,scalarMultBase:g,getSharedSecret:(w,d)=>y(w,d),getPublicKey:w=>g(w),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:h}}var Qe=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ri=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Nl=BigInt(0),Tf=BigInt(1),ni=BigInt(2),Uf=BigInt(3),Rf=BigInt(5),Cf=BigInt(8);function oi(r){let t=BigInt(10),e=BigInt(20),n=BigInt(40),o=BigInt(80),s=Qe,a=r*r%s*r%s,c=$(a,ni,s)*a%s,u=$(c,Tf,s)*r%s,f=$(u,Rf,s)*u%s,l=$(f,t,s)*f%s,p=$(l,e,s)*l%s,S=$(p,n,s)*p%s,b=$(S,o,s)*S%s,y=$(b,o,s)*S%s,h=$(y,t,s)*f%s;return{pow_p_5_8:$(h,ni,s)*r%s,b2:a}}function si(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Nf(r,t){let e=Qe,n=G(t*t*t,e),o=G(n*n*t,e),s=oi(r*o).pow_p_5_8,i=G(r*n*s,e),a=G(t*i*i,e),c=i,u=G(i*ri,e),f=a===r,l=a===G(-r,e),p=a===G(-r*ri,e);return f&&(i=c),(l||p)&&(i=u),Ys(i,e)&&(i=G(-i,e)),{isValid:f||l,value:i}}var Kf=te(Qe,void 0,!0),Df={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Kf,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Cf,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Fs,randomBytes:je,adjustScalarBytes:si,uvRatio:Nf},ii=ti(Df);var tr=ei({P:Qe,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let t=Qe,{pow_p_5_8:e,b2:n}=oi(r);return G($(e,Uf,t)*n,t)},adjustScalarBytes:si,randomBytes:je});var Rr=32;function ai(r,t,e){return ii.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}var Cr=class{type="Ed25519";raw;constructor(t){this.raw=Yn(t,Rr)}toMultihash(){return Yt.digest(Ne(this))}toCID(){return wt.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Et(this.raw,t.raw)}verify(t,e){return ai(this.raw,e,t)}};function fi(r){return r=Yn(r,Rr),new Cr(r)}function Yn(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new gt(`Key must be a Uint8Array of length ${t}, got ${r.length}`);return r}function st(r=0){return new Uint8Array(r)}function it(r=0){return new Uint8Array(r)}var Mf=Math.pow(2,7),kf=Math.pow(2,14),Of=Math.pow(2,21),jn=Math.pow(2,28),Wn=Math.pow(2,35),$n=Math.pow(2,42),Jn=Math.pow(2,49),Z=128,lt=127;function St(r){if(r<Mf)return 1;if(r<kf)return 2;if(r<Of)return 3;if(r<jn)return 4;if(r<Wn)return 5;if(r<$n)return 6;if(r<Jn)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Qn(r,t,e=0){switch(St(r)){case 8:t[e++]=r&255|Z,r/=128;case 7:t[e++]=r&255|Z,r/=128;case 6:t[e++]=r&255|Z,r/=128;case 5:t[e++]=r&255|Z,r/=128;case 4:t[e++]=r&255|Z,r>>>=7;case 3:t[e++]=r&255|Z,r>>>=7;case 2:t[e++]=r&255|Z,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function Hf(r,t,e=0){switch(St(r)){case 8:t.set(e++,r&255|Z),r/=128;case 7:t.set(e++,r&255|Z),r/=128;case 6:t.set(e++,r&255|Z),r/=128;case 5:t.set(e++,r&255|Z),r/=128;case 4:t.set(e++,r&255|Z),r>>>=7;case 3:t.set(e++,r&255|Z),r>>>=7;case 2:t.set(e++,r&255|Z),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function to(r,t){let e=r[t],n=0;if(n+=e&lt,e<Z||(e=r[t+1],n+=(e&lt)<<7,e<Z)||(e=r[t+2],n+=(e&lt)<<14,e<Z)||(e=r[t+3],n+=(e&lt)<<21,e<Z)||(e=r[t+4],n+=(e&lt)*jn,e<Z)||(e=r[t+5],n+=(e&lt)*Wn,e<Z)||(e=r[t+6],n+=(e&lt)*$n,e<Z)||(e=r[t+7],n+=(e&lt)*Jn,e<Z))return n;throw new RangeError("Could not decode varint")}function qf(r,t){let e=r.get(t),n=0;if(n+=e&lt,e<Z||(e=r.get(t+1),n+=(e&lt)<<7,e<Z)||(e=r.get(t+2),n+=(e&lt)<<14,e<Z)||(e=r.get(t+3),n+=(e&lt)<<21,e<Z)||(e=r.get(t+4),n+=(e&lt)*jn,e<Z)||(e=r.get(t+5),n+=(e&lt)*Wn,e<Z)||(e=r.get(t+6),n+=(e&lt)*$n,e<Z)||(e=r.get(t+7),n+=(e&lt)*Jn,e<Z))return n;throw new RangeError("Could not decode varint")}function Nr(r,t,e=0){return t==null&&(t=it(St(r))),t instanceof Uint8Array?Qn(r,t,e):Hf(r,t,e)}function Kr(r,t=0){return r instanceof Uint8Array?to(r,t):qf(r,t)}var ro=new Float32Array([-0]),ee=new Uint8Array(ro.buffer);function ui(r,t,e){ro[0]=r,t[e]=ee[0],t[e+1]=ee[1],t[e+2]=ee[2],t[e+3]=ee[3]}function hi(r,t){return ee[0]=r[t],ee[1]=r[t+1],ee[2]=r[t+2],ee[3]=r[t+3],ro[0]}var no=new Float64Array([-0]),dt=new Uint8Array(no.buffer);function li(r,t,e){no[0]=r,t[e]=dt[0],t[e+1]=dt[1],t[e+2]=dt[2],t[e+3]=dt[3],t[e+4]=dt[4],t[e+5]=dt[5],t[e+6]=dt[6],t[e+7]=dt[7]}function di(r,t){return dt[0]=r[t],dt[1]=r[t+1],dt[2]=r[t+2],dt[3]=r[t+3],dt[4]=r[t+4],dt[5]=r[t+5],dt[6]=r[t+6],dt[7]=r[t+7],no[0]}var Vf=BigInt(Number.MAX_SAFE_INTEGER),Ff=BigInt(Number.MIN_SAFE_INTEGER),At=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return ue;if(t<Vf&&t>Ff)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,o=t-(n<<32n);return e&&(n=~n|0n,o=~o|0n,++o>pi&&(o=0n,++n>pi&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(t){if(t===0)return ue;let e=t<0;e&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return e&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):ue}},ue=new At(0,0);ue.toBigInt=function(){return 0n};ue.zzEncode=ue.zzDecode=function(){return this};ue.length=function(){return 1};var pi=4294967296n;function mi(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function yi(r,t,e){if(e-t<1)return"";let o,s=[],i=0,a;for(;t<e;)a=r[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|r[t++]&63:a>239&&a<365?(a=((a&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(r[t++]&63)<<6|r[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function oo(r,t,e){let n=e,o,s;for(let i=0;i<r.length;++i)o=r.charCodeAt(i),o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&((s=r.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128);return e-n}function Rt(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function Dr(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var so=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Rt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Rt(this,4);return Dr(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Rt(this,4);return Dr(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Rt(this,4);let t=hi(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Rt(this,4);let t=di(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw Rt(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return yi(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Rt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Rt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new At(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Rt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Rt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Rt(this,8);let t=Dr(this.buf,this.pos+=4),e=Dr(this.buf,this.pos+=4);return new At(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=to(this.buf,this.pos);return this.pos+=St(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function io(r){return new so(r instanceof Uint8Array?r:r.subarray())}function he(r,t,e){let n=io(r);return t.decode(n,void 0,e)}var ao={};yt(ao,{base10:()=>zf});var zf=Xt({prefix:"9",name:"base10",alphabet:"0123456789"});var co={};yt(co,{base16:()=>Gf,base16upper:()=>Zf});var Gf=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zf=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fo={};yt(fo,{base2:()=>Xf});var Xf=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var uo={};yt(uo,{base256emoji:()=>Jf});var xi=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Yf=xi.reduce((r,t,e)=>(r[e]=t,r),[]),jf=xi.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function Wf(r){return r.reduce((t,e)=>(t+=Yf[e],t),"")}function $f(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let o=jf[n];if(o==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(o)}return new Uint8Array(t)}var Jf=Ee({prefix:"\u{1F680}",name:"base256emoji",encode:Wf,decode:$f});var ho={};yt(ho,{base64:()=>Qf,base64pad:()=>tu,base64url:()=>eu,base64urlpad:()=>ru});var Qf=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tu=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),eu=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ru=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var lo={};yt(lo,{base8:()=>nu});var nu=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var po={};yt(po,{identity:()=>ou});var ou=Ee({prefix:"\0",name:"identity",encode:r=>vs(r),decode:r=>Bs(r)});var md=new TextEncoder,yd=new TextDecoder;var go={};yt(go,{sha256:()=>Pr,sha512:()=>au});function yo({name:r,code:t,encode:e}){return new mo(r,t,e)}var mo=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?Lt(this.code,e):e.then(n=>Lt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function wi(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var Pr=yo({name:"sha2-256",code:18,encode:wi("SHA-256")}),au=yo({name:"sha2-512",code:19,encode:wi("SHA-512")});var xo={...po,...fo,...lo,...ao,...co,...Bn,...vn,...An,...ho,...uo},_d={...go,...Tn};function Si(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var Ei=Si("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),bo=Si("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=it(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),cu={utf8:Ei,"utf-8":Ei,hex:xo.base16,latin1:bo,ascii:bo,binary:bo,...xo},Mr=cu;function et(r,t="utf8"){let e=Mr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function wo(r){let t=r??8192,e=t>>>1,n,o=t;return function(i){if(i<1||i>e)return it(i);o+i>t&&(n=it(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var le=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function Eo(){}var Ao=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},fu=wo();function uu(r){return globalThis.Buffer!=null?it(r):fu(r)}var rr=class{len;head;tail;states;constructor(){this.len=0,this.head=new le(Eo,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new le(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Bo((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(kr,10,At.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=At.fromBigInt(t);return this._push(kr,e.length(),e)}uint64Number(t){return this._push(Qn,St(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=At.fromBigInt(t).zzEncode();return this._push(kr,e.length(),e)}sint64Number(t){let e=At.fromNumber(t).zzEncode();return this._push(kr,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(So,1,t?1:0)}fixed32(t){return this._push(er,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=At.fromBigInt(t);return this._push(er,4,e.lo)._push(er,4,e.hi)}fixed64Number(t){let e=At.fromNumber(t);return this._push(er,4,e.lo)._push(er,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(ui,4,t)}double(t){return this._push(li,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(So,1,0):this.uint32(e)._push(lu,e,t)}string(t){let e=mi(t);return e!==0?this.uint32(e)._push(oo,e,t):this._push(So,1,0)}fork(){return this.states=new Ao(this),this.head=this.tail=new le(Eo,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new le(Eo,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=uu(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function So(r,t,e){t[e]=r&255}function hu(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var Bo=class extends le{next;constructor(t,e){super(hu,t,e),this.next=void 0}};function kr(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function er(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function lu(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(rr.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(du,t,r),this},rr.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(pu,t,r),this});function du(r,t,e){t.set(r,e)}function pu(r,t,e){r.length<40?oo(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(et(r),e)}function vo(){return new rr}function de(r,t){let e=vo();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var Ke;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Ke||(Ke={}));function Or(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function Lo(r){function t(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let e=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return Or("enum",Ke.VARINT,e,n)}function pe(r,t){return Or("message",Ke.LENGTH_DELIMITED,r,t)}var nr=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var ft;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1"})(ft||(ft={}));var Io;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1"})(Io||(Io={}));(function(r){r.codec=()=>Lo(Io)})(ft||(ft={}));var Vt;(function(r){let t;r.codec=()=>(t==null&&(t=pe((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),ft.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=ft.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>de(e,r.codec()),r.decode=(e,n)=>he(e,r.codec(),n)})(Vt||(Vt={}));var _o;(function(r){let t;r.codec=()=>(t==null&&(t=pe((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),ft.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.Type=ft.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>de(e,r.codec()),r.decode=(e,n)=>he(e,r.codec(),n)})(_o||(_o={}));var ir={};yt(ir,{MAX_RSA_KEY_SIZE:()=>No,generateRSAKeyPair:()=>Mi,jwkToJWKKeyPair:()=>ki,jwkToPkcs1:()=>Iu,jwkToPkix:()=>Do,jwkToRSAPrivateKey:()=>Pi,pkcs1ToJwk:()=>Ni,pkcs1ToRSAPrivateKey:()=>Di,pkixToJwk:()=>Ki,pkixToRSAPublicKey:()=>Po});var mu=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),re=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ne=new Uint32Array(64),To=class extends Ue{constructor(){super(64,32,8,!1),this.A=re[0]|0,this.B=re[1]|0,this.C=re[2]|0,this.D=re[3]|0,this.E=re[4]|0,this.F=re[5]|0,this.G=re[6]|0,this.H=re[7]|0}get(){let{A:t,B:e,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,e,n,o,s,i,a,c]}set(t,e,n,o,s,i,a,c){this.A=t|0,this.B=e|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,e){for(let l=0;l<16;l++,e+=4)ne[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){let p=ne[l-15],S=ne[l-2],b=It(p,7)^It(p,18)^p>>>3,y=It(S,17)^It(S,19)^S>>>10;ne[l]=y+ne[l-7]+b+ne[l-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let p=It(a,6)^It(a,11)^It(a,25),S=f+p+Hs(a,c,u)+mu[l]+ne[l]|0,y=(It(n,2)^It(n,13)^It(n,22))+qs(n,o,s)|0;f=u,u=c,c=a,a=i+S|0,i=s,s=o,o=n,n=S+y|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,u,f)}roundClean(){ne.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Kt=Er(()=>new To);function tt(r,t="utf8"){let e=Mr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.encoder.encode(r).substring(1)}function me(r,t){t==null&&(t=r.reduce((o,s)=>o+s.length,0));let e=it(t),n=0;for(let o of r)e.set(o,n),n+=o.length;return e}var vi=Symbol.for("@achingbrain/uint8arraylist");function Bi(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let o=e+n.byteLength;if(t<o)return{buf:n,index:t-e};e=o}throw new RangeError("index is out of bounds")}function Hr(r){return!!r?.[vi]}var X=class r{bufs;length;[vi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(Hr(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(Hr(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=Bi(this.bufs,t);return e.buf[e.index]}set(t,e){let n=Bi(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(Hr(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:o}=this._subList(t,e);return me(n,o)}subarray(t,e){let{bufs:n,length:o}=this._subList(t,e);return n.length===1?n[0]:me(n,o)}sublist(t,e){let{bufs:n,length:o}=this._subList(t,e),s=new r;return s.length=o,s.bufs=[...n],s}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let u=t>=a&&t<c,f=e>a&&e<=c;if(u&&f){if(t===a&&e===c){n.push(i);break}let l=t-a;n.push(i.subarray(l,l+(e-t)));break}if(u){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(e===c){n.push(i);break}n.push(i.subarray(0,e-a));break}n.push(i)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!Hr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,f;for(let l=e;l<=c;l+=f){f=0;for(let p=u;p>=0;p--){let S=this.get(l+p);if(n[p]!==S){f=Math.max(1,p-a[S]);break}}if(f===0)return l}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let o=st(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,e,n),this.write(o,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,e,n),this.write(o,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,e,n),this.write(o,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let o=st(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,e,n),this.write(o,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,e,n),this.write(o,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,e,n),this.write(o,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let o=st(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,e,n),this.write(o,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let o=st(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,e,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!Et(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((o,s)=>o+s.byteLength,0)),n.length=e,n}};var gu=parseInt("11111",2),Ro=parseInt("10000000",2),xu=parseInt("01111111",2),Li={2:bu,3:Su,5:Eu,6:wu,16:Uo,22:Uo,48:Uo};function or(r,t={offset:0}){let e=r[t.offset]&gu;if(t.offset++,Li[e]!=null)return Li[e](r,t);throw new Error("No decoder for tag "+e)}function qr(r,t){let e=0;if((r[t.offset]&Ro)===Ro){let n=r[t.offset]&xu,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=r[t.offset].toString(16).padStart(2,"0");e=parseInt(o,16)}else e=r[t.offset],t.offset++;return e}function Uo(r,t){qr(r,t);let e=[];for(;!(t.offset>=r.byteLength);){let n=or(r,t);if(n===null)break;e.push(n)}return e}function bu(r,t){let e=qr(r,t),n=t.offset,o=t.offset+e,s=[];for(let i=n;i<o;i++)i===n&&r[i]===0||s.push(r[i]);return t.offset+=e,Uint8Array.from(s)}function wu(r,t){let e=qr(r,t);return t.offset+=e,["oid-unimplemented"]}function Eu(r,t){return t.offset++,null}function Su(r,t){let e=qr(r,t),n=r[t.offset];t.offset++;let o=r.subarray(t.offset,t.offset+e);if(t.offset+=e,n!==0)throw new Error("Unused bits in bit string is unimplemented");return or(o,{offset:0})}function Au(r){let t=r.toString(16);t.length%2===1&&(t="0"+t);let e=new X;for(let n=0;n<t.length;n+=2)e.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return e}function Co(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let t=Au(r.byteLength);return new X(Uint8Array.from([t.byteLength|Ro]),t)}function vt(r){let t=new X,e=parseInt("10000000",2);return(r.subarray()[0]&e)===e&&t.append(Uint8Array.from([0])),t.append(r),new X(Uint8Array.from([2]),Co(t),t)}function Ii(r){let t=Uint8Array.from([0]),e=new X(t,r);return new X(Uint8Array.from([3]),Co(e),e)}function Vr(r){let t=new X;for(let e of r)t.append(e);return new X(Uint8Array.from([48]),Co(t),t)}var sr=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},Fr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var _i={get(r=globalThis){let t=r.crypto;if(t?.subtle==null)throw new Fr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var oe=_i;async function Ti(r){let t=await oe.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await Bu(t);return{privateKey:e[0],publicKey:e[1]}}async function Ui(r,t){let e=await oe.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await oe.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function Ri(r,t,e){let n=await oe.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return oe.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function Bu(r){if(r.privateKey==null||r.publicKey==null)throw new gt("Private and public key are required");return Promise.all([oe.get().subtle.exportKey("jwk",r.privateKey),oe.get().subtle.exportKey("jwk",r.publicKey)])}function Ci(r){if(r.kty!=="RSA")throw new gt("invalid key type");if(r.n==null)throw new gt("invalid key modulus");return et(r.n,"base64url").length*8}var De=class{type="RSA";_key;_raw;_multihash;constructor(t,e){this._key=t,this._multihash=e}get raw(){return this._raw==null&&(this._raw=ir.jwkToPkix(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return wt.createV1(114,this._multihash)}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Et(this.raw,t.raw)}verify(t,e){return Ri(this._key,e,t)}},ar=class{type="RSA";_key;_raw;publicKey;constructor(t,e){this._key=t,this.publicKey=e}get raw(){return this._raw==null&&(this._raw=ir.jwkToPkcs1(this._key)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Et(this.raw,t.raw)}sign(t){return Ui(this._key,t)}};var No=8192,Ko=18,vu=1062,Lu=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Ni(r){let t=or(r);return{n:tt(t[1],"base64url"),e:tt(t[2],"base64url"),d:tt(t[3],"base64url"),p:tt(t[4],"base64url"),q:tt(t[5],"base64url"),dp:tt(t[6],"base64url"),dq:tt(t[7],"base64url"),qi:tt(t[8],"base64url"),kty:"RSA"}}function Iu(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new gt("JWK was missing components");return Vr([vt(Uint8Array.from([0])),vt(et(r.n,"base64url")),vt(et(r.e,"base64url")),vt(et(r.d,"base64url")),vt(et(r.p,"base64url")),vt(et(r.q,"base64url")),vt(et(r.dp,"base64url")),vt(et(r.dq,"base64url")),vt(et(r.qi,"base64url"))]).subarray()}function Ki(r){let t=or(r,{offset:0});return{kty:"RSA",n:tt(t[1][0],"base64url"),e:tt(t[1][1],"base64url")}}function Do(r){if(r.n==null||r.e==null)throw new gt("JWK was missing components");return Vr([Lu,Ii(Vr([vt(et(r.n,"base64url")),vt(et(r.e,"base64url"))]))]).subarray()}function Di(r){let t=Ni(r);return Pi(t)}function Po(r,t){if(r.byteLength>=vu)throw new be("Key size is too large");let e=Ki(r);if(t==null){let n=Kt(Vt.encode({Type:ft.RSA,Data:r}));t=Lt(Ko,n)}return new De(e,t)}function Pi(r){if(Ci(r)>No)throw new gt("Key size is too large");let t=ki(r),e=Kt(Vt.encode({Type:ft.RSA,Data:Do(t.publicKey)})),n=Lt(Ko,e);return new ar(t.privateKey,new De(t.publicKey,n))}async function Mi(r){if(r>No)throw new gt("Key size is too large");let t=await Ti(r),e=Kt(Vt.encode({Type:ft.RSA,Data:Do(t.publicKey)})),n=Lt(Ko,e);return new ar(t.privateKey,new De(t.publicKey,n))}function ki(r){if(r==null)throw new gt("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}var zr=class extends Te{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ye(t);let n=jt(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return _e(this),this.iHash.update(t),this}digestInto(t){_e(this),Ie(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Pe=(r,t,e)=>new zr(r,t).update(e).digest();Pe.create=(r,t)=>new zr(r,t);function Oi(r){r.lowS!==void 0&&_t("lowS",r.lowS),r.prehash!==void 0&&_t("prehash",r.prehash)}function _u(r){let t=Je(r);Bt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:e,Fp:n,a:o}=t;if(e){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Tu,hexToBytes:Uu}=vr,Mo=class extends Error{constructor(t=""){super(t)}},Ft={Err:Mo,_tlv:{encode:(r,t)=>{let{Err:e}=Ft;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");let n=t.length/2,o=ie(n);if(o.length/2&128)throw new e("tlv.encode: long form length too big");let s=n>127?ie(o.length/2|128):"";return ie(r)+s+o+t},decode(r,t){let{Err:e}=Ft,n=0;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[n++]!==r)throw new e("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new e("tlv.decode(long): indefinite length not supported");if(c>4)throw new e("tlv.decode(long): byte length is too big");let u=t.subarray(n,n+c);if(u.length!==c)throw new e("tlv.decode: length bytes not complete");if(u[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(let f of u)i=i<<8|f;if(n+=c,i<128)throw new e("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new e("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(r){let{Err:t}=Ft;if(r<zt)throw new t("integer: negative integers are not allowed");let e=ie(r);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(r){let{Err:t}=Ft;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Tu(r)}},toSig(r){let{Err:t,_int:e,_tlv:n}=Ft,o=typeof r=="string"?Uu(r):r;Re(o);let{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:u,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(a),s:e.decode(u)}},hexFromSig(r){let{_tlv:t,_int:e}=Ft,n=t.encode(2,e.encode(r.r)),o=t.encode(2,e.encode(r.s)),s=n+o;return t.encode(48,s)}},zt=BigInt(0),at=BigInt(1),jp=BigInt(2),Hi=BigInt(3),Wp=BigInt(4);function Ru(r){let t=_u(r),{Fp:e}=t,n=te(t.n,t.nBitLength),o=t.toBytes||((y,h,g)=>{let w=h.toAffine();return qt(Uint8Array.from([4]),e.toBytes(w.x),e.toBytes(w.y))}),s=t.fromBytes||(y=>{let h=y.subarray(1),g=e.fromBytes(h.subarray(0,e.BYTES)),w=e.fromBytes(h.subarray(e.BYTES,2*e.BYTES));return{x:g,y:w}});function i(y){let{a:h,b:g}=t,w=e.sqr(y),d=e.mul(w,y);return e.add(e.add(d,e.mul(y,h)),g)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return We(y,at,t.n)}function c(y){let{allowedPrivateKeyLengths:h,nByteLength:g,wrapPrivateKey:w,n:d}=t;if(h&&typeof y!="bigint"){if(Jt(y)&&(y=kt(y)),typeof y!="string"||!h.includes(y.length))throw new Error("invalid private key");y=y.padStart(g*2,"0")}let L;try{L=typeof y=="bigint"?y:Ot(Y("private key",y,g))}catch{throw new Error("invalid private key, expected hex or "+g+" bytes, got "+typeof y)}return w&&(L=G(L,d)),ct("private key",L,at,d),L}function u(y){if(!(y instanceof p))throw new Error("ProjectivePoint expected")}let f=ce((y,h)=>{let{px:g,py:w,pz:d}=y;if(e.eql(d,e.ONE))return{x:g,y:w};let L=y.is0();h==null&&(h=L?e.ONE:e.inv(d));let R=e.mul(g,h),U=e.mul(w,h),_=e.mul(d,h);if(L)return{x:e.ZERO,y:e.ZERO};if(!e.eql(_,e.ONE))throw new Error("invZ was invalid");return{x:R,y:U}}),l=ce(y=>{if(y.is0()){if(t.allowInfinityPoint&&!e.is0(y.py))return;throw new Error("bad point: ZERO")}let{x:h,y:g}=y.toAffine();if(!e.isValid(h)||!e.isValid(g))throw new Error("bad point: x or y not FE");let w=e.sqr(g),d=i(h);if(!e.eql(w,d))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(h,g,w){if(this.px=h,this.py=g,this.pz=w,h==null||!e.isValid(h))throw new Error("x required");if(g==null||!e.isValid(g))throw new Error("y required");if(w==null||!e.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(h){let{x:g,y:w}=h||{};if(!h||!e.isValid(g)||!e.isValid(w))throw new Error("invalid affine point");if(h instanceof p)throw new Error("projective point not allowed");let d=L=>e.eql(L,e.ZERO);return d(g)&&d(w)?p.ZERO:new p(g,w,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let g=e.invertBatch(h.map(w=>w.pz));return h.map((w,d)=>w.toAffine(g[d])).map(p.fromAffine)}static fromHex(h){let g=p.fromAffine(s(Y("pointHex",h)));return g.assertValidity(),g}static fromPrivateKey(h){return p.BASE.multiply(c(h))}static msm(h,g){return Tr(p,n,h,g)}_setWindowSize(h){b.setWindowSize(this,h)}assertValidity(){l(this)}hasEvenY(){let{y:h}=this.toAffine();if(e.isOdd)return!e.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){u(h);let{px:g,py:w,pz:d}=this,{px:L,py:R,pz:U}=h,_=e.eql(e.mul(g,U),e.mul(L,d)),T=e.eql(e.mul(w,U),e.mul(R,d));return _&&T}negate(){return new p(this.px,e.neg(this.py),this.pz)}double(){let{a:h,b:g}=t,w=e.mul(g,Hi),{px:d,py:L,pz:R}=this,U=e.ZERO,_=e.ZERO,T=e.ZERO,v=e.mul(d,d),k=e.mul(L,L),K=e.mul(R,R),M=e.mul(d,L);return M=e.add(M,M),T=e.mul(d,R),T=e.add(T,T),U=e.mul(h,T),_=e.mul(w,K),_=e.add(U,_),U=e.sub(k,_),_=e.add(k,_),_=e.mul(U,_),U=e.mul(M,U),T=e.mul(w,T),K=e.mul(h,K),M=e.sub(v,K),M=e.mul(h,M),M=e.add(M,T),T=e.add(v,v),v=e.add(T,v),v=e.add(v,K),v=e.mul(v,M),_=e.add(_,v),K=e.mul(L,R),K=e.add(K,K),v=e.mul(K,M),U=e.sub(U,v),T=e.mul(K,k),T=e.add(T,T),T=e.add(T,T),new p(U,_,T)}add(h){u(h);let{px:g,py:w,pz:d}=this,{px:L,py:R,pz:U}=h,_=e.ZERO,T=e.ZERO,v=e.ZERO,k=t.a,K=e.mul(t.b,Hi),M=e.mul(g,L),H=e.mul(w,R),B=e.mul(d,U),I=e.add(g,w),x=e.add(L,R);I=e.mul(I,x),x=e.add(M,H),I=e.sub(I,x),x=e.add(g,d);let m=e.add(L,U);return x=e.mul(x,m),m=e.add(M,B),x=e.sub(x,m),m=e.add(w,d),_=e.add(R,U),m=e.mul(m,_),_=e.add(H,B),m=e.sub(m,_),v=e.mul(k,x),_=e.mul(K,B),v=e.add(_,v),_=e.sub(H,v),v=e.add(H,v),T=e.mul(_,v),H=e.add(M,M),H=e.add(H,M),B=e.mul(k,B),x=e.mul(K,x),H=e.add(H,B),B=e.sub(M,B),B=e.mul(k,B),x=e.add(x,B),M=e.mul(H,x),T=e.add(T,M),M=e.mul(m,x),_=e.mul(I,_),_=e.sub(_,M),M=e.mul(I,H),v=e.mul(m,v),v=e.add(v,M),new p(_,T,v)}subtract(h){return this.add(h.negate())}is0(){return this.equals(p.ZERO)}wNAF(h){return b.wNAFCached(this,h,p.normalizeZ)}multiplyUnsafe(h){let{endo:g,n:w}=t;ct("scalar",h,zt,w);let d=p.ZERO;if(h===zt)return d;if(this.is0()||h===at)return this;if(!g||b.hasPrecomputes(this))return b.wNAFCachedUnsafe(this,h,p.normalizeZ);let{k1neg:L,k1:R,k2neg:U,k2:_}=g.splitScalar(h),T=d,v=d,k=this;for(;R>zt||_>zt;)R&at&&(T=T.add(k)),_&at&&(v=v.add(k)),k=k.double(),R>>=at,_>>=at;return L&&(T=T.negate()),U&&(v=v.negate()),v=new p(e.mul(v.px,g.beta),v.py,v.pz),T.add(v)}multiply(h){let{endo:g,n:w}=t;ct("scalar",h,at,w);let d,L;if(g){let{k1neg:R,k1:U,k2neg:_,k2:T}=g.splitScalar(h),{p:v,f:k}=this.wNAF(U),{p:K,f:M}=this.wNAF(T);v=b.constTimeNegate(R,v),K=b.constTimeNegate(_,K),K=new p(e.mul(K.px,g.beta),K.py,K.pz),d=v.add(K),L=k.add(M)}else{let{p:R,f:U}=this.wNAF(h);d=R,L=U}return p.normalizeZ([d,L])[0]}multiplyAndAddUnsafe(h,g,w){let d=p.BASE,L=(U,_)=>_===zt||_===at||!U.equals(d)?U.multiplyUnsafe(_):U.multiply(_),R=L(this,g).add(L(h,w));return R.is0()?void 0:R}toAffine(h){return f(this,h)}isTorsionFree(){let{h,isTorsionFree:g}=t;if(h===at)return!0;if(g)return g(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:g}=t;return h===at?this:g?g(p,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return _t("isCompressed",h),this.assertValidity(),o(p,this,h)}toHex(h=!0){return _t("isCompressed",h),kt(this.toRawBytes(h))}}p.BASE=new p(t.Gx,t.Gy,e.ONE),p.ZERO=new p(e.ZERO,e.ONE,e.ZERO);let S=t.nBitLength,b=_r(p,t.endo?Math.ceil(S/2):S);return{CURVE:t,ProjectivePoint:p,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:a}}function Cu(r){let t=Je(r);return Bt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function qi(r){let t=Cu(r),{Fp:e,n}=t,o=e.BYTES+1,s=2*e.BYTES+1;function i(B){return G(B,n)}function a(B){return Lr(B,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:l}=Ru({...t,toBytes(B,I,x){let m=I.toAffine(),A=e.toBytes(m.x),E=qt;return _t("isCompressed",x),x?E(Uint8Array.from([I.hasEvenY()?2:3]),A):E(Uint8Array.from([4]),A,e.toBytes(m.y))},fromBytes(B){let I=B.length,x=B[0],m=B.subarray(1);if(I===o&&(x===2||x===3)){let A=Ot(m);if(!We(A,at,e.ORDER))throw new Error("Point is not on curve");let E=f(A),C;try{C=e.sqrt(E)}catch(q){let O=q instanceof Error?": "+q.message:"";throw new Error("Point is not on curve"+O)}let N=(C&at)===at;return(x&1)===1!==N&&(C=e.neg(C)),{x:A,y:C}}else if(I===s&&x===4){let A=e.fromBytes(m.subarray(0,e.BYTES)),E=e.fromBytes(m.subarray(e.BYTES,2*e.BYTES));return{x:A,y:E}}else{let A=o,E=s;throw new Error("invalid Point, expected length of "+A+", or uncompressed "+E+", got "+I)}}}),p=B=>kt(Qt(B,t.nByteLength));function S(B){let I=n>>at;return B>I}function b(B){return S(B)?i(-B):B}let y=(B,I,x)=>Ot(B.slice(I,x));class h{constructor(I,x,m){this.r=I,this.s=x,this.recovery=m,this.assertValidity()}static fromCompact(I){let x=t.nByteLength;return I=Y("compactSignature",I,x*2),new h(y(I,0,x),y(I,x,2*x))}static fromDER(I){let{r:x,s:m}=Ft.toSig(Y("DER",I));return new h(x,m)}assertValidity(){ct("r",this.r,at,n),ct("s",this.s,at,n)}addRecoveryBit(I){return new h(this.r,this.s,I)}recoverPublicKey(I){let{r:x,s:m,recovery:A}=this,E=U(Y("msgHash",I));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");let C=A===2||A===3?x+t.n:x;if(C>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let N=(A&1)===0?"02":"03",P=c.fromHex(N+p(C)),q=a(C),O=i(-E*q),F=i(m*q),z=c.BASE.multiplyAndAddUnsafe(P,O,F);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return S(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return ae(this.toDERHex())}toDERHex(){return Ft.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ae(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}let g={isValidPrivateKey(B){try{return u(B),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let B=Vn(t.n);return Ws(t.randomBytes(B),t.n)},precompute(B=8,I=c.BASE){return I._setWindowSize(B),I.multiply(BigInt(3)),I}};function w(B,I=!0){return c.fromPrivateKey(B).toRawBytes(I)}function d(B){let I=Jt(B),x=typeof B=="string",m=(I||x)&&B.length;return I?m===o||m===s:x?m===2*o||m===2*s:B instanceof c}function L(B,I,x=!0){if(d(B))throw new Error("first arg must be private key");if(!d(I))throw new Error("second arg must be public key");return c.fromHex(I).multiply(u(B)).toRawBytes(x)}let R=t.bits2int||function(B){if(B.length>8192)throw new Error("input is too large");let I=Ot(B),x=B.length*8-t.nBitLength;return x>0?I>>BigInt(x):I},U=t.bits2int_modN||function(B){return i(R(B))},_=$e(t.nBitLength);function T(B){return ct("num < 2^"+t.nBitLength,B,zt,_),Qt(B,t.nByteLength)}function v(B,I,x=k){if(["recovered","canonical"].some(W=>W in x))throw new Error("sign() legacy options not supported");let{hash:m,randomBytes:A}=t,{lowS:E,prehash:C,extraEntropy:N}=x;E==null&&(E=!0),B=Y("msgHash",B),Oi(x),C&&(B=Y("prehashed msgHash",m(B)));let P=U(B),q=u(I),O=[T(q),T(P)];if(N!=null&&N!==!1){let W=N===!0?A(e.BYTES):N;O.push(Y("extraEntropy",W))}let F=qt(...O),z=P;function j(W){let J=R(W);if(!l(J))return;let ht=a(J),xt=c.BASE.multiply(J).toAffine(),mt=i(xt.x);if(mt===zt)return;let Nt=i(ht*i(z+mt*q));if(Nt===zt)return;let Dt=(xt.x===mt?0:2)|Number(xt.y&at),Fe=Nt;return E&&S(Nt)&&(Fe=b(Nt),Dt^=1),new h(mt,Fe,Dt)}return{seed:F,k2sig:j}}let k={lowS:t.lowS,prehash:!1},K={lowS:t.lowS,prehash:!1};function M(B,I,x=k){let{seed:m,k2sig:A}=v(B,I,x),E=t;return Mn(E.hash.outputLen,E.nByteLength,E.hmac)(m,A)}c.BASE._setWindowSize(8);function H(B,I,x,m=K){let A=B;I=Y("msgHash",I),x=Y("publicKey",x);let{lowS:E,prehash:C,format:N}=m;if(Oi(m),"strict"in m)throw new Error("options.strict was renamed to lowS");if(N!==void 0&&N!=="compact"&&N!=="der")throw new Error("format must be compact or der");let P=typeof A=="string"||Jt(A),q=!P&&!N&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!P&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let O,F;try{if(q&&(O=new h(A.r,A.s)),P){try{N!=="compact"&&(O=h.fromDER(A))}catch(Dt){if(!(Dt instanceof Ft.Err))throw Dt}!O&&N!=="der"&&(O=h.fromCompact(A))}F=c.fromHex(x)}catch{return!1}if(!O||E&&O.hasHighS())return!1;C&&(I=t.hash(I));let{r:z,s:j}=O,W=U(I),J=a(j),ht=i(W*J),xt=i(z*J),mt=c.BASE.multiplyAndAddUnsafe(F,ht,xt)?.toAffine();return mt?i(mt.x)===z:!1}return{CURVE:t,getPublicKey:w,getSharedSecret:L,sign:M,verify:H,ProjectivePoint:c,Signature:h,utils:g}}function Nu(r){return{hash:r,hmac:(t,...e)=>Pe(r,t,Un(...e)),randomBytes:je}}function Vi(r,t){let e=n=>qi({...r,...Nu(n)});return{...e(t),create:e}}var Gi=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Fi=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ku=BigInt(1),ko=BigInt(2),zi=(r,t)=>(r+t/ko)/t;function Du(r){let t=Gi,e=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%t,f=u*u*r%t,l=$(f,e,t)*f%t,p=$(l,e,t)*f%t,S=$(p,ko,t)*u%t,b=$(S,o,t)*S%t,y=$(b,s,t)*b%t,h=$(y,a,t)*y%t,g=$(h,c,t)*h%t,w=$(g,a,t)*y%t,d=$(w,e,t)*f%t,L=$(d,i,t)*b%t,R=$(L,n,t)*u%t,U=$(R,ko,t);if(!Oo.eql(Oo.sqr(U),r))throw new Error("Cannot find square root");return U}var Oo=te(Gi,void 0,void 0,{sqrt:Du}),ye=Vi({a:BigInt(0),b:BigInt(7),Fp:Oo,n:Fi,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=Fi,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Ku*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=e,i=BigInt("0x100000000000000000000000000000000"),a=zi(s*r,t),c=zi(-n*r,t),u=G(r-a*e-c*o,t),f=G(-a*n-c*s,t),l=u>i,p=f>i;if(l&&(u=t-u),p&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:l,k1:u,k2neg:p,k2:f}}}},Kt),s0=BigInt(0);var i0=ye.ProjectivePoint;function Zi(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function Xi(r,t,e){let n=Pr.digest(e instanceof Uint8Array?e:e.subarray());if(Zi(n))return n.then(({digest:o})=>ye.verify(t,o,r)).catch(o=>{throw new sr(String(o))});try{return ye.verify(t,n.digest,r)}catch(o){throw new sr(String(o))}}var Gr=class{type="secp256k1";raw;_key;constructor(t){this._key=ji(t),this.raw=Yi(this._key)}toMultihash(){return Yt.digest(Ne(this))}toCID(){return wt.createV1(114,this.toMultihash())}toString(){return nt.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:Et(this.raw,t.raw)}verify(t,e){return Xi(this._key,e,t)}};function Wi(r){return new Gr(r)}function Yi(r){return ye.ProjectivePoint.fromHex(r).toRawBytes(!0)}function ji(r){try{return ye.ProjectivePoint.fromHex(r),r}catch(t){throw new be(String(t))}}function cr(r,t){let{Type:e,Data:n}=Vt.decode(r),o=n??new Uint8Array;switch(e){case ft.RSA:return Po(o,t);case ft.Ed25519:return fi(o);case ft.secp256k1:return Wi(o);default:throw new we}}function Ne(r){return Vt.encode({Type:ft[r.type],Data:r.raw})}var $i=Symbol.for("nodejs.util.inspect.custom"),Pu=114,fr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[xn]=!0;toString(){return this.string==null&&(this.string=nt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return wt.createV1(Pu,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return Et(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return Et(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[$i](){return`PeerId(${this.toString()})`}},Zr=class extends fr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Xr=class extends fr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Yr=class extends fr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Mu=2336,Ho=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Yt.digest(et(this.url))}[$i](){return`PeerId(${this.url})`}[xn]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return wt.createV1(Mu,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=tt(t)),t.toString()===this.toString())}};function qo(r){if(r.type==="Ed25519")return new Xr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Yr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new Zr({multihash:r.toCID().multihash,publicKey:r});throw new we}var jr=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Me=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Wr=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},ur=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function $r(r){return r[Symbol.asyncIterator]!=null}function Ji(r,t){if(r.byteLength>t)throw new Me("Message length too long")}var Qr=r=>{let t=St(r),e=it(t);return Nr(r,e),Qr.bytes=t,e};Qr.bytes=0;function Qi(r,t){t=t??{};let e=t.lengthEncoder??Qr,n=t?.maxDataLength??4194304;function*o(s){Ji(s,n);let i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return $r(r)?async function*(){for await(let s of r)yield*o(s)}():function*(){for(let s of r)yield*o(s)}()}Qi.single=(r,t)=>{t=t??{};let e=t.lengthEncoder??Qr,n=t?.maxDataLength??4194304;return Ji(r,n),new X(e(r.byteLength),r)};var ge;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(ge||(ge={}));var Vo=r=>{let t=Kr(r);return Vo.bytes=St(t),t};Vo.bytes=0;function hr(r,t){let e=new X,n=ge.LENGTH,o=-1,s=t?.lengthDecoder??Vo,i=t?.maxLengthLength??8,a=t?.maxDataLength??4194304;function*c(){for(;e.byteLength>0;){if(n===ge.LENGTH)try{if(o=s(e),o<0)throw new jr("Invalid message length");if(o>a)throw new Me("Message length too long");let u=s.bytes;e.consume(u),t?.onLength!=null&&t.onLength(o),n=ge.DATA}catch(u){if(u instanceof RangeError){if(e.byteLength>i)throw new Wr("Message length length too long");break}throw u}if(n===ge.DATA){if(e.byteLength<o)break;let u=e.sublist(0,o);e.consume(o),t?.onData!=null&&t.onData(u),yield u,n=ge.LENGTH}}}return $r(r)?async function*(){for await(let u of r)e.append(u),yield*c();if(e.byteLength>0)throw new ur("Unexpected end of input")}():function*(){for(let u of r)e.append(u),yield*c();if(e.byteLength>0)throw new ur("Unexpected end of input")}()}hr.fromReader=(r,t)=>{let e=1,n=async function*(){for(;;)try{let{done:s,value:i}=await r.next(e);if(s===!0)return;i!=null&&(yield i)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{e=1}}();return hr(n,{...t??{},onLength:s=>{e=s}})};function Ct(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var tn=class extends Error{type;code;constructor(t,e,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=e??"ABORT_ERR"}};async function ta(r,t,e){if(t==null)return r;if(t.aborted)return r.catch(()=>{}),Promise.reject(new tn(e?.errorMessage,e?.errorCode,e?.errorName));let n,o=new tn(e?.errorMessage,e?.errorCode,e?.errorName);try{return await Promise.race([r,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var Fo=class{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=Ct(),this.haveNext=Ct()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ct(),t}async throw(t){return this.ended=!0,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return await this._push(void 0),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ct(),await ta(this.readNext.promise,e?.signal,e)}};function ea(){return new Fo}var en=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};var zo=class extends Error{code;constructor(t,e){super(t),this.code=e}},Go=class extends zo{type;constructor(t){super(t,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}};function ra(r,t){let e=ea();r.sink(e).catch(async i=>{await e.end(i)}),r.sink=async i=>{for await(let a of i)await e.push(a);await e.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new X;return{read:async(i,a)=>{a?.signal?.throwIfAborted();let c,u=new Promise((f,l)=>{c=()=>{l(new Go("Read aborted"))},a?.signal?.addEventListener("abort",c)});try{if(i==null){let{done:l,value:p}=await Promise.race([n.next(),u]);return l===!0?new X:p}for(;o.byteLength<i;){let{value:l,done:p}=await Promise.race([n.next(),u]);if(p===!0)throw new en("unexpected end of input");o.append(l)}let f=o.sublist(0,i);return o.consume(i),f}finally{c!=null&&a?.signal?.removeEventListener("abort",c)}},write:async(i,a)=>{a?.signal?.throwIfAborted(),i instanceof Uint8Array?await e.push(i,a):await e.push(i.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let i=r.source;r.source=async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i}()}return r}}}var rn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},nn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},on=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Zo(r,t={}){let e=ra(r,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=St(t.maxDataLength));let n=t?.lengthDecoder??Kr,o=t?.lengthEncoder??Nr;return{read:async i=>{let a=-1,c=new X;for(;;){c.append(await e.read(1,i));try{a=n(c)}catch(u){if(u instanceof RangeError)continue;throw u}if(a<0)throw new rn("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new on("message length length too long");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new nn("message length too long");return e.read(a,i)},write:async(i,a)=>{await e.write(new X(o(i.byteLength),i),a)},writeV:async(i,a)=>{let c=new X(...i.flatMap(u=>[o(u.byteLength),u]));await e.write(c,a)},unwrap:()=>e.unwrap()}}function Xo(){let r=Ct(),t=!1;return{sink:async e=>{if(t)throw new Error("already piped");t=!0,r.resolve(e)},source:async function*(){yield*await r.promise}()}}function na(){let r=Xo(),t=Xo();return[{source:r.source,sink:t.sink},{source:t.source,sink:r.sink}]}var sn=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},ke=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new sn(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new sn(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var Yo=class extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}};function an(r={}){return Ou(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function Ou(r,t){t=t??{};let e=t.onEnd,n=new ke,o,s,i,a=Ct(),c=async()=>{try{return n.isEmpty()?i?{done:!0}:await new Promise((h,g)=>{s=w=>{s=null,n.push(w);try{h(r(n))}catch(d){g(d)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ct()})}},u=h=>s!=null?s(h):(n.push(h),o),f=h=>(n=new ke,s!=null?s({error:h}):(n.push({error:h}),o)),l=h=>{if(i)return o;if(t?.objectMode!==!0&&h?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:h})},p=h=>i?o:(i=!0,h!=null?f(h):u({done:!0})),S=()=>(n=new ke,p(),{done:!0}),b=h=>(p(h),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:S,throw:b,push:l,end:p,get readableLength(){return n.size},onEmpty:async h=>{let g=h?.signal;if(g?.throwIfAborted(),n.isEmpty())return;let w,d;g!=null&&(w=new Promise((L,R)=>{d=()=>{R(new Yo)},g.addEventListener("abort",d)}));try{await Promise.race([a.promise,w])}finally{d!=null&&g!=null&&g?.removeEventListener("abort",d)}}},e==null)return o;let y=o;return o={[Symbol.asyncIterator](){return this},next(){return y.next()},throw(h){return y.throw(h),e!=null&&(e(h),e=void 0),{done:!0}},return(){return y.return(),e!=null&&(e(),e=void 0),{done:!0}},push:l,end(h){return y.end(h),e!=null&&(e(h),e=void 0),o},get readableLength(){return y.readableLength},onEmpty:h=>y.onEmpty(h)},o}function Hu(r){return r[Symbol.asyncIterator]!=null}function qu(...r){let t=[];for(let e of r)Hu(e)||t.push(e);return t.length===r.length?function*(){for(let e of t)yield*e}():async function*(){let e=an({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(let o of n)e.push(o)})),e.end()}catch(n){e.end(n)}}),yield*e}()}var oa=qu;function sa(r,...t){if(r==null)throw new Error("Empty pipeline");if(jo(r)){let n=r;r=()=>n.source}else if(aa(r)||ia(r)){let n=r;r=()=>n}let e=[r,...t];if(e.length>1&&jo(e[e.length-1])&&(e[e.length-1]=e[e.length-1].sink),e.length>2)for(let n=1;n<e.length-1;n++)jo(e[n])&&(e[n]=Fu(e[n]));return Vu(...e)}var Vu=(...r)=>{let t;for(;r.length>0;)t=r.shift()(t);return t},ia=r=>r?.[Symbol.asyncIterator]!=null,aa=r=>r?.[Symbol.iterator]!=null,jo=r=>r==null?!1:r.sink!=null&&r.source!=null,Fu=r=>t=>{let e=r.sink(t);if(e?.then!=null){let n=an({objectMode:!0});e.then(()=>{n.end()},i=>{n.end(i)});let o,s=r.source;if(ia(s))o=async function*(){yield*s,n.end()};else if(aa(s))o=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return oa(n,o())}return r.source};var Oe=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function cn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Wo(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function pt(r,...t){if(!Wo(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function $o(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function ca(r,t){pt(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function Jo(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}var Gt=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),fa=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),zu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!zu)throw new Error("Non little-endian hardware is not supported");function Gu(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function fn(r){if(typeof r=="string")r=Gu(r);else if(Wo(r))r=un(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function ua(r,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(r,t)}function ha(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}var Qo=(r,t)=>{function e(n,...o){if(pt(n),r.nonceLength!==void 0){let f=o[0];if(!f)throw new Error("nonce / iv required");r.varSizeNonce?pt(f):pt(f,r.nonceLength)}let s=r.tagLength;s&&o[1]!==void 0&&pt(o[1]);let i=t(n,...o),a=(f,l)=>{if(l!==void 0){if(f!==2)throw new Error("cipher output not supported");pt(l)}},c=!1;return{encrypt(f,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,pt(f),a(i.encrypt.length,l),i.encrypt(f,l)},decrypt(f,l){if(pt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(i.decrypt.length,l),i.decrypt(f,l)}}}return Object.assign(e,r),e};function ts(r,t,e=!0){if(t===void 0)return new Uint8Array(r);if(t.length!==r)throw new Error("invalid output length, expected "+r+", got: "+t.length);if(e&&!Zu(t))throw new Error("invalid output, must be aligned");return t}function es(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),a=Number(e&s),c=n?4:0,u=n?0:4;r.setUint32(t+c,i,n),r.setUint32(t+u,a,n)}function Zu(r){return r.byteOffset%4===0}function un(r){return Uint8Array.from(r)}function Zt(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}var da=r=>Uint8Array.from(r.split("").map(t=>t.charCodeAt(0))),Xu=da("expand 16-byte k"),Yu=da("expand 32-byte k"),ju=Gt(Xu),Wu=Gt(Yu);function D(r,t){return r<<t|r>>>32-t}function rs(r){return r.byteOffset%4===0}var hn=64,$u=16,pa=2**32-1,la=new Uint32Array;function Ju(r,t,e,n,o,s,i,a){let c=o.length,u=new Uint8Array(hn),f=Gt(u),l=rs(o)&&rs(s),p=l?Gt(o):la,S=l?Gt(s):la;for(let b=0;b<c;i++){if(r(t,e,n,f,i,a),i>=pa)throw new Error("arx: counter overflow");let y=Math.min(hn,c-b);if(l&&y===hn){let h=b/4;if(b%4!==0)throw new Error("arx: invalid block position");for(let g=0,w;g<$u;g++)w=h+g,S[w]=p[w]^f[g];b+=hn;continue}for(let h=0,g;h<y;h++)g=b+h,s[g]=o[g]^u[h];b+=y}}function ns(r,t){let{allowShortKeys:e,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=ua({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof r!="function")throw new Error("core must be a function");return cn(o),cn(i),Jo(s),Jo(e),(a,c,u,f,l=0)=>{pt(a),pt(c),pt(u);let p=u.length;if(f===void 0&&(f=new Uint8Array(p)),pt(f),cn(l),l<0||l>=pa)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);let S=[],b=a.length,y,h;if(b===32)S.push(y=un(a)),h=Wu;else if(b===16&&e)y=new Uint8Array(32),y.set(a),y.set(a,16),h=ju,S.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${b}`);rs(c)||S.push(c=un(c));let g=Gt(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(h,g,Gt(c.subarray(0,16)),g),c=c.subarray(16)}let w=16-o;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){let L=new Uint8Array(12);L.set(c,s?0:12-c.length),c=L,S.push(c)}let d=Gt(c);return Ju(r,h,g,d,u,f,l,i),Zt(...S),f}}var ut=(r,t)=>r[t++]&255|(r[t++]&255)<<8,os=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=fn(t),pt(t,32);let e=ut(t,0),n=ut(t,2),o=ut(t,4),s=ut(t,6),i=ut(t,8),a=ut(t,10),c=ut(t,12),u=ut(t,14);this.r[0]=e&8191,this.r[1]=(e>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let f=0;f<8;f++)this.pad[f]=ut(t,16+2*f)}process(t,e,n=!1){let o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],u=i[2],f=i[3],l=i[4],p=i[5],S=i[6],b=i[7],y=i[8],h=i[9],g=ut(t,e+0),w=ut(t,e+2),d=ut(t,e+4),L=ut(t,e+6),R=ut(t,e+8),U=ut(t,e+10),_=ut(t,e+12),T=ut(t,e+14),v=s[0]+(g&8191),k=s[1]+((g>>>13|w<<3)&8191),K=s[2]+((w>>>10|d<<6)&8191),M=s[3]+((d>>>7|L<<9)&8191),H=s[4]+((L>>>4|R<<12)&8191),B=s[5]+(R>>>1&8191),I=s[6]+((R>>>14|U<<2)&8191),x=s[7]+((U>>>11|_<<5)&8191),m=s[8]+((_>>>8|T<<8)&8191),A=s[9]+(T>>>5|o),E=0,C=E+v*a+k*(5*h)+K*(5*y)+M*(5*b)+H*(5*S);E=C>>>13,C&=8191,C+=B*(5*p)+I*(5*l)+x*(5*f)+m*(5*u)+A*(5*c),E+=C>>>13,C&=8191;let N=E+v*c+k*a+K*(5*h)+M*(5*y)+H*(5*b);E=N>>>13,N&=8191,N+=B*(5*S)+I*(5*p)+x*(5*l)+m*(5*f)+A*(5*u),E+=N>>>13,N&=8191;let P=E+v*u+k*c+K*a+M*(5*h)+H*(5*y);E=P>>>13,P&=8191,P+=B*(5*b)+I*(5*S)+x*(5*p)+m*(5*l)+A*(5*f),E+=P>>>13,P&=8191;let q=E+v*f+k*u+K*c+M*a+H*(5*h);E=q>>>13,q&=8191,q+=B*(5*y)+I*(5*b)+x*(5*S)+m*(5*p)+A*(5*l),E+=q>>>13,q&=8191;let O=E+v*l+k*f+K*u+M*c+H*a;E=O>>>13,O&=8191,O+=B*(5*h)+I*(5*y)+x*(5*b)+m*(5*S)+A*(5*p),E+=O>>>13,O&=8191;let F=E+v*p+k*l+K*f+M*u+H*c;E=F>>>13,F&=8191,F+=B*a+I*(5*h)+x*(5*y)+m*(5*b)+A*(5*S),E+=F>>>13,F&=8191;let z=E+v*S+k*p+K*l+M*f+H*u;E=z>>>13,z&=8191,z+=B*c+I*a+x*(5*h)+m*(5*y)+A*(5*b),E+=z>>>13,z&=8191;let j=E+v*b+k*S+K*p+M*l+H*f;E=j>>>13,j&=8191,j+=B*u+I*c+x*a+m*(5*h)+A*(5*y),E+=j>>>13,j&=8191;let W=E+v*y+k*b+K*S+M*p+H*l;E=W>>>13,W&=8191,W+=B*f+I*u+x*c+m*a+A*(5*h),E+=W>>>13,W&=8191;let J=E+v*h+k*y+K*b+M*S+H*p;E=J>>>13,J&=8191,J+=B*l+I*f+x*u+m*c+A*a,E+=J>>>13,J&=8191,E=(E<<2)+E|0,E=E+C|0,C=E&8191,E=E>>>13,N+=E,s[0]=C,s[1]=N,s[2]=P,s[3]=q,s[4]=O,s[5]=F,s[6]=z,s[7]=j,s[8]=W,s[9]=J}finalize(){let{h:t,pad:e}=this,n=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+e[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+e[a]|0)+(i>>>16)|0,t[a]=i&65535;Zt(n)}update(t){$o(this);let{buffer:e,blockLen:n}=this;t=fn(t);let o=t.length;for(let s=0;s<o;){let i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}e.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(e,0,!1),this.pos=0)}return this}destroy(){Zt(this.h,this.r,this.buffer,this.pad)}digestInto(t){$o(this),ca(t,this),this.finished=!0;let{buffer:e,h:n}=this,{pos:o}=this;if(o){for(e[o++]=1;o<16;o++)e[o]=0;this.process(e,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}};function Qu(r){let t=(n,o)=>r(o).update(fn(n)).digest(),e=r(new Uint8Array(32));return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=n=>r(n),t}var ma=Qu(r=>new os(r));function xa(r,t,e,n,o,s=20){let i=r[0],a=r[1],c=r[2],u=r[3],f=t[0],l=t[1],p=t[2],S=t[3],b=t[4],y=t[5],h=t[6],g=t[7],w=o,d=e[0],L=e[1],R=e[2],U=i,_=a,T=c,v=u,k=f,K=l,M=p,H=S,B=b,I=y,x=h,m=g,A=w,E=d,C=L,N=R;for(let q=0;q<s;q+=2)U=U+k|0,A=D(A^U,16),B=B+A|0,k=D(k^B,12),U=U+k|0,A=D(A^U,8),B=B+A|0,k=D(k^B,7),_=_+K|0,E=D(E^_,16),I=I+E|0,K=D(K^I,12),_=_+K|0,E=D(E^_,8),I=I+E|0,K=D(K^I,7),T=T+M|0,C=D(C^T,16),x=x+C|0,M=D(M^x,12),T=T+M|0,C=D(C^T,8),x=x+C|0,M=D(M^x,7),v=v+H|0,N=D(N^v,16),m=m+N|0,H=D(H^m,12),v=v+H|0,N=D(N^v,8),m=m+N|0,H=D(H^m,7),U=U+K|0,N=D(N^U,16),x=x+N|0,K=D(K^x,12),U=U+K|0,N=D(N^U,8),x=x+N|0,K=D(K^x,7),_=_+M|0,A=D(A^_,16),m=m+A|0,M=D(M^m,12),_=_+M|0,A=D(A^_,8),m=m+A|0,M=D(M^m,7),T=T+H|0,E=D(E^T,16),B=B+E|0,H=D(H^B,12),T=T+H|0,E=D(E^T,8),B=B+E|0,H=D(H^B,7),v=v+k|0,C=D(C^v,16),I=I+C|0,k=D(k^I,12),v=v+k|0,C=D(C^v,8),I=I+C|0,k=D(k^I,7);let P=0;n[P++]=i+U|0,n[P++]=a+_|0,n[P++]=c+T|0,n[P++]=u+v|0,n[P++]=f+k|0,n[P++]=l+K|0,n[P++]=p+M|0,n[P++]=S+H|0,n[P++]=b+B|0,n[P++]=y+I|0,n[P++]=h+x|0,n[P++]=g+m|0,n[P++]=w+A|0,n[P++]=d+E|0,n[P++]=L+C|0,n[P++]=R+N|0}function th(r,t,e,n){let o=r[0],s=r[1],i=r[2],a=r[3],c=t[0],u=t[1],f=t[2],l=t[3],p=t[4],S=t[5],b=t[6],y=t[7],h=e[0],g=e[1],w=e[2],d=e[3];for(let R=0;R<20;R+=2)o=o+c|0,h=D(h^o,16),p=p+h|0,c=D(c^p,12),o=o+c|0,h=D(h^o,8),p=p+h|0,c=D(c^p,7),s=s+u|0,g=D(g^s,16),S=S+g|0,u=D(u^S,12),s=s+u|0,g=D(g^s,8),S=S+g|0,u=D(u^S,7),i=i+f|0,w=D(w^i,16),b=b+w|0,f=D(f^b,12),i=i+f|0,w=D(w^i,8),b=b+w|0,f=D(f^b,7),a=a+l|0,d=D(d^a,16),y=y+d|0,l=D(l^y,12),a=a+l|0,d=D(d^a,8),y=y+d|0,l=D(l^y,7),o=o+u|0,d=D(d^o,16),b=b+d|0,u=D(u^b,12),o=o+u|0,d=D(d^o,8),b=b+d|0,u=D(u^b,7),s=s+f|0,h=D(h^s,16),y=y+h|0,f=D(f^y,12),s=s+f|0,h=D(h^s,8),y=y+h|0,f=D(f^y,7),i=i+l|0,g=D(g^i,16),p=p+g|0,l=D(l^p,12),i=i+l|0,g=D(g^i,8),p=p+g|0,l=D(l^p,7),a=a+c|0,w=D(w^a,16),S=S+w|0,c=D(c^S,12),a=a+c|0,w=D(w^a,8),S=S+w|0,c=D(c^S,7);let L=0;n[L++]=o,n[L++]=s,n[L++]=i,n[L++]=a,n[L++]=h,n[L++]=g,n[L++]=w,n[L++]=d}var eh=ns(xa,{counterRight:!1,counterLength:4,allowShortKeys:!1}),rh=ns(xa,{counterRight:!1,counterLength:8,extendNonceFn:th,allowShortKeys:!1});var nh=new Uint8Array(16),ya=(r,t)=>{r.update(t);let e=t.length%16;e&&r.update(nh.subarray(e))},oh=new Uint8Array(32);function ga(r,t,e,n,o){let s=r(t,e,oh),i=ma.create(s);o&&ya(i,o),ya(i,n);let a=new Uint8Array(16),c=fa(a);es(c,0,BigInt(o?o.length:0),!0),es(c,8,BigInt(n.length),!0),i.update(a);let u=i.digest();return Zt(s,a),u}var ba=r=>(t,e,n)=>({encrypt(s,i){let a=s.length;i=ts(a+16,i,!1),i.set(s);let c=i.subarray(0,-16);r(t,e,c,c,1);let u=ga(r,t,e,c,n);return i.set(u,a),Zt(u),i},decrypt(s,i){i=ts(s.length-16,i,!1);let a=s.subarray(0,-16),c=s.subarray(-16),u=ga(r,t,e,a,n);if(!ha(c,u))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),r(t,e,i,i,1),Zt(u),i}}),ss=Qo({blockSize:64,nonceLength:12,tagLength:16},ba(eh)),dy=Qo({blockSize:64,nonceLength:24,tagLength:16},ba(rh));function Ea(r,t,e){return Ye(r),e===void 0&&(e=new Uint8Array(r.outputLen)),Pe(r,jt(e),jt(t))}var is=new Uint8Array([0]),wa=new Uint8Array;function Sa(r,t,e,n=32){if(Ye(r),br(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(n/r.outputLen);e===void 0&&(e=wa);let s=new Uint8Array(o*r.outputLen),i=Pe.create(r,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)is[0]=u+1,a.update(u===0?wa:c).update(e).update(is).digestInto(c),s.set(c,r.outputLen*u),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),is.fill(0),s.slice(0,n)}var ln={hashSHA256(r){return Kt(r.subarray())},getHKDF(r,t){let e=Ea(Kt,t,r),o=Sa(Kt,e,void 0,96),s=o.subarray(0,32),i=o.subarray(32,64),a=o.subarray(64,96);return[s,i,a]},generateX25519KeyPair(){let r=tr.utils.randomPrivateKey();return{publicKey:tr.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:tr.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,t){return tr.getSharedSecret(r.subarray(),t.subarray())},chaCha20Poly1305Encrypt(r,t,e,n){return ss(n,t,e).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,t,e,n,o){return ss(n,t,e).decrypt(r.subarray(),o)}};var Aa=ln;function Ba(r){return{generateKeypair:r.generateX25519KeyPair,dh:(t,e)=>r.generateX25519SharedKey(t.privateKey,e).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var He=r=>{let t=it(2);return t[0]=r>>8,t[1]=r,t};He.bytes=2;var lr=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let t=0;return t+=r[0]<<8,t+=r[1],t}return r.getUint16(0)};lr.bytes=2;function va(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function as(r,t){!t.enabled||!Oe||(r?(t(`LOCAL_STATIC_PUBLIC_KEY ${tt(r.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${tt(r.privateKey,"hex")}`)):t("Missing local static keys."))}function cs(r,t){!t.enabled||!Oe||(r?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${tt(r.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${tt(r.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function La(r,t){!t.enabled||!Oe||t(r?`REMOTE_STATIC_PUBLIC_KEY ${tt(r.subarray(),"hex")}`:"Missing remote static public key.")}function fs(r,t){!t.enabled||!Oe||t(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${tt(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function us(r,t,e){!e.enabled||!Oe||(e(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&tt(r.k,"hex")}`),e(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&tt(t.k,"hex")}`))}var qe=class r extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var sh=0,ih=4294967295,ah="Cipherstate has reached maximum n, a new handshake must be performed",dn=class{n;bytes;view;constructor(t=sh){this.n=t,this.bytes=st(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>ih)throw new Error(ah)}};var xe=st(0),Ve=class{k;n;crypto;constructor(t,e=void 0,n=0){this.crypto=t,this.k=e,this.n=new dn(n)}hasKey(){return!!this.k}encryptWithAd(t,e){if(!this.hasKey())return e;this.n.assertValue();let n=this.crypto.encrypt(e,this.n.getBytes(),t,this.k);return this.n.increment(),n}decryptWithAd(t,e,n){if(!this.hasKey())return e;this.n.assertValue();let o=this.crypto.decrypt(e,this.n.getBytes(),t,this.k,n);return this.n.increment(),o}},hs=class{cs;ck;h;crypto;constructor(t,e){this.crypto=t;let n=et(e,"utf-8");this.h=ch(t,n),this.ck=this.h,this.cs=new Ve(t)}mixKey(t){let[e,n]=this.crypto.hkdf(this.ck,t);this.ck=e,this.cs=new Ve(this.crypto,n)}mixHash(t){this.h=this.crypto.hash(new X(this.h,t))}encryptAndHash(t){let e=this.cs.encryptWithAd(this.h,t);return this.mixHash(e),e}decryptAndHash(t){let e=this.cs.decryptWithAd(this.h,t);return this.mixHash(t),e}split(){let[t,e]=this.crypto.hkdf(this.ck,xe);return[new Ve(this.crypto,t),new Ve(this.crypto,e)]}},ls=class{ss;s;e;rs;re;initiator;crypto;constructor(t){let{crypto:e,protocolName:n,prologue:o,initiator:s,s:i,e:a,rs:c,re:u}=t;this.crypto=e,this.ss=new hs(e,n),this.ss.mixHash(o),this.initiator=s,this.s=i,this.e=a,this.rs=c,this.re=u}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let t=this.crypto.generateKeypair();return this.ss.mixHash(t.publicKey),this.e=t,t.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(t,e=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(t.byteLength<e+32)throw new Error("message is not long enough");this.re=t.sublist(e,e+32),this.ss.mixHash(this.re)}readS(t,e=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(t.byteLength<e+n)throw new Error("message is not long enough");let o=t.sublist(e,e+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},dr=class extends ls{writeMessageA(t){return new X(this.writeE(),this.ss.encryptAndHash(t))}writeMessageB(t){let e=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new X(e,n,this.ss.encryptAndHash(t))}writeMessageC(t){let e=this.writeS();return this.writeSE(),new X(e,this.ss.encryptAndHash(t))}readMessageA(t){try{return this.readE(t),this.ss.decryptAndHash(t.sublist(32))}catch(e){throw new qe(`handshake stage 0 validation fail: ${e.message}`)}}readMessageB(t){try{this.readE(t),this.readEE();let e=this.readS(t,32);return this.readES(),this.ss.decryptAndHash(t.sublist(32+e))}catch(e){throw new qe(`handshake stage 1 validation fail: ${e.message}`)}}readMessageC(t){try{let e=this.readS(t);return this.readSE(),this.ss.decryptAndHash(t.sublist(e))}catch(e){throw new qe(`handshake stage 2 validation fail: ${e.message}`)}}};function ch(r,t){if(t.length<=32){let e=st(32);return e.set(t),e}else return r.hash(t)}var pn;(function(r){let t;r.codec=()=>(t==null&&(t=pe((e,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),e.webtransportCerthashes!=null)for(let s of e.webtransportCerthashes)n.uint32(10),n.bytes(s);if(e.streamMuxers!=null)for(let s of e.streamMuxers)n.uint32(18),n.string(s);o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={webtransportCerthashes:[],streamMuxers:[]},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&s.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new nr('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(e.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&s.streamMuxers.length===o.limits.streamMuxers)throw new nr('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(e.string());break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>de(e,r.codec()),r.decode=(e,n)=>he(e,r.codec(),n)})(pn||(pn={}));var pr;(function(r){let t;r.codec=()=>(t==null&&(t=pe((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.identityKey!=null&&e.identityKey.byteLength>0&&(n.uint32(10),n.bytes(e.identityKey)),e.identitySig!=null&&e.identitySig.byteLength>0&&(n.uint32(18),n.bytes(e.identitySig)),e.extensions!=null&&(n.uint32(34),pn.codec().encode(e.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={identityKey:st(0),identitySig:st(0)},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let a=e.uint32();switch(a>>>3){case 1:{s.identityKey=e.bytes();break}case 2:{s.identitySig=e.bytes();break}case 4:{s.extensions=pn.codec().decode(e,e.uint32(),{limits:o.limits?.extensions});break}default:{e.skipType(a&7);break}}}return s})),t),r.encode=e=>de(e,r.codec()),r.decode=(e,n)=>he(e,r.codec(),n)})(pr||(pr={}));async function ds(r,t,e){let n=await r.sign(Ia(t));return pr.encode({identityKey:Ne(r.publicKey),identitySig:n,extensions:e})}async function ps(r,t,e){try{let n=pr.decode(r),o=cr(n.identityKey);if(e?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${e}`);if(!t)throw new Error("Remote static does not exist");let s=Ia(t);if(!await o.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new yr(n.message)}}function Ia(r){let t=et("noise-libp2p-static-key:");return r instanceof Uint8Array?me([t,r],t.length+r.length):(r.prepend(t),r)}async function _a(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:u}=r,f=await ds(s,a.publicKey,u),l=new dr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:i,s:a});as(l.s,e),e.trace("Stage 0 - Initiator starting to send first message."),await n.write(l.writeMessageA(xe),t),e.trace("Stage 0 - Initiator finished sending first message."),cs(l.e,e),e.trace("Stage 1 - Initiator waiting to receive first message from responder...");let p=l.readMessageB(await n.read(t));e.trace("Stage 1 - Initiator received the message."),fs(l.re,e),La(l.rs,e),e.trace("Initiator going to check remote's signature...");let S=await ps(p,l.rs,c);e.trace("All good with the signature!"),e.trace("Stage 2 - Initiator sending third handshake message."),await n.write(l.writeMessageC(f),t),e.trace("Stage 2 - Initiator sent message with signed payload.");let[b,y]=l.ss.split();return us(b,y,e),{payload:S,encrypt:h=>b.encryptWithAd(xe,h),decrypt:(h,g)=>y.decryptWithAd(xe,h,g)}}async function Ta(r,t){let{log:e,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:u}=r,f=await ds(s,a.publicKey,u),l=new dr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:i,s:a});as(l.s,e),e.trace("Stage 0 - Responder waiting to receive first message."),l.readMessageA(await n.read(t)),e.trace("Stage 0 - Responder received first message."),fs(l.re,e),e.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(l.writeMessageB(f),t),e.trace("Stage 1 - Responder sent the second handshake message with signed payload."),cs(l.e,e),e.trace("Stage 2 - Responder waiting for third handshake message...");let p=l.readMessageC(await n.read(t));e.trace("Stage 2 - Responder received the message, finished handshake.");let S=await ps(p,l.rs,c),[b,y]=l.ss.split();return us(b,y,e),{payload:S,encrypt:h=>y.encryptWithAd(xe,h),decrypt:(h,g)=>b.decryptWithAd(xe,h,g)}}var Ra=16;function Ca(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65519){let s=o+65519;s>n.length&&(s=n.length);let i;n instanceof Uint8Array?i=r.encrypt(n.subarray(o,s)):i=r.encrypt(n.sublist(o,s)),t?.encryptedPackets.increment(),yield new X(He(i.byteLength),i)}}}function Na(r,t){return async function*(e){for await(let n of e)for(let o=0;o<n.length;o+=65535){let s=o+65535;if(s>n.length&&(s=n.length),s-Ra<o)throw new Error("Invalid chunk");let i=n.sublist(o,s),a=n.subarray(o,s-Ra);try{let c=r.decrypt(i,a);t?.decryptedPackets.increment(),yield c}catch(c){throw t?.decryptErrors.increment(),c}}}}var mn=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(t,e={}){let{staticNoiseKey:n,extensions:o,crypto:s,prologueBytes:i}=e,{metrics:a}=t;this.components=t;let c=s??Aa;this.crypto=Ba(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?va(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=i??st(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[Ss]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(t,e){let n=Zo(t,{lengthEncoder:He,lengthDecoder:lr,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=cr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:qo(i),streamMuxer:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}getStreamMuxer(t){if(t==null)return;let e=this.components.upgrader.getStreamMuxers();if(e!=null)for(let n of t){let o=e.get(n);if(o!=null)return o}if(t.length)throw new gr("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(t,e){let n=Zo(t,{lengthEncoder:He,lengthDecoder:lr,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,e?.remotePeer?.publicKey,e),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=cr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:qo(i),streamMuxer:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(t,e,n,o){let s;try{s=await _a({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(i){throw this.metrics?.xxHandshakeErrors.increment(),i}return s}async performHandshakeResponder(t,e,n,o){let s;try{s=await Ta({connection:t,privateKey:e,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(i){throw this.metrics?.xxHandshakeErrors.increment(),i}return s}async createSecureConnection(t,e){let[n,o]=na(),s=t.unwrap();return await sa(n,Ca(e,this.metrics),s,i=>hr(i,{lengthDecoder:lr}),Na(e,this.metrics),n),o}};function fh(r={}){return t=>new mn(t,r)}return Za(uh);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return ChainsafeLibp2PNoise}));
