(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PIdentify = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PIdentify=(()=>{var xc=Object.create;var kr=Object.defineProperty;var wc=Object.getOwnPropertyDescriptor;var Ec=Object.getOwnPropertyNames;var vc=Object.getPrototypeOf,Sc=Object.prototype.hasOwnProperty;var Ac=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),vt=(r,t)=>{for(var e in t)kr(r,e,{get:t[e],enumerable:!0})},$s=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ec(t))!Sc.call(r,o)&&o!==e&&kr(r,o,{get:()=>t[o],enumerable:!(n=wc(t,o))||n.enumerable});return r};var Ic=(r,t,e)=>(e=r!=null?xc(vc(r)):{},$s(t||!r||!r.__esModule?kr(e,"default",{value:r,enumerable:!0}):e,r)),Bc=r=>$s(kr({},"__esModule",{value:!0}),r);var Ja=Ac(Ur=>{(function(){var r,t,e,n,o,s,i,c;c=function(a){var f,u,l,d;return f=(a&255<<24)>>>24,u=(a&255<<16)>>>16,l=(a&65280)>>>8,d=a&255,[f,u,l,d].join(".")},i=function(a){var f,u,l,d,g,m;for(f=[],l=d=0;d<=3&&a.length!==0;l=++d){if(l>0){if(a[0]!==".")throw new Error("Invalid IP");a=a.substring(1)}m=t(a),g=m[0],u=m[1],a=a.substring(u),f.push(g)}if(a.length!==0)throw new Error("Invalid IP");switch(f.length){case 1:if(f[0]>4294967295)throw new Error("Invalid IP");return f[0]>>>0;case 2:if(f[0]>255||f[1]>16777215)throw new Error("Invalid IP");return(f[0]<<24|f[1])>>>0;case 3:if(f[0]>255||f[1]>255||f[2]>65535)throw new Error("Invalid IP");return(f[0]<<24|f[1]<<16|f[2])>>>0;case 4:if(f[0]>255||f[1]>255||f[2]>255||f[3]>255)throw new Error("Invalid IP");return(f[0]<<24|f[1]<<16|f[2]<<8|f[3])>>>0;default:throw new Error("Invalid IP")}},e=function(a){return a.charCodeAt(0)},n=e("0"),s=e("a"),o=e("A"),t=function(a){var f,u,l,d,g;for(d=0,f=10,u="9",l=0,a.length>1&&a[l]==="0"&&(a[l+1]==="x"||a[l+1]==="X"?(l+=2,f=16):"0"<=a[l+1]&&a[l+1]<="9"&&(l++,f=8,u="7")),g=l;l<a.length;){if("0"<=a[l]&&a[l]<=u)d=d*f+(e(a[l])-n)>>>0;else if(f===16)if("a"<=a[l]&&a[l]<="f")d=d*f+(10+e(a[l])-s)>>>0;else if("A"<=a[l]&&a[l]<="F")d=d*f+(10+e(a[l])-o)>>>0;else break;else break;if(d>4294967295)throw new Error("too large");l++}if(l===g)throw new Error("empty octet");return[d,l]},r=function(){function a(f,u){var l,d,g,m;if(typeof f!="string")throw new Error("Missing `net' parameter");if(u||(m=f.split("/",2),f=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=i(u)}catch(b){throw l=b,new Error("Invalid mask: "+u)}for(d=g=32;g>=0;d=--g)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(i(f)&this.maskLong)>>>0}catch(b){throw l=b,new Error("Invalid net address: "+f)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return a.prototype.contains=function(f){return typeof f=="string"&&(f.indexOf("/")>0||f.split(".").length!==4)&&(f=new a(f)),f instanceof a?this.contains(f.base)&&this.contains(f.broadcast||f.last):(i(f)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},a.prototype.next=function(f){return f==null&&(f=1),new a(c(this.netLong+this.size*f),this.mask)},a.prototype.forEach=function(f){var u,l,d;for(d=i(this.first),l=i(this.last),u=0;d<=l;)f(c(d),d,u),u++,d++},a.prototype.toString=function(){return this.base+"/"+this.bitmask},a}(),Ur.ip2long=i,Ur.long2ip=c,Ur.Netmask=r}).call(Ur)});var bd={};vt(bd,{identify:()=>yd,identifyPush:()=>gd});var Mn=Symbol.for("@libp2p/peer-id");var ct=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},ke=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Mr=class extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}},Fr=class extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}},Vr=class extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}},Dt=class extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}};var ve=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var qr=Symbol.for("@libp2p/service-capabilities"),vd=Symbol.for("@libp2p/service-dependencies");var zn={};vt(zn,{base58btc:()=>W,base58flickr:()=>Dc});var Gd=new Uint8Array(0);function js(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function Xt(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Zs(r){return new TextEncoder().encode(r)}function Ys(r){return new TextDecoder().decode(r)}function Pc(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var o=0;o<r.length;o++){var s=r.charAt(o),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=o}var c=r.length,a=r.charAt(0),f=Math.log(c)/Math.log(256),u=Math.log(256)/Math.log(c);function l(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var b=0,h=0,E=0,S=m.length;E!==S&&m[E]===0;)E++,b++;for(var y=(S-E)*u+1>>>0,I=new Uint8Array(y);E!==S;){for(var _=m[E],L=0,B=y-1;(_!==0||L<h)&&B!==-1;B--,L++)_+=256*I[B]>>>0,I[B]=_%c>>>0,_=_/c>>>0;if(_!==0)throw new Error("Non-zero carry");h=L,E++}for(var C=y-h;C!==y&&I[C]===0;)C++;for(var P=a.repeat(b);C<y;++C)P+=r.charAt(I[C]);return P}function d(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var b=0;if(m[b]!==" "){for(var h=0,E=0;m[b]===a;)h++,b++;for(var S=(m.length-b)*f+1>>>0,y=new Uint8Array(S);m[b];){var I=e[m.charCodeAt(b)];if(I===255)return;for(var _=0,L=S-1;(I!==0||_<E)&&L!==-1;L--,_++)I+=c*y[L]>>>0,y[L]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");E=_,b++}if(m[b]!==" "){for(var B=S-E;B!==S&&y[B]===0;)B++;for(var C=new Uint8Array(h+(S-B)),P=h;B!==S;)C[P++]=y[B++];return C}}}function g(m){var b=d(m);if(b)return b;throw new Error(`Non-${t} character`)}return{encode:l,decodeUnsafe:d,decode:g}}var Tc=Pc,Cc=Tc,Xs=Cc;var Fn=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Vn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let o=e.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Js(this,t)}},qn=class{decoders;constructor(t){this.decoders=t}or(t){return Js(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Js(r,t){return new qn({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var Hn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,o){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=o,this.encoder=new Fn(t,e,n),this.decoder=new Vn(t,e,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Me({name:r,prefix:t,encode:e,decode:n}){return new Hn(r,t,e,n)}function ce({name:r,prefix:t,alphabet:e}){let{encode:n,decode:o}=Xs(e,r);return Me({prefix:t,name:r,encode:n,decode:s=>Xt(o(s))})}function Lc(r,t,e,n){let o={};for(let u=0;u<t.length;++u)o[t[u]]=u;let s=r.length;for(;r[s-1]==="=";)--s;let i=new Uint8Array(s*e/8|0),c=0,a=0,f=0;for(let u=0;u<s;++u){let l=o[r[u]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<e|l,c+=e,c>=8&&(c-=8,i[f++]=255&a>>c)}if(c>=e||(255&a<<8-c)!==0)throw new SyntaxError("Unexpected end of data");return i}function _c(r,t,e){let n=t[t.length-1]==="=",o=(1<<e)-1,s="",i=0,c=0;for(let a=0;a<r.length;++a)for(c=c<<8|r[a],i+=8;i>e;)i-=e,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<e-i]),n)for(;(s.length*e&7)!==0;)s+="=";return s}function nt({name:r,prefix:t,bitsPerChar:e,alphabet:n}){return Me({prefix:t,name:r,encode(o){return _c(o,n,e)},decode(o){return Lc(o,n,e,r)}})}var W=ce({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Dc=ce({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gn={};vt(Gn,{base32:()=>Jt,base32hex:()=>Nc,base32hexpad:()=>kc,base32hexpadupper:()=>Mc,base32hexupper:()=>Kc,base32pad:()=>Uc,base32padupper:()=>Oc,base32upper:()=>Rc,base32z:()=>Fc});var Jt=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Rc=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Uc=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oc=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Nc=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Kc=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kc=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Mc=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fc=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var $n={};vt($n,{base36:()=>cr,base36upper:()=>Vc});var cr=ce({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Vc=ce({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var qc=ei,Qs=128,Hc=127,zc=~Hc,Gc=Math.pow(2,31);function ei(r,t,e){t=t||[],e=e||0;for(var n=e;r>=Gc;)t[e++]=r&255|Qs,r/=128;for(;r&zc;)t[e++]=r&255|Qs,r>>>=7;return t[e]=r|0,ei.bytes=e-n+1,t}var $c=jn,jc=128,ti=127;function jn(r,n){var e=0,n=n||0,o=0,s=n,i,c=r.length;do{if(s>=c)throw jn.bytes=0,new RangeError("Could not decode varint");i=r[s++],e+=o<28?(i&ti)<<o:(i&ti)*Math.pow(2,o),o+=7}while(i>=jc);return jn.bytes=s-n,e}var Zc=Math.pow(2,7),Yc=Math.pow(2,14),Wc=Math.pow(2,21),Xc=Math.pow(2,28),Jc=Math.pow(2,35),Qc=Math.pow(2,42),tu=Math.pow(2,49),eu=Math.pow(2,56),ru=Math.pow(2,63),nu=function(r){return r<Zc?1:r<Yc?2:r<Wc?3:r<Xc?4:r<Jc?5:r<Qc?6:r<tu?7:r<eu?8:r<ru?9:10},ou={encode:qc,decode:$c,encodingLength:nu},su=ou,ur=su;function fr(r,t=0){return[ur.decode(r,t),ur.decode.bytes]}function Fe(r,t,e=0){return ur.encode(r,t,e),t}function Ve(r){return ur.encodingLength(r)}function Rt(r,t){let e=t.byteLength,n=Ve(r),o=n+Ve(e),s=new Uint8Array(o+e);return Fe(r,s,0),Fe(e,s,n),s.set(t,o),new qe(r,e,t,s)}function Se(r){let t=Xt(r),[e,n]=fr(t),[o,s]=fr(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new qe(e,o,i,t)}function ri(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&js(r.bytes,e.bytes)}}var qe=class{code;size;digest;bytes;constructor(t,e,n,o){this.code=t,this.size=e,this.digest=n,this.bytes=o}};function ni(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return au(e,Zn(r),t??W.encoder);default:return cu(e,Zn(r),t??Jt.encoder)}}var oi=new WeakMap;function Zn(r){let t=oi.get(r);if(t==null){let e=new Map;return oi.set(r,e),e}return t}var it=class r{code;version;multihash;bytes;"/";constructor(t,e,n,o){this.code=e,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==lr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==uu)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=Rt(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&ri(t.multihash,n.multihash)}toString(t){return ni(this,t)}toJSON(){return{"/":ni(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:o,multihash:s,bytes:i}=e;return new r(n,o,s,i??si(n,o,s.bytes))}else if(e[fu]===!0){let{version:n,multihash:o,code:s}=e,i=Se(o);return r.create(n,s,i)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==lr)throw new Error(`Version 0 CID must use dag-pb (code: ${lr}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let o=si(t,e,n.bytes);return new r(t,e,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,lr,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,o=Xt(t.subarray(n,n+e.multihashSize));if(o.byteLength!==e.multihashSize)throw new Error("Incorrect length");let s=o.subarray(e.multihashSize-e.digestSize),i=new qe(e.multihashCode,e.digestSize,s,o);return[e.version===0?r.createV0(i):r.createV1(e.codec,i),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[l,d]=fr(t.subarray(e));return e+=d,l},o=n(),s=lr;if(o===18?(o=0,e=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=e,c=n(),a=n(),f=e+a,u=f-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:u,size:f}}static parse(t,e){let[n,o]=iu(t,e),s=r.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Zn(s).set(n,t),s}};function iu(r,t){switch(r[0]){case"Q":{let e=t??W;return[W.prefix,e.decode(`${W.prefix}${r}`)]}case W.prefix:{let e=t??W;return[W.prefix,e.decode(r)]}case Jt.prefix:{let e=t??Jt;return[Jt.prefix,e.decode(r)]}case cr.prefix:{let e=t??cr;return[cr.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function au(r,t,e){let{prefix:n}=e;if(n!==W.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let o=t.get(n);if(o==null){let s=e.encode(r).slice(1);return t.set(n,s),s}else return o}function cu(r,t,e){let{prefix:n}=e,o=t.get(n);if(o==null){let s=e.encode(r);return t.set(n,s),s}else return o}var lr=112,uu=18;function si(r,t,e){let n=Ve(r),o=n+Ve(t),s=new Uint8Array(o+e.byteLength);return Fe(r,s,0),Fe(t,s,n),s.set(e,o),s}var fu=Symbol.for("@ipld/js-cid/CID");var Yn={};vt(Yn,{identity:()=>Ut});var ii=0,lu="identity",ai=Xt;function du(r){return Rt(ii,ai(r))}var Ut={code:ii,name:lu,encode:ai,digest:du};function dt(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function mt(r=0){return new Uint8Array(r)}function At(r=0){return new Uint8Array(r)}function Ct(r,t){t==null&&(t=r.reduce((o,s)=>o+s.length,0));let e=At(t),n=0;for(let o of r)e.set(o,n),n+=o.length;return e}var ui=Symbol.for("@achingbrain/uint8arraylist");function ci(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let o=e+n.byteLength;if(t<o)return{buf:n,index:t-e};e=o}throw new RangeError("index is out of bounds")}function zr(r){return!!r?.[ui]}var ot=class r{bufs;length;[ui]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(zr(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(zr(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=ci(this.bufs,t);return e.buf[e.index]}set(t,e){let n=ci(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(zr(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:o}=this._subList(t,e);return Ct(n,o)}subarray(t,e){let{bufs:n,length:o}=this._subList(t,e);return n.length===1?n[0]:Ct(n,o)}sublist(t,e){let{bufs:n,length:o}=this._subList(t,e),s=new r;return s.length=o,s.bufs=[...n],s}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let f=t>=c&&t<a,u=e>c&&e<=a;if(f&&u){if(t===c&&e===a){n.push(i);break}let l=t-c;n.push(i.subarray(l,l+(e-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(u){if(e===a){n.push(i);break}n.push(i.subarray(0,e-c));break}n.push(i)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!zr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let l=0;l<s;l++)i[l]=-1;for(let l=0;l<o;l++)i[n[l]]=l;let c=i,a=this.byteLength-n.byteLength,f=n.byteLength-1,u;for(let l=e;l<=a;l+=u){u=0;for(let d=f;d>=0;d--){let g=this.get(l+d);if(n[d]!==g){u=Math.max(1,d-c[g]);break}}if(u===0)return l}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=At(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let o=mt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,e,n),this.write(o,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let o=mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,e,n),this.write(o,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let o=mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,e,n),this.write(o,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=At(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let o=mt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,e,n),this.write(o,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let o=mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,e,n),this.write(o,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let o=mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,e,n),this.write(o,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let o=mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,e,n),this.write(o,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let o=mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,e,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!dt(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((o,s)=>o+s.byteLength,0)),n.length=e,n}};var Wn={};vt(Wn,{base10:()=>hu});var hu=ce({prefix:"9",name:"base10",alphabet:"0123456789"});var Xn={};vt(Xn,{base16:()=>pu,base16upper:()=>mu});var pu=nt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mu=nt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Jn={};vt(Jn,{base2:()=>yu});var yu=nt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Qn={};vt(Qn,{base256emoji:()=>Eu});var fi=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),gu=fi.reduce((r,t,e)=>(r[e]=t,r),[]),bu=fi.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function xu(r){return r.reduce((t,e)=>(t+=gu[e],t),"")}function wu(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let o=bu[n];if(o==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(o)}return new Uint8Array(t)}var Eu=Me({prefix:"\u{1F680}",name:"base256emoji",encode:xu,decode:wu});var eo={};vt(eo,{base64:()=>vu,base64pad:()=>Su,base64url:()=>to,base64urlpad:()=>Au});var vu=nt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Su=nt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),to=nt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Au=nt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ro={};vt(ro,{base8:()=>Iu});var Iu=nt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var no={};vt(no,{identity:()=>Bu});var Bu=Me({prefix:"\0",name:"identity",encode:r=>Ys(r),decode:r=>Zs(r)});var Th=new TextEncoder,Ch=new TextDecoder;var io={};vt(io,{sha256:()=>dr,sha512:()=>Cu});function so({name:r,code:t,encode:e}){return new oo(r,t,e)}var oo=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?Rt(this.code,e):e.then(n=>Rt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function di(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var dr=so({name:"sha2-256",code:18,encode:di("SHA-256")}),Cu=so({name:"sha2-512",code:19,encode:di("SHA-512")});var hr={...no,...Jn,...ro,...Wn,...Xn,...Gn,...$n,...zn,...eo,...Qn},Vh={...io,...Yn};function pi(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var hi=pi("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ao=pi("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=At(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),Lu={utf8:hi,"utf-8":hi,hex:hr.base16,latin1:ao,ascii:ao,binary:ao,...hr},Gr=Lu;function M(r,t="utf8"){let e=Gr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function O(r,t="utf8"){let e=Gr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.encoder.encode(r).substring(1)}var _u=parseInt("11111",2),co=parseInt("10000000",2),Du=parseInt("01111111",2),mi={0:pr,1:pr,2:Ru,3:Nu,4:Ku,5:Ou,6:Uu,16:pr,22:pr,48:pr};function Qt(r,t={offset:0}){let e=r[t.offset]&_u;if(t.offset++,mi[e]!=null)return mi[e](r,t);throw new Error("No decoder for tag "+e)}function mr(r,t){let e=0;if((r[t.offset]&co)===co){let n=r[t.offset]&Du,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=r[t.offset].toString(16).padStart(2,"0");e=parseInt(o,16)}else e=r[t.offset],t.offset++;return e}function pr(r,t){mr(r,t);let e=[];for(;!(t.offset>=r.byteLength);){let n=Qt(r,t);if(n===null)break;e.push(n)}return e}function Ru(r,t){let e=mr(r,t),n=t.offset,o=t.offset+e,s=[];for(let i=n;i<o;i++)i===n&&r[i]===0||s.push(r[i]);return t.offset+=e,Uint8Array.from(s)}function Uu(r,t){let e=mr(r,t),n=t.offset+e,o=r[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let f=r[t.offset];if(t.offset++,a.push(f&127),f<128){a.reverse();let u=0;for(let l=0;l<a.length;l++)u+=a[l]<<l*7;c+=`.${u}`,a=[]}}return c}function Ou(r,t){return t.offset++,null}function Nu(r,t){let e=mr(r,t),n=r[t.offset];t.offset++;let o=r.subarray(t.offset,t.offset+e-1);if(t.offset+=e,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function Ku(r,t){let e=mr(r,t),n=r.subarray(t.offset,t.offset+e);return t.offset+=e,n}function ku(r){let t=r.toString(16);t.length%2===1&&(t="0"+t);let e=new ot;for(let n=0;n<t.length;n+=2)e.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return e}function uo(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let t=ku(r.byteLength);return new ot(Uint8Array.from([t.byteLength|co]),t)}function It(r){let t=new ot,e=128;return(r.subarray()[0]&e)===e&&t.append(Uint8Array.from([0])),t.append(r),new ot(Uint8Array.from([2]),uo(t),t)}function $r(r){let t=Uint8Array.from([0]),e=new ot(t,r);return new ot(Uint8Array.from([3]),uo(e),e)}function fe(r,t=48){let e=new ot;for(let n of r)e.append(n);return new ot(Uint8Array.from([t]),uo(e),e)}async function yi(r,t,e){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,t,e.subarray())}var Mu=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Fu=Uint8Array.from([6,5,43,129,4,0,34]),Vu=Uint8Array.from([6,5,43,129,4,0,35]),qu={ext:!0,kty:"EC",crv:"P-256"},Hu={ext:!0,kty:"EC",crv:"P-384"},zu={ext:!0,kty:"EC",crv:"P-521"},fo=32,lo=48,ho=66;function po(r){let t=Qt(r);return gi(t)}function gi(r){let t=r[1][1][0],e=1,n,o;if(t.byteLength===fo*2+1)return n=O(t.subarray(e,e+fo),"base64url"),o=O(t.subarray(e+fo),"base64url"),new He({...qu,key_ops:["verify"],x:n,y:o});if(t.byteLength===lo*2+1)return n=O(t.subarray(e,e+lo),"base64url"),o=O(t.subarray(e+lo),"base64url"),new He({...Hu,key_ops:["verify"],x:n,y:o});if(t.byteLength===ho*2+1)return n=O(t.subarray(e,e+ho),"base64url"),o=O(t.subarray(e+ho),"base64url"),new He({...zu,key_ops:["verify"],x:n,y:o});throw new ct(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function bi(r){return fe([It(Uint8Array.from([1])),fe([Gu(r.crv)],160),fe([$r(new ot(Uint8Array.from([4]),M(r.x??"","base64url"),M(r.y??"","base64url")))],161)]).subarray()}function Gu(r){if(r==="P-256")return Mu;if(r==="P-384")return Fu;if(r==="P-521")return Vu;throw new ct(`Invalid curve ${r}`)}var He=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=bi(this.jwk)),this._raw}toMultihash(){return Ut.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:dt(this.raw,t.raw)}async verify(t,e){return yi(this.jwk,e,t)}};function xi(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function $u(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ze(r,...t){if(!$u(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length))throw new Error("Uint8Array expected of length "+t+", got length="+r.length)}function wi(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xi(r.outputLen),xi(r.blockLen)}function Ge(r,t=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(t&&r.finished)throw new Error("Hash#digest() has already been called")}function Ei(r,t){ze(r);let e=t.outputLen;if(r.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}var Ae=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function jr(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ot(r,t){return r<<32-t|r>>>t}function vi(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function yr(r){return typeof r=="string"&&(r=vi(r)),ze(r),r}function mo(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];ze(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}var $e=class{clone(){return this._cloneInto()}};function Zr(r){let t=n=>r().update(yr(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}function Yr(r=32){if(Ae&&typeof Ae.getRandomValues=="function")return Ae.getRandomValues(new Uint8Array(r));if(Ae&&typeof Ae.randomBytes=="function")return Ae.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function ju(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(e>>o&s),c=Number(e&s),a=n?4:0,f=n?0:4;r.setUint32(t+a,i,n),r.setUint32(t+f,c,n)}function Si(r,t,e){return r&t^~r&e}function Ai(r,t,e){return r&t^r&e^t&e}var je=class extends $e{constructor(t,e,n,o){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=jr(this.buffer)}update(t){Ge(this);let{view:e,buffer:n,blockLen:o}=this;t=yr(t);let s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=jr(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ge(this),Ei(t,this),this.finished=!0;let{buffer:e,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(n,0),i=0);for(let l=i;l<o;l++)e[l]=0;ju(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=jr(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],s)}digest(){let{buffer:t,outputLen:e}=this;this.digestInto(t);let n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:e,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%e&&t.buffer.set(n),t}};var Wr=BigInt(4294967295),yo=BigInt(32);function Ii(r,t=!1){return t?{h:Number(r&Wr),l:Number(r>>yo&Wr)}:{h:Number(r>>yo&Wr)|0,l:Number(r&Wr)|0}}function Zu(r,t=!1){let e=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let o=0;o<r.length;o++){let{h:s,l:i}=Ii(r[o],t);[e[o],n[o]]=[s,i]}return[e,n]}var Yu=(r,t)=>BigInt(r>>>0)<<yo|BigInt(t>>>0),Wu=(r,t,e)=>r>>>e,Xu=(r,t,e)=>r<<32-e|t>>>e,Ju=(r,t,e)=>r>>>e|t<<32-e,Qu=(r,t,e)=>r<<32-e|t>>>e,tf=(r,t,e)=>r<<64-e|t>>>e-32,ef=(r,t,e)=>r>>>e-32|t<<64-e,rf=(r,t)=>t,nf=(r,t)=>r,of=(r,t,e)=>r<<e|t>>>32-e,sf=(r,t,e)=>t<<e|r>>>32-e,af=(r,t,e)=>t<<e-32|r>>>64-e,cf=(r,t,e)=>r<<e-32|t>>>64-e;function uf(r,t,e,n){let o=(t>>>0)+(n>>>0);return{h:r+e+(o/2**32|0)|0,l:o|0}}var ff=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),lf=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,df=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),hf=(r,t,e,n,o)=>t+e+n+o+(r/2**32|0)|0,pf=(r,t,e,n,o)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(o>>>0),mf=(r,t,e,n,o,s)=>t+e+n+o+s+(r/2**32|0)|0;var yf={fromBig:Ii,split:Zu,toBig:Yu,shrSH:Wu,shrSL:Xu,rotrSH:Ju,rotrSL:Qu,rotrBH:tf,rotrBL:ef,rotr32H:rf,rotr32L:nf,rotlSH:of,rotlSL:sf,rotlBH:af,rotlBL:cf,add:uf,add3L:ff,add3H:lf,add4L:df,add4H:hf,add5H:mf,add5L:pf},N=yf;var[gf,bf]=N.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),le=new Uint32Array(80),de=new Uint32Array(80),go=class extends je{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:t,Al:e,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:f,El:u,Fh:l,Fl:d,Gh:g,Gl:m,Hh:b,Hl:h}=this;return[t,e,n,o,s,i,c,a,f,u,l,d,g,m,b,h]}set(t,e,n,o,s,i,c,a,f,u,l,d,g,m,b,h){this.Ah=t|0,this.Al=e|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=f|0,this.El=u|0,this.Fh=l|0,this.Fl=d|0,this.Gh=g|0,this.Gl=m|0,this.Hh=b|0,this.Hl=h|0}process(t,e){for(let y=0;y<16;y++,e+=4)le[y]=t.getUint32(e),de[y]=t.getUint32(e+=4);for(let y=16;y<80;y++){let I=le[y-15]|0,_=de[y-15]|0,L=N.rotrSH(I,_,1)^N.rotrSH(I,_,8)^N.shrSH(I,_,7),B=N.rotrSL(I,_,1)^N.rotrSL(I,_,8)^N.shrSL(I,_,7),C=le[y-2]|0,P=de[y-2]|0,J=N.rotrSH(C,P,19)^N.rotrBH(C,P,61)^N.shrSH(C,P,6),H=N.rotrSL(C,P,19)^N.rotrBL(C,P,61)^N.shrSL(C,P,6),k=N.add4L(B,H,de[y-7],de[y-16]),at=N.add4H(k,L,J,le[y-7],le[y-16]);le[y]=at|0,de[y]=k|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:f,Dl:u,Eh:l,El:d,Fh:g,Fl:m,Gh:b,Gl:h,Hh:E,Hl:S}=this;for(let y=0;y<80;y++){let I=N.rotrSH(l,d,14)^N.rotrSH(l,d,18)^N.rotrBH(l,d,41),_=N.rotrSL(l,d,14)^N.rotrSL(l,d,18)^N.rotrBL(l,d,41),L=l&g^~l&b,B=d&m^~d&h,C=N.add5L(S,_,B,bf[y],de[y]),P=N.add5H(C,E,I,L,gf[y],le[y]),J=C|0,H=N.rotrSH(n,o,28)^N.rotrBH(n,o,34)^N.rotrBH(n,o,39),k=N.rotrSL(n,o,28)^N.rotrBL(n,o,34)^N.rotrBL(n,o,39),at=n&s^n&c^s&c,v=o&i^o&a^i&a;E=b|0,S=h|0,b=g|0,h=m|0,g=l|0,m=d|0,{h:l,l:d}=N.add(f|0,u|0,P|0,J|0),f=c|0,u=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let T=N.add3L(J,k,v);n=N.add3H(T,P,H,at),o=T|0}({h:n,l:o}=N.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=N.add(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=N.add(this.Ch|0,this.Cl|0,c|0,a|0),{h:f,l:u}=N.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:l,l:d}=N.add(this.Eh|0,this.El|0,l|0,d|0),{h:g,l:m}=N.add(this.Fh|0,this.Fl|0,g|0,m|0),{h:b,l:h}=N.add(this.Gh|0,this.Gl|0,b|0,h|0),{h:E,l:S}=N.add(this.Hh|0,this.Hl|0,E|0,S|0),this.set(n,o,s,i,c,a,f,u,l,d,g,m,b,h,E,S)}roundClean(){le.fill(0),de.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Bi=Zr(()=>new go);var Qr={};vt(Qr,{aInRange:()=>Bt,abool:()=>Nt,abytes:()=>Ze,bitGet:()=>Af,bitLen:()=>Eo,bitMask:()=>br,bitSet:()=>If,bytesToHex:()=>ee,bytesToNumberBE:()=>re,bytesToNumberLE:()=>pe,concatBytes:()=>ne,createHmacDrbg:()=>vo,ensureBytes:()=>rt,equalBytes:()=>vf,hexToBytes:()=>Be,hexToNumber:()=>wo,inRange:()=>gr,isBytes:()=>he,memoized:()=>Te,notImplemented:()=>Pf,numberToBytesBE:()=>me,numberToBytesLE:()=>Pe,numberToHexUnpadded:()=>Ie,numberToVarBytesBE:()=>Ef,utf8ToBytes:()=>Sf,validateObject:()=>$t});var Xr=BigInt(0),Jr=BigInt(1),xf=BigInt(2);function he(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ze(r){if(!he(r))throw new Error("Uint8Array expected")}function Nt(r,t){if(typeof t!="boolean")throw new Error(r+" boolean expected, got "+t)}var wf=Array.from({length:256},(r,t)=>t.toString(16).padStart(2,"0"));function ee(r){Ze(r);let t="";for(let e=0;e<r.length;e++)t+=wf[r[e]];return t}function Ie(r){let t=r.toString(16);return t.length&1?"0"+t:t}function wo(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Xr:BigInt("0x"+r)}var te={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pi(r){if(r>=te._0&&r<=te._9)return r-te._0;if(r>=te.A&&r<=te.F)return r-(te.A-10);if(r>=te.a&&r<=te.f)return r-(te.a-10)}function Be(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let t=r.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(e);for(let o=0,s=0;o<e;o++,s+=2){let i=Pi(r.charCodeAt(s)),c=Pi(r.charCodeAt(s+1));if(i===void 0||c===void 0){let a=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function re(r){return wo(ee(r))}function pe(r){return Ze(r),wo(ee(Uint8Array.from(r).reverse()))}function me(r,t){return Be(r.toString(16).padStart(t*2,"0"))}function Pe(r,t){return me(r,t).reverse()}function Ef(r){return Be(Ie(r))}function rt(r,t,e){let n;if(typeof t=="string")try{n=Be(t)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(he(t))n=Uint8Array.from(t);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof e=="number"&&o!==e)throw new Error(r+" of length "+e+" expected, got "+o);return n}function ne(...r){let t=0;for(let n=0;n<r.length;n++){let o=r[n];Ze(o),t+=o.length}let e=new Uint8Array(t);for(let n=0,o=0;n<r.length;n++){let s=r[n];e.set(s,o),o+=s.length}return e}function vf(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}function Sf(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}var bo=r=>typeof r=="bigint"&&Xr<=r;function gr(r,t,e){return bo(r)&&bo(t)&&bo(e)&&t<=r&&r<e}function Bt(r,t,e,n){if(!gr(t,e,n))throw new Error("expected valid "+r+": "+e+" <= n < "+n+", got "+t)}function Eo(r){let t;for(t=0;r>Xr;r>>=Jr,t+=1);return t}function Af(r,t){return r>>BigInt(t)&Jr}function If(r,t,e){return r|(e?Jr:Xr)<<BigInt(t)}var br=r=>(xf<<BigInt(r-1))-Jr,xo=r=>new Uint8Array(r),Ti=r=>Uint8Array.from(r);function vo(r,t,e){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let n=xo(r),o=xo(r),s=0,i=()=>{n.fill(1),o.fill(0),s=0},c=(...l)=>e(o,n,...l),a=(l=xo())=>{o=c(Ti([0]),l),n=c(),l.length!==0&&(o=c(Ti([1]),l),n=c())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,d=[];for(;l<t;){n=c();let g=n.slice();d.push(g),l+=n.length}return ne(...d)};return(l,d)=>{i(),a(l);let g;for(;!(g=d(f()));)a();return i(),g}}var Bf={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||he(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,t)=>t.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function $t(r,t,e={}){let n=(o,s,i)=>{let c=Bf[s];if(typeof c!="function")throw new Error("invalid validator function");let a=r[o];if(!(i&&a===void 0)&&!c(a,r))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+a)};for(let[o,s]of Object.entries(t))n(o,s,!1);for(let[o,s]of Object.entries(e))n(o,s,!0);return r}var Pf=()=>{throw new Error("not implemented")};function Te(r){let t=new WeakMap;return(e,...n)=>{let o=t.get(e);if(o!==void 0)return o;let s=r(e,...n);return t.set(e,s),s}}var ut=BigInt(0),Q=BigInt(1),Ce=BigInt(2),Tf=BigInt(3),So=BigInt(4),Ci=BigInt(5),Li=BigInt(8),Cf=BigInt(9),Lf=BigInt(16);function Y(r,t){let e=r%t;return e>=ut?e:t+e}function _f(r,t,e){if(t<ut)throw new Error("invalid exponent, negatives unsupported");if(e<=ut)throw new Error("invalid modulus");if(e===Q)return ut;let n=Q;for(;t>ut;)t&Q&&(n=n*r%e),r=r*r%e,t>>=Q;return n}function tt(r,t,e){let n=r;for(;t-- >ut;)n*=n,n%=e;return n}function tn(r,t){if(r===ut)throw new Error("invert: expected non-zero number");if(t<=ut)throw new Error("invert: expected positive modulus, got "+t);let e=Y(r,t),n=t,o=ut,s=Q,i=Q,c=ut;for(;e!==ut;){let f=n/e,u=n%e,l=o-i*f,d=s-c*f;n=e,e=u,o=i,s=c,i=l,c=d}if(n!==Q)throw new Error("invert: does not exist");return Y(o,t)}function Df(r){let t=(r-Q)/Ce,e,n,o;for(e=r-Q,n=0;e%Ce===ut;e/=Ce,n++);for(o=Ce;o<r&&_f(o,t,r)!==r-Q;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let i=(r+Q)/So;return function(a,f){let u=a.pow(f,i);if(!a.eql(a.sqr(u),f))throw new Error("Cannot find square root");return u}}let s=(e+Q)/Ce;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=n,u=c.pow(c.mul(c.ONE,o),e),l=c.pow(a,s),d=c.pow(a,e);for(;!c.eql(d,c.ONE);){if(c.eql(d,c.ZERO))return c.ZERO;let g=1;for(let b=c.sqr(d);g<f&&!c.eql(b,c.ONE);g++)b=c.sqr(b);let m=c.pow(u,Q<<BigInt(f-g-1));u=c.sqr(m),l=c.mul(l,m),d=c.mul(d,u),f=g}return l}}function Rf(r){if(r%So===Tf){let t=(r+Q)/So;return function(n,o){let s=n.pow(o,t);if(!n.eql(n.sqr(s),o))throw new Error("Cannot find square root");return s}}if(r%Li===Ci){let t=(r-Ci)/Li;return function(n,o){let s=n.mul(o,Ce),i=n.pow(s,t),c=n.mul(o,i),a=n.mul(n.mul(c,Ce),i),f=n.mul(c,n.sub(a,n.ONE));if(!n.eql(n.sqr(f),o))throw new Error("Cannot find square root");return f}}return r%Lf,Df(r)}var _i=(r,t)=>(Y(r,t)&Q)===Q,Uf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ao(r){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=Uf.reduce((n,o)=>(n[o]="function",n),t);return $t(r,e)}function Of(r,t,e){if(e<ut)throw new Error("invalid exponent, negatives unsupported");if(e===ut)return r.ONE;if(e===Q)return t;let n=r.ONE,o=t;for(;e>ut;)e&Q&&(n=r.mul(n,o)),o=r.sqr(o),e>>=Q;return n}function Nf(r,t){let e=new Array(t.length),n=t.reduce((s,i,c)=>r.is0(i)?s:(e[c]=s,r.mul(s,i)),r.ONE),o=r.inv(n);return t.reduceRight((s,i,c)=>r.is0(i)?s:(e[c]=r.mul(s,e[c]),r.mul(s,i)),o),e}function Io(r,t){let e=t!==void 0?t:r.toString(2).length,n=Math.ceil(e/8);return{nBitLength:e,nByteLength:n}}function ye(r,t,e=!1,n={}){if(r<=ut)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:s}=Io(r,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let i,c=Object.freeze({ORDER:r,isLE:e,BITS:o,BYTES:s,MASK:br(o),ZERO:ut,ONE:Q,create:a=>Y(a,r),isValid:a=>{if(typeof a!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof a);return ut<=a&&a<r},is0:a=>a===ut,isOdd:a=>(a&Q)===Q,neg:a=>Y(-a,r),eql:(a,f)=>a===f,sqr:a=>Y(a*a,r),add:(a,f)=>Y(a+f,r),sub:(a,f)=>Y(a-f,r),mul:(a,f)=>Y(a*f,r),pow:(a,f)=>Of(c,a,f),div:(a,f)=>Y(a*tn(f,r),r),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>tn(a,r),sqrt:n.sqrt||(a=>(i||(i=Rf(r)),i(c,a))),invertBatch:a=>Nf(c,a),cmov:(a,f,u)=>u?f:a,toBytes:a=>e?Pe(a,s):me(a,s),fromBytes:a=>{if(a.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+a.length);return e?pe(a):re(a)}});return Object.freeze(c)}function Di(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let t=r.toString(2).length;return Math.ceil(t/8)}function Bo(r){let t=Di(r);return t+Math.ceil(t/2)}function Ri(r,t,e=!1){let n=r.length,o=Di(t),s=Bo(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=e?pe(r):re(r),c=Y(i,t-Q)+Q;return e?Pe(c,o):me(c,o)}var Ui=BigInt(0),en=BigInt(1);function Po(r,t){let e=t.negate();return r?e:t}function Oi(r,t){if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+r)}function To(r,t){Oi(r,t);let e=Math.ceil(t/r)+1,n=2**(r-1);return{windows:e,windowSize:n}}function Kf(r,t){if(!Array.isArray(r))throw new Error("array expected");r.forEach((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)})}function kf(r,t){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)})}var Co=new WeakMap,Ni=new WeakMap;function Lo(r){return Ni.get(r)||1}function rn(r,t){return{constTimeNegate:Po,hasPrecomputes(e){return Lo(e)!==1},unsafeLadder(e,n,o=r.ZERO){let s=e;for(;n>Ui;)n&en&&(o=o.add(s)),s=s.double(),n>>=en;return o},precomputeWindow(e,n){let{windows:o,windowSize:s}=To(n,t),i=[],c=e,a=c;for(let f=0;f<o;f++){a=c,i.push(a);for(let u=1;u<s;u++)a=a.add(c),i.push(a);c=a.double()}return i},wNAF(e,n,o){let{windows:s,windowSize:i}=To(e,t),c=r.ZERO,a=r.BASE,f=BigInt(2**e-1),u=2**e,l=BigInt(e);for(let d=0;d<s;d++){let g=d*i,m=Number(o&f);o>>=l,m>i&&(m-=u,o+=en);let b=g,h=g+Math.abs(m)-1,E=d%2!==0,S=m<0;m===0?a=a.add(Po(E,n[b])):c=c.add(Po(S,n[h]))}return{p:c,f:a}},wNAFUnsafe(e,n,o,s=r.ZERO){let{windows:i,windowSize:c}=To(e,t),a=BigInt(2**e-1),f=2**e,u=BigInt(e);for(let l=0;l<i;l++){let d=l*c;if(o===Ui)break;let g=Number(o&a);if(o>>=u,g>c&&(g-=f,o+=en),g===0)continue;let m=n[d+Math.abs(g)-1];g<0&&(m=m.negate()),s=s.add(m)}return s},getPrecomputes(e,n,o){let s=Co.get(n);return s||(s=this.precomputeWindow(n,e),e!==1&&Co.set(n,o(s))),s},wNAFCached(e,n,o){let s=Lo(e);return this.wNAF(s,this.getPrecomputes(s,e,o),n)},wNAFCachedUnsafe(e,n,o,s){let i=Lo(e);return i===1?this.unsafeLadder(e,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,o),n,s)},setWindowSize(e,n){Oi(n,t),Ni.set(e,n),Co.delete(e)}}}function nn(r,t,e,n){if(Kf(e,r),kf(n,t),e.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,s=Eo(BigInt(e.length)),i=s>12?s-3:s>4?s-2:s?2:1,c=(1<<i)-1,a=new Array(c+1).fill(o),f=Math.floor((t.BITS-1)/i)*i,u=o;for(let l=f;l>=0;l-=i){a.fill(o);for(let g=0;g<n.length;g++){let m=n[g],b=Number(m>>BigInt(l)&BigInt(c));a[b]=a[b].add(e[g])}let d=o;for(let g=a.length-1,m=o;g>0;g--)m=m.add(a[g]),d=d.add(m);if(u=u.add(d),l!==0)for(let g=0;g<i;g++)u=u.double()}return u}function xr(r){return Ao(r.Fp),$t(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Io(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Kt=BigInt(0),Pt=BigInt(1),on=BigInt(2),Mf=BigInt(8),Ff={zip215:!0};function Vf(r){let t=xr(r);return $t(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Ki(r){let t=Vf(r),{Fp:e,n,prehash:o,hash:s,randomBytes:i,nByteLength:c,h:a}=t,f=on<<BigInt(c*8)-Pt,u=e.create,l=ye(t.n,t.nBitLength),d=t.uvRatio||((x,p)=>{try{return{isValid:!0,value:e.sqrt(x*e.inv(p))}}catch{return{isValid:!1,value:Kt}}}),g=t.adjustScalarBytes||(x=>x),m=t.domain||((x,p,w)=>{if(Nt("phflag",w),p.length||w)throw new Error("Contexts/pre-hash are not supported");return x});function b(x,p){Bt("coordinate "+x,p,Kt,f)}function h(x){if(!(x instanceof y))throw new Error("ExtendedPoint expected")}let E=Te((x,p)=>{let{ex:w,ey:A,ez:D}=x,R=x.is0();p==null&&(p=R?Mf:e.inv(D));let K=u(w*p),F=u(A*p),U=u(D*p);if(R)return{x:Kt,y:Pt};if(U!==Pt)throw new Error("invZ was invalid");return{x:K,y:F}}),S=Te(x=>{let{a:p,d:w}=t;if(x.is0())throw new Error("bad point: ZERO");let{ex:A,ey:D,ez:R,et:K}=x,F=u(A*A),U=u(D*D),j=u(R*R),X=u(j*j),ft=u(F*p),lt=u(j*u(ft+U)),pt=u(X+u(w*u(F*U)));if(lt!==pt)throw new Error("bad point: equation left != right (1)");let yt=u(A*D),St=u(R*K);if(yt!==St)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(p,w,A,D){this.ex=p,this.ey=w,this.ez=A,this.et=D,b("x",p),b("y",w),b("z",A),b("t",D),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(p){if(p instanceof y)throw new Error("extended point not allowed");let{x:w,y:A}=p||{};return b("x",w),b("y",A),new y(w,A,Pt,u(w*A))}static normalizeZ(p){let w=e.invertBatch(p.map(A=>A.ez));return p.map((A,D)=>A.toAffine(w[D])).map(y.fromAffine)}static msm(p,w){return nn(y,l,p,w)}_setWindowSize(p){L.setWindowSize(this,p)}assertValidity(){S(this)}equals(p){h(p);let{ex:w,ey:A,ez:D}=this,{ex:R,ey:K,ez:F}=p,U=u(w*F),j=u(R*D),X=u(A*F),ft=u(K*D);return U===j&&X===ft}is0(){return this.equals(y.ZERO)}negate(){return new y(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:p}=t,{ex:w,ey:A,ez:D}=this,R=u(w*w),K=u(A*A),F=u(on*u(D*D)),U=u(p*R),j=w+A,X=u(u(j*j)-R-K),ft=U+K,lt=ft-F,pt=U-K,yt=u(X*lt),St=u(ft*pt),Et=u(X*pt),zt=u(lt*ft);return new y(yt,St,zt,Et)}add(p){h(p);let{a:w,d:A}=t,{ex:D,ey:R,ez:K,et:F}=this,{ex:U,ey:j,ez:X,et:ft}=p;if(w===BigInt(-1)){let Ms=u((R-D)*(j+U)),Fs=u((R+D)*(j-U)),kn=u(Fs-Ms);if(kn===Kt)return this.double();let Vs=u(K*on*ft),qs=u(F*on*X),Hs=qs+Vs,zs=Fs+Ms,Gs=qs-Vs,mc=u(Hs*kn),yc=u(zs*Gs),gc=u(Hs*Gs),bc=u(kn*zs);return new y(mc,yc,bc,gc)}let lt=u(D*U),pt=u(R*j),yt=u(F*A*ft),St=u(K*X),Et=u((D+R)*(U+j)-lt-pt),zt=St-yt,Wt=St+yt,ar=u(pt-w*lt),lc=u(Et*zt),dc=u(Wt*ar),hc=u(Et*ar),pc=u(zt*Wt);return new y(lc,dc,pc,hc)}subtract(p){return this.add(p.negate())}wNAF(p){return L.wNAFCached(this,p,y.normalizeZ)}multiply(p){let w=p;Bt("scalar",w,Pt,n);let{p:A,f:D}=this.wNAF(w);return y.normalizeZ([A,D])[0]}multiplyUnsafe(p,w=y.ZERO){let A=p;return Bt("scalar",A,Kt,n),A===Kt?_:this.is0()||A===Pt?this:L.wNAFCachedUnsafe(this,A,y.normalizeZ,w)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}isTorsionFree(){return L.unsafeLadder(this,n).is0()}toAffine(p){return E(this,p)}clearCofactor(){let{h:p}=t;return p===Pt?this:this.multiplyUnsafe(p)}static fromHex(p,w=!1){let{d:A,a:D}=t,R=e.BYTES;p=rt("pointHex",p,R),Nt("zip215",w);let K=p.slice(),F=p[R-1];K[R-1]=F&-129;let U=pe(K),j=w?f:e.ORDER;Bt("pointHex.y",U,Kt,j);let X=u(U*U),ft=u(X-Pt),lt=u(A*X-D),{isValid:pt,value:yt}=d(ft,lt);if(!pt)throw new Error("Point.fromHex: invalid y coordinate");let St=(yt&Pt)===Pt,Et=(F&128)!==0;if(!w&&yt===Kt&&Et)throw new Error("Point.fromHex: x=0 and x_0=1");return Et!==St&&(yt=u(-yt)),y.fromAffine({x:yt,y:U})}static fromPrivateKey(p){return P(p).point}toRawBytes(){let{x:p,y:w}=this.toAffine(),A=Pe(w,e.BYTES);return A[A.length-1]|=p&Pt?128:0,A}toHex(){return ee(this.toRawBytes())}}y.BASE=new y(t.Gx,t.Gy,Pt,u(t.Gx*t.Gy)),y.ZERO=new y(Kt,Pt,Pt,Kt);let{BASE:I,ZERO:_}=y,L=rn(y,c*8);function B(x){return Y(x,n)}function C(x){return B(pe(x))}function P(x){let p=e.BYTES;x=rt("private key",x,p);let w=rt("hashed private key",s(x),2*p),A=g(w.slice(0,p)),D=w.slice(p,2*p),R=C(A),K=I.multiply(R),F=K.toRawBytes();return{head:A,prefix:D,scalar:R,point:K,pointBytes:F}}function J(x){return P(x).pointBytes}function H(x=new Uint8Array,...p){let w=ne(...p);return C(s(m(w,rt("context",x),!!o)))}function k(x,p,w={}){x=rt("message",x),o&&(x=o(x));let{prefix:A,scalar:D,pointBytes:R}=P(p),K=H(w.context,A,x),F=I.multiply(K).toRawBytes(),U=H(w.context,F,R,x),j=B(K+U*D);Bt("signature.s",j,Kt,n);let X=ne(F,Pe(j,e.BYTES));return rt("result",X,e.BYTES*2)}let at=Ff;function v(x,p,w,A=at){let{context:D,zip215:R}=A,K=e.BYTES;x=rt("signature",x,2*K),p=rt("message",p),w=rt("publicKey",w,K),R!==void 0&&Nt("zip215",R),o&&(p=o(p));let F=pe(x.slice(K,2*K)),U,j,X;try{U=y.fromHex(w,R),j=y.fromHex(x.slice(0,K),R),X=I.multiplyUnsafe(F)}catch{return!1}if(!R&&U.isSmallOrder())return!1;let ft=H(D,j.toRawBytes(),U.toRawBytes(),p);return j.add(U.multiplyUnsafe(ft)).subtract(X).clearCofactor().equals(y.ZERO)}return I._setWindowSize(8),{CURVE:t,getPublicKey:J,sign:k,verify:v,ExtendedPoint:y,utils:{getExtendedPublicKey:P,randomPrivateKey:()=>i(e.BYTES),precompute(x=8,p=y.BASE){return p._setWindowSize(x),p.multiply(BigInt(3)),p}}}}var _o=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ki=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Gp=BigInt(0),qf=BigInt(1),Mi=BigInt(2),$p=BigInt(3),Hf=BigInt(5),zf=BigInt(8);function Gf(r){let t=BigInt(10),e=BigInt(20),n=BigInt(40),o=BigInt(80),s=_o,c=r*r%s*r%s,a=tt(c,Mi,s)*c%s,f=tt(a,qf,s)*r%s,u=tt(f,Hf,s)*f%s,l=tt(u,t,s)*u%s,d=tt(l,e,s)*l%s,g=tt(d,n,s)*d%s,m=tt(g,o,s)*g%s,b=tt(m,o,s)*g%s,h=tt(b,t,s)*u%s;return{pow_p_5_8:tt(h,Mi,s)*r%s,b2:c}}function $f(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function jf(r,t){let e=_o,n=Y(t*t*t,e),o=Y(n*n*t,e),s=Gf(r*o).pow_p_5_8,i=Y(r*n*s,e),c=Y(t*i*i,e),a=i,f=Y(i*ki,e),u=c===r,l=c===Y(-r,e),d=c===Y(-r*ki,e);return u&&(i=a),(l||d)&&(i=f),_i(i,e)&&(i=Y(-i,e)),{isValid:u||l,value:i}}var Zf=ye(_o,void 0,!0),Yf={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Zf,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:zf,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Bi,randomBytes:Yr,adjustScalarBytes:$f,uvRatio:jf},Fi=Ki(Yf);var sn=32;function Vi(r,t,e){return Fi.verify(t,e instanceof Uint8Array?e:e.subarray(),r)}var an=class{type="Ed25519";raw;constructor(t){this.raw=Do(t,sn)}toMultihash(){return Ut.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:dt(this.raw,t.raw)}verify(t,e){return Vi(this.raw,e,t)}};function Ro(r){return r=Do(r,sn),new an(r)}function Do(r,t){if(r=Uint8Array.from(r??[]),r.length!==t)throw new ct(`Key must be a Uint8Array of length ${t}, got ${r.length}`);return r}var Xf=Math.pow(2,7),Jf=Math.pow(2,14),Qf=Math.pow(2,21),Uo=Math.pow(2,28),Oo=Math.pow(2,35),No=Math.pow(2,42),Ko=Math.pow(2,49),$=128,gt=127;function bt(r){if(r<Xf)return 1;if(r<Jf)return 2;if(r<Qf)return 3;if(r<Uo)return 4;if(r<Oo)return 5;if(r<No)return 6;if(r<Ko)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ko(r,t,e=0){switch(bt(r)){case 8:t[e++]=r&255|$,r/=128;case 7:t[e++]=r&255|$,r/=128;case 6:t[e++]=r&255|$,r/=128;case 5:t[e++]=r&255|$,r/=128;case 4:t[e++]=r&255|$,r>>>=7;case 3:t[e++]=r&255|$,r>>>=7;case 2:t[e++]=r&255|$,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function tl(r,t,e=0){switch(bt(r)){case 8:t.set(e++,r&255|$),r/=128;case 7:t.set(e++,r&255|$),r/=128;case 6:t.set(e++,r&255|$),r/=128;case 5:t.set(e++,r&255|$),r/=128;case 4:t.set(e++,r&255|$),r>>>=7;case 3:t.set(e++,r&255|$),r>>>=7;case 2:t.set(e++,r&255|$),r>>>=7;case 1:{t.set(e++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return t}function Mo(r,t){let e=r[t],n=0;if(n+=e&gt,e<$||(e=r[t+1],n+=(e&gt)<<7,e<$)||(e=r[t+2],n+=(e&gt)<<14,e<$)||(e=r[t+3],n+=(e&gt)<<21,e<$)||(e=r[t+4],n+=(e&gt)*Uo,e<$)||(e=r[t+5],n+=(e&gt)*Oo,e<$)||(e=r[t+6],n+=(e&gt)*No,e<$)||(e=r[t+7],n+=(e&gt)*Ko,e<$))return n;throw new RangeError("Could not decode varint")}function el(r,t){let e=r.get(t),n=0;if(n+=e&gt,e<$||(e=r.get(t+1),n+=(e&gt)<<7,e<$)||(e=r.get(t+2),n+=(e&gt)<<14,e<$)||(e=r.get(t+3),n+=(e&gt)<<21,e<$)||(e=r.get(t+4),n+=(e&gt)*Uo,e<$)||(e=r.get(t+5),n+=(e&gt)*Oo,e<$)||(e=r.get(t+6),n+=(e&gt)*No,e<$)||(e=r.get(t+7),n+=(e&gt)*Ko,e<$))return n;throw new RangeError("Could not decode varint")}function _t(r,t,e=0){return t==null&&(t=At(bt(r))),t instanceof Uint8Array?ko(r,t,e):tl(r,t,e)}function oe(r,t=0){return r instanceof Uint8Array?Mo(r,t):el(r,t)}var Fo=new Float32Array([-0]),ge=new Uint8Array(Fo.buffer);function Hi(r,t,e){Fo[0]=r,t[e]=ge[0],t[e+1]=ge[1],t[e+2]=ge[2],t[e+3]=ge[3]}function zi(r,t){return ge[0]=r[t],ge[1]=r[t+1],ge[2]=r[t+2],ge[3]=r[t+3],Fo[0]}var Vo=new Float64Array([-0]),xt=new Uint8Array(Vo.buffer);function Gi(r,t,e){Vo[0]=r,t[e]=xt[0],t[e+1]=xt[1],t[e+2]=xt[2],t[e+3]=xt[3],t[e+4]=xt[4],t[e+5]=xt[5],t[e+6]=xt[6],t[e+7]=xt[7]}function $i(r,t){return xt[0]=r[t],xt[1]=r[t+1],xt[2]=r[t+2],xt[3]=r[t+3],xt[4]=r[t+4],xt[5]=r[t+5],xt[6]=r[t+6],xt[7]=r[t+7],Vo[0]}var rl=BigInt(Number.MAX_SAFE_INTEGER),nl=BigInt(Number.MIN_SAFE_INTEGER),Lt=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Le;if(t<rl&&t>nl)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,o=t-(n<<32n);return e&&(n=~n|0n,o=~o|0n,++o>ji&&(o=0n,++n>ji&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(t){if(t===0)return Le;let e=t<0;e&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return e&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):Le}},Le=new Lt(0,0);Le.toBigInt=function(){return 0n};Le.zzEncode=Le.zzDecode=function(){return this};Le.length=function(){return 1};var ji=4294967296n;function Zi(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function Yi(r,t,e){if(e-t<1)return"";let o,s=[],i=0,c;for(;t<e;)c=r[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|r[t++]&63:c>239&&c<365?(c=((c&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(r[t++]&63)<<6|r[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function qo(r,t,e){let n=e,o,s;for(let i=0;i<r.length;++i)o=r.charCodeAt(i),o<128?t[e++]=o:o<2048?(t[e++]=o>>6|192,t[e++]=o&63|128):(o&64512)===55296&&((s=r.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[e++]=o>>18|240,t[e++]=o>>12&63|128,t[e++]=o>>6&63|128,t[e++]=o&63|128):(t[e++]=o>>12|224,t[e++]=o>>6&63|128,t[e++]=o&63|128);return e-n}function kt(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function un(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var Ho=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,kt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw kt(this,4);return un(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw kt(this,4);return un(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw kt(this,4);let t=zi(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw kt(this,4);let t=$i(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw kt(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return Yi(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw kt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw kt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new Lt(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw kt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw kt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw kt(this,8);let t=un(this.buf,this.pos+=4),e=un(this.buf,this.pos+=4);return new Lt(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Mo(this.buf,this.pos);return this.pos+=bt(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function zo(r){return new Ho(r instanceof Uint8Array?r:r.subarray())}function Mt(r,t,e){let n=zo(r);return t.decode(n,void 0,e)}function Go(r){let t=r??8192,e=t>>>1,n,o=t;return function(i){if(i<1||i>e)return At(i);o+i>t&&(n=At(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var _e=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function $o(){}var Zo=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},ol=Go();function sl(r){return globalThis.Buffer!=null?At(r):ol(r)}var Er=class{len;head;tail;states;constructor(){this.len=0,this.head=new _e($o,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new _e(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Yo((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(fn,10,Lt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=Lt.fromBigInt(t);return this._push(fn,e.length(),e)}uint64Number(t){return this._push(ko,bt(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=Lt.fromBigInt(t).zzEncode();return this._push(fn,e.length(),e)}sint64Number(t){let e=Lt.fromNumber(t).zzEncode();return this._push(fn,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(jo,1,t?1:0)}fixed32(t){return this._push(wr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=Lt.fromBigInt(t);return this._push(wr,4,e.lo)._push(wr,4,e.hi)}fixed64Number(t){let e=Lt.fromNumber(t);return this._push(wr,4,e.lo)._push(wr,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Hi,4,t)}double(t){return this._push(Gi,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(jo,1,0):this.uint32(e)._push(al,e,t)}string(t){let e=Zi(t);return e!==0?this.uint32(e)._push(qo,e,t):this._push(jo,1,0)}fork(){return this.states=new Zo(this),this.head=this.tail=new _e($o,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new _e($o,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=sl(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function jo(r,t,e){t[e]=r&255}function il(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var Yo=class extends _e{next;constructor(t,e){super(il,t,e),this.next=void 0}};function fn(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function wr(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function al(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(Er.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(cl,t,r),this},Er.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(ul,t,r),this});function cl(r,t,e){t.set(r,e)}function ul(r,t,e){r.length<40?qo(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(M(r),e)}function Wo(){return new Er}function Ft(r,t){let e=Wo();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var Ye;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Ye||(Ye={}));function ln(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function Xo(r){function t(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let e=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return ln("enum",Ye.VARINT,e,n)}function Vt(r,t){return ln("message",Ye.LENGTH_DELIMITED,r,t)}var De=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var st;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(st||(st={}));var Jo;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Jo||(Jo={}));(function(r){r.codec=()=>Xo(Jo)})(st||(st={}));var jt;(function(r){let t;r.codec=()=>(t==null&&(t=Vt((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),st.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let c=e.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(c&7);break}}}return s})),t),r.encode=e=>Ft(e,r.codec()),r.decode=(e,n)=>Mt(e,r.codec(),n)})(jt||(jt={}));var Qo;(function(r){let t;r.codec=()=>(t==null&&(t=Vt((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.Type!=null&&(n.uint32(8),st.codec().encode(e.Type,n)),e.Data!=null&&(n.uint32(18),n.bytes(e.Data)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let c=e.uint32();switch(c>>>3){case 1:{s.Type=st.codec().decode(e);break}case 2:{s.Data=e.bytes();break}default:{e.skipType(c&7);break}}}return s})),t),r.encode=e=>Ft(e,r.codec()),r.decode=(e,n)=>Mt(e,r.codec(),n)})(Qo||(Qo={}));var vr=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},dn=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Ji={get(r=globalThis){let t=r.crypto;if(t?.subtle==null)throw new dn("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var be=Ji;var Ar={};vt(Ar,{MAX_RSA_KEY_SIZE:()=>es,generateRSAKeyPair:()=>ra,jwkToJWKKeyPair:()=>na,jwkToPkcs1:()=>pl,jwkToPkix:()=>ss,jwkToRSAPrivateKey:()=>us,pkcs1MessageToJwk:()=>ns,pkcs1MessageToRSAPrivateKey:()=>is,pkcs1ToJwk:()=>hl,pkcs1ToRSAPrivateKey:()=>ea,pkixMessageToJwk:()=>os,pkixMessageToRSAPublicKey:()=>cs,pkixToJwk:()=>ml,pkixToRSAPublicKey:()=>as});var fl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),we=new Uint32Array(64),ts=class extends je{constructor(){super(64,32,8,!1),this.A=xe[0]|0,this.B=xe[1]|0,this.C=xe[2]|0,this.D=xe[3]|0,this.E=xe[4]|0,this.F=xe[5]|0,this.G=xe[6]|0,this.H=xe[7]|0}get(){let{A:t,B:e,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,e,n,o,s,i,c,a]}set(t,e,n,o,s,i,c,a){this.A=t|0,this.B=e|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,e){for(let l=0;l<16;l++,e+=4)we[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){let d=we[l-15],g=we[l-2],m=Ot(d,7)^Ot(d,18)^d>>>3,b=Ot(g,17)^Ot(g,19)^g>>>10;we[l]=b+we[l-7]+m+we[l-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){let d=Ot(c,6)^Ot(c,11)^Ot(c,25),g=u+d+Si(c,a,f)+fl[l]+we[l]|0,b=(Ot(n,2)^Ot(n,13)^Ot(n,22))+Ai(n,o,s)|0;u=f,f=a,a=c,c=i+g|0,i=s,s=o,o=n,n=g+b|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,o,s,i,c,a,f,u)}roundClean(){we.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var We=Zr(()=>new ts);var Xe=class{type="RSA";jwk;_raw;_multihash;constructor(t,e){this.jwk=t,this._multihash=e}get raw(){return this._raw==null&&(this._raw=Ar.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return it.createV1(114,this._multihash)}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:dt(this.raw,t.raw)}verify(t,e){return ta(this.jwk,e,t)}},Sr=class{type="RSA";jwk;_raw;publicKey;constructor(t,e){this.jwk=t,this.publicKey=e}get raw(){return this._raw==null&&(this._raw=Ar.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:dt(this.raw,t.raw)}sign(t){return Qi(this.jwk,t)}};var es=8192,rs=18,ll=1062,dl=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function hl(r){let t=Qt(r);return ns(t)}function ns(r){return{n:O(r[1],"base64url"),e:O(r[2],"base64url"),d:O(r[3],"base64url"),p:O(r[4],"base64url"),q:O(r[5],"base64url"),dp:O(r[6],"base64url"),dq:O(r[7],"base64url"),qi:O(r[8],"base64url"),kty:"RSA"}}function pl(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ct("JWK was missing components");return fe([It(Uint8Array.from([0])),It(M(r.n,"base64url")),It(M(r.e,"base64url")),It(M(r.d,"base64url")),It(M(r.p,"base64url")),It(M(r.q,"base64url")),It(M(r.dp,"base64url")),It(M(r.dq,"base64url")),It(M(r.qi,"base64url"))]).subarray()}function ml(r){let t=Qt(r,{offset:0});return os(t)}function os(r){let t=Qt(r[1],{offset:0});return{kty:"RSA",n:O(t[0],"base64url"),e:O(t[1],"base64url")}}function ss(r){if(r.n==null||r.e==null)throw new ct("JWK was missing components");return fe([dl,$r(fe([It(M(r.n,"base64url")),It(M(r.e,"base64url"))]))]).subarray()}function ea(r){let t=Qt(r);return is(t)}function is(r){let t=ns(r);return us(t)}function as(r,t){if(r.byteLength>=ll)throw new ke("Key size is too large");let e=Qt(r,{offset:0});return cs(e,r,t)}function cs(r,t,e){let n=os(r);if(e==null){let o=We(jt.encode({Type:st.RSA,Data:t}));e=Rt(rs,o)}return new Xe(n,e)}function us(r){if(sa(r)>es)throw new ct("Key size is too large");let t=na(r),e=We(jt.encode({Type:st.RSA,Data:ss(t.publicKey)})),n=Rt(rs,e);return new Sr(t.privateKey,new Xe(t.publicKey,n))}async function ra(r){if(r>es)throw new ct("Key size is too large");let t=await oa(r),e=We(jt.encode({Type:st.RSA,Data:ss(t.publicKey)})),n=Rt(rs,e);return new Sr(t.privateKey,new Xe(t.publicKey,n))}function na(r){if(r==null)throw new ct("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function oa(r){let t=await be.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),e=await yl(t);return{privateKey:e[0],publicKey:e[1]}}async function Qi(r,t){let e=await be.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await be.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},e,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(n,0,n.byteLength)}async function ta(r,t,e){let n=await be.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return be.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,e instanceof Uint8Array?e:e.subarray())}async function yl(r){if(r.privateKey==null||r.publicKey==null)throw new ct("Private and public key are required");return Promise.all([be.get().subtle.exportKey("jwk",r.privateKey),be.get().subtle.exportKey("jwk",r.publicKey)])}function sa(r){if(r.kty!=="RSA")throw new ct("invalid key type");if(r.n==null)throw new ct("invalid key modulus");return M(r.n,"base64url").length*8}var hn=class extends $e{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,wi(t);let n=yr(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return Ge(this),this.iHash.update(t),this}digestInto(t){Ge(this),ze(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:e,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},fs=(r,t,e)=>new hn(r,t).update(e).digest();fs.create=(r,t)=>new hn(r,t);function ia(r){r.lowS!==void 0&&Nt("lowS",r.lowS),r.prehash!==void 0&&Nt("prehash",r.prehash)}function gl(r){let t=xr(r);$t(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:e,Fp:n,a:o}=t;if(e){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:bl,hexToBytes:xl}=Qr,ls=class extends Error{constructor(t=""){super(t)}},se={Err:ls,_tlv:{encode:(r,t)=>{let{Err:e}=se;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");let n=t.length/2,o=Ie(n);if(o.length/2&128)throw new e("tlv.encode: long form length too big");let s=n>127?Ie(o.length/2|128):"";return Ie(r)+s+o+t},decode(r,t){let{Err:e}=se,n=0;if(r<0||r>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[n++]!==r)throw new e("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new e("tlv.decode(long): indefinite length not supported");if(a>4)throw new e("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+a);if(f.length!==a)throw new e("tlv.decode: length bytes not complete");if(f[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(let u of f)i=i<<8|u;if(n+=a,i<128)throw new e("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new e("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(r){let{Err:t}=se;if(r<ie)throw new t("integer: negative integers are not allowed");let e=Ie(r);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(r){let{Err:t}=se;if(r[0]&128)throw new t("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bl(r)}},toSig(r){let{Err:t,_int:e,_tlv:n}=se,o=typeof r=="string"?xl(r):r;Ze(o);let{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:f,l:u}=n.decode(2,a);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(c),s:e.decode(f)}},hexFromSig(r){let{_tlv:t,_int:e}=se,n=t.encode(2,e.encode(r.r)),o=t.encode(2,e.encode(r.s)),s=n+o;return t.encode(48,s)}},ie=BigInt(0),ht=BigInt(1),Em=BigInt(2),aa=BigInt(3),vm=BigInt(4);function wl(r){let t=gl(r),{Fp:e}=t,n=ye(t.n,t.nBitLength),o=t.toBytes||((b,h,E)=>{let S=h.toAffine();return ne(Uint8Array.from([4]),e.toBytes(S.x),e.toBytes(S.y))}),s=t.fromBytes||(b=>{let h=b.subarray(1),E=e.fromBytes(h.subarray(0,e.BYTES)),S=e.fromBytes(h.subarray(e.BYTES,2*e.BYTES));return{x:E,y:S}});function i(b){let{a:h,b:E}=t,S=e.sqr(b),y=e.mul(S,b);return e.add(e.add(y,e.mul(b,h)),E)}if(!e.eql(e.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function c(b){return gr(b,ht,t.n)}function a(b){let{allowedPrivateKeyLengths:h,nByteLength:E,wrapPrivateKey:S,n:y}=t;if(h&&typeof b!="bigint"){if(he(b)&&(b=ee(b)),typeof b!="string"||!h.includes(b.length))throw new Error("invalid private key");b=b.padStart(E*2,"0")}let I;try{I=typeof b=="bigint"?b:re(rt("private key",b,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof b)}return S&&(I=Y(I,y)),Bt("private key",I,ht,y),I}function f(b){if(!(b instanceof d))throw new Error("ProjectivePoint expected")}let u=Te((b,h)=>{let{px:E,py:S,pz:y}=b;if(e.eql(y,e.ONE))return{x:E,y:S};let I=b.is0();h==null&&(h=I?e.ONE:e.inv(y));let _=e.mul(E,h),L=e.mul(S,h),B=e.mul(y,h);if(I)return{x:e.ZERO,y:e.ZERO};if(!e.eql(B,e.ONE))throw new Error("invZ was invalid");return{x:_,y:L}}),l=Te(b=>{if(b.is0()){if(t.allowInfinityPoint&&!e.is0(b.py))return;throw new Error("bad point: ZERO")}let{x:h,y:E}=b.toAffine();if(!e.isValid(h)||!e.isValid(E))throw new Error("bad point: x or y not FE");let S=e.sqr(E),y=i(h);if(!e.eql(S,y))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(h,E,S){if(this.px=h,this.py=E,this.pz=S,h==null||!e.isValid(h))throw new Error("x required");if(E==null||!e.isValid(E))throw new Error("y required");if(S==null||!e.isValid(S))throw new Error("z required");Object.freeze(this)}static fromAffine(h){let{x:E,y:S}=h||{};if(!h||!e.isValid(E)||!e.isValid(S))throw new Error("invalid affine point");if(h instanceof d)throw new Error("projective point not allowed");let y=I=>e.eql(I,e.ZERO);return y(E)&&y(S)?d.ZERO:new d(E,S,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){let E=e.invertBatch(h.map(S=>S.pz));return h.map((S,y)=>S.toAffine(E[y])).map(d.fromAffine)}static fromHex(h){let E=d.fromAffine(s(rt("pointHex",h)));return E.assertValidity(),E}static fromPrivateKey(h){return d.BASE.multiply(a(h))}static msm(h,E){return nn(d,n,h,E)}_setWindowSize(h){m.setWindowSize(this,h)}assertValidity(){l(this)}hasEvenY(){let{y:h}=this.toAffine();if(e.isOdd)return!e.isOdd(h);throw new Error("Field doesn't support isOdd")}equals(h){f(h);let{px:E,py:S,pz:y}=this,{px:I,py:_,pz:L}=h,B=e.eql(e.mul(E,L),e.mul(I,y)),C=e.eql(e.mul(S,L),e.mul(_,y));return B&&C}negate(){return new d(this.px,e.neg(this.py),this.pz)}double(){let{a:h,b:E}=t,S=e.mul(E,aa),{px:y,py:I,pz:_}=this,L=e.ZERO,B=e.ZERO,C=e.ZERO,P=e.mul(y,y),J=e.mul(I,I),H=e.mul(_,_),k=e.mul(y,I);return k=e.add(k,k),C=e.mul(y,_),C=e.add(C,C),L=e.mul(h,C),B=e.mul(S,H),B=e.add(L,B),L=e.sub(J,B),B=e.add(J,B),B=e.mul(L,B),L=e.mul(k,L),C=e.mul(S,C),H=e.mul(h,H),k=e.sub(P,H),k=e.mul(h,k),k=e.add(k,C),C=e.add(P,P),P=e.add(C,P),P=e.add(P,H),P=e.mul(P,k),B=e.add(B,P),H=e.mul(I,_),H=e.add(H,H),P=e.mul(H,k),L=e.sub(L,P),C=e.mul(H,J),C=e.add(C,C),C=e.add(C,C),new d(L,B,C)}add(h){f(h);let{px:E,py:S,pz:y}=this,{px:I,py:_,pz:L}=h,B=e.ZERO,C=e.ZERO,P=e.ZERO,J=t.a,H=e.mul(t.b,aa),k=e.mul(E,I),at=e.mul(S,_),v=e.mul(y,L),T=e.add(E,S),x=e.add(I,_);T=e.mul(T,x),x=e.add(k,at),T=e.sub(T,x),x=e.add(E,y);let p=e.add(I,L);return x=e.mul(x,p),p=e.add(k,v),x=e.sub(x,p),p=e.add(S,y),B=e.add(_,L),p=e.mul(p,B),B=e.add(at,v),p=e.sub(p,B),P=e.mul(J,x),B=e.mul(H,v),P=e.add(B,P),B=e.sub(at,P),P=e.add(at,P),C=e.mul(B,P),at=e.add(k,k),at=e.add(at,k),v=e.mul(J,v),x=e.mul(H,x),at=e.add(at,v),v=e.sub(k,v),v=e.mul(J,v),x=e.add(x,v),k=e.mul(at,x),C=e.add(C,k),k=e.mul(p,x),B=e.mul(T,B),B=e.sub(B,k),k=e.mul(T,at),P=e.mul(p,P),P=e.add(P,k),new d(B,C,P)}subtract(h){return this.add(h.negate())}is0(){return this.equals(d.ZERO)}wNAF(h){return m.wNAFCached(this,h,d.normalizeZ)}multiplyUnsafe(h){let{endo:E,n:S}=t;Bt("scalar",h,ie,S);let y=d.ZERO;if(h===ie)return y;if(this.is0()||h===ht)return this;if(!E||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,h,d.normalizeZ);let{k1neg:I,k1:_,k2neg:L,k2:B}=E.splitScalar(h),C=y,P=y,J=this;for(;_>ie||B>ie;)_&ht&&(C=C.add(J)),B&ht&&(P=P.add(J)),J=J.double(),_>>=ht,B>>=ht;return I&&(C=C.negate()),L&&(P=P.negate()),P=new d(e.mul(P.px,E.beta),P.py,P.pz),C.add(P)}multiply(h){let{endo:E,n:S}=t;Bt("scalar",h,ht,S);let y,I;if(E){let{k1neg:_,k1:L,k2neg:B,k2:C}=E.splitScalar(h),{p:P,f:J}=this.wNAF(L),{p:H,f:k}=this.wNAF(C);P=m.constTimeNegate(_,P),H=m.constTimeNegate(B,H),H=new d(e.mul(H.px,E.beta),H.py,H.pz),y=P.add(H),I=J.add(k)}else{let{p:_,f:L}=this.wNAF(h);y=_,I=L}return d.normalizeZ([y,I])[0]}multiplyAndAddUnsafe(h,E,S){let y=d.BASE,I=(L,B)=>B===ie||B===ht||!L.equals(y)?L.multiplyUnsafe(B):L.multiply(B),_=I(this,E).add(I(h,S));return _.is0()?void 0:_}toAffine(h){return u(this,h)}isTorsionFree(){let{h,isTorsionFree:E}=t;if(h===ht)return!0;if(E)return E(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h,clearCofactor:E}=t;return h===ht?this:E?E(d,this):this.multiplyUnsafe(t.h)}toRawBytes(h=!0){return Nt("isCompressed",h),this.assertValidity(),o(d,this,h)}toHex(h=!0){return Nt("isCompressed",h),ee(this.toRawBytes(h))}}d.BASE=new d(t.Gx,t.Gy,e.ONE),d.ZERO=new d(e.ZERO,e.ONE,e.ZERO);let g=t.nBitLength,m=rn(d,t.endo?Math.ceil(g/2):g);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:c}}function El(r){let t=xr(r);return $t(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function ca(r){let t=El(r),{Fp:e,n}=t,o=e.BYTES+1,s=2*e.BYTES+1;function i(v){return Y(v,n)}function c(v){return tn(v,n)}let{ProjectivePoint:a,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:l}=wl({...t,toBytes(v,T,x){let p=T.toAffine(),w=e.toBytes(p.x),A=ne;return Nt("isCompressed",x),x?A(Uint8Array.from([T.hasEvenY()?2:3]),w):A(Uint8Array.from([4]),w,e.toBytes(p.y))},fromBytes(v){let T=v.length,x=v[0],p=v.subarray(1);if(T===o&&(x===2||x===3)){let w=re(p);if(!gr(w,ht,e.ORDER))throw new Error("Point is not on curve");let A=u(w),D;try{D=e.sqrt(A)}catch(F){let U=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+U)}let R=(D&ht)===ht;return(x&1)===1!==R&&(D=e.neg(D)),{x:w,y:D}}else if(T===s&&x===4){let w=e.fromBytes(p.subarray(0,e.BYTES)),A=e.fromBytes(p.subarray(e.BYTES,2*e.BYTES));return{x:w,y:A}}else{let w=o,A=s;throw new Error("invalid Point, expected length of "+w+", or uncompressed "+A+", got "+T)}}}),d=v=>ee(me(v,t.nByteLength));function g(v){let T=n>>ht;return v>T}function m(v){return g(v)?i(-v):v}let b=(v,T,x)=>re(v.slice(T,x));class h{constructor(T,x,p){this.r=T,this.s=x,this.recovery=p,this.assertValidity()}static fromCompact(T){let x=t.nByteLength;return T=rt("compactSignature",T,x*2),new h(b(T,0,x),b(T,x,2*x))}static fromDER(T){let{r:x,s:p}=se.toSig(rt("DER",T));return new h(x,p)}assertValidity(){Bt("r",this.r,ht,n),Bt("s",this.s,ht,n)}addRecoveryBit(T){return new h(this.r,this.s,T)}recoverPublicKey(T){let{r:x,s:p,recovery:w}=this,A=L(rt("msgHash",T));if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");let D=w===2||w===3?x+t.n:x;if(D>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");let R=(w&1)===0?"02":"03",K=a.fromHex(R+d(D)),F=c(D),U=i(-A*F),j=i(p*F),X=a.BASE.multiplyAndAddUnsafe(K,U,j);if(!X)throw new Error("point at infinify");return X.assertValidity(),X}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new h(this.r,i(-this.s),this.recovery):this}toDERRawBytes(){return Be(this.toDERHex())}toDERHex(){return se.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Be(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}let E={isValidPrivateKey(v){try{return f(v),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{let v=Bo(t.n);return Ri(t.randomBytes(v),t.n)},precompute(v=8,T=a.BASE){return T._setWindowSize(v),T.multiply(BigInt(3)),T}};function S(v,T=!0){return a.fromPrivateKey(v).toRawBytes(T)}function y(v){let T=he(v),x=typeof v=="string",p=(T||x)&&v.length;return T?p===o||p===s:x?p===2*o||p===2*s:v instanceof a}function I(v,T,x=!0){if(y(v))throw new Error("first arg must be private key");if(!y(T))throw new Error("second arg must be public key");return a.fromHex(T).multiply(f(v)).toRawBytes(x)}let _=t.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");let T=re(v),x=v.length*8-t.nBitLength;return x>0?T>>BigInt(x):T},L=t.bits2int_modN||function(v){return i(_(v))},B=br(t.nBitLength);function C(v){return Bt("num < 2^"+t.nBitLength,v,ie,B),me(v,t.nByteLength)}function P(v,T,x=J){if(["recovered","canonical"].some(lt=>lt in x))throw new Error("sign() legacy options not supported");let{hash:p,randomBytes:w}=t,{lowS:A,prehash:D,extraEntropy:R}=x;A==null&&(A=!0),v=rt("msgHash",v),ia(x),D&&(v=rt("prehashed msgHash",p(v)));let K=L(v),F=f(T),U=[C(F),C(K)];if(R!=null&&R!==!1){let lt=R===!0?w(e.BYTES):R;U.push(rt("extraEntropy",lt))}let j=ne(...U),X=K;function ft(lt){let pt=_(lt);if(!l(pt))return;let yt=c(pt),St=a.BASE.multiply(pt).toAffine(),Et=i(St.x);if(Et===ie)return;let zt=i(yt*i(X+Et*F));if(zt===ie)return;let Wt=(St.x===Et?0:2)|Number(St.y&ht),ar=zt;return A&&g(zt)&&(ar=m(zt),Wt^=1),new h(Et,ar,Wt)}return{seed:j,k2sig:ft}}let J={lowS:t.lowS,prehash:!1},H={lowS:t.lowS,prehash:!1};function k(v,T,x=J){let{seed:p,k2sig:w}=P(v,T,x),A=t;return vo(A.hash.outputLen,A.nByteLength,A.hmac)(p,w)}a.BASE._setWindowSize(8);function at(v,T,x,p=H){let w=v;T=rt("msgHash",T),x=rt("publicKey",x);let{lowS:A,prehash:D,format:R}=p;if(ia(p),"strict"in p)throw new Error("options.strict was renamed to lowS");if(R!==void 0&&R!=="compact"&&R!=="der")throw new Error("format must be compact or der");let K=typeof w=="string"||he(w),F=!K&&!R&&typeof w=="object"&&w!==null&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!K&&!F)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let U,j;try{if(F&&(U=new h(w.r,w.s)),K){try{R!=="compact"&&(U=h.fromDER(w))}catch(Wt){if(!(Wt instanceof se.Err))throw Wt}!U&&R!=="der"&&(U=h.fromCompact(w))}j=a.fromHex(x)}catch{return!1}if(!U||A&&U.hasHighS())return!1;D&&(T=t.hash(T));let{r:X,s:ft}=U,lt=L(T),pt=c(ft),yt=i(lt*pt),St=i(X*pt),Et=a.BASE.multiplyAndAddUnsafe(j,yt,St)?.toAffine();return Et?i(Et.x)===X:!1}return{CURVE:t,getPublicKey:S,getSharedSecret:I,sign:k,verify:at,ProjectivePoint:a,Signature:h,utils:E}}function vl(r){return{hash:r,hmac:(t,...e)=>fs(r,t,mo(...e)),randomBytes:Yr}}function ua(r,t){let e=n=>ca({...r,...vl(n)});return{...e(t),create:e}}var da=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),fa=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Sl=BigInt(1),ds=BigInt(2),la=(r,t)=>(r+t/ds)/t;function Al(r){let t=da,e=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=r*r*r%t,u=f*f*r%t,l=tt(u,e,t)*u%t,d=tt(l,e,t)*u%t,g=tt(d,ds,t)*f%t,m=tt(g,o,t)*g%t,b=tt(m,s,t)*m%t,h=tt(b,c,t)*b%t,E=tt(h,a,t)*h%t,S=tt(E,c,t)*b%t,y=tt(S,e,t)*u%t,I=tt(y,i,t)*m%t,_=tt(I,n,t)*f%t,L=tt(_,ds,t);if(!hs.eql(hs.sqr(L),r))throw new Error("Cannot find square root");return L}var hs=ye(da,void 0,void 0,{sqrt:Al}),Re=ua({a:BigInt(0),b:BigInt(7),Fp:hs,n:fa,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let t=fa,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Sl*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=e,i=BigInt("0x100000000000000000000000000000000"),c=la(s*r,t),a=la(-n*r,t),f=Y(r-c*e-a*o,t),u=Y(-c*n-a*s,t),l=f>i,d=u>i;if(l&&(f=t-f),d&&(u=t-u),f>i||u>i)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:l,k1:f,k2neg:d,k2:u}}}},We),_m=BigInt(0);var Dm=Re.ProjectivePoint;function ha(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function pa(r,t,e){let n=dr.digest(e instanceof Uint8Array?e:e.subarray());if(ha(n))return n.then(({digest:o})=>Re.verify(t,o,r)).catch(o=>{throw new vr(String(o))});try{return Re.verify(t,n.digest,r)}catch(o){throw new vr(String(o))}}var pn=class{type="secp256k1";raw;_key;constructor(t){this._key=ya(t),this.raw=ma(this._key)}toMultihash(){return Ut.digest(Gt(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return W.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:dt(this.raw,t.raw)}verify(t,e){return pa(this._key,e,t)}};function ps(r){return new pn(r)}function ma(r){return Re.ProjectivePoint.fromHex(r).toRawBytes(!0)}function ya(r){try{return Re.ProjectivePoint.fromHex(r),r}catch(t){throw new ke(String(t))}}function Je(r,t){let{Type:e,Data:n}=jt.decode(r),o=n??new Uint8Array;switch(e){case st.RSA:return as(o,t);case st.Ed25519:return Ro(o);case st.secp256k1:return ps(o);case st.ECDSA:return po(o);default:throw new ve}}function ga(r){let{Type:t,Data:e}=jt.decode(r.digest),n=e??new Uint8Array;switch(t){case st.Ed25519:return Ro(n);case st.secp256k1:return ps(n);case st.ECDSA:return po(n);default:throw new ve}}function Gt(r){return jt.encode({Type:st[r.type],Data:r.raw})}var Ir;(function(r){let t;r.codec=()=>(t==null&&(t=Vt((e,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),e.publicKey!=null&&e.publicKey.byteLength>0&&(n.uint32(10),n.bytes(e.publicKey)),e.payloadType!=null&&e.payloadType.byteLength>0&&(n.uint32(18),n.bytes(e.payloadType)),e.payload!=null&&e.payload.byteLength>0&&(n.uint32(26),n.bytes(e.payload)),e.signature!=null&&e.signature.byteLength>0&&(n.uint32(42),n.bytes(e.signature)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={publicKey:mt(0),payloadType:mt(0),payload:mt(0),signature:mt(0)},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let c=e.uint32();switch(c>>>3){case 1:{s.publicKey=e.bytes();break}case 2:{s.payloadType=e.bytes();break}case 3:{s.payload=e.bytes();break}case 5:{s.signature=e.bytes();break}default:{e.skipType(c&7);break}}}return s})),t),r.encode=e=>Ft(e,r.codec()),r.decode=(e,n)=>Mt(e,r.codec(),n)})(Ir||(Ir={}));var mn=class extends Error{constructor(t="Invalid signature"){super(t),this.name="InvalidSignatureError"}};var Zt=class r{static createFromProtobuf=async t=>{let e=Ir.decode(t),n=Je(e.publicKey);return new r({publicKey:n,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};static seal=async(t,e)=>{if(e==null)throw new Error("Missing private key");let n=t.domain,o=t.codec,s=t.marshal(),i=ba(n,o,s),c=await e.sign(i.subarray());return new r({publicKey:e.publicKey,payloadType:o,payload:s,signature:c})};static openAndCertify=async(t,e)=>{let n=await r.createFromProtobuf(t);if(!await n.validate(e))throw new mn("Envelope signature is not valid for the given domain");return n};publicKey;payloadType;payload;signature;marshaled;constructor(t){let{publicKey:e,payloadType:n,payload:o,signature:s}=t;this.publicKey=e,this.payloadType=n,this.payload=o,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=Ir.encode({publicKey:Gt(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return dt(this.marshal(),t.marshal())}async validate(t){let e=ba(t,this.payloadType,this.payload);return this.publicKey.verify(e.subarray(),this.signature)}},ba=(r,t,e)=>{let n=M(r),o=_t(n.byteLength),s=_t(t.length),i=_t(e.length);return new ot(o,n,s,t,i,e)};var xa=Symbol.for("nodejs.util.inspect.custom"),Il=114,Br=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Mn]=!0;toString(){return this.string==null&&(this.string=W.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return it.createV1(Il,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return dt(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return dt(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[xa](){return`PeerId(${this.toString()})`}},Pr=class extends Br{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Tr=class extends Br{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},Cr=class extends Br{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Bl=2336,Lr=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Ut.digest(M(this.url))}[xa](){return`PeerId(${this.url})`}[Mn]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return it.createV1(Bl,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=O(t)),t.toString()===this.toString())}};var Pl=114,wa=2336;function Ea(r){if(r.type==="Ed25519")return new Tr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Cr({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new Pr({multihash:r.toCID().multihash,publicKey:r});throw new ve}function ms(r){if(Cl(r))return new Pr({multihash:r});if(Tl(r))try{let t=ga(r);if(t.type==="Ed25519")return new Tr({multihash:r,publicKey:t});if(t.type==="secp256k1")return new Cr({multihash:r,publicKey:t})}catch{let e=O(r.digest);return new Lr(new URL(e))}throw new Fr("Supplied PeerID Multihash is invalid")}function yn(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==Pl&&r.code!==wa)throw new Mr("Supplied PeerID CID is invalid");if(r.code===wa){let t=O(r.multihash.digest);return new Lr(new URL(t))}return ms(r.multihash)}function Tl(r){return r.code===Ut.code}function Cl(r){return r.code===dr.code}function va(r,t){let e=(n,o)=>n.toString().localeCompare(o.toString());return r.length!==t.length?!1:(t.sort(e),r.sort(e).every((n,o)=>t[o].equals(n)))}var gn=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let e=this.index,n=t();return n===void 0&&(this.index=e),n}parseWith(t){let e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let e=this.readChar();if(e===t)return e})}readSeparator(t,e,n){return this.readAtomically(()=>{if(!(e>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,e,n,o){return this.readAtomically(()=>{let s=0,i=0,c=this.peekChar();if(c===void 0)return;let a=c==="0",f=2**(8*o)-1;for(;;){let u=this.readAtomically(()=>{let l=this.readChar();if(l===void 0)return;let d=Number.parseInt(l,t);if(!Number.isNaN(d))return d});if(u===void 0)break;if(s*=t,s+=u,s>f||(i+=1,e!==void 0&&i>e))return}if(i!==0)return!n&&a&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let e=0;e<t.length;e++){let n=this.readSeparator(".",e,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[e]=n}return t})}readIPv6Addr(){let t=e=>{for(let n=0;n<e.length/2;n++){let o=n*2;if(n<e.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];e[o]=s>>8,e[o+1]=s&255}return[e.length,!1]};return this.readAtomically(()=>{let e=new Uint8Array(16),[n,o]=t(e);if(n===16)return e;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[c]=t(s.subarray(0,i));return e.set(s.subarray(0,c),16-c),e})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Sa=45,Ll=15,Qe=new gn;function bn(r){if(!(r.length>Ll))return Qe.new(r).parseWith(()=>Qe.readIPv4Addr())}function xn(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>Sa))return Qe.new(r).parseWith(()=>Qe.readIPv6Addr())}function Ue(r,t=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>Sa)return;let e=Qe.new(r).parseWith(()=>Qe.readIPAddr());if(e)return t&&e.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,e[0],e[1],e[2],e[3]]):e}function Aa(r,t,e){let n=0;for(let o of r)if(!(n<t)){if(n>e)break;if(o!==255)return!1;n++}return!0}function Ia(r,t,e,n){let o=0;for(let s of r)if(!(o<e)){if(o>n)break;if(s!==t[o])return!1;o++}return!0}function ys(r){switch(r.length){case Oe:return r.join(".");case Ne:{let t=[];for(let e=0;e<r.length;e++)e%2===0&&t.push(r[e].toString(16).padStart(2,"0")+r[e+1].toString(16).padStart(2,"0"));return t.join(":")}default:throw new Error("Invalid ip length")}}function Ba(r){let t=0;for(let[e,n]of r.entries()){if(n===255){t+=8;continue}for(;(n&128)!=0;)t++,n=n<<1;if((n&128)!=0)return-1;for(let o=e+1;o<r.length;o++)if(r[o]!=0)return-1;break}return t}function Pa(r){let t="0x";for(let e of r)t+=(e>>4).toString(16)+(e&15).toString(16);return t}var Oe=4,Ne=16,rg=parseInt("0xFFFF",16),_l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function _r(r,t){t.length===Ne&&r.length===Oe&&Aa(t,0,11)&&(t=t.slice(12)),t.length===Oe&&r.length===Ne&&Ia(r,_l,0,11)&&(r=r.slice(12));let e=r.length;if(e!=t.length)throw new Error("Failed to mask ip");let n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=r[o]&t[o];return n}function Ta(r,t){if(typeof t=="string"&&(t=Ue(t)),t==null)throw new Error("Invalid ip");if(t.length!==r.network.length)return!1;for(let e=0;e<t.length;e++)if((r.network[e]&r.mask[e])!==(t[e]&r.mask[e]))return!1;return!0}function gs(r){let[t,e]=r.split("/");if(!t||!e)throw new Error("Failed to parse given CIDR: "+r);let n=Oe,o=bn(t);if(o==null&&(n=Ne,o=xn(t),o==null))throw new Error("Failed to parse given CIDR: "+r);let s=parseInt(e,10);if(Number.isNaN(s)||String(s).length!==e.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);let i=bs(s,8*n);return{network:_r(o,i),mask:i}}function bs(r,t){if(t!==8*Oe&&t!==8*Ne)throw new Error("Invalid CIDR mask");if(r<0||r>t)throw new Error("Invalid CIDR mask");let e=t/8,n=new Uint8Array(e);for(let o=0;o<e;o++){if(r>=8){n[o]=255,r-=8;continue}n[o]=255-(255>>r),r=0}return n}var tr=class{constructor(t,e){if(e==null)({network:this.network,mask:this.mask}=gs(t));else{let n=Ue(t);if(n==null)throw new Error("Failed to parse network");e=String(e);let o=parseInt(e,10);if(Number.isNaN(o)||String(o).length!==e.length||o<0||o>n.length*8){let s=Ue(e);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=bs(o,8*n.length);this.network=_r(n,this.mask)}}contains(t){return Ta({network:this.network,mask:this.mask},t)}toString(){let t=Ba(this.mask),e=t!==-1?String(t):Pa(this.mask);return ys(this.network)+"/"+e}};function Ca(r,t){return new tr(r).contains(t)}function er(r){return!!bn(r)}function rr(r){return!!xn(r)}function wn(r){return!!Ue(r)}var La=er,Dl=rr,xs=function(r){let t=0;if(r=r.toString().trim(),La(r)){let e=new Uint8Array(t+4);return r.split(/\./g).forEach(n=>{e[t++]=parseInt(n,10)&255}),e}if(Dl(r)){let e=r.split(":",8),n;for(n=0;n<e.length;n++){let s=La(e[n]),i;s&&(i=xs(e[n]),e[n]=O(i.slice(0,2),"base16")),i!=null&&++n<8&&e.splice(n,0,O(i.slice(2,4),"base16"))}if(e[0]==="")for(;e.length<8;)e.unshift("0");else if(e[e.length-1]==="")for(;e.length<8;)e.push("0");else if(e.length<8){for(n=0;n<e.length&&e[n]!=="";n++);let s=[n,1];for(n=9-e.length;n>0;n--)s.push("0");e.splice.apply(e,s)}let o=new Uint8Array(t+16);for(n=0;n<e.length;n++){let s=parseInt(e[n],16);o[t++]=s>>8&255,o[t++]=s&255}return o}throw new Error("invalid ip address")},_a=function(r,t=0,e){t=~~t,e=e??r.length-t;let n=new DataView(r.buffer);if(e===4){let o=[];for(let s=0;s<e;s++)o.push(r[t+s]);return o.join(".")}if(e===16){let o=[];for(let s=0;s<e;s+=2)o.push(n.getUint16(t+s).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var nr={},ws={},Ul=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]];Ul.forEach(r=>{let t=Ol(...r);ws[t.code]=t,nr[t.name]=t});function Ol(r,t,e,n,o){return{code:r,size:t,name:e,resolvable:!!n,path:!!o}}function z(r){if(typeof r=="number"){if(ws[r]!=null)return ws[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(nr[r]!=null)return nr[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var Og=z("ip4"),Ng=z("ip6"),Kg=z("ipcidr");function As(r,t){switch(z(r).code){case 4:case 41:return Kl(t);case 42:return Ss(t);case 43:return O(t,"base10");case 6:case 273:case 33:case 132:return Ua(t).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ss(t);case 421:return Vl(t);case 444:return Ra(t);case 445:return Ra(t);case 466:return Fl(t);case 481:return globalThis.encodeURIComponent(Ss(t));default:return O(t,"base16")}}function Is(r,t){switch(z(r).code){case 4:return Da(t);case 41:return Da(t);case 42:return vs(t);case 43:return M(t,"base10");case 6:case 273:case 33:case 132:return Bs(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return vs(t);case 421:return kl(t);case 444:return ql(t);case 445:return Hl(t);case 466:return Ml(t);case 481:return vs(globalThis.decodeURIComponent(t));default:return M(t,"base16")}}var Es=Object.values(hr).map(r=>r.decoder),Nl=function(){let r=Es[0].or(Es[1]);return Es.slice(2).forEach(t=>r=r.or(t)),r}();function Da(r){if(!wn(r))throw new Error("invalid ip address");return xs(r)}function Kl(r){let t=_a(r,0,r.length);if(t==null)throw new Error("ipBuff is required");if(!wn(t))throw new Error("invalid ip address");return t}function Bs(r){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,r),new Uint8Array(t)}function Ua(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function vs(r){let t=M(r),e=Uint8Array.from(_t(t.length));return Ct([e,t],e.length+t.length)}function Ss(r){let t=oe(r);if(r=r.slice(bt(t)),r.length!==t)throw new Error("inconsistent lengths");return O(r)}function kl(r){let t;r[0]==="Q"||r[0]==="1"?t=Se(W.decode(`z${r}`)).bytes:t=it.parse(r).multihash.bytes;let e=Uint8Array.from(_t(t.length));return Ct([e,t],e.length+t.length)}function Ml(r){let t=Nl.decode(r),e=Uint8Array.from(_t(t.length));return Ct([e,t],e.length+t.length)}function Fl(r){let t=oe(r),e=r.slice(bt(t));if(e.length!==t)throw new Error("inconsistent lengths");return"u"+O(e,"base64url")}function Vl(r){let t=oe(r),e=r.slice(bt(t));if(e.length!==t)throw new Error("inconsistent lengths");return O(e,"base58btc")}function ql(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let e=Jt.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Bs(n);return Ct([e,o],e.length+o.length)}function Hl(r){let t=r.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let e=Jt.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Bs(n);return Ct([e,o],e.length+o.length)}function Ra(r){let t=r.slice(0,r.length-2),e=r.slice(r.length-2),n=O(t,"base32"),o=Ua(e);return`${n}:${o}`}function Oa(r){r=Ps(r);let t=[],e=[],n=null,o=r.split("/").slice(1);if(o.length===1&&o[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<o.length;s++){let i=o[s],c=z(i);if(c.size===0){t.push([c.code]),e.push([c.code]);continue}if(s++,s>=o.length)throw new En("invalid address: "+r);if(c.path===!0){n=Ps(o.slice(s).join("/")),t.push([c.code,Is(c.code,n)]),e.push([c.code,n]);break}let a=Is(c.code,o[s]);t.push([c.code,a]),e.push([c.code,As(c.code,a)])}return{string:Na(e),bytes:vn(t),tuples:t,stringTuples:e,path:n}}function Ts(r){let t=[],e=[],n=null,o=0;for(;o<r.length;){let s=oe(r,o),i=bt(s),c=z(s),a=zl(c,r.slice(o+i));if(a===0){t.push([s]),e.push([s]),o+=i;continue}let f=r.slice(o+i,o+i+a);if(o+=a+i,o>r.length)throw new En("Invalid address Uint8Array: "+O(r,"base16"));t.push([s,f]);let u=As(s,f);if(e.push([s,u]),c.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:Na(e),tuples:t,stringTuples:e,path:n}}function Na(r){let t=[];return r.map(e=>{let n=z(e[0]);return t.push(n.name),e.length>1&&e[1]!=null&&t.push(e[1]),null}),Ps(t.join("/"))}function vn(r){return Ct(r.map(t=>{let e=z(t[0]),n=Uint8Array.from(_t(e.code));return t.length>1&&t[1]!=null&&(n=Ct([n,t[1]])),n}))}function zl(r,t){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let e=oe(t instanceof Uint8Array?t:Uint8Array.from(t));return e+bt(e)}}function Ps(r){return"/"+r.trim().split("/").filter(t=>t).join("/")}var En=class extends Error{static name="ParseError";name="ParseError";constructor(t){super(`Error parsing address: ${t}`)}};var Gl=Symbol.for("nodejs.util.inspect.custom"),Ls=Symbol.for("@multiformats/js-multiaddr/multiaddr"),$l=[z("dns").code,z("dns4").code,z("dns6").code,z("dnsaddr").code],Cs=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}},Sn=class r{bytes;#e;#t;#r;#n;[Ls]=!0;constructor(t){t==null&&(t="");let e;if(t instanceof Uint8Array)e=Ts(t);else if(typeof t=="string"){if(t.length>0&&t.charAt(0)!=="/")throw new Error(`multiaddr "${t}" must start with a "/"`);e=Oa(t)}else if(ka(t))e=Ts(t.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=e.bytes,this.#e=e.string,this.#t=e.tuples,this.#r=e.stringTuples,this.#n=e.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let t,e,n,o,s="",i=z("tcp"),c=z("udp"),a=z("ip4"),f=z("ip6"),u=z("dns6"),l=z("ip6zone");for(let[g,m]of this.stringTuples())g===l.code&&(s=`%${m??""}`),$l.includes(g)&&(e=i.name==="tcp"?"tcp":"udp",o=443,n=`${m??""}${s}`,t=g===u.code?6:4),(g===i.code||g===c.code)&&(e=z(g).name==="tcp"?"tcp":"udp",o=parseInt(m??"")),(g===a.code||g===f.code)&&(e=z(g).name==="tcp"?"tcp":"udp",n=`${m??""}${s}`,t=g===f.code?6:4);if(t==null||e==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:e,port:o}}protos(){return this.#t.map(([t])=>Object.assign({},z(t)))}protoCodes(){return this.#t.map(([t])=>t)}protoNames(){return this.#t.map(([t])=>z(t).name)}tuples(){return this.#t.map(([t,e])=>e==null?[t]:[t,e])}stringTuples(){return this.#r.map(([t,e])=>e==null?[t]:[t,e])}encapsulate(t){return t=new r(t),new r(this.toString()+t.toString())}decapsulate(t){let e=t.toString(),n=this.toString(),o=n.lastIndexOf(e);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new r(n.slice(0,o))}decapsulateCode(t){let e=this.tuples();for(let n=e.length-1;n>=0;n--)if(e[n][0]===t)return new r(vn(e.slice(0,n)));return this}getPeerId(){try{let t=[];this.stringTuples().forEach(([n,o])=>{n===nr.p2p.code&&t.push([n,o]),n===nr["p2p-circuit"].code&&(t=[])});let e=t.pop();if(e?.[1]!=null){let n=e[1];return n[0]==="Q"||n[0]==="1"?O(W.decode(`z${n}`),"base58btc"):O(it.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#n}equals(t){return dt(this.bytes,t.bytes)}async resolve(t){let e=this.protos().find(s=>s.resolvable);if(e==null)return[this];let n=Ka.get(e.name);if(n==null)throw new Cs(`no available resolver for ${e.name}`);return(await n(this,t)).map(s=>Yt(s))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){let e=(t??this).protos();return!(e.length!==2||e[0].code!==4&&e[0].code!==41||e[1].code!==6&&e[1].code!==273)}[Gl](){return`Multiaddr(${this.#e})`}};var Ka=new Map;function ka(r){return!!r?.[Ls]}function Yt(r){return new Sn(r)}var Ma="libp2p-peer-record",Fa=Uint8Array.from([3,1]);var Dr;(function(r){let t;(function(n){let o;n.codec=()=>(o==null&&(o=Vt((s,i,c={})=>{c.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),c.lengthDelimited!==!1&&i.ldelim()},(s,i,c={})=>{let a={multiaddr:mt(0)},f=i==null?s.len:s.pos+i;for(;s.pos<f;){let u=s.uint32();switch(u>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(u&7);break}}}return a})),o),n.encode=s=>Ft(s,n.codec()),n.decode=(s,i)=>Mt(s,n.codec(),i)})(t=r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=Vt((n,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(o.uint32(10),o.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(o.uint32(16),o.uint64(n.seq)),n.addresses!=null)for(let i of n.addresses)o.uint32(26),r.AddressInfo.codec().encode(i,o);s.lengthDelimited!==!1&&o.ldelim()},(n,o,s={})=>{let i={peerId:mt(0),seq:0n,addresses:[]},c=o==null?n.len:n.pos+o;for(;n.pos<c;){let a=n.uint32();switch(a>>>3){case 1:{i.peerId=n.bytes();break}case 2:{i.seq=n.uint64();break}case 3:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new De('Decode error - map field "addresses" had too many elements');i.addresses.push(r.AddressInfo.codec().decode(n,n.uint32(),{limits:s.limits?.addresses$}));break}default:{n.skipType(a&7);break}}}return i})),e),r.encode=n=>Ft(n,r.codec()),r.decode=(n,o)=>Mt(n,r.codec(),o)})(Dr||(Dr={}));var qt=class r{static createFromProtobuf=t=>{let e=Dr.decode(t),n=ms(Se(e.peerId)),o=(e.addresses??[]).map(i=>Yt(i.multiaddr)),s=e.seq;return new r({peerId:n,multiaddrs:o,seqNumber:s})};static DOMAIN=Ma;static CODEC=Fa;peerId;multiaddrs;seqNumber;domain=r.DOMAIN;codec=r.CODEC;marshaled;constructor(t){let{peerId:e,multiaddrs:n,seqNumber:o}=t;this.peerId=e,this.multiaddrs=n??[],this.seqNumber=o??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Dr.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(t=>({multiaddr:t.bytes}))})),this.marshaled}equals(t){return!(!(t instanceof r)||!this.peerId.equals(t.peerId)||this.seqNumber!==t.seqNumber||!va(this.multiaddrs,t.multiaddrs))}};function jl(r){return r[Symbol.asyncIterator]!=null}function Zl(r){if(jl(r))return(async()=>{for await(let t of r);})();for(let t of r);}var Va=Zl;function Ht(){let r={};return r.promise=new Promise((t,e)=>{r.resolve=t,r.reject=e}),r}var An=globalThis.CustomEvent??Event;async function*_s(r,t={}){let e=t.concurrency??1/0;e<1&&(e=1/0);let n=t.ordered??!1,o=new EventTarget,s=[],i=Ht(),c=Ht(),a=!1,f,u=!1;o.addEventListener("task-complete",()=>{c.resolve()}),Promise.resolve().then(async()=>{try{for await(let m of r){if(s.length===e&&(i=Ht(),await i.promise),u)break;let b={done:!1};s.push(b),m().then(h=>{b.done=!0,b.ok=!0,b.value=h,o.dispatchEvent(new An("task-complete"))},h=>{b.done=!0,b.err=h,o.dispatchEvent(new An("task-complete"))})}a=!0,o.dispatchEvent(new An("task-complete"))}catch(m){f=m,o.dispatchEvent(new An("task-complete"))}});function l(){return n?s[0]?.done:!!s.find(m=>m.done)}function*d(){for(;s.length>0&&s[0].done;){let m=s[0];if(s.shift(),m.ok)yield m.value;else throw u=!0,i.resolve(),m.err;i.resolve()}}function*g(){for(;l();)for(let m=0;m<s.length;m++)if(s[m].done){let b=s[m];if(s.splice(m,1),m--,b.ok)yield b.value;else throw u=!0,i.resolve(),b.err;i.resolve()}}for(;;){if(l()||(c=Ht(),await c.promise),f!=null)throw f;if(n?yield*d():yield*g(),a&&s.length===0)break}}var In=class extends Error{type;code;constructor(t,e,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=e??"ABORT_ERR"}};async function Rr(r,t,e){if(t==null)return r;if(t.aborted)return r.catch(()=>{}),Promise.reject(new In(e?.errorMessage,e?.errorCode,e?.errorName));let n,o=new In(e?.errorMessage,e?.errorCode,e?.errorName);try{return await Promise.race([r,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var Ds=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Ht(),this.haveNext=Ht()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ht(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,e){await this._push(t,e)}async end(t,e){t!=null?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ht(),await Rr(this.readNext.promise,e?.signal,e)}};function qa(){return new Ds}var Bn=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Ha(r,t){let e=qa();r.sink(e).catch(async i=>{await e.end(i)}),r.sink=async i=>{for await(let c of i)await e.push(c);await e.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new ot;return{read:async i=>{if(i?.signal?.throwIfAborted(),i?.bytes==null){let{done:a,value:f}=await Rr(n.next(),i?.signal);return a===!0?null:f}for(;o.byteLength<i.bytes;){let{value:a,done:f}=await Rr(n.next(),i?.signal);if(f===!0)throw new Bn("unexpected end of input");o.append(a)}let c=o.sublist(0,i.bytes);return o.consume(i.bytes),c},write:async(i,c)=>{c?.signal?.throwIfAborted(),i instanceof Uint8Array?await e.push(i,c):await e.push(i.subarray(),c)},unwrap:()=>{if(o.byteLength>0){let i=r.source;r.source=async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i}()}return r}}}var Pn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Tn=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Cn=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function za(r,t={}){let e=Ha(r,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=bt(t.maxDataLength));let n=t?.lengthDecoder??oe,o=t?.lengthEncoder??_t;return{read:async i=>{let c=-1,a=new ot;for(;;){a.append(await e.read({...i,bytes:1}));try{c=n(a)}catch(f){if(f instanceof RangeError)continue;throw f}if(c<0)throw new Pn("Invalid message length");if(t?.maxLengthLength!=null&&a.byteLength>t.maxLengthLength)throw new Cn("message length length too long");if(c>-1)break}if(t?.maxDataLength!=null&&c>t.maxDataLength)throw new Tn("message length too long");return e.read({...i,bytes:c})},write:async(i,c)=>{await e.write(new ot(o(i.byteLength),i),c)},writeV:async(i,c)=>{let a=new ot(...i.flatMap(f=>[o(f.byteLength),f]));await e.write(a,c)},unwrap:()=>e.unwrap()}}function or(r,t){let e=za(r,t),n={read:async(o,s)=>{let i=await e.read(s);return o.decode(i)},write:async(o,s,i)=>{await e.write(s.encode(o),i)},writeV:async(o,s,i)=>{await e.writeV(o.map(c=>s.encode(c)),i)},pb:o=>({read:async s=>n.read(o,s),write:async(s,i)=>n.write(s,o,i),writeV:async(s,i)=>n.writeV(s,o,i),unwrap:()=>n}),unwrap:()=>e.unwrap()};return n}var Ga="0.1.0",$a="id",ja="id/push",Za="1.0.0",Ya="1.0.0";var Ee;(function(r){let t;r.codec=()=>(t==null&&(t=Vt((e,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),e.protocolVersion!=null&&(n.uint32(42),n.string(e.protocolVersion)),e.agentVersion!=null&&(n.uint32(50),n.string(e.agentVersion)),e.publicKey!=null&&(n.uint32(10),n.bytes(e.publicKey)),e.listenAddrs!=null)for(let s of e.listenAddrs)n.uint32(18),n.bytes(s);if(e.observedAddr!=null&&(n.uint32(34),n.bytes(e.observedAddr)),e.protocols!=null)for(let s of e.protocols)n.uint32(26),n.string(s);e.signedPeerRecord!=null&&(n.uint32(66),n.bytes(e.signedPeerRecord)),o.lengthDelimited!==!1&&n.ldelim()},(e,n,o={})=>{let s={listenAddrs:[],protocols:[]},i=n==null?e.len:e.pos+n;for(;e.pos<i;){let c=e.uint32();switch(c>>>3){case 5:{s.protocolVersion=e.string();break}case 6:{s.agentVersion=e.string();break}case 1:{s.publicKey=e.bytes();break}case 2:{if(o.limits?.listenAddrs!=null&&s.listenAddrs.length===o.limits.listenAddrs)throw new De('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(e.bytes());break}case 4:{s.observedAddr=e.bytes();break}case 3:{if(o.limits?.protocols!=null&&s.protocols.length===o.limits.protocols)throw new De('Decode error - map field "protocols" had too many elements');s.protocols.push(e.string());break}case 8:{s.signedPeerRecord=e.bytes();break}default:{e.skipType(c&7);break}}}return s})),t),r.encode=e=>Ft(e,r.codec()),r.decode=(e,n)=>Mt(e,r.codec(),n)})(Ee||(Ee={}));var Tt={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:8192,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:32};function Wa(r){if(r!=null&&r.length>0)try{return Yt(r)}catch{}}function Xl(r,t){return t??r.userAgent}async function Ln(r,t,e,n,o){if(e("received identify from %p",n.remotePeer),o==null)throw new Dt("message was null or undefined");let s={};if(o.listenAddrs.length>0&&(s.addresses=o.listenAddrs.map(a=>({isCertified:!1,multiaddr:Yt(a)}))),o.protocols.length>0&&(s.protocols=o.protocols),o.publicKey!=null){let a=Je(o.publicKey);if(!Ea(a).equals(n.remotePeer))throw new Dt("public key did not match remote PeerId");s.publicKey=a}let i;if(o.signedPeerRecord!=null){e.trace("received signedPeerRecord from %p",n.remotePeer);let a=o.signedPeerRecord,f=await Zt.openAndCertify(a,qt.DOMAIN),u=qt.createFromProtobuf(f.payload),l=yn(f.publicKey.toCID());if(!u.peerId.equals(l))throw new Dt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new Dt("signing key does not match remote PeerId");let d;try{d=await r.get(u.peerId)}catch(g){if(g.name!=="NotFoundError")throw g}if(d!=null&&(s.metadata=d.metadata,d.peerRecordEnvelope!=null)){let g=await Zt.createFromProtobuf(d.peerRecordEnvelope),m=qt.createFromProtobuf(g.payload);m.seqNumber>=u.seqNumber&&(e("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,u.seqNumber),u=m,a=d.peerRecordEnvelope)}s.peerRecordEnvelope=a,s.addresses=u.multiaddrs.map(g=>({isCertified:!0,multiaddr:g})),i={seq:u.seqNumber,addresses:u.multiaddrs}}else e("%p did not send a signed peer record",n.remotePeer);if(e.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),o.agentVersion!=null||o.protocolVersion!=null){let a={};o.agentVersion!=null&&(a.AgentVersion=M(o.agentVersion)),o.protocolVersion!=null&&(a.ProtocolVersion=M(o.protocolVersion)),e.trace("merging %p metadata",n.remotePeer,a),await r.merge(n.remotePeer,{metadata:a})}let c={peerId:n.remotePeer,protocolVersion:o.protocolVersion,agentVersion:o.agentVersion,publicKey:o.publicKey,listenAddrs:o.listenAddrs.map(a=>Yt(a)),observedAddr:o.observedAddr==null?void 0:Yt(o.observedAddr),protocols:o.protocols,signedPeerRecord:i,connection:n};return t.safeDispatchEvent("peer:identify",{detail:c}),c}var sr=class{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(t,e){this.protocol=e.protocol,this.started=!1,this.peerId=t.peerId,this.privateKey=t.privateKey,this.peerStore=t.peerStore,this.registrar=t.registrar,this.addressManager=t.addressManager,this.events=t.events,this.log=e.log,this.timeout=e.timeout??Tt.timeout,this.maxInboundStreams=e.maxInboundStreams??Tt.maxInboundStreams,this.maxOutboundStreams=e.maxOutboundStreams??Tt.maxOutboundStreams,this.maxMessageSize=e.maxMessageSize??Tt.maxMessageSize,this.maxObservedAddresses=e.maxObservedAddresses??Tt.maxObservedAddresses,this.runOnLimitedConnection=e.runOnLimitedConnection??Tt.runOnLimitedConnection,this.host={protocolVersion:`${e.protocolPrefix??Tt.protocolPrefix}/${Ga}`,agentVersion:Xl(t.nodeInfo,e.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:M(this.host.agentVersion),ProtocolVersion:M(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,t=>{this.handleProtocol(t).catch(e=>{this.log.error(e)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}};var _n=class extends sr{connectionManager;concurrency;constructor(t,e={}){super(t,{...e,protocol:`/${e.protocolPrefix??Tt.protocolPrefix}/${ja}/${Ya}`,log:t.logger.forComponent("libp2p:identify-push")}),this.connectionManager=t.connectionManager,this.concurrency=e.concurrency??Tt.concurrency,(e.runOnSelfUpdate??Tt.runOnSelfUpdate)&&t.events.addEventListener("self:peer:update",n=>{this.push().catch(o=>{this.log.error(o)})})}[qr]=["@libp2p/identify-push"];async push(){if(!this.isStarted())return;let t=this.addressManager.getAddresses().map(u=>u.decapsulateCode(z("p2p").code)),e=new qt({peerId:this.peerId,multiaddrs:t}),n=await Zt.seal(e,this.privateKey),o=this.registrar.getProtocols(),s=await this.peerStore.get(this.peerId),i=O(s.metadata.get("AgentVersion")??M(this.host.agentVersion)),c=O(s.metadata.get("ProtocolVersion")??M(this.host.protocolVersion)),a=this;async function*f(){for(let u of a.connectionManager.getConnections())(await a.peerStore.get(u.remotePeer)).protocols.includes(a.protocol)&&(yield async()=>{let d,g=AbortSignal.timeout(a.timeout);try{d=await u.newStream(a.protocol,{signal:g,runOnLimitedConnection:a.runOnLimitedConnection}),await or(d,{maxDataLength:a.maxMessageSize}).pb(Ee).write({listenAddrs:t.map(b=>b.bytes),signedPeerRecord:n.marshal(),protocols:o,agentVersion:i,protocolVersion:c},{signal:g}),await d.close({signal:g})}catch(m){a.log.error("could not push identify update to peer",m),d?.abort(m)}})}await Va(_s(f(),{concurrency:this.concurrency}))}async handleProtocol(t){let{connection:e,stream:n}=t;try{if(this.peerId.equals(e.remotePeer))throw new Error("received push from ourselves?");let o={signal:AbortSignal.timeout(this.timeout)},i=await or(n,{maxDataLength:this.maxMessageSize}).pb(Ee).read(o);await n.close(o),await Ln(this.peerStore,this.events,this.log,e,i)}catch(o){this.log.error("received invalid message",o),n.abort(o);return}this.log.trace("handled push from %p",e.remotePeer)}};var Ql=41;function Xa(r){try{let[[t,e]]=r.stringTuples();if(e==null)return!1;if(t===Ql)return Ca("2000::/3",e)}catch{}return!1}var Qa=Ic(Ja(),1),td=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],ed=td.map(r=>new Qa.Netmask(r));function Rs(r){for(let t of ed)if(t.contains(r))return!0;return!1}function rd(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function nd(r){let t=r.split(":");if(t.length<2)return!1;let e=t[t.length-1].padStart(4,"0"),n=t[t.length-2].padStart(4,"0"),o=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(e.substring(0,2),16)}.${parseInt(e.substring(2),16)}`;return Rs(o)}function od(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function sd(r){let t=r.split(":"),e=t[t.length-1];return Rs(e)}function id(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function tc(r){return er(r)?Rs(r):rd(r)?nd(r):od(r)?sd(r):rr(r)?id(r):void 0}function ec(r){try{let[[t]]=r.stringTuples();return t===4||t===41}catch{}return!1}function rc(r){try{if(!ec(r))return!1;let[[,t]]=r.stringTuples();return t==null?!1:tc(t)??!1}catch{}return!0}var ad=r=>r.toString().split("/").slice(1),ir=r=>({match:t=>t.length<1?!1:r(t[0])?t.slice(1):!1,pattern:"fn"}),V=r=>({match:t=>ir(e=>e===r).match(t),pattern:r}),Ke=()=>({match:r=>ir(t=>typeof t=="string").match(r),pattern:"{string}"}),Or=()=>({match:r=>ir(t=>!isNaN(parseInt(t))).match(r),pattern:"{number}"}),Z=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{W.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),Nr=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{to.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),G=r=>({match:t=>{let e=r.match(t);return e===!1?t:e},pattern:`optional(${r.pattern})`}),wt=(...r)=>({match:t=>{let e;for(let n of r){let o=n.match(t);o!==!1&&(e==null||o.length<e.length)&&(e=o)}return e??!1},pattern:`or(${r.map(t=>t.pattern).join(", ")})`}),q=(...r)=>({match:t=>{for(let e of r){let n=e.match(t);if(n===!1)return!1;t=n}return t},pattern:`and(${r.map(t=>t.pattern).join(", ")})`});function et(...r){function t(o){let s=ad(o);for(let i of r){let c=i.match(s);if(c===!1)return!1;s=c}return s}function e(o){return t(o)!==!1}function n(o){let s=t(o);return s===!1?!1:s.length===0}return{matchers:r,matches:e,exactMatch:n}}var cd=Z(),Bx=et(cd),Rn=q(V("dns4"),Ke()),Un=q(V("dns6"),Ke()),On=q(V("dnsaddr"),Ke()),Os=q(V("dns"),Ke()),Px=et(Rn,G(Z())),Tx=et(Un,G(Z())),Cx=et(On,G(Z())),Lx=et(wt(Os,On,Rn,Un),G(Z())),nc=q(V("ip4"),ir(er)),oc=q(V("ip6"),ir(rr)),Ns=wt(nc,oc),ae=wt(Ns,Os,Rn,Un,On),sc=et(wt(Ns,q(wt(Os,On,Rn,Un),G(Z())))),_x=et(nc),Dx=et(oc),Rx=et(Ns),Ks=q(ae,V("tcp"),Or()),Kr=q(ae,V("udp"),Or()),ic=et(q(Ks,G(Z()))),Ux=et(Kr),ks=q(Kr,V("quic"),G(Z())),Nn=q(Kr,V("quic-v1"),G(Z())),ud=wt(ks,Nn),Ox=et(ks),Nx=et(Nn),Us=wt(ae,Ks,Kr,ks,Nn),ac=wt(q(Us,V("ws"),G(Z()))),Kx=et(ac),cc=wt(q(Us,V("wss"),G(Z())),q(Us,V("tls"),G(q(V("sni"),Ke())),V("ws"),G(Z()))),kx=et(cc),uc=q(Kr,V("webrtc-direct"),G(Nr()),G(Nr()),G(Z())),Mx=et(uc),fc=q(Nn,V("webtransport"),G(Nr()),G(Nr()),G(Z())),Fx=et(fc),Dn=wt(ac,cc,q(Ks,G(Z())),q(ud,G(Z())),q(ae,G(Z())),uc,fc,Z()),Vx=et(Dn),fd=q(Dn,V("p2p-circuit"),Z()),qx=et(fd),ld=wt(q(Dn,V("p2p-circuit"),V("webrtc"),G(Z())),q(Dn,V("webrtc"),G(Z())),q(V("webrtc"),G(Z()))),Hx=et(ld),dd=wt(q(ae,V("tcp"),Or(),V("http"),G(Z())),q(ae,V("http"),G(Z()))),zx=et(dd),hd=wt(q(ae,V("tcp"),wt(q(V("443"),V("http")),q(Or(),V("https"))),G(Z())),q(ae,V("tls"),V("http"),G(Z())),q(ae,V("https"),G(Z()))),Gx=et(hd),pd=wt(q(V("memory"),Ke(),G(Z()))),$x=et(pd);var md=41,Kn=class extends sr{constructor(t,e={}){super(t,{...e,protocol:`/${e.protocolPrefix??Tt.protocolPrefix}/${$a}/${Za}`,log:t.logger.forComponent("libp2p:identify")}),(e.runOnConnectionOpen??Tt.runOnConnectionOpen)&&t.events.addEventListener("connection:open",n=>{let o=n.detail;this.identify(o).catch(s=>{s.name!==Vr.name&&this.log.error("error during identify trigged by connection:open",s)})})}[qr]=["@libp2p/identify"];async _identify(t,e={}){let n;if(e.signal==null){let o=AbortSignal.timeout(this.timeout);e={...e,signal:o}}try{n=await t.newStream(this.protocol,{...e,runOnLimitedConnection:this.runOnLimitedConnection});let s=await or(n,{maxDataLength:this.maxMessageSize}).pb(Ee).read(e);return await n.close(e),s}catch(o){throw n?.abort(o),o}}async identify(t,e={}){let n=await this._identify(t,e),{publicKey:o,protocols:s,observedAddr:i}=n;if(o==null)throw new Dt("public key was missing from identify message");let c=Je(o),a=yn(c.toCID());if(!t.remotePeer.equals(a))throw new Dt("identified peer does not match the expected peer");if(this.peerId.equals(a))throw new Dt("identified peer is our own peer id?");return this.maybeAddObservedAddress(i),this.log("identify completed for peer %p and protocols %o",a,s),Ln(this.peerStore,this.events,this.log,t,n)}maybeAddObservedAddress(t){let e=Wa(t);if(e==null)return;if(this.log.trace("our observed address was %a",e),rc(e)){this.log.trace("our observed address was private");return}if(e.stringTuples()[0][0]===md&&!Xa(e)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}ic.exactMatch(e)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(e))}async handleProtocol(t){let{connection:e,stream:n}=t,o=AbortSignal.timeout(this.timeout);try{let s=await this.peerStore.get(this.peerId),i=this.addressManager.getAddresses().map(u=>u.decapsulateCode(z("p2p").code)),c=s.peerRecordEnvelope;if(i.length>0&&c==null){let u=new qt({peerId:this.peerId,multiaddrs:i});c=(await Zt.seal(u,this.privateKey)).marshal().subarray()}let a=e.remoteAddr.bytes;sc.matches(e.remoteAddr)||(a=void 0),await or(n).pb(Ee).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Gt(this.privateKey.publicKey),listenAddrs:i.map(u=>u.bytes),signedPeerRecord:c,observedAddr:a,protocols:s.protocols},{signal:o}),await n.close({signal:o})}catch(s){this.log.error("could not respond to identify request",s),n.abort(s)}}};function yd(r={}){return t=>new Kn(t,r)}function gd(r={}){return t=>new _n(t,r)}return Bc(bd);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PIdentify}));
