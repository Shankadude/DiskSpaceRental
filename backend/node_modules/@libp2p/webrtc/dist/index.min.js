(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PWebrtc = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PWebrtc=(()=>{var mA=Object.create;var El=Object.defineProperty;var yA=Object.getOwnPropertyDescriptor;var gA=Object.getOwnPropertyNames;var wA=Object.getPrototypeOf,bA=Object.prototype.hasOwnProperty;var Up=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ft=(r,e)=>{for(var t in e)El(r,t,{get:e[t],enumerable:!0})},wg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of gA(e))!bA.call(r,o)&&o!==t&&El(r,o,{get:()=>e[o],enumerable:!(n=yA(e,o))||n.enumerable});return r};var jr=(r,e,t)=>(t=r!=null?mA(wA(r)):{},wg(e||!r||!r.__esModule?El(t,"default",{value:r,enumerable:!0}):t,r)),xA=r=>wg(El({},"__esModule",{value:!0}),r);var ab=Up(()=>{var sb;(function(r){(function(e){var t=typeof globalThis=="object"||typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(r);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function o(c,u){return function(p,h){Object.defineProperty(c,p,{configurable:!0,writable:!0,value:h}),u&&u(p,h)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,u=!a&&!c,p={create:a?function(){return sa(Object.create(null))}:c?function(){return sa({__proto__:null})}:function(){return sa({})},has:u?function(x,_){return n.call(x,_)}:function(x,_){return _ in x},get:u?function(x,_){return n.call(x,_)?x[_]:void 0}:function(x,_){return x[_]}},h=Object.getPrototypeOf(Function),m=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Sl(),g=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Lp(),b=typeof WeakMap=="function"?WeakMap:Dp(),w=o?Symbol.for("@reflect-metadata:registry"):void 0,y=xl(),S=vl(y);function T(x,_,k,V){if(P(k)){if(!ut(x))throw new TypeError;if(!Xt(_))throw new TypeError;return J(x,_)}else{if(!ut(x))throw new TypeError;if(!ee(_))throw new TypeError;if(!ee(V)&&!P(V)&&!ie(V))throw new TypeError;return ie(V)&&(V=void 0),k=Oe(k),ue(x,_,k,V)}}e("decorate",T);function v(x,_){function k(V,se){if(!ee(V))throw new TypeError;if(!P(se)&&!gr(se))throw new TypeError;N(x,_,V,se)}return k}e("metadata",v);function L(x,_,k,V){if(!ee(k))throw new TypeError;return P(V)||(V=Oe(V)),N(x,_,k,V)}e("defineMetadata",L);function F(x,_,k){if(!ee(_))throw new TypeError;return P(k)||(k=Oe(k)),R(x,_,k)}e("hasMetadata",F);function K(x,_,k){if(!ee(_))throw new TypeError;return P(k)||(k=Oe(k)),U(x,_,k)}e("hasOwnMetadata",K);function O(x,_,k){if(!ee(_))throw new TypeError;return P(k)||(k=Oe(k)),I(x,_,k)}e("getMetadata",O);function M(x,_,k){if(!ee(_))throw new TypeError;return P(k)||(k=Oe(k)),E(x,_,k)}e("getOwnMetadata",M);function D(x,_){if(!ee(x))throw new TypeError;return P(_)||(_=Oe(_)),B(x,_)}e("getMetadataKeys",D);function ne(x,_){if(!ee(x))throw new TypeError;return P(_)||(_=Oe(_)),W(x,_)}e("getOwnMetadataKeys",ne);function G(x,_,k){if(!ee(_))throw new TypeError;if(P(k)||(k=Oe(k)),!ee(_))throw new TypeError;P(k)||(k=Oe(k));var V=Un(_,k,!1);return P(V)?!1:V.OrdinaryDeleteMetadata(x,_,k)}e("deleteMetadata",G);function J(x,_){for(var k=x.length-1;k>=0;--k){var V=x[k],se=V(_);if(!P(se)&&!ie(se)){if(!Xt(se))throw new TypeError;_=se}}return _}function ue(x,_,k,V){for(var se=x.length-1;se>=0;--se){var Ye=x[se],nt=Ye(_,k,V);if(!P(nt)&&!ie(nt)){if(!ee(nt))throw new TypeError;V=nt}}return V}function R(x,_,k){var V=U(x,_,k);if(V)return!0;var se=$i(_);return ie(se)?!1:R(x,se,k)}function U(x,_,k){var V=Un(_,k,!1);return P(V)?!1:Be(V.OrdinaryHasOwnMetadata(x,_,k))}function I(x,_,k){var V=U(x,_,k);if(V)return E(x,_,k);var se=$i(_);if(!ie(se))return I(x,se,k)}function E(x,_,k){var V=Un(_,k,!1);if(!P(V))return V.OrdinaryGetOwnMetadata(x,_,k)}function N(x,_,k,V){var se=Un(k,V,!0);se.OrdinaryDefineOwnMetadata(x,_,k,V)}function B(x,_){var k=W(x,_),V=$i(x);if(V===null)return k;var se=B(V,_);if(se.length<=0)return k;if(k.length<=0)return se;for(var Ye=new g,nt=[],ge=0,z=k;ge<z.length;ge++){var Y=z[ge],Q=Ye.has(Y);Q||(Ye.add(Y),nt.push(Y))}for(var te=0,we=se;te<we.length;te++){var Y=we[te],Q=Ye.has(Y);Q||(Ye.add(Y),nt.push(Y))}return nt}function W(x,_){var k=Un(x,_,!1);return k?k.OrdinaryOwnMetadataKeys(x,_):[]}function q(x){if(x===null)return 1;switch(typeof x){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return x===null?1:6;default:return 6}}function P(x){return x===void 0}function ie(x){return x===null}function ce(x){return typeof x=="symbol"}function ee(x){return typeof x=="object"?x!==null:typeof x=="function"}function xe(x,_){switch(q(x)){case 0:return x;case 1:return x;case 2:return x;case 3:return x;case 4:return x;case 5:return x}var k=_===3?"string":_===5?"number":"default",V=yl(x,i);if(V!==void 0){var se=V.call(x,k);if(ee(se))throw new TypeError;return se}return Pe(x,k==="default"?"number":k)}function Pe(x,_){if(_==="string"){var k=x.toString;if(We(k)){var V=k.call(x);if(!ee(V))return V}var se=x.valueOf;if(We(se)){var V=se.call(x);if(!ee(V))return V}}else{var se=x.valueOf;if(We(se)){var V=se.call(x);if(!ee(V))return V}var Ye=x.toString;if(We(Ye)){var V=Ye.call(x);if(!ee(V))return V}}throw new TypeError}function Be(x){return!!x}function De(x){return""+x}function Oe(x){var _=xe(x,3);return ce(_)?_:De(_)}function ut(x){return Array.isArray?Array.isArray(x):x instanceof Object?x instanceof Array:Object.prototype.toString.call(x)==="[object Array]"}function We(x){return typeof x=="function"}function Xt(x){return typeof x=="function"}function gr(x){switch(q(x)){case 3:return!0;case 4:return!0;default:return!1}}function nn(x,_){return x===_||x!==x&&_!==_}function yl(x,_){var k=x[_];if(k!=null){if(!We(k))throw new TypeError;return k}}function gl(x){var _=yl(x,s);if(!We(_))throw new TypeError;var k=_.call(x);if(!ee(k))throw new TypeError;return k}function wl(x){return x.value}function bl(x){var _=x.next();return _.done?!1:_}function oa(x){var _=x.return;_&&_.call(x)}function $i(x){var _=Object.getPrototypeOf(x);if(typeof x!="function"||x===h||_!==h)return _;var k=x.prototype,V=k&&Object.getPrototypeOf(k);if(V==null||V===Object.prototype)return _;var se=V.constructor;return typeof se!="function"||se===x?_:se}function ia(){var x;!P(w)&&typeof t.Reflect<"u"&&!(w in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(x=Al(t.Reflect));var _,k,V,se=new b,Ye={registerProvider:nt,getProvider:z,setProvider:Q};return Ye;function nt(te){if(!Object.isExtensible(Ye))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case x===te:break;case P(_):_=te;break;case _===te:break;case P(k):k=te;break;case k===te:break;default:V===void 0&&(V=new g),V.add(te);break}}function ge(te,we){if(!P(_)){if(_.isProviderFor(te,we))return _;if(!P(k)){if(k.isProviderFor(te,we))return _;if(!P(V))for(var Me=gl(V);;){var Ze=bl(Me);if(!Ze)return;var wr=wl(Ze);if(wr.isProviderFor(te,we))return oa(Me),wr}}}if(!P(x)&&x.isProviderFor(te,we))return x}function z(te,we){var Me=se.get(te),Ze;return P(Me)||(Ze=Me.get(we)),P(Ze)&&(Ze=ge(te,we),P(Ze)||(P(Me)&&(Me=new m,se.set(te,Me)),Me.set(we,Ze))),Ze}function Y(te){if(P(te))throw new TypeError;return _===te||k===te||!P(V)&&V.has(te)}function Q(te,we,Me){if(!Y(Me))throw new Error("Metadata provider not registered.");var Ze=z(te,we);if(Ze!==Me){if(!P(Ze))return!1;var wr=se.get(te);P(wr)&&(wr=new m,se.set(te,wr)),wr.set(we,Me)}return!0}}function xl(){var x;return!P(w)&&ee(t.Reflect)&&Object.isExtensible(t.Reflect)&&(x=t.Reflect[w]),P(x)&&(x=ia()),!P(w)&&ee(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,w,{enumerable:!1,configurable:!1,writable:!1,value:x}),x}function vl(x){var _=new b,k={isProviderFor:function(Y,Q){var te=_.get(Y);return P(te)?!1:te.has(Q)},OrdinaryDefineOwnMetadata:nt,OrdinaryHasOwnMetadata:se,OrdinaryGetOwnMetadata:Ye,OrdinaryOwnMetadataKeys:ge,OrdinaryDeleteMetadata:z};return y.registerProvider(k),k;function V(Y,Q,te){var we=_.get(Y),Me=!1;if(P(we)){if(!te)return;we=new m,_.set(Y,we),Me=!0}var Ze=we.get(Q);if(P(Ze)){if(!te)return;if(Ze=new m,we.set(Q,Ze),!x.setProvider(Y,Q,k))throw we.delete(Q),Me&&_.delete(Y),new Error("Wrong provider for target.")}return Ze}function se(Y,Q,te){var we=V(Q,te,!1);return P(we)?!1:Be(we.has(Y))}function Ye(Y,Q,te){var we=V(Q,te,!1);if(!P(we))return we.get(Y)}function nt(Y,Q,te,we){var Me=V(te,we,!0);Me.set(Y,Q)}function ge(Y,Q){var te=[],we=V(Y,Q,!1);if(P(we))return te;for(var Me=we.keys(),Ze=gl(Me),wr=0;;){var gg=bl(Ze);if(!gg)return te.length=wr,te;var hA=wl(gg);try{te[wr]=hA}catch(dA){try{oa(Ze)}finally{throw dA}}wr++}}function z(Y,Q,te){var we=V(Q,te,!1);if(P(we)||!we.delete(Y))return!1;if(we.size===0){var Me=_.get(Q);P(Me)||(Me.delete(te),Me.size===0&&_.delete(Me))}return!0}}function Al(x){var _=x.defineMetadata,k=x.hasOwnMetadata,V=x.getOwnMetadata,se=x.getOwnMetadataKeys,Ye=x.deleteMetadata,nt=new b,ge={isProviderFor:function(z,Y){var Q=nt.get(z);return!P(Q)&&Q.has(Y)?!0:se(z,Y).length?(P(Q)&&(Q=new g,nt.set(z,Q)),Q.add(Y),!0):!1},OrdinaryDefineOwnMetadata:_,OrdinaryHasOwnMetadata:k,OrdinaryGetOwnMetadata:V,OrdinaryOwnMetadataKeys:se,OrdinaryDeleteMetadata:Ye};return ge}function Un(x,_,k){var V=y.getProvider(x,_);if(!P(V))return V;if(k){if(y.setProvider(x,_,S))return S;throw new Error("Illegal state.")}}function Sl(){var x={},_=[],k=function(){function ge(z,Y,Q){this._index=0,this._keys=z,this._values=Y,this._selector=Q}return ge.prototype["@@iterator"]=function(){return this},ge.prototype[s]=function(){return this},ge.prototype.next=function(){var z=this._index;if(z>=0&&z<this._keys.length){var Y=this._selector(this._keys[z],this._values[z]);return z+1>=this._keys.length?(this._index=-1,this._keys=_,this._values=_):this._index++,{value:Y,done:!1}}return{value:void 0,done:!0}},ge.prototype.throw=function(z){throw this._index>=0&&(this._index=-1,this._keys=_,this._values=_),z},ge.prototype.return=function(z){return this._index>=0&&(this._index=-1,this._keys=_,this._values=_),{value:z,done:!0}},ge}(),V=function(){function ge(){this._keys=[],this._values=[],this._cacheKey=x,this._cacheIndex=-2}return Object.defineProperty(ge.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ge.prototype.has=function(z){return this._find(z,!1)>=0},ge.prototype.get=function(z){var Y=this._find(z,!1);return Y>=0?this._values[Y]:void 0},ge.prototype.set=function(z,Y){var Q=this._find(z,!0);return this._values[Q]=Y,this},ge.prototype.delete=function(z){var Y=this._find(z,!1);if(Y>=0){for(var Q=this._keys.length,te=Y+1;te<Q;te++)this._keys[te-1]=this._keys[te],this._values[te-1]=this._values[te];return this._keys.length--,this._values.length--,nn(z,this._cacheKey)&&(this._cacheKey=x,this._cacheIndex=-2),!0}return!1},ge.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=x,this._cacheIndex=-2},ge.prototype.keys=function(){return new k(this._keys,this._values,se)},ge.prototype.values=function(){return new k(this._keys,this._values,Ye)},ge.prototype.entries=function(){return new k(this._keys,this._values,nt)},ge.prototype["@@iterator"]=function(){return this.entries()},ge.prototype[s]=function(){return this.entries()},ge.prototype._find=function(z,Y){if(!nn(this._cacheKey,z)){this._cacheIndex=-1;for(var Q=0;Q<this._keys.length;Q++)if(nn(this._keys[Q],z)){this._cacheIndex=Q;break}}return this._cacheIndex<0&&Y&&(this._cacheIndex=this._keys.length,this._keys.push(z),this._values.push(void 0)),this._cacheIndex},ge}();return V;function se(ge,z){return ge}function Ye(ge,z){return z}function nt(ge,z){return[ge,z]}}function Lp(){var x=function(){function _(){this._map=new m}return Object.defineProperty(_.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),_.prototype.has=function(k){return this._map.has(k)},_.prototype.add=function(k){return this._map.set(k,k),this},_.prototype.delete=function(k){return this._map.delete(k)},_.prototype.clear=function(){this._map.clear()},_.prototype.keys=function(){return this._map.keys()},_.prototype.values=function(){return this._map.keys()},_.prototype.entries=function(){return this._map.entries()},_.prototype["@@iterator"]=function(){return this.keys()},_.prototype[s]=function(){return this.keys()},_}();return x}function Dp(){var x=16,_=p.create(),k=V();return function(){function z(){this._key=V()}return z.prototype.has=function(Y){var Q=se(Y,!1);return Q!==void 0?p.has(Q,this._key):!1},z.prototype.get=function(Y){var Q=se(Y,!1);return Q!==void 0?p.get(Q,this._key):void 0},z.prototype.set=function(Y,Q){var te=se(Y,!0);return te[this._key]=Q,this},z.prototype.delete=function(Y){var Q=se(Y,!1);return Q!==void 0?delete Q[this._key]:!1},z.prototype.clear=function(){this._key=V()},z}();function V(){var z;do z="@@WeakMap@@"+ge();while(p.has(_,z));return _[z]=!0,z}function se(z,Y){if(!n.call(z,k)){if(!Y)return;Object.defineProperty(z,k,{value:p.create()})}return z[k]}function Ye(z,Y){for(var Q=0;Q<Y;++Q)z[Q]=Math.random()*255|0;return z}function nt(z){if(typeof Uint8Array=="function"){var Y=new Uint8Array(z);return typeof crypto<"u"?crypto.getRandomValues(Y):typeof msCrypto<"u"?msCrypto.getRandomValues(Y):Ye(Y,z),Y}return Ye(new Array(z),z)}function ge(){var z=nt(x);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var Y="",Q=0;Q<x;++Q){var te=z[Q];(Q===4||Q===6||Q===8)&&(Y+="-"),te<16&&(Y+="0"),Y+=te.toString(16).toLowerCase()}return Y}}function sa(x){return x.__=void 0,delete x.__,x}})})(sb||(sb={}))});var gn=Up(hs=>{"use strict";var b_="[object ArrayBuffer]",yn=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===b_}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),o=r.toUint8Array(t);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let s of t)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of t){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},Gd="string",x_=/^[0-9a-f\s]+$/i,v_=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,A_=/^[a-zA-Z0-9-_]+$/,Gu=class{static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n.buffer}static toString(e){let t=yn.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}},sr=class{static toString(e,t=!1){let n=yn.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),t);return n}},zu=class r{static isHex(e){return typeof e===Gd&&x_.test(e)}static isBase64(e){return typeof e===Gd&&v_.test(e)}static isBase64Url(e){return typeof e===Gd&&A_.test(e)}static ToString(e,t="utf8"){let n=yn.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return sr.toString(n,!0);case"utf16":case"utf16be":return sr.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return sr.fromString(e,!0);case"utf16":case"utf16be":return sr.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=yn.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Gu.fromString(e);case"utf16":case"utf16be":return sr.fromString(e);case"utf16le":case"usc2":return sr.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Gu.toString(e);case"utf16":case"utf16be":return sr.toString(e);case"utf16le":case"usc2":return sr.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);return n.buffer}static ToBinary(e){let t=yn.toUint8Array(e),n="";for(let o=0;o<t.length;o++)n+=String.fromCharCode(t[o]);return n}static ToHex(e){let t=yn.toUint8Array(e),n="",o=t.length;for(let i=0;i<o;i++){let s=t[i];s<16&&(n+="0"),n+=s.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let n=new Uint8Array(t.length/2);for(let o=0;o<t.length;o=o+2){let i=t.slice(o,o+2);n[o/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,t=!1){return sr.toString(e,t)}static FromUtf16String(e,t=!1){return sr.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};zu.DEFAULT_UTF8_ENCODING="utf8";function S_(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)t[i]=o[i]}return t}function E_(...r){let e=r.map(o=>o.byteLength).reduce((o,i)=>o+i),t=new Uint8Array(e),n=0;return r.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)t[n++]=i}),t.buffer}function __(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}hs.BufferSourceConverter=yn;hs.Convert=zu;hs.assign=S_;hs.combine=E_;hs.isEqual=__});var tv=Up((SV,$f)=>{var Lx,Dx,Ux,jx,Mx,Kx,Hx,Vx,$x,Vf,ey,Fx,Wx,$s,qx,Gx,zx,Xx,Yx,Zx,Jx,Qx,ev;(function(r){var e=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof $f=="object"&&typeof $f.exports=="object"?r(t(e,t($f.exports))):r(t(e));function t(n,o){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(i,s){return n[i]=o?o(i,s):s}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])};Lx=function(t,n){e(t,n);function o(){this.constructor=t}t.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)},Dx=Object.assign||function(t){for(var n,o=1,i=arguments.length;o<i;o++){n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Ux=function(t,n){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(o[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(o[i[s]]=t[i[s]]);return o},jx=function(t,n,o,i){var s=arguments.length,a=s<3?n:i===null?i=Object.getOwnPropertyDescriptor(n,o):i,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(t,n,o,i);else for(var u=t.length-1;u>=0;u--)(c=t[u])&&(a=(s<3?c(a):s>3?c(n,o,a):c(n,o))||a);return s>3&&a&&Object.defineProperty(n,o,a),a},Mx=function(t,n){return function(o,i){n(o,i,t)}},Kx=function(t,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,n)},Hx=function(t,n,o,i){function s(a){return a instanceof o?a:new o(function(c){c(a)})}return new(o||(o=Promise))(function(a,c){function u(m){try{h(i.next(m))}catch(g){c(g)}}function p(m){try{h(i.throw(m))}catch(g){c(g)}}function h(m){m.done?a(m.value):s(m.value).then(u,p)}h((i=i.apply(t,n||[])).next())})},Vx=function(t,n){var o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,s,a,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(h){return function(m){return p([h,m])}}function p(h){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(a=h[0]&2?s.return:h[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,h[1])).done)return a;switch(s=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return o.label++,{value:h[1],done:!1};case 5:o.label++,s=h[1],h=[0];continue;case 7:h=o.ops.pop(),o.trys.pop();continue;default:if(a=o.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){o=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){o.label=h[1];break}if(h[0]===6&&o.label<a[1]){o.label=a[1],a=h;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(h);break}a[2]&&o.ops.pop(),o.trys.pop();continue}h=n.call(t,o)}catch(m){h=[6,m],s=0}finally{i=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},ev=function(t,n,o,i){i===void 0&&(i=o),t[i]=n[o]},$x=function(t,n){for(var o in t)o!=="default"&&!n.hasOwnProperty(o)&&(n[o]=t[o])},Vf=function(t){var n=typeof Symbol=="function"&&Symbol.iterator,o=n&&t[n],i=0;if(o)return o.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},ey=function(t,n){var o=typeof Symbol=="function"&&t[Symbol.iterator];if(!o)return t;var i=o.call(t),s,a=[],c;try{for(;(n===void 0||n-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(u){c={error:u}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(c)throw c.error}}return a},Fx=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(ey(arguments[n]));return t},Wx=function(){for(var t=0,n=0,o=arguments.length;n<o;n++)t+=arguments[n].length;for(var i=Array(t),s=0,n=0;n<o;n++)for(var a=arguments[n],c=0,u=a.length;c<u;c++,s++)i[s]=a[c];return i},$s=function(t){return this instanceof $s?(this.v=t,this):new $s(t)},qx=function(t,n,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o.apply(t,n||[]),s,a=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(b){i[b]&&(s[b]=function(w){return new Promise(function(y,S){a.push([b,w,y,S])>1||u(b,w)})})}function u(b,w){try{p(i[b](w))}catch(y){g(a[0][3],y)}}function p(b){b.value instanceof $s?Promise.resolve(b.value.v).then(h,m):g(a[0][2],b)}function h(b){u("next",b)}function m(b){u("throw",b)}function g(b,w){b(w),a.shift(),a.length&&u(a[0][0],a[0][1])}},Gx=function(t){var n,o;return n={},i("next"),i("throw",function(s){throw s}),i("return"),n[Symbol.iterator]=function(){return this},n;function i(s,a){n[s]=t[s]?function(c){return(o=!o)?{value:$s(t[s](c)),done:s==="return"}:a?a(c):c}:a}},zx=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],o;return n?n.call(t):(t=typeof Vf=="function"?Vf(t):t[Symbol.iterator](),o={},i("next"),i("throw"),i("return"),o[Symbol.asyncIterator]=function(){return this},o);function i(a){o[a]=t[a]&&function(c){return new Promise(function(u,p){c=t[a](c),s(u,p,c.done,c.value)})}}function s(a,c,u,p){Promise.resolve(p).then(function(h){a({value:h,done:u})},c)}},Xx=function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},Yx=function(t){if(t&&t.__esModule)return t;var n={};if(t!=null)for(var o in t)Object.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n.default=t,n},Zx=function(t){return t&&t.__esModule?t:{default:t}},Jx=function(t,n){if(!n.has(t))throw new TypeError("attempted to get private field on non-instance");return n.get(t)},Qx=function(t,n,o){if(!n.has(t))throw new TypeError("attempted to set private field on non-instance");return n.set(t,o),o},r("__extends",Lx),r("__assign",Dx),r("__rest",Ux),r("__decorate",jx),r("__param",Mx),r("__metadata",Kx),r("__awaiter",Hx),r("__generator",Vx),r("__exportStar",$x),r("__createBinding",ev),r("__values",Vf),r("__read",ey),r("__spread",Fx),r("__spreadArrays",Wx),r("__await",$s),r("__asyncGenerator",qx),r("__asyncDelegator",Gx),r("__asyncValues",zx),r("__makeTemplateObject",Xx),r("__importStar",Yx),r("__importDefault",Zx),r("__classPrivateFieldGet",Jx),r("__classPrivateFieldSet",Qx)})});var TI={};ft(TI,{webRTC:()=>II,webRTCDirect:()=>CI});var jp=Symbol.for("@libp2p/peer-id");var _l=Symbol.for("@libp2p/transport");var bg;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(bg||(bg={}));var Cl=class extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}},Il=class extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},ve=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},Fi=class extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}},aa=class extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}};var Tl=class extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}};var Bl=class extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}},To=class extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}},Bo=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}};var kl=class extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}},Nl=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};var Pl=class extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}};var Ol=class extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}},Rl=class extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}};var jn=class extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}};var Mn=class extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let o=this.#e.get(e);o==null&&(o=[],this.#e.set(e,o)),o.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let o=this.#e.get(e);o!=null&&(o=o.filter(({callback:i})=>i!==t),this.#e.set(e,o))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:o})=>!o),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}};var Wi=Symbol.for("@libp2p/service-capabilities"),xg=Symbol.for("@libp2p/service-dependencies");var $p={};ft($p,{base58btc:()=>ke,base58flickr:()=>CA});var rT=new Uint8Array(0);function vg(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function on(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ag(r){return new TextEncoder().encode(r)}function Sg(r){return new TextDecoder().decode(r)}function vA(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),p=Math.log(256)/Math.log(a);function h(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var w=0,y=0,S=0,T=b.length;S!==T&&b[S]===0;)S++,w++;for(var v=(T-S)*p+1>>>0,L=new Uint8Array(v);S!==T;){for(var F=b[S],K=0,O=v-1;(F!==0||K<y)&&O!==-1;O--,K++)F+=256*L[O]>>>0,L[O]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");y=K,S++}for(var M=v-y;M!==v&&L[M]===0;)M++;for(var D=c.repeat(w);M<v;++M)D+=r.charAt(L[M]);return D}function m(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var w=0;if(b[w]!==" "){for(var y=0,S=0;b[w]===c;)y++,w++;for(var T=(b.length-w)*u+1>>>0,v=new Uint8Array(T);b[w];){var L=t[b.charCodeAt(w)];if(L===255)return;for(var F=0,K=T-1;(L!==0||F<S)&&K!==-1;K--,F++)L+=a*v[K]>>>0,v[K]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");S=F,w++}if(b[w]!==" "){for(var O=T-S;O!==T&&v[O]===0;)O++;for(var M=new Uint8Array(y+(T-O)),D=y;O!==T;)M[D++]=v[O++];return M}}}function g(b){var w=m(b);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:m,decode:g}}var AA=vA,SA=AA,_g=SA;var Mp=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Kp=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;let o=t.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cg(this,e)}},Hp=class{decoders;constructor(e){this.decoders=e}or(e){return Cg(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Cg(r,e){return new Hp({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}var Vp=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Mp(e,t,n),this.decoder=new Kp(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function qi({name:r,prefix:e,encode:t,decode:n}){return new Vp(r,e,t,n)}function Kn({name:r,prefix:e,alphabet:t}){let{encode:n,decode:o}=_g(t,r);return qi({prefix:e,name:r,encode:n,decode:i=>on(o(i))})}function EA(r,e,t,n){let o={};for(let p=0;p<e.length;++p)o[e[p]]=p;let i=r.length;for(;r[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),a=0,c=0,u=0;for(let p=0;p<i;++p){let h=o[r[p]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=t||(255&c<<8-a)!==0)throw new SyntaxError("Unexpected end of data");return s}function _A(r,e,t){let n=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,i+=e[o&a>>s];if(s!==0&&(i+=e[o&a<<t-s]),n)for(;(i.length*t&7)!==0;)i+="=";return i}function qe({name:r,prefix:e,bitsPerChar:t,alphabet:n}){return qi({prefix:e,name:r,encode(o){return _A(o,n,t)},decode(o){return EA(o,n,t,r)}})}var ke=Kn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),CA=Kn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Fp={};ft(Fp,{base32:()=>sn,base32hex:()=>kA,base32hexpad:()=>PA,base32hexpadupper:()=>OA,base32hexupper:()=>NA,base32pad:()=>TA,base32padupper:()=>BA,base32upper:()=>IA,base32z:()=>RA});var sn=qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),IA=qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),TA=qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),BA=qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kA=qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),NA=qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),PA=qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),OA=qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),RA=qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Wp={};ft(Wp,{base36:()=>ca,base36upper:()=>LA});var ca=Kn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),LA=Kn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var tr={};ft(tr,{Digest:()=>ko,create:()=>At,decode:()=>Hn,equals:()=>Gp,hasCode:()=>eS});var DA=Bg,Ig=128,UA=127,jA=~UA,MA=Math.pow(2,31);function Bg(r,e,t){e=e||[],t=t||0;for(var n=t;r>=MA;)e[t++]=r&255|Ig,r/=128;for(;r&jA;)e[t++]=r&255|Ig,r>>>=7;return e[t]=r|0,Bg.bytes=t-n+1,e}var KA=qp,HA=128,Tg=127;function qp(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw qp.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&Tg)<<o:(s&Tg)*Math.pow(2,o),o+=7}while(s>=HA);return qp.bytes=i-n,t}var VA=Math.pow(2,7),$A=Math.pow(2,14),FA=Math.pow(2,21),WA=Math.pow(2,28),qA=Math.pow(2,35),GA=Math.pow(2,42),zA=Math.pow(2,49),XA=Math.pow(2,56),YA=Math.pow(2,63),ZA=function(r){return r<VA?1:r<$A?2:r<FA?3:r<WA?4:r<qA?5:r<GA?6:r<zA?7:r<XA?8:r<YA?9:10},JA={encode:DA,decode:KA,encodingLength:ZA},QA=JA,la=QA;function ua(r,e=0){return[la.decode(r,e),la.decode.bytes]}function Gi(r,e,t=0){return la.encode(r,e,t),e}function zi(r){return la.encodingLength(r)}function At(r,e){let t=e.byteLength,n=zi(r),o=n+zi(t),i=new Uint8Array(o+t);return Gi(r,i,0),Gi(t,i,n),i.set(e,o),new ko(r,t,e,i)}function Hn(r){let e=on(r),[t,n]=ua(e),[o,i]=ua(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new ko(t,o,s,e)}function Gp(r,e){if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&vg(r.bytes,t.bytes)}}var ko=class{code;size;digest;bytes;constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};function eS(r,e){return r.code===e}function kg(r,e){let{bytes:t,version:n}=r;switch(n){case 0:return rS(t,zp(r),e??ke.encoder);default:return nS(t,zp(r),e??sn.encoder)}}var Ng=new WeakMap;function zp(r){let e=Ng.get(r);if(e==null){let t=new Map;return Ng.set(r,t),t}return e}var Je=class r{code;version;multihash;bytes;"/";constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==fa)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==oS)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=At(e,t);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return r.equals(this,e)}static equals(e,t){let n=t;return n!=null&&e.code===n.code&&e.version===n.version&&Gp(e.multihash,n.multihash)}toString(e){return kg(this,e)}toJSON(){return{"/":kg(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:o,multihash:i,bytes:s}=t;return new r(n,o,i,s??Pg(n,o,i.bytes))}else if(t[iS]===!0){let{version:n,multihash:o,code:i}=t,s=Hn(o);return r.create(n,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==fa)throw new Error(`Version 0 CID must use dag-pb (code: ${fa}) block encoding`);return new r(e,t,n,n.bytes)}case 1:{let o=Pg(e,t,n.bytes);return new r(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,fa,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,n]=r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),n=t.size-t.multihashSize,o=on(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new ko(t.multihashCode,t.digestSize,i,o);return[t.version===0?r.createV0(s):r.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[h,m]=ua(e.subarray(t));return t+=m,h},o=n(),i=fa;if(o===18?(o=0,t=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,a=n(),c=n(),u=t+c,p=u-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:p,size:u}}static parse(e,t){let[n,o]=tS(e,t),i=r.decode(o);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return zp(i).set(n,e),i}};function tS(r,e){switch(r[0]){case"Q":{let t=e??ke;return[ke.prefix,t.decode(`${ke.prefix}${r}`)]}case ke.prefix:{let t=e??ke;return[ke.prefix,t.decode(r)]}case sn.prefix:{let t=e??sn;return[sn.prefix,t.decode(r)]}case ca.prefix:{let t=e??ca;return[ca.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function rS(r,e,t){let{prefix:n}=t;if(n!==ke.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return o}function nS(r,e,t){let{prefix:n}=t,o=e.get(n);if(o==null){let i=t.encode(r);return e.set(n,i),i}else return o}var fa=112,oS=18;function Pg(r,e,t){let n=zi(r),o=n+zi(e),i=new Uint8Array(o+t.byteLength);return Gi(r,i,0),Gi(e,i,n),i.set(t,o),i}var iS=Symbol.for("@ipld/js-cid/CID");var Xp={};ft(Xp,{identity:()=>br});var Og=0,sS="identity",Rg=on;function aS(r){return At(Og,Rg(r))}var br={code:Og,name:sS,encode:Rg,digest:aS};function Ge(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function ot(r=0){return new Uint8Array(r)}function Qe(r=0){return new Uint8Array(r)}function it(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=Qe(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var Dg=Symbol.for("@achingbrain/uint8arraylist");function Lg(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let o=t+n.byteLength;if(e<o)return{buf:n,index:e-t};t=o}throw new RangeError("index is out of bounds")}function Dl(r){return!!r?.[Dg]}var fe=class r{bufs;length;[Dg]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Dl(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Dl(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=Lg(this.bufs,e);return t.buf[t.index]}set(e,t){let n=Lg(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Dl(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:o}=this._subList(e,t);return it(n,o)}subarray(e,t){let{bufs:n,length:o}=this._subList(e,t);return n.length===1?n[0]:it(n,o)}sublist(e,t){let{bufs:n,length:o}=this._subList(e,t),i=new r;return i.length=o,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,e>=c)continue;let u=e>=a&&e<c,p=t>a&&t<=c;if(u&&p){if(e===a&&t===c){n.push(s);break}let h=e-a;n.push(s.subarray(h,h+(t-e)));break}if(u){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(p){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Dl(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let h=0;h<i;h++)s[h]=-1;for(let h=0;h<o;h++)s[n[h]]=h;let a=s,c=this.byteLength-n.byteLength,u=n.byteLength-1,p;for(let h=t;h<=c;h+=p){p=0;for(let m=u;m>=0;m--){let g=this.get(h+m);if(n[m]!==g){p=Math.max(1,m-a[g]);break}}if(p===0)return h}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=Qe(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let o=ot(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,t,n),this.write(o,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,t,n),this.write(o,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,t,n),this.write(o,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=Qe(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let o=ot(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,t,n),this.write(o,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,t,n),this.write(o,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,t,n),this.write(o,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,t,n),this.write(o,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,t,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof r)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ge(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new r;return n.bufs=e,t==null&&(t=e.reduce((o,i)=>o+i.byteLength,0)),n.length=t,n}};var Yp={};ft(Yp,{base10:()=>lS});var lS=Kn({prefix:"9",name:"base10",alphabet:"0123456789"});var Zp={};ft(Zp,{base16:()=>uS,base16upper:()=>fS});var uS=qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fS=qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Jp={};ft(Jp,{base2:()=>pS});var pS=qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Qp={};ft(Qp,{base256emoji:()=>gS});var Ug=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),hS=Ug.reduce((r,e,t)=>(r[t]=e,r),[]),dS=Ug.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function mS(r){return r.reduce((e,t)=>(e+=hS[t],e),"")}function yS(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let o=dS[n];if(o==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(o)}return new Uint8Array(e)}var gS=qi({prefix:"\u{1F680}",name:"base256emoji",encode:mS,decode:yS});var eh={};ft(eh,{base64:()=>wS,base64pad:()=>bS,base64url:()=>No,base64urlpad:()=>xS});var wS=qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bS=qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),No=qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xS=qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var th={};ft(th,{base8:()=>vS});var vS=qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var rh={};ft(rh,{identity:()=>AS});var AS=qi({prefix:"\0",name:"identity",encode:r=>Sg(r),decode:r=>Ag(r)});var jT=new TextEncoder,MT=new TextDecoder;var ih={};ft(ih,{sha256:()=>rr,sha512:()=>_S});function oh({name:r,code:e,encode:t}){return new nh(r,e,t)}var nh=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?At(this.code,t):t.then(n=>At(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Mg(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}var rr=oh({name:"sha2-256",code:18,encode:Mg("SHA-256")}),_S=oh({name:"sha2-512",code:19,encode:Mg("SHA-512")});var Po={...rh,...Jp,...th,...Yp,...Zp,...Fp,...Wp,...$p,...eh,...Qp},ZT={...ih,...Xp};function Hg(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Kg=Hg("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),sh=Hg("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Qe(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),CS={utf8:Kg,"utf-8":Kg,hex:Po.base16,latin1:sh,ascii:sh,binary:sh,...Po},Ul=CS;function de(r,e="utf8"){let t=Ul[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function le(r,e="utf8"){let t=Ul[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var IS=parseInt("11111",2),ah=parseInt("10000000",2),TS=parseInt("01111111",2),Vg={0:pa,1:pa,2:BS,3:PS,4:OS,5:NS,6:kS,16:pa,22:pa,48:pa};function an(r,e={offset:0}){let t=r[e.offset]&IS;if(e.offset++,Vg[t]!=null)return Vg[t](r,e);throw new Error("No decoder for tag "+t)}function ha(r,e){let t=0;if((r[e.offset]&ah)===ah){let n=r[e.offset]&TS,o="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)o+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(o,16)}else t=r[e.offset],e.offset++;return t}function pa(r,e){ha(r,e);let t=[];for(;!(e.offset>=r.byteLength);){let n=an(r,e);if(n===null)break;t.push(n)}return t}function BS(r,e){let t=ha(r,e),n=e.offset,o=e.offset+t,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return e.offset+=t,Uint8Array.from(i)}function kS(r,e){let t=ha(r,e),n=e.offset+t,o=r[e.offset];e.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;e.offset<n;){let u=r[e.offset];if(e.offset++,c.push(u&127),u<128){c.reverse();let p=0;for(let h=0;h<c.length;h++)p+=c[h]<<h*7;a+=`.${p}`,c=[]}}return a}function NS(r,e){return e.offset++,null}function PS(r,e){let t=ha(r,e),n=r[e.offset];e.offset++;let o=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function OS(r,e){let t=ha(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function RS(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);let t=new fe;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function jl(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let e=RS(r.byteLength);return new fe(Uint8Array.from([e.byteLength|ah]),e)}function Bt(r){let e=new fe,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new fe(Uint8Array.from([2]),jl(e),e)}function da(r){let e=Uint8Array.from([0]),t=new fe(e,r);return new fe(Uint8Array.from([3]),jl(t),t)}function $g(r){return new fe(Uint8Array.from([4]),jl(r),r)}function xr(r,e=48){let t=new fe;for(let n of r)t.append(n);return new fe(Uint8Array.from([e]),jl(t),t)}async function Fg(r="P-256"){let e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function Wg(r,e){let t=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]),n=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},t,e.subarray());return new Uint8Array(n,0,n.byteLength)}async function qg(r,e,t){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},n,e,t.subarray())}var LS=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),DS=Uint8Array.from([6,5,43,129,4,0,34]),US=Uint8Array.from([6,5,43,129,4,0,35]),jS={ext:!0,kty:"EC",crv:"P-256"},MS={ext:!0,kty:"EC",crv:"P-384"},KS={ext:!0,kty:"EC",crv:"P-521"},ch=32,lh=48,uh=66;function fh(r){let e=an(r);return Gg(e)}function Gg(r){let e=r[1][1][0],t=1,n,o;if(e.byteLength===ch*2+1)return n=le(e.subarray(t,t+ch),"base64url"),o=le(e.subarray(t+ch),"base64url"),new Oo({...jS,key_ops:["verify"],x:n,y:o});if(e.byteLength===lh*2+1)return n=le(e.subarray(t,t+lh),"base64url"),o=le(e.subarray(t+lh),"base64url"),new Oo({...MS,key_ops:["verify"],x:n,y:o});if(e.byteLength===uh*2+1)return n=le(e.subarray(t,t+uh),"base64url"),o=le(e.subarray(t+uh),"base64url"),new Oo({...KS,key_ops:["verify"],x:n,y:o});throw new ve(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function zg(r){return xr([Bt(Uint8Array.from([1])),$g(de(r.d??"","base64url")),xr([Yg(r.crv)],160),xr([da(new fe(Uint8Array.from([4]),de(r.x??"","base64url"),de(r.y??"","base64url")))],161)]).subarray()}function Xg(r){return xr([Bt(Uint8Array.from([1])),xr([Yg(r.crv)],160),xr([da(new fe(Uint8Array.from([4]),de(r.x??"","base64url"),de(r.y??"","base64url")))],161)]).subarray()}function Yg(r){if(r==="P-256")return LS;if(r==="P-384")return DS;if(r==="P-521")return US;throw new ve(`Invalid curve ${r}`)}async function Zg(r="P-256"){let e=await Fg(r);return new Ml(e.privateKey)}var Oo=class{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=Xg(this.jwk)),this._raw}toMultihash(){return br.digest(Vn(this))}toCID(){return Je.createV1(114,this.toMultihash())}toString(){return ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}async verify(e,t){return qg(this.jwk,t,e)}},Ml=class{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new Oo({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=zg(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}async sign(e){return Wg(this.jwk,e)}};function Kl(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function HS(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xi(r,...e){if(!HS(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ma(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Kl(r.outputLen),Kl(r.blockLen)}function Yi(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Jg(r,e){Xi(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}var Ro=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Hl(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function vr(r,e){return r<<32-e|r>>>e}function Qg(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function $n(r){return typeof r=="string"&&(r=Qg(r)),Xi(r),r}function ph(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];Xi(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}var Zi=class{clone(){return this._cloneInto()}};function Vl(r){let e=n=>r().update($n(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ya(r=32){if(Ro&&typeof Ro.getRandomValues=="function")return Ro.getRandomValues(new Uint8Array(r));if(Ro&&typeof Ro.randomBytes=="function")return Ro.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function VS(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,u=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+u,a,n)}function e0(r,e,t){return r&e^~r&t}function t0(r,e,t){return r&e^r&t^e&t}var Ji=class extends Zi{constructor(e,t,n,o){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hl(this.buffer)}update(e){Yi(this);let{view:t,buffer:n,blockLen:o}=this;e=$n(e);let i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=Hl(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Yi(this),Jg(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(n,0),s=0);for(let h=s;h<o;h++)t[h]=0;VS(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=Hl(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,p=this.get();if(u>p.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,p[h],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.length=o,e.pos=a,e.finished=i,e.destroyed=s,o%t&&e.buffer.set(n),e}};var $l=BigInt(4294967295),hh=BigInt(32);function r0(r,e=!1){return e?{h:Number(r&$l),l:Number(r>>hh&$l)}:{h:Number(r>>hh&$l)|0,l:Number(r&$l)|0}}function $S(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let o=0;o<r.length;o++){let{h:i,l:s}=r0(r[o],e);[t[o],n[o]]=[i,s]}return[t,n]}var FS=(r,e)=>BigInt(r>>>0)<<hh|BigInt(e>>>0),WS=(r,e,t)=>r>>>t,qS=(r,e,t)=>r<<32-t|e>>>t,GS=(r,e,t)=>r>>>t|e<<32-t,zS=(r,e,t)=>r<<32-t|e>>>t,XS=(r,e,t)=>r<<64-t|e>>>t-32,YS=(r,e,t)=>r>>>t-32|e<<64-t,ZS=(r,e)=>e,JS=(r,e)=>r,QS=(r,e,t)=>r<<t|e>>>32-t,eE=(r,e,t)=>e<<t|r>>>32-t,tE=(r,e,t)=>e<<t-32|r>>>64-t,rE=(r,e,t)=>r<<t-32|e>>>64-t;function nE(r,e,t,n){let o=(e>>>0)+(n>>>0);return{h:r+t+(o/2**32|0)|0,l:o|0}}var oE=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),iE=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,sE=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),aE=(r,e,t,n,o)=>e+t+n+o+(r/2**32|0)|0,cE=(r,e,t,n,o)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),lE=(r,e,t,n,o,i)=>e+t+n+o+i+(r/2**32|0)|0;var uE={fromBig:r0,split:$S,toBig:FS,shrSH:WS,shrSL:qS,rotrSH:GS,rotrSL:zS,rotrBH:XS,rotrBL:YS,rotr32H:ZS,rotr32L:JS,rotlSH:QS,rotlSL:eE,rotlBH:tE,rotlBL:rE,add:nE,add3L:oE,add3H:iE,add4L:sE,add4H:aE,add5H:lE,add5L:cE},he=uE;var[fE,pE]=he.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Fn=new Uint32Array(80),Wn=new Uint32Array(80),dh=class extends Ji{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:u,El:p,Fh:h,Fl:m,Gh:g,Gl:b,Hh:w,Hl:y}=this;return[e,t,n,o,i,s,a,c,u,p,h,m,g,b,w,y]}set(e,t,n,o,i,s,a,c,u,p,h,m,g,b,w,y){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=p|0,this.Fh=h|0,this.Fl=m|0,this.Gh=g|0,this.Gl=b|0,this.Hh=w|0,this.Hl=y|0}process(e,t){for(let v=0;v<16;v++,t+=4)Fn[v]=e.getUint32(t),Wn[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){let L=Fn[v-15]|0,F=Wn[v-15]|0,K=he.rotrSH(L,F,1)^he.rotrSH(L,F,8)^he.shrSH(L,F,7),O=he.rotrSL(L,F,1)^he.rotrSL(L,F,8)^he.shrSL(L,F,7),M=Fn[v-2]|0,D=Wn[v-2]|0,ne=he.rotrSH(M,D,19)^he.rotrBH(M,D,61)^he.shrSH(M,D,6),G=he.rotrSL(M,D,19)^he.rotrBL(M,D,61)^he.shrSL(M,D,6),J=he.add4L(O,G,Wn[v-7],Wn[v-16]),ue=he.add4H(J,K,ne,Fn[v-7],Fn[v-16]);Fn[v]=ue|0,Wn[v]=J|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:u,Dl:p,Eh:h,El:m,Fh:g,Fl:b,Gh:w,Gl:y,Hh:S,Hl:T}=this;for(let v=0;v<80;v++){let L=he.rotrSH(h,m,14)^he.rotrSH(h,m,18)^he.rotrBH(h,m,41),F=he.rotrSL(h,m,14)^he.rotrSL(h,m,18)^he.rotrBL(h,m,41),K=h&g^~h&w,O=m&b^~m&y,M=he.add5L(T,F,O,pE[v],Wn[v]),D=he.add5H(M,S,L,K,fE[v],Fn[v]),ne=M|0,G=he.rotrSH(n,o,28)^he.rotrBH(n,o,34)^he.rotrBH(n,o,39),J=he.rotrSL(n,o,28)^he.rotrBL(n,o,34)^he.rotrBL(n,o,39),ue=n&i^n&a^i&a,R=o&s^o&c^s&c;S=w|0,T=y|0,w=g|0,y=b|0,g=h|0,b=m|0,{h,l:m}=he.add(u|0,p|0,D|0,ne|0),u=a|0,p=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let U=he.add3L(ne,J,R);n=he.add3H(U,D,G,ue),o=U|0}({h:n,l:o}=he.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=he.add(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=he.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:p}=he.add(this.Dh|0,this.Dl|0,u|0,p|0),{h,l:m}=he.add(this.Eh|0,this.El|0,h|0,m|0),{h:g,l:b}=he.add(this.Fh|0,this.Fl|0,g|0,b|0),{h:w,l:y}=he.add(this.Gh|0,this.Gl|0,w|0,y|0),{h:S,l:T}=he.add(this.Hh|0,this.Hl|0,S|0,T|0),this.set(n,o,i,s,a,c,u,p,h,m,g,b,w,y,S,T)}roundClean(){Fn.fill(0),Wn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var n0=Vl(()=>new dh);var ql={};ft(ql,{aInRange:()=>pt,abool:()=>Ar,abytes:()=>Qi,bitGet:()=>wE,bitLen:()=>wh,bitMask:()=>wa,bitSet:()=>bE,bytesToHex:()=>ln,bytesToNumberBE:()=>un,bytesToNumberLE:()=>Sr,concatBytes:()=>pn,createHmacDrbg:()=>bh,ensureBytes:()=>Ue,equalBytes:()=>yE,hexToBytes:()=>Do,hexToNumber:()=>gh,inRange:()=>ga,isBytes:()=>qn,memoized:()=>Uo,notImplemented:()=>vE,numberToBytesBE:()=>Gn,numberToBytesLE:()=>fn,numberToHexUnpadded:()=>Lo,numberToVarBytesBE:()=>mE,utf8ToBytes:()=>gE,validateObject:()=>nr});var Fl=BigInt(0),Wl=BigInt(1),hE=BigInt(2);function qn(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Qi(r){if(!qn(r))throw new Error("Uint8Array expected")}function Ar(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}var dE=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function ln(r){Qi(r);let e="";for(let t=0;t<r.length;t++)e+=dE[r[t]];return e}function Lo(r){let e=r.toString(16);return e.length&1?"0"+e:e}function gh(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Fl:BigInt("0x"+r)}var cn={_0:48,_9:57,A:65,F:70,a:97,f:102};function o0(r){if(r>=cn._0&&r<=cn._9)return r-cn._0;if(r>=cn.A&&r<=cn.F)return r-(cn.A-10);if(r>=cn.a&&r<=cn.f)return r-(cn.a-10)}function Do(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,i=0;o<t;o++,i+=2){let s=o0(r.charCodeAt(i)),a=o0(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}function un(r){return gh(ln(r))}function Sr(r){return Qi(r),gh(ln(Uint8Array.from(r).reverse()))}function Gn(r,e){return Do(r.toString(16).padStart(e*2,"0"))}function fn(r,e){return Gn(r,e).reverse()}function mE(r){return Do(Lo(r))}function Ue(r,e,t){let n;if(typeof e=="string")try{n=Do(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(qn(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof t=="number"&&o!==t)throw new Error(r+" of length "+t+" expected, got "+o);return n}function pn(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];Qi(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}function yE(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}function gE(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}var mh=r=>typeof r=="bigint"&&Fl<=r;function ga(r,e,t){return mh(r)&&mh(e)&&mh(t)&&e<=r&&r<t}function pt(r,e,t,n){if(!ga(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function wh(r){let e;for(e=0;r>Fl;r>>=Wl,e+=1);return e}function wE(r,e){return r>>BigInt(e)&Wl}function bE(r,e,t){return r|(t?Wl:Fl)<<BigInt(e)}var wa=r=>(hE<<BigInt(r-1))-Wl,yh=r=>new Uint8Array(r),i0=r=>Uint8Array.from(r);function bh(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=yh(r),o=yh(r),i=0,s=()=>{n.fill(1),o.fill(0),i=0},a=(...h)=>t(o,n,...h),c=(h=yh())=>{o=a(i0([0]),h),n=a(),h.length!==0&&(o=a(i0([1]),h),n=a())},u=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,m=[];for(;h<e;){n=a();let g=n.slice();m.push(g),h+=n.length}return pn(...m)};return(h,m)=>{s(),c(h);let g;for(;!(g=m(u()));)c();return s(),g}}var xE={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||qn(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function nr(r,e,t={}){let n=(o,i,s)=>{let a=xE[i];if(typeof a!="function")throw new Error("invalid validator function");let c=r[o];if(!(s&&c===void 0)&&!a(c,r))throw new Error("param "+String(o)+" is invalid. Expected "+i+", got "+c)};for(let[o,i]of Object.entries(e))n(o,i,!1);for(let[o,i]of Object.entries(t))n(o,i,!0);return r}var vE=()=>{throw new Error("not implemented")};function Uo(r){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let i=r(t,...n);return e.set(t,i),i}}var st=BigInt(0),He=BigInt(1),jo=BigInt(2),AE=BigInt(3),xh=BigInt(4),s0=BigInt(5),a0=BigInt(8),SE=BigInt(9),EE=BigInt(16);function Ee(r,e){let t=r%e;return t>=st?t:e+t}function vh(r,e,t){if(e<st)throw new Error("invalid exponent, negatives unsupported");if(t<=st)throw new Error("invalid modulus");if(t===He)return st;let n=He;for(;e>st;)e&He&&(n=n*r%t),r=r*r%t,e>>=He;return n}function Ke(r,e,t){let n=r;for(;e-- >st;)n*=n,n%=t;return n}function Gl(r,e){if(r===st)throw new Error("invert: expected non-zero number");if(e<=st)throw new Error("invert: expected positive modulus, got "+e);let t=Ee(r,e),n=e,o=st,i=He,s=He,a=st;for(;t!==st;){let u=n/t,p=n%t,h=o-s*u,m=i-a*u;n=t,t=p,o=s,i=a,s=h,a=m}if(n!==He)throw new Error("invert: does not exist");return Ee(o,e)}function _E(r){let e=(r-He)/jo,t,n,o;for(t=r-He,n=0;t%jo===st;t/=jo,n++);for(o=jo;o<r&&vh(o,e,r)!==r-He;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){let s=(r+He)/xh;return function(c,u){let p=c.pow(u,s);if(!c.eql(c.sqr(p),u))throw new Error("Cannot find square root");return p}}let i=(t+He)/jo;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,p=a.pow(a.mul(a.ONE,o),t),h=a.pow(c,i),m=a.pow(c,t);for(;!a.eql(m,a.ONE);){if(a.eql(m,a.ZERO))return a.ZERO;let g=1;for(let w=a.sqr(m);g<u&&!a.eql(w,a.ONE);g++)w=a.sqr(w);let b=a.pow(p,He<<BigInt(u-g-1));p=a.sqr(b),h=a.mul(h,b),m=a.mul(m,p),u=g}return h}}function CE(r){if(r%xh===AE){let e=(r+He)/xh;return function(n,o){let i=n.pow(o,e);if(!n.eql(n.sqr(i),o))throw new Error("Cannot find square root");return i}}if(r%a0===s0){let e=(r-s0)/a0;return function(n,o){let i=n.mul(o,jo),s=n.pow(i,e),a=n.mul(o,s),c=n.mul(n.mul(a,jo),s),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),o))throw new Error("Cannot find square root");return u}}return r%EE,_E(r)}var c0=(r,e)=>(Ee(r,e)&He)===He,IE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ah(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=IE.reduce((n,o)=>(n[o]="function",n),e);return nr(r,t)}function TE(r,e,t){if(t<st)throw new Error("invalid exponent, negatives unsupported");if(t===st)return r.ONE;if(t===He)return e;let n=r.ONE,o=e;for(;t>st;)t&He&&(n=r.mul(n,o)),o=r.sqr(o),t>>=He;return n}function BE(r,e){let t=new Array(e.length),n=e.reduce((i,s,a)=>r.is0(s)?i:(t[a]=i,r.mul(i,s)),r.ONE),o=r.inv(n);return e.reduceRight((i,s,a)=>r.is0(s)?i:(t[a]=r.mul(i,t[a]),r.mul(i,s)),o),t}function Sh(r,e){let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function zn(r,e,t=!1,n={}){if(r<=st)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:o,nByteLength:i}=Sh(r,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let s,a=Object.freeze({ORDER:r,isLE:t,BITS:o,BYTES:i,MASK:wa(o),ZERO:st,ONE:He,create:c=>Ee(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return st<=c&&c<r},is0:c=>c===st,isOdd:c=>(c&He)===He,neg:c=>Ee(-c,r),eql:(c,u)=>c===u,sqr:c=>Ee(c*c,r),add:(c,u)=>Ee(c+u,r),sub:(c,u)=>Ee(c-u,r),mul:(c,u)=>Ee(c*u,r),pow:(c,u)=>TE(a,c,u),div:(c,u)=>Ee(c*Gl(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Gl(c,r),sqrt:n.sqrt||(c=>(s||(s=CE(r)),s(a,c))),invertBatch:c=>BE(a,c),cmov:(c,u,p)=>p?u:c,toBytes:c=>t?fn(c,i):Gn(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?Sr(c):un(c)}});return Object.freeze(a)}function l0(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function Eh(r){let e=l0(r);return e+Math.ceil(e/2)}function u0(r,e,t=!1){let n=r.length,o=l0(e),i=Eh(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=t?Sr(r):un(r),a=Ee(s,e-He)+He;return t?fn(a,o):Gn(a,o)}var f0=BigInt(0),zl=BigInt(1);function _h(r,e){let t=e.negate();return r?t:e}function p0(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Ch(r,e){p0(r,e);let t=Math.ceil(e/r)+1,n=2**(r-1);return{windows:t,windowSize:n}}function kE(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function NE(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}var Ih=new WeakMap,h0=new WeakMap;function Th(r){return h0.get(r)||1}function Xl(r,e){return{constTimeNegate:_h,hasPrecomputes(t){return Th(t)!==1},unsafeLadder(t,n,o=r.ZERO){let i=t;for(;n>f0;)n&zl&&(o=o.add(i)),i=i.double(),n>>=zl;return o},precomputeWindow(t,n){let{windows:o,windowSize:i}=Ch(n,e),s=[],a=t,c=a;for(let u=0;u<o;u++){c=a,s.push(c);for(let p=1;p<i;p++)c=c.add(a),s.push(c);a=c.double()}return s},wNAF(t,n,o){let{windows:i,windowSize:s}=Ch(t,e),a=r.ZERO,c=r.BASE,u=BigInt(2**t-1),p=2**t,h=BigInt(t);for(let m=0;m<i;m++){let g=m*s,b=Number(o&u);o>>=h,b>s&&(b-=p,o+=zl);let w=g,y=g+Math.abs(b)-1,S=m%2!==0,T=b<0;b===0?c=c.add(_h(S,n[w])):a=a.add(_h(T,n[y]))}return{p:a,f:c}},wNAFUnsafe(t,n,o,i=r.ZERO){let{windows:s,windowSize:a}=Ch(t,e),c=BigInt(2**t-1),u=2**t,p=BigInt(t);for(let h=0;h<s;h++){let m=h*a;if(o===f0)break;let g=Number(o&c);if(o>>=p,g>a&&(g-=u,o+=zl),g===0)continue;let b=n[m+Math.abs(g)-1];g<0&&(b=b.negate()),i=i.add(b)}return i},getPrecomputes(t,n,o){let i=Ih.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&Ih.set(n,o(i))),i},wNAFCached(t,n,o){let i=Th(t);return this.wNAF(i,this.getPrecomputes(i,t,o),n)},wNAFCachedUnsafe(t,n,o,i){let s=Th(t);return s===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,o),n,i)},setWindowSize(t,n){p0(n,e),h0.set(t,n),Ih.delete(t)}}}function Yl(r,e,t,n){if(kE(t,r),NE(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,i=wh(BigInt(t.length)),s=i>12?i-3:i>4?i-2:i?2:1,a=(1<<s)-1,c=new Array(a+1).fill(o),u=Math.floor((e.BITS-1)/s)*s,p=o;for(let h=u;h>=0;h-=s){c.fill(o);for(let g=0;g<n.length;g++){let b=n[g],w=Number(b>>BigInt(h)&BigInt(a));c[w]=c[w].add(t[g])}let m=o;for(let g=c.length-1,b=o;g>0;g--)b=b.add(c[g]),m=m.add(b);if(p=p.add(m),h!==0)for(let g=0;g<s;g++)p=p.double()}return p}function ba(r){return Ah(r.Fp),nr(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Sh(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var Er=BigInt(0),Rt=BigInt(1),Zl=BigInt(2),PE=BigInt(8),OE={zip215:!0};function RE(r){let e=ba(r);return nr(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function d0(r){let e=RE(r),{Fp:t,n,prehash:o,hash:i,randomBytes:s,nByteLength:a,h:c}=e,u=Zl<<BigInt(a*8)-Rt,p=t.create,h=zn(e.n,e.nBitLength),m=e.uvRatio||((I,E)=>{try{return{isValid:!0,value:t.sqrt(I*t.inv(E))}}catch{return{isValid:!1,value:Er}}}),g=e.adjustScalarBytes||(I=>I),b=e.domain||((I,E,N)=>{if(Ar("phflag",N),E.length||N)throw new Error("Contexts/pre-hash are not supported");return I});function w(I,E){pt("coordinate "+I,E,Er,u)}function y(I){if(!(I instanceof v))throw new Error("ExtendedPoint expected")}let S=Uo((I,E)=>{let{ex:N,ey:B,ez:W}=I,q=I.is0();E==null&&(E=q?PE:t.inv(W));let P=p(N*E),ie=p(B*E),ce=p(W*E);if(q)return{x:Er,y:Rt};if(ce!==Rt)throw new Error("invZ was invalid");return{x:P,y:ie}}),T=Uo(I=>{let{a:E,d:N}=e;if(I.is0())throw new Error("bad point: ZERO");let{ex:B,ey:W,ez:q,et:P}=I,ie=p(B*B),ce=p(W*W),ee=p(q*q),xe=p(ee*ee),Pe=p(ie*E),Be=p(ee*p(Pe+ce)),De=p(xe+p(N*p(ie*ce)));if(Be!==De)throw new Error("bad point: equation left != right (1)");let Oe=p(B*W),ut=p(q*P);if(Oe!==ut)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(E,N,B,W){this.ex=E,this.ey=N,this.ez=B,this.et=W,w("x",E),w("y",N),w("z",B),w("t",W),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(E){if(E instanceof v)throw new Error("extended point not allowed");let{x:N,y:B}=E||{};return w("x",N),w("y",B),new v(N,B,Rt,p(N*B))}static normalizeZ(E){let N=t.invertBatch(E.map(B=>B.ez));return E.map((B,W)=>B.toAffine(N[W])).map(v.fromAffine)}static msm(E,N){return Yl(v,h,E,N)}_setWindowSize(E){K.setWindowSize(this,E)}assertValidity(){T(this)}equals(E){y(E);let{ex:N,ey:B,ez:W}=this,{ex:q,ey:P,ez:ie}=E,ce=p(N*ie),ee=p(q*W),xe=p(B*ie),Pe=p(P*W);return ce===ee&&xe===Pe}is0(){return this.equals(v.ZERO)}negate(){return new v(p(-this.ex),this.ey,this.ez,p(-this.et))}double(){let{a:E}=e,{ex:N,ey:B,ez:W}=this,q=p(N*N),P=p(B*B),ie=p(Zl*p(W*W)),ce=p(E*q),ee=N+B,xe=p(p(ee*ee)-q-P),Pe=ce+P,Be=Pe-ie,De=ce-P,Oe=p(xe*Be),ut=p(Pe*De),We=p(xe*De),Xt=p(Be*Pe);return new v(Oe,ut,Xt,We)}add(E){y(E);let{a:N,d:B}=e,{ex:W,ey:q,ez:P,et:ie}=this,{ex:ce,ey:ee,ez:xe,et:Pe}=E;if(N===BigInt(-1)){let oa=p((q-W)*(ee+ce)),$i=p((q+W)*(ee-ce)),ia=p($i-oa);if(ia===Er)return this.double();let xl=p(P*Zl*Pe),vl=p(ie*Zl*xe),Al=vl+xl,Un=$i+oa,Sl=vl-xl,Lp=p(Al*ia),Dp=p(Un*Sl),sa=p(Al*Sl),x=p(ia*Un);return new v(Lp,Dp,x,sa)}let Be=p(W*ce),De=p(q*ee),Oe=p(ie*B*Pe),ut=p(P*xe),We=p((W+q)*(ce+ee)-Be-De),Xt=ut-Oe,gr=ut+Oe,nn=p(De-N*Be),yl=p(We*Xt),gl=p(gr*nn),wl=p(We*nn),bl=p(Xt*gr);return new v(yl,gl,bl,wl)}subtract(E){return this.add(E.negate())}wNAF(E){return K.wNAFCached(this,E,v.normalizeZ)}multiply(E){let N=E;pt("scalar",N,Rt,n);let{p:B,f:W}=this.wNAF(N);return v.normalizeZ([B,W])[0]}multiplyUnsafe(E,N=v.ZERO){let B=E;return pt("scalar",B,Er,n),B===Er?F:this.is0()||B===Rt?this:K.wNAFCachedUnsafe(this,B,v.normalizeZ,N)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return K.unsafeLadder(this,n).is0()}toAffine(E){return S(this,E)}clearCofactor(){let{h:E}=e;return E===Rt?this:this.multiplyUnsafe(E)}static fromHex(E,N=!1){let{d:B,a:W}=e,q=t.BYTES;E=Ue("pointHex",E,q),Ar("zip215",N);let P=E.slice(),ie=E[q-1];P[q-1]=ie&-129;let ce=Sr(P),ee=N?u:t.ORDER;pt("pointHex.y",ce,Er,ee);let xe=p(ce*ce),Pe=p(xe-Rt),Be=p(B*xe-W),{isValid:De,value:Oe}=m(Pe,Be);if(!De)throw new Error("Point.fromHex: invalid y coordinate");let ut=(Oe&Rt)===Rt,We=(ie&128)!==0;if(!N&&Oe===Er&&We)throw new Error("Point.fromHex: x=0 and x_0=1");return We!==ut&&(Oe=p(-Oe)),v.fromAffine({x:Oe,y:ce})}static fromPrivateKey(E){return D(E).point}toRawBytes(){let{x:E,y:N}=this.toAffine(),B=fn(N,t.BYTES);return B[B.length-1]|=E&Rt?128:0,B}toHex(){return ln(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Rt,p(e.Gx*e.Gy)),v.ZERO=new v(Er,Rt,Rt,Er);let{BASE:L,ZERO:F}=v,K=Xl(v,a*8);function O(I){return Ee(I,n)}function M(I){return O(Sr(I))}function D(I){let E=t.BYTES;I=Ue("private key",I,E);let N=Ue("hashed private key",i(I),2*E),B=g(N.slice(0,E)),W=N.slice(E,2*E),q=M(B),P=L.multiply(q),ie=P.toRawBytes();return{head:B,prefix:W,scalar:q,point:P,pointBytes:ie}}function ne(I){return D(I).pointBytes}function G(I=new Uint8Array,...E){let N=pn(...E);return M(i(b(N,Ue("context",I),!!o)))}function J(I,E,N={}){I=Ue("message",I),o&&(I=o(I));let{prefix:B,scalar:W,pointBytes:q}=D(E),P=G(N.context,B,I),ie=L.multiply(P).toRawBytes(),ce=G(N.context,ie,q,I),ee=O(P+ce*W);pt("signature.s",ee,Er,n);let xe=pn(ie,fn(ee,t.BYTES));return Ue("result",xe,t.BYTES*2)}let ue=OE;function R(I,E,N,B=ue){let{context:W,zip215:q}=B,P=t.BYTES;I=Ue("signature",I,2*P),E=Ue("message",E),N=Ue("publicKey",N,P),q!==void 0&&Ar("zip215",q),o&&(E=o(E));let ie=Sr(I.slice(P,2*P)),ce,ee,xe;try{ce=v.fromHex(N,q),ee=v.fromHex(I.slice(0,P),q),xe=L.multiplyUnsafe(ie)}catch{return!1}if(!q&&ce.isSmallOrder())return!1;let Pe=G(W,ee.toRawBytes(),ce.toRawBytes(),E);return ee.add(ce.multiplyUnsafe(Pe)).subtract(xe).clearCofactor().equals(v.ZERO)}return L._setWindowSize(8),{CURVE:e,getPublicKey:ne,sign:J,verify:R,ExtendedPoint:v,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>s(t.BYTES),precompute(I=8,E=v.BASE){return E._setWindowSize(I),E.multiply(BigInt(3)),E}}}}var es=BigInt(0),Bh=BigInt(1);function LE(r){return nr(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function m0(r){let e=LE(r),{P:t}=e,n=T=>Ee(T,t),o=e.montgomeryBits,i=Math.ceil(o/8),s=e.nByteLength,a=e.adjustScalarBytes||(T=>T),c=e.powPminus2||(T=>vh(T,t-BigInt(2),t));function u(T,v,L){let F=n(T*(v-L));return v=n(v-F),L=n(L+F),[v,L]}let p=(e.a-BigInt(2))/BigInt(4);function h(T,v){pt("u",T,es,t),pt("scalar",v,es,t);let L=v,F=T,K=Bh,O=es,M=T,D=Bh,ne=es,G;for(let ue=BigInt(o-1);ue>=es;ue--){let R=L>>ue&Bh;ne^=R,G=u(ne,K,M),K=G[0],M=G[1],G=u(ne,O,D),O=G[0],D=G[1],ne=R;let U=K+O,I=n(U*U),E=K-O,N=n(E*E),B=I-N,W=M+D,q=M-D,P=n(q*U),ie=n(W*E),ce=P+ie,ee=P-ie;M=n(ce*ce),D=n(F*n(ee*ee)),K=n(I*N),O=n(B*(I+n(p*B)))}G=u(ne,K,M),K=G[0],M=G[1],G=u(ne,O,D),O=G[0],D=G[1];let J=c(O);return n(K*J)}function m(T){return fn(n(T),i)}function g(T){let v=Ue("u coordinate",T,i);return s===32&&(v[31]&=127),Sr(v)}function b(T){let v=Ue("scalar",T),L=v.length;if(L!==i&&L!==s){let F=""+i+" or "+s;throw new Error("invalid scalar, expected "+F+" bytes, got "+L)}return Sr(a(v))}function w(T,v){let L=g(v),F=b(T),K=h(L,F);if(K===es)throw new Error("invalid private or public key received");return m(K)}let y=m(e.Gu);function S(T){return w(T,y)}return{scalarMult:w,scalarMultBase:S,getSharedSecret:(T,v)=>w(T,v),getPublicKey:T=>S(T),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}var xa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),y0=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),r8=BigInt(0),DE=BigInt(1),g0=BigInt(2),UE=BigInt(3),jE=BigInt(5),ME=BigInt(8);function w0(r){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),i=xa,a=r*r%i*r%i,c=Ke(a,g0,i)*a%i,u=Ke(c,DE,i)*r%i,p=Ke(u,jE,i)*u%i,h=Ke(p,e,i)*p%i,m=Ke(h,t,i)*h%i,g=Ke(m,n,i)*m%i,b=Ke(g,o,i)*g%i,w=Ke(b,o,i)*g%i,y=Ke(w,e,i)*p%i;return{pow_p_5_8:Ke(y,g0,i)*r%i,b2:a}}function b0(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function KE(r,e){let t=xa,n=Ee(e*e*e,t),o=Ee(n*n*e,t),i=w0(r*o).pow_p_5_8,s=Ee(r*n*i,t),a=Ee(e*s*s,t),c=s,u=Ee(s*y0,t),p=a===r,h=a===Ee(-r,t),m=a===Ee(-r*y0,t);return p&&(s=c),(h||m)&&(s=u),c0(s,t)&&(s=Ee(-s,t)),{isValid:p||h,value:s}}var HE=zn(xa,void 0,!0),VE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:HE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:ME,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:n0,randomBytes:ya,adjustScalarBytes:b0,uvRatio:KE},va=d0(VE);var Aa=m0({P:xa,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let e=xa,{pow_p_5_8:t,b2:n}=w0(r);return Ee(Ke(t,UE,e)*n,e)},adjustScalarBytes:b0,randomBytes:ya});var Jl=32,Ql=64,kh=32;function x0(){let r=va.utils.randomPrivateKey(),e=va.getPublicKey(r);return{privateKey:$E(r,e),publicKey:e}}function v0(r,e){let t=r.subarray(0,kh);return va.sign(e instanceof Uint8Array?e:e.subarray(),t)}function A0(r,e,t){return va.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}function $E(r,e){let t=new Uint8Array(Ql);for(let n=0;n<kh;n++)t[n]=r[n],t[kh+n]=e[n];return t}var Sa=class{type="Ed25519";raw;constructor(e){this.raw=tu(e,Jl)}toMultihash(){return br.digest(Vn(this))}toCID(){return Je.createV1(114,this.toMultihash())}toString(){return ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}verify(e,t){return A0(this.raw,t,e)}},eu=class{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=tu(e,Ql),this.publicKey=new Sa(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}sign(e){return v0(this.raw,e)}};function Nh(r){return r=tu(r,Jl),new Sa(r)}async function E0(){let{privateKey:r,publicKey:e}=x0();return new eu(r,e)}function tu(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ve(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}var FE=Math.pow(2,7),WE=Math.pow(2,14),qE=Math.pow(2,21),Ph=Math.pow(2,28),Oh=Math.pow(2,35),Rh=Math.pow(2,42),Lh=Math.pow(2,49),Ie=128,St=127;function _e(r){if(r<FE)return 1;if(r<WE)return 2;if(r<qE)return 3;if(r<Ph)return 4;if(r<Oh)return 5;if(r<Rh)return 6;if(r<Lh)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Dh(r,e,t=0){switch(_e(r)){case 8:e[t++]=r&255|Ie,r/=128;case 7:e[t++]=r&255|Ie,r/=128;case 6:e[t++]=r&255|Ie,r/=128;case 5:e[t++]=r&255|Ie,r/=128;case 4:e[t++]=r&255|Ie,r>>>=7;case 3:e[t++]=r&255|Ie,r>>>=7;case 2:e[t++]=r&255|Ie,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function GE(r,e,t=0){switch(_e(r)){case 8:e.set(t++,r&255|Ie),r/=128;case 7:e.set(t++,r&255|Ie),r/=128;case 6:e.set(t++,r&255|Ie),r/=128;case 5:e.set(t++,r&255|Ie),r/=128;case 4:e.set(t++,r&255|Ie),r>>>=7;case 3:e.set(t++,r&255|Ie),r>>>=7;case 2:e.set(t++,r&255|Ie),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function Uh(r,e){let t=r[e],n=0;if(n+=t&St,t<Ie||(t=r[e+1],n+=(t&St)<<7,t<Ie)||(t=r[e+2],n+=(t&St)<<14,t<Ie)||(t=r[e+3],n+=(t&St)<<21,t<Ie)||(t=r[e+4],n+=(t&St)*Ph,t<Ie)||(t=r[e+5],n+=(t&St)*Oh,t<Ie)||(t=r[e+6],n+=(t&St)*Rh,t<Ie)||(t=r[e+7],n+=(t&St)*Lh,t<Ie))return n;throw new RangeError("Could not decode varint")}function zE(r,e){let t=r.get(e),n=0;if(n+=t&St,t<Ie||(t=r.get(e+1),n+=(t&St)<<7,t<Ie)||(t=r.get(e+2),n+=(t&St)<<14,t<Ie)||(t=r.get(e+3),n+=(t&St)<<21,t<Ie)||(t=r.get(e+4),n+=(t&St)*Ph,t<Ie)||(t=r.get(e+5),n+=(t&St)*Oh,t<Ie)||(t=r.get(e+6),n+=(t&St)*Rh,t<Ie)||(t=r.get(e+7),n+=(t&St)*Lh,t<Ie))return n;throw new RangeError("Could not decode varint")}function Lt(r,e,t=0){return e==null&&(e=Qe(_e(r))),e instanceof Uint8Array?Dh(r,e,t):GE(r,e,t)}function kt(r,e=0){return r instanceof Uint8Array?Uh(r,e):zE(r,e)}var jh=new Float32Array([-0]),Yn=new Uint8Array(jh.buffer);function _0(r,e,t){jh[0]=r,e[t]=Yn[0],e[t+1]=Yn[1],e[t+2]=Yn[2],e[t+3]=Yn[3]}function C0(r,e){return Yn[0]=r[e],Yn[1]=r[e+1],Yn[2]=r[e+2],Yn[3]=r[e+3],jh[0]}var Mh=new Float64Array([-0]),Et=new Uint8Array(Mh.buffer);function I0(r,e,t){Mh[0]=r,e[t]=Et[0],e[t+1]=Et[1],e[t+2]=Et[2],e[t+3]=Et[3],e[t+4]=Et[4],e[t+5]=Et[5],e[t+6]=Et[6],e[t+7]=Et[7]}function T0(r,e){return Et[0]=r[e],Et[1]=r[e+1],Et[2]=r[e+2],Et[3]=r[e+3],Et[4]=r[e+4],Et[5]=r[e+5],Et[6]=r[e+6],Et[7]=r[e+7],Mh[0]}var XE=BigInt(Number.MAX_SAFE_INTEGER),YE=BigInt(Number.MIN_SAFE_INTEGER),Yt=class r{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Mo;if(e<XE&&e>YE)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,o=e-(n<<32n);return t&&(n=~n|0n,o=~o|0n,++o>B0&&(o=0n,++n>B0&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(e){if(e===0)return Mo;let t=e<0;t&&(e=-e);let n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(e){return typeof e=="number"?r.fromNumber(e):typeof e=="bigint"?r.fromBigInt(e):typeof e=="string"?r.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new r(e.low>>>0,e.high>>>0):Mo}},Mo=new Yt(0,0);Mo.toBigInt=function(){return 0n};Mo.zzEncode=Mo.zzDecode=function(){return this};Mo.length=function(){return 1};var B0=4294967296n;function k0(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function N0(r,e,t){if(t-e<1)return"";let o,i=[],s=0,a;for(;e<t;)a=r[e++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function Kh(r,e,t){let n=t,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128);return t-n}function _r(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function ru(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var Hh=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,_r(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw _r(this,4);return ru(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw _r(this,4);return ru(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw _r(this,4);let e=C0(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw _r(this,4);let e=T0(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw _r(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return N0(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw _r(this,e);this.pos+=e}else do if(this.pos>=this.len)throw _r(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Yt(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw _r(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw _r(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw _r(this,8);let e=ru(this.buf,this.pos+=4),t=ru(this.buf,this.pos+=4);return new Yt(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=Uh(this.buf,this.pos);return this.pos+=_e(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Vh(r){return new Hh(r instanceof Uint8Array?r:r.subarray())}function Cr(r,e,t){let n=Vh(r);return e.decode(n,void 0,t)}function $h(r){let e=r??8192,t=e>>>1,n,o=e;return function(s){if(s<1||s>t)return Qe(s);o+s>e&&(n=Qe(e),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var Ko=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function Fh(){}var qh=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},ZE=$h();function JE(r){return globalThis.Buffer!=null?Qe(r):ZE(r)}var _a=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ko(Fh,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Ko(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Gh((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(nu,10,Yt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Yt.fromBigInt(e);return this._push(nu,t.length(),t)}uint64Number(e){return this._push(Dh,_e(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Yt.fromBigInt(e).zzEncode();return this._push(nu,t.length(),t)}sint64Number(e){let t=Yt.fromNumber(e).zzEncode();return this._push(nu,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Wh,1,e?1:0)}fixed32(e){return this._push(Ea,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Yt.fromBigInt(e);return this._push(Ea,4,t.lo)._push(Ea,4,t.hi)}fixed64Number(e){let t=Yt.fromNumber(e);return this._push(Ea,4,t.lo)._push(Ea,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(_0,4,e)}double(e){return this._push(I0,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(Wh,1,0):this.uint32(t)._push(e2,t,e)}string(e){let t=k0(e);return t!==0?this.uint32(t)._push(Kh,t,e):this._push(Wh,1,0)}fork(){return this.states=new qh(this),this.head=this.tail=new Ko(Fh,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ko(Fh,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=JE(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function Wh(r,e,t){e[t]=r&255}function QE(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var Gh=class extends Ko{next;constructor(e,t){super(QE,e,t),this.next=void 0}};function nu(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Ea(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function e2(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(_a.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(t2,e,r),this},_a.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(r2,e,r),this});function t2(r,e,t){e.set(r,t)}function r2(r,e,t){r.length<40?Kh(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(de(r),t)}function zh(){return new _a}function Ir(r,e){let t=zh();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var ts;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(ts||(ts={}));function ou(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Ho(r){function e(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let t=function(i,s){let a=e(i);s.int32(a)},n=function(i){let s=i.int32();return e(s)};return ou("enum",ts.VARINT,t,n)}function Tr(r,e){return ou("message",ts.LENGTH_DELIMITED,r,e)}var Ca=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var et;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(et||(et={}));var Xh;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(Xh||(Xh={}));(function(r){r.codec=()=>Ho(Xh)})(et||(et={}));var Mr;(function(r){let e;r.codec=()=>(e==null&&(e=Tr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),et.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=et.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ir(t,r.codec()),r.decode=(t,n)=>Cr(t,r.codec(),n)})(Mr||(Mr={}));var Yh;(function(r){let e;r.codec=()=>(e==null&&(e=Tr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),et.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=et.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ir(t,r.codec()),r.decode=(t,n)=>Cr(t,r.codec(),n)})(Yh||(Yh={}));var Ia=class extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}},Ta=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},iu=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};var R0={get(r=globalThis){let e=r.crypto;if(e?.subtle==null)throw new iu("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};var Zn=R0;var ka={};ft(ka,{MAX_RSA_KEY_SIZE:()=>Jh,generateRSAKeyPair:()=>ad,jwkToJWKKeyPair:()=>j0,jwkToPkcs1:()=>a2,jwkToPkix:()=>rd,jwkToRSAPrivateKey:()=>sd,pkcs1MessageToJwk:()=>ed,pkcs1MessageToRSAPrivateKey:()=>nd,pkcs1ToJwk:()=>s2,pkcs1ToRSAPrivateKey:()=>U0,pkixMessageToJwk:()=>td,pkixMessageToRSAPublicKey:()=>id,pkixToJwk:()=>c2,pkixToRSAPublicKey:()=>od});var n2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qn=new Uint32Array(64),Zh=class extends Ji{constructor(){super(64,32,8,!1),this.A=Jn[0]|0,this.B=Jn[1]|0,this.C=Jn[2]|0,this.D=Jn[3]|0,this.E=Jn[4]|0,this.F=Jn[5]|0,this.G=Jn[6]|0,this.H=Jn[7]|0}get(){let{A:e,B:t,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,t,n,o,i,s,a,c]}set(e,t,n,o,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Qn[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){let m=Qn[h-15],g=Qn[h-2],b=vr(m,7)^vr(m,18)^m>>>3,w=vr(g,17)^vr(g,19)^g>>>10;Qn[h]=w+Qn[h-7]+b+Qn[h-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:u,H:p}=this;for(let h=0;h<64;h++){let m=vr(a,6)^vr(a,11)^vr(a,25),g=p+m+e0(a,c,u)+n2[h]+Qn[h]|0,w=(vr(n,2)^vr(n,13)^vr(n,22))+t0(n,o,i)|0;p=u,u=c,c=a,a=s+g|0,s=i,i=o,o=n,n=g+w|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,p=p+this.H|0,this.set(n,o,i,s,a,c,u,p)}roundClean(){Qn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Kr=Vl(()=>new Zh);var rs=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=ka.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Je.createV1(114,this._multihash)}toString(){return ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}verify(e,t){return D0(this.jwk,t,e)}},Ba=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=ka.jwkToPkcs1(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}sign(e){return L0(this.jwk,e)}};var Jh=8192,Qh=18,o2=1062,i2=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function s2(r){let e=an(r);return ed(e)}function ed(r){return{n:le(r[1],"base64url"),e:le(r[2],"base64url"),d:le(r[3],"base64url"),p:le(r[4],"base64url"),q:le(r[5],"base64url"),dp:le(r[6],"base64url"),dq:le(r[7],"base64url"),qi:le(r[8],"base64url"),kty:"RSA"}}function a2(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ve("JWK was missing components");return xr([Bt(Uint8Array.from([0])),Bt(de(r.n,"base64url")),Bt(de(r.e,"base64url")),Bt(de(r.d,"base64url")),Bt(de(r.p,"base64url")),Bt(de(r.q,"base64url")),Bt(de(r.dp,"base64url")),Bt(de(r.dq,"base64url")),Bt(de(r.qi,"base64url"))]).subarray()}function c2(r){let e=an(r,{offset:0});return td(e)}function td(r){let e=an(r[1],{offset:0});return{kty:"RSA",n:le(e[0],"base64url"),e:le(e[1],"base64url")}}function rd(r){if(r.n==null||r.e==null)throw new ve("JWK was missing components");return xr([i2,da(xr([Bt(de(r.n,"base64url")),Bt(de(r.e,"base64url"))]))]).subarray()}function U0(r){let e=an(r);return nd(e)}function nd(r){let e=ed(r);return sd(e)}function od(r,e){if(r.byteLength>=o2)throw new Fi("Key size is too large");let t=an(r,{offset:0});return id(t,r,e)}function id(r,e,t){let n=td(r);if(t==null){let o=Kr(Mr.encode({Type:et.RSA,Data:e}));t=At(Qh,o)}return new rs(n,t)}function sd(r){if(K0(r)>Jh)throw new ve("Key size is too large");let e=j0(r),t=Kr(Mr.encode({Type:et.RSA,Data:rd(e.publicKey)})),n=At(Qh,t);return new Ba(e.privateKey,new rs(e.publicKey,n))}async function ad(r){if(r>Jh)throw new ve("Key size is too large");let e=await M0(r),t=Kr(Mr.encode({Type:et.RSA,Data:rd(e.publicKey)})),n=At(Qh,t);return new Ba(e.privateKey,new rs(e.publicKey,n))}function j0(r){if(r==null)throw new ve("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function M0(r){let e=await Zn.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await l2(e);return{privateKey:t[0],publicKey:t[1]}}async function L0(r,e){let t=await Zn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Zn.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(n,0,n.byteLength)}async function D0(r,e,t){let n=await Zn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Zn.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t instanceof Uint8Array?t:t.subarray())}async function l2(r){if(r.privateKey==null||r.publicKey==null)throw new ve("Private and public key are required");return Promise.all([Zn.get().subtle.exportKey("jwk",r.privateKey),Zn.get().subtle.exportKey("jwk",r.publicKey)])}function K0(r){if(r.kty!=="RSA")throw new ve("invalid key type");if(r.n==null)throw new ve("invalid key modulus");return de(r.n,"base64url").length*8}var su=class extends Zi{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ma(e);let n=$n(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return Yi(this),this.iHash.update(e),this}digestInto(e){Yi(this),Xi(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ns=(r,e,t)=>new su(r,e).update(t).digest();ns.create=(r,e)=>new su(r,e);function H0(r){r.lowS!==void 0&&Ar("lowS",r.lowS),r.prehash!==void 0&&Ar("prehash",r.prehash)}function u2(r){let e=ba(r);nr(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:t,Fp:n,a:o}=e;if(t){if(!n.eql(o,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}var{bytesToNumberBE:f2,hexToBytes:p2}=ql,cd=class extends Error{constructor(e=""){super(e)}},hn={Err:cd,_tlv:{encode:(r,e)=>{let{Err:t}=hn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let n=e.length/2,o=Lo(n);if(o.length/2&128)throw new t("tlv.encode: long form length too big");let i=n>127?Lo(o.length/2|128):"";return Lo(r)+i+o+e},decode(r,e){let{Err:t}=hn,n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");let o=e[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let u=e.subarray(n,n+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let p of u)s=s<<8|p;if(n+=c,s<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+s);if(a.length!==s)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+s)}}},_int:{encode(r){let{Err:e}=hn;if(r<dn)throw new e("integer: negative integers are not allowed");let t=Lo(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=hn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return f2(r)}},toSig(r){let{Err:e,_int:t,_tlv:n}=hn,o=typeof r=="string"?p2(r):r;Qi(o);let{v:i,l:s}=n.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:u,l:p}=n.decode(2,c);if(p.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){let{_tlv:e,_int:t}=hn,n=e.encode(2,t.encode(r.r)),o=e.encode(2,t.encode(r.s)),i=n+o;return e.encode(48,i)}},dn=BigInt(0),lt=BigInt(1),Tk=BigInt(2),V0=BigInt(3),Bk=BigInt(4);function h2(r){let e=u2(r),{Fp:t}=e,n=zn(e.n,e.nBitLength),o=e.toBytes||((w,y,S)=>{let T=y.toAffine();return pn(Uint8Array.from([4]),t.toBytes(T.x),t.toBytes(T.y))}),i=e.fromBytes||(w=>{let y=w.subarray(1),S=t.fromBytes(y.subarray(0,t.BYTES)),T=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:S,y:T}});function s(w){let{a:y,b:S}=e,T=t.sqr(w),v=t.mul(T,w);return t.add(t.add(v,t.mul(w,y)),S)}if(!t.eql(t.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function a(w){return ga(w,lt,e.n)}function c(w){let{allowedPrivateKeyLengths:y,nByteLength:S,wrapPrivateKey:T,n:v}=e;if(y&&typeof w!="bigint"){if(qn(w)&&(w=ln(w)),typeof w!="string"||!y.includes(w.length))throw new Error("invalid private key");w=w.padStart(S*2,"0")}let L;try{L=typeof w=="bigint"?w:un(Ue("private key",w,S))}catch{throw new Error("invalid private key, expected hex or "+S+" bytes, got "+typeof w)}return T&&(L=Ee(L,v)),pt("private key",L,lt,v),L}function u(w){if(!(w instanceof m))throw new Error("ProjectivePoint expected")}let p=Uo((w,y)=>{let{px:S,py:T,pz:v}=w;if(t.eql(v,t.ONE))return{x:S,y:T};let L=w.is0();y==null&&(y=L?t.ONE:t.inv(v));let F=t.mul(S,y),K=t.mul(T,y),O=t.mul(v,y);if(L)return{x:t.ZERO,y:t.ZERO};if(!t.eql(O,t.ONE))throw new Error("invZ was invalid");return{x:F,y:K}}),h=Uo(w=>{if(w.is0()){if(e.allowInfinityPoint&&!t.is0(w.py))return;throw new Error("bad point: ZERO")}let{x:y,y:S}=w.toAffine();if(!t.isValid(y)||!t.isValid(S))throw new Error("bad point: x or y not FE");let T=t.sqr(S),v=s(y);if(!t.eql(T,v))throw new Error("bad point: equation left != right");if(!w.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class m{constructor(y,S,T){if(this.px=y,this.py=S,this.pz=T,y==null||!t.isValid(y))throw new Error("x required");if(S==null||!t.isValid(S))throw new Error("y required");if(T==null||!t.isValid(T))throw new Error("z required");Object.freeze(this)}static fromAffine(y){let{x:S,y:T}=y||{};if(!y||!t.isValid(S)||!t.isValid(T))throw new Error("invalid affine point");if(y instanceof m)throw new Error("projective point not allowed");let v=L=>t.eql(L,t.ZERO);return v(S)&&v(T)?m.ZERO:new m(S,T,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){let S=t.invertBatch(y.map(T=>T.pz));return y.map((T,v)=>T.toAffine(S[v])).map(m.fromAffine)}static fromHex(y){let S=m.fromAffine(i(Ue("pointHex",y)));return S.assertValidity(),S}static fromPrivateKey(y){return m.BASE.multiply(c(y))}static msm(y,S){return Yl(m,n,y,S)}_setWindowSize(y){b.setWindowSize(this,y)}assertValidity(){h(this)}hasEvenY(){let{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){u(y);let{px:S,py:T,pz:v}=this,{px:L,py:F,pz:K}=y,O=t.eql(t.mul(S,K),t.mul(L,v)),M=t.eql(t.mul(T,K),t.mul(F,v));return O&&M}negate(){return new m(this.px,t.neg(this.py),this.pz)}double(){let{a:y,b:S}=e,T=t.mul(S,V0),{px:v,py:L,pz:F}=this,K=t.ZERO,O=t.ZERO,M=t.ZERO,D=t.mul(v,v),ne=t.mul(L,L),G=t.mul(F,F),J=t.mul(v,L);return J=t.add(J,J),M=t.mul(v,F),M=t.add(M,M),K=t.mul(y,M),O=t.mul(T,G),O=t.add(K,O),K=t.sub(ne,O),O=t.add(ne,O),O=t.mul(K,O),K=t.mul(J,K),M=t.mul(T,M),G=t.mul(y,G),J=t.sub(D,G),J=t.mul(y,J),J=t.add(J,M),M=t.add(D,D),D=t.add(M,D),D=t.add(D,G),D=t.mul(D,J),O=t.add(O,D),G=t.mul(L,F),G=t.add(G,G),D=t.mul(G,J),K=t.sub(K,D),M=t.mul(G,ne),M=t.add(M,M),M=t.add(M,M),new m(K,O,M)}add(y){u(y);let{px:S,py:T,pz:v}=this,{px:L,py:F,pz:K}=y,O=t.ZERO,M=t.ZERO,D=t.ZERO,ne=e.a,G=t.mul(e.b,V0),J=t.mul(S,L),ue=t.mul(T,F),R=t.mul(v,K),U=t.add(S,T),I=t.add(L,F);U=t.mul(U,I),I=t.add(J,ue),U=t.sub(U,I),I=t.add(S,v);let E=t.add(L,K);return I=t.mul(I,E),E=t.add(J,R),I=t.sub(I,E),E=t.add(T,v),O=t.add(F,K),E=t.mul(E,O),O=t.add(ue,R),E=t.sub(E,O),D=t.mul(ne,I),O=t.mul(G,R),D=t.add(O,D),O=t.sub(ue,D),D=t.add(ue,D),M=t.mul(O,D),ue=t.add(J,J),ue=t.add(ue,J),R=t.mul(ne,R),I=t.mul(G,I),ue=t.add(ue,R),R=t.sub(J,R),R=t.mul(ne,R),I=t.add(I,R),J=t.mul(ue,I),M=t.add(M,J),J=t.mul(E,I),O=t.mul(U,O),O=t.sub(O,J),J=t.mul(U,ue),D=t.mul(E,D),D=t.add(D,J),new m(O,M,D)}subtract(y){return this.add(y.negate())}is0(){return this.equals(m.ZERO)}wNAF(y){return b.wNAFCached(this,y,m.normalizeZ)}multiplyUnsafe(y){let{endo:S,n:T}=e;pt("scalar",y,dn,T);let v=m.ZERO;if(y===dn)return v;if(this.is0()||y===lt)return this;if(!S||b.hasPrecomputes(this))return b.wNAFCachedUnsafe(this,y,m.normalizeZ);let{k1neg:L,k1:F,k2neg:K,k2:O}=S.splitScalar(y),M=v,D=v,ne=this;for(;F>dn||O>dn;)F&lt&&(M=M.add(ne)),O&lt&&(D=D.add(ne)),ne=ne.double(),F>>=lt,O>>=lt;return L&&(M=M.negate()),K&&(D=D.negate()),D=new m(t.mul(D.px,S.beta),D.py,D.pz),M.add(D)}multiply(y){let{endo:S,n:T}=e;pt("scalar",y,lt,T);let v,L;if(S){let{k1neg:F,k1:K,k2neg:O,k2:M}=S.splitScalar(y),{p:D,f:ne}=this.wNAF(K),{p:G,f:J}=this.wNAF(M);D=b.constTimeNegate(F,D),G=b.constTimeNegate(O,G),G=new m(t.mul(G.px,S.beta),G.py,G.pz),v=D.add(G),L=ne.add(J)}else{let{p:F,f:K}=this.wNAF(y);v=F,L=K}return m.normalizeZ([v,L])[0]}multiplyAndAddUnsafe(y,S,T){let v=m.BASE,L=(K,O)=>O===dn||O===lt||!K.equals(v)?K.multiplyUnsafe(O):K.multiply(O),F=L(this,S).add(L(y,T));return F.is0()?void 0:F}toAffine(y){return p(this,y)}isTorsionFree(){let{h:y,isTorsionFree:S}=e;if(y===lt)return!0;if(S)return S(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:y,clearCofactor:S}=e;return y===lt?this:S?S(m,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return Ar("isCompressed",y),this.assertValidity(),o(m,this,y)}toHex(y=!0){return Ar("isCompressed",y),ln(this.toRawBytes(y))}}m.BASE=new m(e.Gx,e.Gy,t.ONE),m.ZERO=new m(t.ZERO,t.ONE,t.ZERO);let g=e.nBitLength,b=Xl(m,e.endo?Math.ceil(g/2):g);return{CURVE:e,ProjectivePoint:m,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:a}}function d2(r){let e=ba(r);return nr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function $0(r){let e=d2(r),{Fp:t,n}=e,o=t.BYTES+1,i=2*t.BYTES+1;function s(R){return Ee(R,n)}function a(R){return Gl(R,n)}let{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:p,isWithinCurveOrder:h}=h2({...e,toBytes(R,U,I){let E=U.toAffine(),N=t.toBytes(E.x),B=pn;return Ar("isCompressed",I),I?B(Uint8Array.from([U.hasEvenY()?2:3]),N):B(Uint8Array.from([4]),N,t.toBytes(E.y))},fromBytes(R){let U=R.length,I=R[0],E=R.subarray(1);if(U===o&&(I===2||I===3)){let N=un(E);if(!ga(N,lt,t.ORDER))throw new Error("Point is not on curve");let B=p(N),W;try{W=t.sqrt(B)}catch(ie){let ce=ie instanceof Error?": "+ie.message:"";throw new Error("Point is not on curve"+ce)}let q=(W&lt)===lt;return(I&1)===1!==q&&(W=t.neg(W)),{x:N,y:W}}else if(U===i&&I===4){let N=t.fromBytes(E.subarray(0,t.BYTES)),B=t.fromBytes(E.subarray(t.BYTES,2*t.BYTES));return{x:N,y:B}}else{let N=o,B=i;throw new Error("invalid Point, expected length of "+N+", or uncompressed "+B+", got "+U)}}}),m=R=>ln(Gn(R,e.nByteLength));function g(R){let U=n>>lt;return R>U}function b(R){return g(R)?s(-R):R}let w=(R,U,I)=>un(R.slice(U,I));class y{constructor(U,I,E){this.r=U,this.s=I,this.recovery=E,this.assertValidity()}static fromCompact(U){let I=e.nByteLength;return U=Ue("compactSignature",U,I*2),new y(w(U,0,I),w(U,I,2*I))}static fromDER(U){let{r:I,s:E}=hn.toSig(Ue("DER",U));return new y(I,E)}assertValidity(){pt("r",this.r,lt,n),pt("s",this.s,lt,n)}addRecoveryBit(U){return new y(this.r,this.s,U)}recoverPublicKey(U){let{r:I,s:E,recovery:N}=this,B=K(Ue("msgHash",U));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");let W=N===2||N===3?I+e.n:I;if(W>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");let q=(N&1)===0?"02":"03",P=c.fromHex(q+m(W)),ie=a(W),ce=s(-B*ie),ee=s(E*ie),xe=c.BASE.multiplyAndAddUnsafe(P,ce,ee);if(!xe)throw new Error("point at infinify");return xe.assertValidity(),xe}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Do(this.toDERHex())}toDERHex(){return hn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Do(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}let S={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let R=Eh(e.n);return u0(e.randomBytes(R),e.n)},precompute(R=8,U=c.BASE){return U._setWindowSize(R),U.multiply(BigInt(3)),U}};function T(R,U=!0){return c.fromPrivateKey(R).toRawBytes(U)}function v(R){let U=qn(R),I=typeof R=="string",E=(U||I)&&R.length;return U?E===o||E===i:I?E===2*o||E===2*i:R instanceof c}function L(R,U,I=!0){if(v(R))throw new Error("first arg must be private key");if(!v(U))throw new Error("second arg must be public key");return c.fromHex(U).multiply(u(R)).toRawBytes(I)}let F=e.bits2int||function(R){if(R.length>8192)throw new Error("input is too large");let U=un(R),I=R.length*8-e.nBitLength;return I>0?U>>BigInt(I):U},K=e.bits2int_modN||function(R){return s(F(R))},O=wa(e.nBitLength);function M(R){return pt("num < 2^"+e.nBitLength,R,dn,O),Gn(R,e.nByteLength)}function D(R,U,I=ne){if(["recovered","canonical"].some(Be=>Be in I))throw new Error("sign() legacy options not supported");let{hash:E,randomBytes:N}=e,{lowS:B,prehash:W,extraEntropy:q}=I;B==null&&(B=!0),R=Ue("msgHash",R),H0(I),W&&(R=Ue("prehashed msgHash",E(R)));let P=K(R),ie=u(U),ce=[M(ie),M(P)];if(q!=null&&q!==!1){let Be=q===!0?N(t.BYTES):q;ce.push(Ue("extraEntropy",Be))}let ee=pn(...ce),xe=P;function Pe(Be){let De=F(Be);if(!h(De))return;let Oe=a(De),ut=c.BASE.multiply(De).toAffine(),We=s(ut.x);if(We===dn)return;let Xt=s(Oe*s(xe+We*ie));if(Xt===dn)return;let gr=(ut.x===We?0:2)|Number(ut.y&lt),nn=Xt;return B&&g(Xt)&&(nn=b(Xt),gr^=1),new y(We,nn,gr)}return{seed:ee,k2sig:Pe}}let ne={lowS:e.lowS,prehash:!1},G={lowS:e.lowS,prehash:!1};function J(R,U,I=ne){let{seed:E,k2sig:N}=D(R,U,I),B=e;return bh(B.hash.outputLen,B.nByteLength,B.hmac)(E,N)}c.BASE._setWindowSize(8);function ue(R,U,I,E=G){let N=R;U=Ue("msgHash",U),I=Ue("publicKey",I);let{lowS:B,prehash:W,format:q}=E;if(H0(E),"strict"in E)throw new Error("options.strict was renamed to lowS");if(q!==void 0&&q!=="compact"&&q!=="der")throw new Error("format must be compact or der");let P=typeof N=="string"||qn(N),ie=!P&&!q&&typeof N=="object"&&N!==null&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!P&&!ie)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ce,ee;try{if(ie&&(ce=new y(N.r,N.s)),P){try{q!=="compact"&&(ce=y.fromDER(N))}catch(gr){if(!(gr instanceof hn.Err))throw gr}!ce&&q!=="der"&&(ce=y.fromCompact(N))}ee=c.fromHex(I)}catch{return!1}if(!ce||B&&ce.hasHighS())return!1;W&&(U=e.hash(U));let{r:xe,s:Pe}=ce,Be=K(U),De=a(Pe),Oe=s(Be*De),ut=s(xe*De),We=c.BASE.multiplyAndAddUnsafe(ee,Oe,ut)?.toAffine();return We?s(We.x)===xe:!1}return{CURVE:e,getPublicKey:T,getSharedSecret:L,sign:J,verify:ue,ProjectivePoint:c,Signature:y,utils:S}}function m2(r){return{hash:r,hmac:(e,...t)=>ns(r,e,ph(...t)),randomBytes:ya}}function F0(r,e){let t=n=>$0({...r,...m2(n)});return{...t(e),create:t}}var G0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),W0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),y2=BigInt(1),ld=BigInt(2),q0=(r,e)=>(r+e/ld)/e;function g2(r){let e=G0,t=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%e,p=u*u*r%e,h=Ke(p,t,e)*p%e,m=Ke(h,t,e)*p%e,g=Ke(m,ld,e)*u%e,b=Ke(g,o,e)*g%e,w=Ke(b,i,e)*b%e,y=Ke(w,a,e)*w%e,S=Ke(y,c,e)*y%e,T=Ke(S,a,e)*w%e,v=Ke(T,t,e)*p%e,L=Ke(v,s,e)*b%e,F=Ke(L,n,e)*u%e,K=Ke(F,ld,e);if(!ud.eql(ud.sqr(K),r))throw new Error("Cannot find square root");return K}var ud=zn(G0,void 0,void 0,{sqrt:g2}),or=F0({a:BigInt(0),b:BigInt(7),Fp:ud,n:W0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let e=W0,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-y2*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,s=BigInt("0x100000000000000000000000000000000"),a=q0(i*r,e),c=q0(-n*r,e),u=Ee(r-a*t-c*o,e),p=Ee(-a*n-c*i,e),h=u>s,m=p>s;if(h&&(u=e-u),m&&(p=e-p),u>s||p>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:u,k2neg:m,k2:p}}}},Kr),jk=BigInt(0);var Mk=or.ProjectivePoint;function fd(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function z0(r,e){let t=rr.digest(e instanceof Uint8Array?e:e.subarray());if(fd(t))return t.then(({digest:n})=>or.sign(n,r).toDERRawBytes()).catch(n=>{throw new Ia(String(n))});try{return or.sign(t.digest,r).toDERRawBytes()}catch(n){throw new Ia(String(n))}}function X0(r,e,t){let n=rr.digest(t instanceof Uint8Array?t:t.subarray());if(fd(n))return n.then(({digest:o})=>or.verify(e,o,r)).catch(o=>{throw new Ta(String(o))});try{return or.verify(e,n.digest,r)}catch(o){throw new Ta(String(o))}}var Na=class{type="secp256k1";raw;_key;constructor(e){this._key=J0(e),this.raw=Y0(this._key)}toMultihash(){return br.digest(Vn(this))}toCID(){return Je.createV1(114,this.toMultihash())}toString(){return ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}verify(e,t){return X0(this._key,t,e)}},au=class{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=Z0(e),this.publicKey=new Na(t??Q0(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ge(this.raw,e.raw)}sign(e){return z0(this.raw,e)}};function pd(r){return new Na(r)}async function ew(){let r=w2();return new au(r)}function Y0(r){return or.ProjectivePoint.fromHex(r).toRawBytes(!0)}function Z0(r){try{return or.getPublicKey(r,!0),r}catch(e){throw new aa(String(e))}}function J0(r){try{return or.ProjectivePoint.fromHex(r),r}catch(e){throw new Fi(String(e))}}function Q0(r){try{return or.getPublicKey(r,!0)}catch(e){throw new aa(String(e))}}function w2(){return or.utils.randomPrivateKey()}async function tw(r,e){if(r==="Ed25519")return E0();if(r==="secp256k1")return ew();if(r==="RSA")return ad(b2(e));if(r==="ECDSA")return Zg(x2(e));throw new jn}function Pa(r,e){let{Type:t,Data:n}=Mr.decode(r),o=n??new Uint8Array;switch(t){case et.RSA:return od(o,e);case et.Ed25519:return Nh(o);case et.secp256k1:return pd(o);case et.ECDSA:return fh(o);default:throw new jn}}function rw(r){let{Type:e,Data:t}=Mr.decode(r.digest),n=t??new Uint8Array;switch(e){case et.Ed25519:return Nh(n);case et.secp256k1:return pd(n);case et.ECDSA:return fh(n);default:throw new jn}}function Vn(r){return Mr.encode({Type:et[r.type],Data:r.raw})}function b2(r){return r==null?2048:parseInt(r,10)}function x2(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new ve("Unsupported curve, should be P-256, P-384 or P-521")}async function cu(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new ve("Only RSA and ECDSA keys are supported")}var nw=Symbol.for("nodejs.util.inspect.custom"),v2=114,Oa=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[jp]=!0;toString(){return this.string==null&&(this.string=ke.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Je.createV1(v2,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Ge(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Ge(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[nw](){return`PeerId(${this.toString()})`}},Ra=class extends Oa{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},La=class extends Oa{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}},Da=class extends Oa{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}},A2=2336,Ua=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=br.digest(de(this.url))}[nw](){return`PeerId(${this.url})`}[jp]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Je.createV1(A2,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=le(e)),e.toString()===this.toString())}};var S2=114,ow=2336;function os(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=Hn(ke.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return E2(Je.parse(r));if(e==null)throw new ve('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=Hn(e.decode(r))}return iw(t)}function hd(r){if(r.type==="Ed25519")return new La({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Da({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new Ra({multihash:r.toCID().multihash,publicKey:r});throw new jn}function iw(r){if(C2(r))return new Ra({multihash:r});if(_2(r))try{let e=rw(r);if(e.type==="Ed25519")return new La({multihash:r,publicKey:e});if(e.type==="secp256k1")return new Da({multihash:r,publicKey:e})}catch{let t=le(r.digest);return new Ua(new URL(t))}throw new Nl("Supplied PeerID Multihash is invalid")}function E2(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==S2&&r.code!==ow)throw new kl("Supplied PeerID CID is invalid");if(r.code===ow){let e=le(r.multihash.digest);return new Ua(new URL(e))}return iw(r.multihash)}function _2(r){return r.code===br.code}function C2(r){return r.code===rr.code}var lu=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",u=2**(8*o)-1;for(;;){let p=this.readAtomically(()=>{let h=this.readChar();if(h===void 0)return;let m=Number.parseInt(h,e);if(!Number.isNaN(m))return m});if(p===void 0)break;if(i*=e,i+=p,i>u||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let o=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[o]=s[0],t[o+1]=s[1],t[o+2]=s[2],t[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];t[o]=i>>8,t[o+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=e(i.subarray(0,s));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var sw=45,I2=15,is=new lu;function dd(r){if(!(r.length>I2))return is.new(r).parseWith(()=>is.readIPv4Addr())}function md(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>sw))return is.new(r).parseWith(()=>is.readIPv6Addr())}function uu(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>sw)return;let t=is.new(r).parseWith(()=>is.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}var F5=parseInt("0xFFFF",16),W5=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function fu(r){return!!dd(r)}function pu(r){return!!md(r)}function hu(r){return!!uu(r)}var lw=fu,P2=pu,yd=function(r){let e=0;if(r=r.toString().trim(),lw(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(P2(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=lw(t[n]),s;i&&(s=yd(t[n]),t[n]=le(s.slice(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,le(s.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){let i=parseInt(t[n],16);o[e++]=i>>8&255,o[e++]=i&255}return o}throw new Error("invalid ip address")},uw=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let o=[];for(let i=0;i<t;i++)o.push(r[e+i]);return o.join(".")}if(t===16){let o=[];for(let i=0;i<t;i+=2)o.push(n.getUint16(e+i).toString(16));return o.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var ss={},gd={},R2=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,-1,"http-path"],[777,-1,"memory"]];R2.forEach(r=>{let e=L2(...r);gd[e.code]=e,ss[e.name]=e});function L2(r,e,t,n,o){return{code:r,size:e,name:t,resolvable:!!n,path:!!o}}function Re(r){if(typeof r=="number"){if(gd[r]!=null)return gd[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(ss[r]!=null)return ss[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var T4=Re("ip4"),B4=Re("ip6"),k4=Re("ipcidr");function vd(r,e){switch(Re(r).code){case 4:case 41:return U2(e);case 42:return xd(e);case 43:return le(e,"base10");case 6:case 273:case 33:case 132:return hw(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return xd(e);case 421:return H2(e);case 444:return pw(e);case 445:return pw(e);case 466:return K2(e);case 481:return globalThis.encodeURIComponent(xd(e));default:return le(e,"base16")}}function Ad(r,e){switch(Re(r).code){case 4:return fw(e);case 41:return fw(e);case 42:return bd(e);case 43:return de(e,"base10");case 6:case 273:case 33:case 132:return Sd(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return bd(e);case 421:return j2(e);case 444:return V2(e);case 445:return $2(e);case 466:return M2(e);case 481:return bd(globalThis.decodeURIComponent(e));default:return de(e,"base16")}}var wd=Object.values(Po).map(r=>r.decoder),D2=function(){let r=wd[0].or(wd[1]);return wd.slice(2).forEach(e=>r=r.or(e)),r}();function fw(r){if(!hu(r))throw new Error("invalid ip address");return yd(r)}function U2(r){let e=uw(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!hu(e))throw new Error("invalid ip address");return e}function Sd(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function hw(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function bd(r){let e=de(r),t=Uint8Array.from(Lt(e.length));return it([t,e],t.length+e.length)}function xd(r){let e=kt(r);if(r=r.slice(_e(e)),r.length!==e)throw new Error("inconsistent lengths");return le(r)}function j2(r){let e;r[0]==="Q"||r[0]==="1"?e=Hn(ke.decode(`z${r}`)).bytes:e=Je.parse(r).multihash.bytes;let t=Uint8Array.from(Lt(e.length));return it([t,e],t.length+e.length)}function M2(r){let e=D2.decode(r),t=Uint8Array.from(Lt(e.length));return it([t,e],t.length+e.length)}function K2(r){let e=kt(r),t=r.slice(_e(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+le(t,"base64url")}function H2(r){let e=kt(r),t=r.slice(_e(e));if(t.length!==e)throw new Error("inconsistent lengths");return le(t,"base58btc")}function V2(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=sn.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Sd(n);return it([t,o],t.length+o.length)}function $2(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=sn.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=Sd(n);return it([t,o],t.length+o.length)}function pw(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=le(e,"base32"),o=hw(t);return`${n}:${o}`}function dw(r){r=Ed(r);let e=[],t=[],n=null,o=r.split("/").slice(1);if(o.length===1&&o[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<o.length;i++){let s=o[i],a=Re(s);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=o.length)throw new du("invalid address: "+r);if(a.path===!0){n=Ed(o.slice(i).join("/")),e.push([a.code,Ad(a.code,n)]),t.push([a.code,n]);break}let c=Ad(a.code,o[i]);e.push([a.code,c]),t.push([a.code,vd(a.code,c)])}return{string:mw(t),bytes:mu(e),tuples:e,stringTuples:t,path:n}}function _d(r){let e=[],t=[],n=null,o=0;for(;o<r.length;){let i=kt(r,o),s=_e(i),a=Re(i),c=F2(a,r.slice(o+s));if(c===0){e.push([i]),t.push([i]),o+=s;continue}let u=r.slice(o+s,o+s+c);if(o+=c+s,o>r.length)throw new du("Invalid address Uint8Array: "+le(r,"base16"));e.push([i,u]);let p=vd(i,u);if(t.push([i,p]),a.path===!0){n=p;break}}return{bytes:Uint8Array.from(r),string:mw(t),tuples:e,stringTuples:t,path:n}}function mw(r){let e=[];return r.map(t=>{let n=Re(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),Ed(e.join("/"))}function mu(r){return it(r.map(e=>{let t=Re(e[0]),n=Uint8Array.from(Lt(t.code));return e.length>1&&e[1]!=null&&(n=it([n,e[1]])),n}))}function F2(r,e){if(r.size>0)return r.size/8;if(r.size===0)return 0;{let t=kt(e instanceof Uint8Array?e:Uint8Array.from(e));return t+_e(t)}}function Ed(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}var du=class extends Error{static name="ParseError";name="ParseError";constructor(e){super(`Error parsing address: ${e}`)}};var W2=Symbol.for("nodejs.util.inspect.custom"),Id=Symbol.for("@multiformats/js-multiaddr/multiaddr"),q2=[Re("dns").code,Re("dns4").code,Re("dns6").code,Re("dnsaddr").code],Cd=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}},yu=class r{bytes;#e;#t;#r;#n;[Id]=!0;constructor(e){e==null&&(e="");let t;if(e instanceof Uint8Array)t=_d(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=dw(e)}else if(gw(e))t=_d(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,o,i="",s=Re("tcp"),a=Re("udp"),c=Re("ip4"),u=Re("ip6"),p=Re("dns6"),h=Re("ip6zone");for(let[g,b]of this.stringTuples())g===h.code&&(i=`%${b??""}`),q2.includes(g)&&(t=s.name==="tcp"?"tcp":"udp",o=443,n=`${b??""}${i}`,e=g===p.code?6:4),(g===s.code||g===a.code)&&(t=Re(g).name==="tcp"?"tcp":"udp",o=parseInt(b??"")),(g===c.code||g===u.code)&&(t=Re(g).name==="tcp"?"tcp":"udp",n=`${b??""}${i}`,e=g===u.code?6:4);if(e==null||t==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:o}}protos(){return this.#t.map(([e])=>Object.assign({},Re(e)))}protoCodes(){return this.#t.map(([e])=>e)}protoNames(){return this.#t.map(([e])=>Re(e).name)}tuples(){return this.#t.map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return this.#r.map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new r(e),new r(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new r(n.slice(0,o))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new r(mu(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,o])=>{n===ss.p2p.code&&e.push([n,o]),n===ss["p2p-circuit"].code&&(e=[])});let t=e.pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?le(ke.decode(`z${n}`),"base58btc"):le(Je.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#n}equals(e){return Ge(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=yw.get(t.name);if(n==null)throw new Cd(`no available resolver for ${t.name}`);return(await n(this,e)).map(i=>Hr(i))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[W2](){return`Multiaddr(${this.#e})`}};var yw=new Map;function gw(r){return!!r?.[Id]}function Hr(r){return new yu(r)}var G2=r=>r.toString().split("/").slice(1),as=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),be=r=>({match:e=>as(t=>t===r).match(e),pattern:r}),Vo=()=>({match:r=>as(e=>typeof e=="string").match(r),pattern:"{string}"}),ja=()=>({match:r=>as(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),Te=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{ke.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),Ma=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{No.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),Ce=r=>({match:e=>{let t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),_t=(...r)=>({match:e=>{let t;for(let n of r){let o=n.match(e);o!==!1&&(t==null||o.length<t.length)&&(t=o)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),Ae=(...r)=>({match:e=>{for(let t of r){let n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function je(...r){function e(o){let i=G2(o);for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function t(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}var z2=Te(),a6=je(z2),wu=Ae(be("dns4"),Vo()),bu=Ae(be("dns6"),Vo()),xu=Ae(be("dnsaddr"),Vo()),Bd=Ae(be("dns"),Vo()),c6=je(wu,Ce(Te())),l6=je(bu,Ce(Te())),u6=je(xu,Ce(Te())),f6=je(_t(Bd,xu,wu,bu),Ce(Te())),ww=Ae(be("ip4"),as(fu)),bw=Ae(be("ip6"),as(pu)),kd=_t(ww,bw),mn=_t(kd,Bd,wu,bu,xu),p6=je(_t(kd,Ae(_t(Bd,xu,wu,bu),Ce(Te())))),h6=je(ww),d6=je(bw),m6=je(kd),Nd=Ae(mn,be("tcp"),ja()),Ka=Ae(mn,be("udp"),ja()),y6=je(Ae(Nd,Ce(Te()))),g6=je(Ka),Pd=Ae(Ka,be("quic"),Ce(Te())),vu=Ae(Ka,be("quic-v1"),Ce(Te())),X2=_t(Pd,vu),w6=je(Pd),b6=je(vu),Td=_t(mn,Nd,Ka,Pd,vu),xw=_t(Ae(Td,be("ws"),Ce(Te()))),x6=je(xw),vw=_t(Ae(Td,be("wss"),Ce(Te())),Ae(Td,be("tls"),Ce(Ae(be("sni"),Vo())),be("ws"),Ce(Te()))),v6=je(vw),Aw=Ae(Ka,be("webrtc-direct"),Ce(Ma()),Ce(Ma()),Ce(Te())),Sw=je(Aw),Ew=Ae(vu,be("webtransport"),Ce(Ma()),Ce(Ma()),Ce(Te())),A6=je(Ew),gu=_t(xw,vw,Ae(Nd,Ce(Te())),Ae(X2,Ce(Te())),Ae(mn,Ce(Te())),Aw,Ew,Te()),_w=je(gu),Y2=Ae(gu,be("p2p-circuit"),Te()),S6=je(Y2),Z2=_t(Ae(gu,be("p2p-circuit"),be("webrtc"),Ce(Te())),Ae(gu,be("webrtc"),Ce(Te())),Ae(be("webrtc"),Ce(Te()))),Cw=je(Z2),J2=_t(Ae(mn,be("tcp"),ja(),be("http"),Ce(Te())),Ae(mn,be("http"),Ce(Te()))),E6=je(J2),Q2=_t(Ae(mn,be("tcp"),_t(Ae(be("443"),be("http")),Ae(ja(),be("https"))),Ce(Te())),Ae(mn,be("tls"),be("http"),Ce(Te())),Ae(mn,be("https"),Ce(Te()))),_6=je(Q2),e_=_t(Ae(be("memory"),Vo(),Ce(Te()))),C6=je(e_);var Ct;(function(r){let e;(function(o){o.FIN="FIN",o.STOP_SENDING="STOP_SENDING",o.RESET="RESET",o.FIN_ACK="FIN_ACK"})(e=r.Flag||(r.Flag={}));let t;(function(o){o[o.FIN=0]="FIN",o[o.STOP_SENDING=1]="STOP_SENDING",o[o.RESET=2]="RESET",o[o.FIN_ACK=3]="FIN_ACK"})(t||(t={})),function(o){o.codec=()=>Ho(t)}(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=Tr((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.flag!=null&&(i.uint32(8),r.Flag.codec().encode(o.flag,i)),o.message!=null&&(i.uint32(18),i.bytes(o.message)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let u=o.uint32();switch(u>>>3){case 1:{a.flag=r.Flag.codec().decode(o);break}case 2:{a.message=o.bytes();break}default:{o.skipType(u&7);break}}}return a})),n),r.encode=o=>Ir(o,r.codec()),r.decode=(o,i)=>Cr(o,r.codec(),i)})(Ct||(Ct={}));var Iw=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],Od=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),Tw="libp2p+webrtc+v1/";var Bw=466,kw=2*1024*1024,Nw=30*1e3,cs=16*1024;function t_(r=cs){let e=_e(r-_e(r)),t=1+_e(Object.keys(Ct.Flag).length-1),n=1,o=r-e-t-n,i=_e(o);return e+t+n+i}var Pw=t_(),Ow=5e3,Rw=5e3,Lw=3e4,Rd="/webrtc",Ha="/webrtc-signaling/0.0.1",Dw="/libp2p/webrtc-direct/certificate",Uw="webrtc-direct-certificate-private-key";var jw=12096e5,Ld=864e5;var Mw=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},r_=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}();var n_=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}();var o_=function(){function r(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"}return r}();var i_=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var s_=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var a_=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,c_=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Kw=3,l_=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",a_]],Hw=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function $w(r){return r?Vw(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new s_:typeof navigator<"u"?Vw(navigator.userAgent):p_()}function u_(r){return r!==""&&l_.reduce(function(e,t){var n=t[0],o=t[1];if(e)return e;var i=o.exec(r);return!!i&&[n,i]},!1)}function Vw(r){var e=u_(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new i_;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<Kw&&(o=Mw(Mw([],o,!0),h_(Kw-o.length),!0)):o=[];var i=o.join("."),s=f_(r),a=c_.exec(r);return a&&a[1]?new o_(t,i,s,a[1]):new r_(t,i,s)}function f_(r){for(var e=0,t=Hw.length;e<t;e++){var n=Hw[e],o=n[0],i=n[1],s=i.exec(r);if(s)return o}return null}function p_(){var r=typeof process<"u"&&process.version;return r?new n_(process.version.slice(1)):null}function h_(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}function Le(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var Dd=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Ud=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Fw=r=>globalThis.DOMException===void 0?new Ud(r):new DOMException(r),Ww=r=>{let e=r.reason===void 0?Fw("This operation was aborted."):r.reason;return e instanceof Error?e:Fw(e)};function Va(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a,u=new Promise((p,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:g}=e;g.aborted&&h(Ww(g)),a=()=>{h(Ww(g))},g.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(p,h);return}let m=new Dd;s=i.setTimeout.call(void 0,()=>{if(n){try{p(n())}catch(g){h(g)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?p():o instanceof Error?h(o):(m.message=o??`Promise timed out after ${t} milliseconds`,h(m))},t),(async()=>{try{p(await r)}catch(g){h(g)}})()}).finally(()=>{u.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return u.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},u}var qw=$w(),$a=qw!=null&&qw.name==="firefox",Au=async function*(){},Su=async r=>{};function Gw(r,e,t=Lw,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);let o=Le(),i=!1;r.bufferedAmountLowThreshold=0;let s=()=>{i||(n.log("%s drain channel closed before drain",e),o.resolve())};r.addEventListener("close",s,{once:!0}),r.addEventListener("bufferedamountlow",()=>{i=!0,r.removeEventListener("close",s),o.resolve()}),await Va(o.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(o=>{n.log.error("error closing outbound stream",o)})}async function jd(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??Iw.map(e=>({urls:[e]})),r}var zw=(r=32)=>Tw+[...Array(r)].map(()=>Od.at(Math.floor(Math.random()*Od.length))).join("");var $o=class{log;peerConnection;remoteAddr;timeline;metrics;source=Au();sink=Su;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let n=this.peerConnection,o=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",o),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}};var Eu=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},ls=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Eu(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Eu(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var Md=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function us(r={}){return d_(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function d_(r,e){e=e??{};let t=e.onEnd,n=new ls,o,i,s,a=Le(),c=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((y,S)=>{i=T=>{i=null,n.push(T);try{y(r(n))}catch(v){S(v)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Le()})}},u=y=>i!=null?i(y):(n.push(y),o),p=y=>(n=new ls,i!=null?i({error:y}):(n.push({error:y}),o)),h=y=>{if(s)return o;if(e?.objectMode!==!0&&y?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:y})},m=y=>s?o:(s=!0,y!=null?p(y):u({done:!0})),g=()=>(n=new ls,m(),{done:!0}),b=y=>(m(y),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:g,throw:b,push:h,end:m,get readableLength(){return n.size},onEmpty:async y=>{let S=y?.signal;if(S?.throwIfAborted(),n.isEmpty())return;let T,v;S!=null&&(T=new Promise((L,F)=>{v=()=>{F(new Md)},S.addEventListener("abort",v)}));try{await Promise.race([a.promise,T])}finally{v!=null&&S!=null&&S?.removeEventListener("abort",v)}}},t==null)return o;let w=o;return o={[Symbol.asyncIterator](){return this},next(){return w.next()},throw(y){return w.throw(y),t!=null&&(t(y),t=void 0),{done:!0}},return(){return w.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(y){return w.end(y),t!=null&&(t(y),t=void 0),o},get readableLength(){return w.readableLength},onEmpty:y=>w.onEmpty(y)},o}var _u=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function It(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new _u(t?.errorMessage,t?.errorCode,t?.errorName));let n,o=new _u(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((i,s)=>{n=()=>{s(o)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}function Xw(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function Yw(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function Zw(r,e){let t=Xw(r).return?.();Yw(t)&&t.catch(n=>{e.error("could not cause iterator to return",n)})}var m_=5e3;function Kd(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Cu=class{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=Le(),this.closed=Le(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??m_,this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=us({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new To(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let t={signal:this.sinkController.signal};if(this.direction==="outbound"){let o=this.sendNewStream(t);Kd(o)&&await o}let n=()=>{Zw(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let o of e){o=o instanceof Uint8Array?new fe(o):o;let i=this.sendData(o,t);Kd(i)&&(this.sendingData=Le(),await i,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await It(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await It(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await It(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await It(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();Kd(t)&&t.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;let e=new Bl("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}};function Hd(r){let e=new globalThis.AbortController;function t(){e.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(let i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}let o=e.signal;return o.clear=n,o}var Iu=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},fs=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Tu=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},Fa=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Bu(r){return r[Symbol.asyncIterator]!=null}function Jw(r,e){if(r.byteLength>e)throw new fs("Message length too long")}var Nu=r=>{let e=_e(r),t=Qe(e);return Lt(r,t),Nu.bytes=e,t};Nu.bytes=0;function Wa(r,e){e=e??{};let t=e.lengthEncoder??Nu,n=e?.maxDataLength??4194304;function*o(i){Jw(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return Bu(r)?async function*(){for await(let i of r)yield*o(i)}():function*(){for(let i of r)yield*o(i)}()}Wa.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??Nu,n=e?.maxDataLength??4194304;return Jw(r,n),new fe(t(r.byteLength),r)};var Fo;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Fo||(Fo={}));var Vd=r=>{let e=kt(r);return Vd.bytes=_e(e),e};Vd.bytes=0;function qa(r,e){let t=new fe,n=Fo.LENGTH,o=-1,i=e?.lengthDecoder??Vd,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===Fo.LENGTH)try{if(o=i(t),o<0)throw new Iu("Invalid message length");if(o>a)throw new fs("Message length too long");let u=i.bytes;t.consume(u),e?.onLength!=null&&e.onLength(o),n=Fo.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>s)throw new Tu("Message length length too long");break}throw u}if(n===Fo.DATA){if(t.byteLength<o)break;let u=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(u),yield u,n=Fo.LENGTH}}}return Bu(r)?async function*(){for await(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new Fa("Unexpected end of input")}():function*(){for(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new Fa("Unexpected end of input")}()}qa.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:i,value:s}=await r.next(t);if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return qa(n,{...e??{},onLength:i=>{t=i}})};var $d=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}};async function Ga(r,e,t,n){let o=new $d(n?.errorMessage,n?.errorCode);return t?.aborted===!0?Promise.reject(o):new Promise((i,s)=>{function a(){t?.removeEventListener("abort",p),r.removeEventListener(e,c),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,u)}let c=h=>{try{if(n?.filter?.(h)===!1)return}catch(m){a(),s(m);return}a(),i(h)},u=h=>{a(),s(h.detail)},p=()=>{a(),s(o)};t?.addEventListener("abort",p),r.addEventListener(e,c),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,u)})}var Fd=class extends Cu{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=o=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Va(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(i){this.log.error("error receiving FIN_ACK",i)}}).then(()=>{this.incomingData.end(),this.channel.close(),t?.(o)}).catch(i=>{this.log.error("error ending stream",i)})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=us(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??Nw,this.maxBufferedAmount=e.maxBufferedAmount??kw,this.maxMessageSize=(e.maxMessageSize??cs)-Pw,this.receiveFinAck=Le(),this.finAckTimeout=e.closeTimeout??Ow,this.openTimeout=e.openTimeout??Rw,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new To("Unknown datachannel state")}this.channel.onopen=o=>{this.timeline.open=new Date().getTime()},this.channel.onclose=o=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(i=>{this.log.error("error closing stream after channel closed",i)})},this.channel.onerror=o=>{this.log.trace("received onerror event"),this.closeController.abort();let i=o.error;this.abort(i)},this.channel.onmessage=async o=>{let{data:i}=o;i===null||i.byteLength===0||this.incomingData.push(new Uint8Array(i,0,i.byteLength))};let n=this;Promise.resolve().then(async()=>{for await(let o of qa(this.incomingData)){let i=n.processIncomingProtobuf(o);i!=null&&n.sourcePush(new fe(i))}}).catch(o=>{this.log.error("error processing incoming data channel messages",o)})}sendNewStream(){}async _sendMessage(e,t=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new To(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){let n=AbortSignal.timeout(this.openTimeout),o=Hd([this.closeController.signal,n]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Ga(this.channel,"open",o)}finally{o.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let n=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),o=Hd([this.closeController.signal,n]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Ga(this.channel,"bufferedamountlow",o)}catch(i){throw n.aborted?new Ol(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):i}finally{o.clear()}}try{this.channel.send(e.subarray())}catch(n){this.log.error("error while sending message",n)}}async sendData(e){for(this.log.trace("-> will send %d bytes",e.byteLength),e=e.sublist();e.byteLength>0;){let t=Math.min(e.byteLength,this.maxMessageSize),n=e.subarray(0,t),o=Ct.encode({message:n}),i=Wa.single(o);this.log.trace("-> sending message %s",this.channel.readyState),await this._sendMessage(i),this.log.trace("-> sent message %s",this.channel.readyState),e.consume(t)}this.log.trace("-> sent data %s",this.channel.readyState)}async sendReset(){try{await this._sendFlag(Ct.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}}async sendCloseWrite(e){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Ct.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await It(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(n){this.log.error("failed to await FIN_ACK",n)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Ct.Flag.STOP_SENDING)}processIncomingProtobuf(e){let t=Ct.decode(e);if(t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===Ct.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Ct.Flag.FIN_ACK).catch(n=>{this.log.error("error sending FIN_ACK immediately",n)})),t.flag===Ct.Flag.RESET&&this.reset(),t.flag===Ct.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===Ct.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return t.message}async _sendFlag(e){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,e.toString()),!1;this.log.trace("sending flag %s",e.toString());let t=Ct.encode({flag:e}),n=Wa.single(t);try{return await this._sendMessage(n,!1),!0}catch(o){this.log.error("could not send flag %s - %e",e.toString(),o)}return!1}};function ps(r){let{channel:e,direction:t}=r;return new Fd({id:t==="inbound"?`i${e.id}`:`r${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${t}:${e.id}`),...r})}var eo=class{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??Rd,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}let o={},i=ps({channel:n,direction:"inbound",onEnd:s=>{o.onEnd(s)},logger:e.logger,...this.dataChannelOptions});o.stream=i,o.channel=n,o.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(s=>s.stream.id!==i.id)},this.bufferedStreams.push(o)}}createStreamMuxer(e){return new Wd(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}},Wd=class{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??Rd,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}let o=n.id,i=ps({channel:n,direction:"inbound",onEnd:()=>{this.#e(i,n),this.log("incoming channel %s ended",o)},logger:this.logger,...this.dataChannelOptions});this.streams.push(i),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(i)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),this.#e(n.stream,n.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(n.stream)})})}#e(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),Gw(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(n=>n.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(let t of this.streams)t.abort(e)}source=Au();sink=Su;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let n=ps({channel:e,direction:"outbound",onEnd:()=>{this.#e(n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),this.metrics?.increment({outgoing_stream:!0}),n}};var Pu=globalThis.RTCPeerConnection,Ou=globalThis.RTCSessionDescription,Qw=globalThis.RTCIceCandidate;var qd=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await It(this.readNext.promise,t?.signal,t)}};function Ru(){return new qd}var Lu=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function eb(r,e){let t=Ru();r.sink(t).catch(async s=>{await t.end(s)}),r.sink=async s=>{for await(let a of s)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new fe;return{read:async s=>{if(s?.signal?.throwIfAborted(),s?.bytes==null){let{done:c,value:u}=await It(n.next(),s?.signal);return c===!0?null:u}for(;o.byteLength<s.bytes;){let{value:c,done:u}=await It(n.next(),s?.signal);if(u===!0)throw new Lu("unexpected end of input");o.append(c)}let a=o.sublist(0,s.bytes);return o.consume(s.bytes),a},write:async(s,a)=>{a?.signal?.throwIfAborted(),s instanceof Uint8Array?await t.push(s,a):await t.push(s.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let s=r.source;r.source=async function*(){e?.yieldBytes===!1?yield o:yield*o,yield*s}()}return r}}}var Du=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Uu=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},ju=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function tb(r,e={}){let t=eb(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=_e(e.maxDataLength));let n=e?.lengthDecoder??kt,o=e?.lengthEncoder??Lt;return{read:async s=>{let a=-1,c=new fe;for(;;){c.append(await t.read({...s,bytes:1}));try{a=n(c)}catch(u){if(u instanceof RangeError)continue;throw u}if(a<0)throw new Du("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new ju("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new Uu("message length too long");return t.read({...s,bytes:a})},write:async(s,a)=>{await t.write(new fe(o(s.byteLength),s),a)},writeV:async(s,a)=>{let c=new fe(...s.flatMap(u=>[o(u.byteLength),u]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function Mu(r,e){let t=tb(r,e),n={read:async(o,i)=>{let s=await t.read(i);return o.decode(s)},write:async(o,i,s)=>{await t.write(i.encode(o),s)},writeV:async(o,i,s)=>{await t.writeV(o.map(a=>i.encode(a)),s)},pb:o=>({read:async i=>n.read(o,i),write:async(i,s)=>n.write(i,o,s),writeV:async(i,s)=>n.writeV(i,o,s),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}var Zt=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}};var to=class extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}},ir=class extends to{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}};var Ku=class extends to{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}};var Hu=class extends to{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}},Vu=class extends to{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}};var Dt;(function(r){let e;(function(o){o.SDP_OFFER="SDP_OFFER",o.SDP_ANSWER="SDP_ANSWER",o.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.SDP_OFFER=0]="SDP_OFFER",o[o.SDP_ANSWER=1]="SDP_ANSWER",o[o.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),function(o){o.codec=()=>Ho(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Tr((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.data!=null&&(i.uint32(18),i.string(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let u=o.uint32();switch(u>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.data=o.string();break}default:{o.skipType(u&7);break}}}return a})),n),r.encode=o=>Ir(o,r.codec()),r.decode=(o,i)=>Cr(o,r.codec(),i)})(Dt||(Dt={}));var $u=async(r,e,t)=>{try{let n=Le();for(w_(r,n);;){let o=await Promise.race([n.promise,e.read({signal:t.signal}).catch(()=>{})]);if(o==null){t.signal?.throwIfAborted();break}if(o.type!==Dt.Type.ICE_CANDIDATE)throw new Pl("ICE candidate message expected");let i=JSON.parse(o.data??"null");if(i===""||i===null){t.onProgress?.(new Zt("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}let s=new Qw(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new Zt("webrtc:add-ice-candidate",s.candidate)),await r.addIceCandidate(s)}catch(a){t.log.error("%s bad candidate received",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate",t.direction,n),t.signal?.aborted===!0&&Fu(r)!=="connected")throw n}};function Fu(r){return $a?r.iceConnectionState:r.connectionState}function w_(r,e){r[$a?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(Fu(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Tl("RTCPeerConnection was closed"));break;default:break}}}async function rb({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:o,connectionManager:i,transportManager:s,log:a,logger:c,onProgress:u}){let{baseAddr:p}=nb(o);n?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",p);let h=p.getPeerId();if(h==null)throw new ve("Relay peer was missing");let m=i.getConnections(os(h)),g,b=!1;m.length===0?(u?.(new Zt("webrtc:dial-relay")),g=await s.dial(p,{signal:t,onProgress:u}),b=!0):(u?.(new Zt("webrtc:reuse-relay-connection")),g=m[0]);try{u?.(new Zt("webrtc:open-signaling-stream"));let w=await g.newStream(Ha,{signal:t,runOnLimitedConnection:!0}),y=Mu(w).pb(Dt),S=new Pu(r),T=new eo({logger:c},{peerConnection:S,dataChannelOptions:e});try{let v=S.createDataChannel("init");S.onicecandidate=({candidate:O})=>{let M=JSON.stringify(O?.toJSON()??null);a.trace("initiator sending ICE candidate %o",O),y.write({type:Dt.Type.ICE_CANDIDATE,data:M},{signal:t}).catch(D=>{a.error("error sending ICE candidate",D)})},S.onicecandidateerror=O=>{a.error("initiator ICE candidate error",O)};let L=await S.createOffer().catch(O=>{throw a.error("could not execute createOffer",O),new ir("Failed to set createOffer")});a.trace("initiator send SDP offer %s",L.sdp),u?.(new Zt("webrtc:send-sdp-offer")),await y.write({type:Dt.Type.SDP_OFFER,data:L.sdp},{signal:t}),await S.setLocalDescription(L).catch(O=>{throw a.error("could not execute setLocalDescription",O),new ir("Failed to set localDescription")}),u?.(new Zt("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let F=await y.read({signal:t});if(F.type!==Dt.Type.SDP_ANSWER)throw new ir("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",F.data);let K=new Ou({type:"answer",sdp:F.data});return await S.setRemoteDescription(K).catch(O=>{throw a.error("could not execute setRemoteDescription",O),new ir("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),u?.(new Zt("webrtc:read-ice-candidates")),await $u(S,y,{direction:"initiator",signal:t,log:a,onProgress:u}),a.trace("initiator connected, closing init channel"),v.close(),u?.(new Zt("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await w.close({signal:t}),a.trace("initiator connected to remote address %s",o),{remoteAddress:o,peerConnection:S,muxerFactory:T}}catch(v){throw a.error("outgoing signaling error",v),S.close(),w.abort(v),v}finally{S.onicecandidate=null,S.onicecandidateerror=null}}finally{if(b)try{await g.close({signal:t})}catch(w){g.abort(w)}}}var ob=je(_w.matchers[0],be("p2p-circuit")),Wu=class r extends Mn{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(n=>ob.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof r)).map(e=>e.getAddrs().filter(t=>ob.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}};async function ib({peerConnection:r,stream:e,signal:t,connection:n,log:o}){o.trace("new inbound signaling stream");let i=Mu(e).pb(Dt);try{r.onicecandidate=({candidate:p})=>{let h=JSON.stringify(p?.toJSON()??null);o.trace("recipient sending ICE candidate %s",h),i.write({type:Dt.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(m=>{o.error("error sending ICE candidate",m)})},o.trace("recipient read SDP offer");let a=await i.read({signal:t});if(a.type!==Dt.Type.SDP_OFFER)throw new ir(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);o.trace("recipient received SDP offer %s",a.data);let c=new Ou({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(p=>{throw o.error("could not execute setRemoteDescription",p),new ir("Failed to set remoteDescription")});let u=await r.createAnswer().catch(p=>{throw o.error("could not execute createAnswer",p),new ir("Failed to create answer")});o.trace("recipient send SDP answer %s",u.sdp),await i.write({type:Dt.Type.SDP_ANSWER,data:u.sdp},{signal:t}),await r.setLocalDescription(u).catch(p=>{throw o.error("could not execute setLocalDescription",p),new ir("Failed to set localDescription")}),o.trace("recipient read candidates until connected"),await $u(r,i,{direction:"recipient",signal:t,log:o})}catch(a){if(Fu(r)!=="connected")throw o.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}let s=Hr(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return o.trace("recipient connected to remote address %s",s),{remoteAddress:s}}var qu=class{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[_l]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[Wi]=["@libp2p/transport"];[xg]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(Ha,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(Ha),this._started=!1}createListener(e){return new Wu(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(Cw.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);let{remoteAddress:n,peerConnection:o,muxerFactory:i}=await rb({rtcConfiguration:await jd(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new $o(this.components,{peerConnection:o,timeline:{open:Date.now()},remoteAddr:n,metrics:this.metrics?.dialerEvents}),a=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(o,s),a}async _onProtocol({connection:e,stream:t},n){let o=new Pu(await jd(this.init.rtcConfiguration)),i=new eo(this.components,{peerConnection:o,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:s}=await ib({peerConnection:o,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});let a=new $o(this.components,{peerConnection:o,timeline:{open:new Date().getTime()},remoteAddr:s,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(a,{skipEncryption:!0,skipProtection:!0,muxerFactory:i,signal:n}),this._closeOnShutdown(o,a)}catch(s){throw this.log.error("incoming signaling error",s),o.close(),t.abort(s),s}}_closeOnShutdown(e,t){let n=()=>{t.close().catch(o=>{this.log.error("could not close WebRTCMultiaddrConnection",o)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}};function nb(r){let e=r.toString().split("/webrtc/");if(e.length!==2)throw new ve("webrtc protocol was not present in multiaddr");if(!e[0].includes("/p2p-circuit"))throw new ve("p2p-circuit protocol was not present in multiaddr");let t=Hr(e[0]),o=Hr("/"+e[1]).getPeerId();if(o==null)throw new ve("destination peer id was missing");let i=t.protos().pop();if(i===void 0)throw new ve("invalid multiaddr");return i.name!=="p2p"&&(t=t.encapsulate(`/p2p/${o}`)),{baseAddr:t,peerId:os(o)}}var $G=jr(ab());var Wr={};ft(Wr,{Any:()=>$r,BaseBlock:()=>tt,BaseStringBlock:()=>Za,BitString:()=>Nr,BmpString:()=>Xo,Boolean:()=>qo,CharacterString:()=>oi,Choice:()=>ms,Constructed:()=>at,DATE:()=>nc,DateTime:()=>ic,Duration:()=>sc,EndOfContent:()=>Ja,Enumerated:()=>Go,GeneralString:()=>ni,GeneralizedTime:()=>ii,GraphicString:()=>ri,HexBlock:()=>Fr,IA5String:()=>ti,Integer:()=>xn,Null:()=>Br,NumericString:()=>Zo,ObjectIdentifier:()=>zo,OctetString:()=>kr,Primitive:()=>bn,PrintableString:()=>Jo,RawData:()=>Yd,RelativeObjectIdentifier:()=>rc,Repeated:()=>si,Sequence:()=>Mt,Set:()=>Kt,TIME:()=>ac,TeletexString:()=>Qo,TimeOfDay:()=>oc,UTCTime:()=>io,UniversalString:()=>Yo,Utf8String:()=>ar,ValueBlock:()=>ht,VideotexString:()=>ei,ViewWriter:()=>ds,VisibleString:()=>oo,compareSchema:()=>no,fromBER:()=>An,verifySchema:()=>M_});var me=jr(gn());function Wo(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function ro(r,e,t=-1){let n=t,o=r,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(r<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let u=new Uint8Array(c);for(let p=a-1;p>=0;p--){let h=Math.pow(2,p*e);u[i-p-1]=Math.floor(o/h),o-=u[i-p-1]*h}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function Xu(...r){let e=0,t=0;for(let i of r)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of r)o.set(i,t),t+=i.length;return o}function zd(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let n=Wo(t,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,Wo(i,8)-n}function cb(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let s=t-e,a=ro(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=ro(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function lb(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function Ut(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(t)}var t3=Math.log(2);function Yu(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Zd(r){let e=0,t=0;for(let o=0;o<r.length;o++){let i=r[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<r.length;o++){let i=r[o];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function vn(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var ds=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Zd(this.items)}},za=[new Uint8Array([1])],ub="0123456789",Xd="name",fb="valueHexView",I_="isHexOnly",T_="idBlock",B_="tagClass",k_="tagNumber",N_="isConstructed",P_="fromBER",O_="toBER",R_="local",jt="",Pr=new ArrayBuffer(0),pf=new Uint8Array(0),Ya="EndOfContent",hb="OCTET STRING",db="BIT STRING";function Fr(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?me.BufferSourceConverter.toUint8Array(i.valueHex):pf}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!vn(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Pr)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:me.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var wn=class{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=jt,warnings:n=[],valueBeforeDecode:o=pf}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=me.BufferSourceConverter.toUint8Array(o)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:me.Convert.ToHex(this.valueBeforeDecodeView)}}};wn.NAME="baseBlock";var ht=class extends wn{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};ht.NAME="valueBlock";var Zu=class extends Fr(wn){constructor({idBlock:e={}}={}){var t,n,o,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?me.BufferSourceConverter.toUint8Array(e.valueHex):pf,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(o=e.tagNumber)!==null&&o!==void 0?o:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Pr}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let o=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,o[0]=t}return o.buffer}if(!this.isHexOnly){let o=ro(this.tagNumber,7),i=new Uint8Array(o),s=o.byteLength,a=new Uint8Array(s+1);if(a[0]=t|31,!e){for(let c=0;c<s-1;c++)a[c+1]=i[c]|128;a[s]=i[s-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){let o=this.valueHexView;for(let i=0;i<o.length-1;i++)n[i+1]=o[i]|128;n[this.valueHexView.byteLength]=o[o.length-1]}return n.buffer}fromBER(e,t,n){let o=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,u=this.valueHexView=new Uint8Array(255),p=255;for(;i[c]&128;){if(u[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===p){p+=255;let m=new Uint8Array(p);for(let g=0;g<u.length;g++)m[g]=u[g];u=this.valueHexView=new Uint8Array(p)}}this.blockLength=c+1,u[c-1]=i[c]&127;let h=new Uint8Array(c);for(let m=0;m<c;m++)h[m]=u[m];u=this.valueHexView=new Uint8Array(c),u.set(h),this.blockLength<=9?this.tagNumber=Wo(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Zu.NAME="identificationBlock";var Ju=class extends wn{constructor({lenBlock:e={}}={}){var t,n,o;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(o=e.length)!==null&&o!==void 0?o:0}fromBER(e,t,n){let o=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=i[0]&127;if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=t+1,c=o.subarray(a,a+s);return c[s-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Wo(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){let o=ro(this.length,8);if(o.byteLength>127)return this.error="Too big length",Pr;if(t=new ArrayBuffer(o.byteLength+1),e)return t;let i=new Uint8Array(o);n=new Uint8Array(t),n[0]=o.byteLength|128;for(let s=0;s<o.byteLength;s++)n[s+1]=i[s];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};Ju.NAME="lengthBlock";var X={},tt=class extends wn{constructor({name:e=jt,optional:t=!1,primitiveSchema:n,...o}={},i){super(o),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new Zu(o),this.lenBlock=new Ju(o),this.valueBlock=i?new i(o):new ht(o)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}toBER(e,t){let n=t||new ds;t||mb(this);let o=this.idBlock.toBER(e);if(n.write(o),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let s=this.lenBlock.toBER(e);n.write(s),n.write(i)}return t?Pr:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():me.Convert.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=me.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let t=this.toBER(),n=e.toBER();return lb(t,n)}};tt.NAME="BaseBlock";function mb(r){var e;if(r instanceof X.Constructed)for(let t of r.valueBlock.value)mb(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var Za=class extends tt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=jt,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};Za.NAME="BaseStringBlock";var Qu=class extends Fr(ht){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}};Qu.NAME="PrimitiveValueBlock";var yb,bn=class extends tt{constructor(e={}){super(e,Qu),this.idBlock.isConstructed=!1}};yb=bn;X.Primitive=yb;bn.NAME="PRIMITIVE";function L_(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function ys(r,e=0,t=r.length){let n=e,o=new tt({},ht),i=new wn;if(!vn(i,r,e,t))return o.error=i.error,{offset:-1,result:o};if(!r.subarray(e,e+t).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(r,e,t);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,t-=o.idBlock.blockLength,a=o.lenBlock.fromBER(r,e,t),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,t-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=tt;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=X.EndOfContent;break;case 1:c=X.Boolean;break;case 2:c=X.Integer;break;case 3:c=X.BitString;break;case 4:c=X.OctetString;break;case 5:c=X.Null;break;case 6:c=X.ObjectIdentifier;break;case 10:c=X.Enumerated;break;case 12:c=X.Utf8String;break;case 13:c=X.RelativeObjectIdentifier;break;case 14:c=X.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=X.Sequence;break;case 17:c=X.Set;break;case 18:c=X.NumericString;break;case 19:c=X.PrintableString;break;case 20:c=X.TeletexString;break;case 21:c=X.VideotexString;break;case 22:c=X.IA5String;break;case 23:c=X.UTCTime;break;case 24:c=X.GeneralizedTime;break;case 25:c=X.GraphicString;break;case 26:c=X.VisibleString;break;case 27:c=X.GeneralString;break;case 28:c=X.UniversalString;break;case 29:c=X.CharacterString;break;case 30:c=X.BmpString;break;case 31:c=X.DATE;break;case 32:c=X.TimeOfDay;break;case 33:c=X.DateTime;break;case 34:c=X.Duration;break;default:{let u=o.idBlock.isConstructed?new X.Constructed:new X.Primitive;u.idBlock=o.idBlock,u.lenBlock=o.lenBlock,u.warnings=o.warnings,o=u}}break;case 2:case 3:case 4:default:c=o.idBlock.isConstructed?X.Constructed:X.Primitive}return o=L_(o,c),a=o.fromBER(r,e,o.lenBlock.isIndefiniteForm?t:o.lenBlock.length),o.valueBeforeDecodeView=r.subarray(n,n+o.blockLength),{offset:a,result:o}}function An(r){if(!r.byteLength){let e=new tt({},ht);return e.error="Input buffer has zero length",{offset:-1,result:e}}return ys(me.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function D_(r,e){return r?1:e}var Vr=class extends ht{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){let o=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,o,t,n))return-1;if(this.valueBeforeDecodeView=o.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;D_(this.isIndefiniteForm,n)>0;){let s=ys(o,i,n);if(s.offset===-1)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,n-=s.result.blockLength,this.value.push(s.result),this.isIndefiniteForm&&s.result.constructor.NAME===Ya)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Ya?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){let n=t||new ds;for(let o=0;o<this.value.length;o++)this.value[o].toBER(e,n);return t?Pr:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}};Vr.NAME="ConstructedValueBlock";var gb,at=class extends tt{constructor(e={}){super(e,Vr),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};gb=at;X.Constructed=gb;at.NAME="CONSTRUCTED";var ef=class extends ht{fromBER(e,t,n){return t}toBER(e){return Pr}};ef.override="EndOfContentValueBlock";var wb,Ja=class extends tt{constructor(e={}){super(e,ef),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};wb=Ja;X.EndOfContent=wb;Ja.NAME=Ya;var bb,Br=class extends tt{constructor(e={}){super(e,ht),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};bb=Br;X.Null=bb;Br.NAME="NULL";var tf=class extends Fr(ht){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=me.BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){let o=me.BufferSourceConverter.toUint8Array(e);return vn(this,o,t,n)?(this.valueHexView=o.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,zd.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};tf.NAME="BooleanValueBlock";var xb,qo=class extends tt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,tf),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};xb=qo;X.Boolean=xb;qo.NAME="BOOLEAN";var rf=class extends Fr(Vr){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let o=0;if(this.isConstructed){if(this.isHexOnly=!1,o=Vr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let i=0;i<this.value.length;i++){let s=this.value[i].constructor.NAME;if(s===Ya){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==hb)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,o=super.fromBER(e,t,n),this.blockLength=n;return o}toBER(e,t){return this.isConstructed?Vr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};rf.NAME="OctetStringValueBlock";var Jd,kr=class extends tt{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},rf),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){let s=ys(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return at.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=me.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof Jd&&e.push(t.valueBlock.valueHexView);return me.BufferSourceConverter.concat(e)}};Jd=kr;X.OctetString=Jd;kr.NAME=hb;var nf=class extends Fr(Vr){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let o=-1;if(this.isConstructed){if(o=Vr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let a of this.value){let c=a.constructor.NAME;if(c===Ya){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==db)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let u=a.valueBlock;if(this.unusedBits>0&&u.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=u.unusedBits}return o}let i=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,i,t,n))return-1;let s=i.subarray(t,t+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=s.subarray(1);try{if(a.byteLength){let c=ys(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+n}toBER(e,t){if(this.isConstructed)return Vr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Pr;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};nf.NAME="BitStringValueBlock";var vb,Nr=class extends tt{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},nf),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return at.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let s of t)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};vb=Nr;X.BitString=vb;Nr.NAME=db;var Ab;function U_(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,u=0,p=c<s?s:c,h=0;for(let m=p;m>=0;m--,h++){switch(!0){case h<a.length:u=i[s-h]+a[c-h]+t[0];break;default:u=i[s-h]+t[0]}switch(t[0]=u/10,!0){case h>=i.length:i=Xu(new Uint8Array([u%10]),i);break;default:i[s-h]=u%10}}return t[0]>0&&(i=Xu(t,i)),i}function pb(r){if(r>=za.length)for(let e=za.length;e<=r;e++){let t=new Uint8Array([0]),n=za[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+t[0]]);t[0]=i[0]/10,n[o]=i[0]%10}t[0]>0&&(n=Xu(t,n)),za.push(n)}return za[r]}function j_(r,e){let t=0,n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,u,p=0;for(let h=c;h>=0;h--,p++)switch(u=i[s-p]-a[c-p]-t,!0){case u<0:t=1,i[s-p]=u+10;break;default:t=0,i[s-p]=u}if(t>0)for(let h=s-c+1;h>=0;h--,p++)if(u=i[s-p]-t,u<0)t=1,i[s-p]=u+10;else{t=0,i[s-p]=u;break}return i.slice()}var Qa=class extends Fr(ht){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=zd.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(cb(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,o=0){let i=this.fromBER(e,t,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let o=super.fromBER(e,t,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let u=0;u<8;u++){if((o&1)===1)switch(n){case e:t=j_(pb(n),t),s="-";break;default:t=U_(t,pb(n))}n++,o>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(s+=ub.charAt(t[c]));return a===!1&&(s+=ub.charAt(0)),s}};Ab=Qa;Qa.NAME="IntegerValueBlock";Object.defineProperty(Ab.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Xa,xn=class extends tt{constructor(e={}){super(e,Qa),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Yu(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Yu();let t=BigInt(e),n=new ds,o=t.toString(16).replace(/^-/,""),i=new Uint8Array(me.Convert.FromHex(o));if(t<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let u=BigInt(`0x${me.Convert.ToHex(a)}`)+t,p=me.BufferSourceConverter.toUint8Array(me.Convert.FromHex(u.toString(16)));p[0]|=128,n.write(p)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new Xa({valueHex:n.final()})}convertToDER(){let e=new Xa({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Xa({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};Xa=xn;X.Integer=Xa;xn.NAME="INTEGER";var Sb,Go=class extends xn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Sb=Go;X.Enumerated=Sb;Go.NAME="ENUMERATED";var ec=class extends Fr(ht){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;let o=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Wo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Yu();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let n=new Uint8Array(t.length/7);for(let o=0;o<n.length;o++)n[o]=parseInt(t.slice(o*7,o*7+7),2)+(o+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=ro(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Pr;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n}toString(){let e="";if(this.isHexOnly)e=me.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};ec.NAME="sidBlock";var of=class extends ht{constructor({value:e=jt,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new ec;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e){let t=[];for(let n=0;n<this.value.length;n++){let o=this.value[n].toBER(e);if(o.byteLength===0)return this.error=this.value[n].error,Pr;t.push(o)}return Zd(t)}fromString(e){this.value=[];let t=0,n=0,o="",i=!1;do if(n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1,i){let s=this.value[0],a=0;switch(s.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(o,10);if(isNaN(c))return;s.valueDec=c+a,i=!1}else{let s=new ec;if(o>Number.MAX_SAFE_INTEGER){Yu();let a=BigInt(o);s.valueBigInt=a}else if(s.valueDec=parseInt(o,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t?(o=`{${o}}`,this.value[n].isFirstSid?e=`2.{${o} - 80}`:e+=o):e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};of.NAME="ObjectIdentifierValueBlock";var Eb,zo=class extends tt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,of),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Eb=zo;X.ObjectIdentifier=Eb;zo.NAME="OBJECT IDENTIFIER";var tc=class extends Fr(wn){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;let o=me.BufferSourceConverter.toUint8Array(e);if(!vn(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Wo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=ro(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Pr;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=me.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};tc.NAME="relativeSidBlock";var sf=class extends ht{constructor({value:e=jt,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new tc;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e,t){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(e);if(i.byteLength===0)return this.error=this.value[o].error,Pr;n.push(i)}return Zd(n)}fromString(e){this.value=[];let t=0,n=0,o="";do{n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1;let i=new tc;if(i.valueDec=parseInt(o,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(o=`{${o}}`),e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};sf.NAME="RelativeObjectIdentifierValueBlock";var _b,rc=class extends tt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,sf),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};_b=rc;X.RelativeObjectIdentifier=_b;rc.NAME="RelativeObjectIdentifier";var Cb,Mt=class extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Cb=Mt;X.Sequence=Cb;Mt.NAME="SEQUENCE";var Ib,Kt=class extends at{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};Ib=Kt;X.Set=Ib;Kt.NAME="SET";var af=class extends Fr(ht){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=jt}toJSON(){return{...super.toJSON(),value:this.value}}};af.NAME="StringValueBlock";var cf=class extends af{};cf.NAME="SimpleStringValueBlock";var Nt=class extends Za{constructor({...e}={}){super(e,cf)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,me.BufferSourceConverter.toUint8Array(e))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);this.valueBlock.value=e}};Nt.NAME="SIMPLE STRING";var lf=class extends Nt{fromBuffer(e){this.valueBlock.valueHexView=me.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=me.Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=me.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(me.Convert.FromUtf8String(e)),this.valueBlock.value=e}};lf.NAME="Utf8StringValueBlock";var Tb,ar=class extends lf{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};Tb=ar;X.Utf8String=Tb;ar.NAME="UTF8String";var uf=class extends Nt{fromBuffer(e){this.valueBlock.value=me.Convert.ToUtf16String(e),this.valueBlock.valueHexView=me.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(me.Convert.FromUtf16String(e))}};uf.NAME="BmpStringValueBlock";var Bb,Xo=class extends uf{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Bb=Xo;X.BmpString=Bb;Xo.NAME="BMPString";var ff=class extends Nt{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let o=0;o<n.length;o+=4)n[o]=n[o+3],n[o+1]=n[o+2],n[o+2]=0,n[o+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let o=0;o<t;o++){let i=ro(e.charCodeAt(o),8),s=new Uint8Array(i);if(s.length>4)continue;let a=4-s.length;for(let c=s.length-1;c>=0;c--)n[o*4+c+a]=s[c]}this.valueBlock.value=e}};ff.NAME="UniversalStringValueBlock";var kb,Yo=class extends ff{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};kb=Yo;X.UniversalString=kb;Yo.NAME="UniversalString";var Nb,Zo=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};Nb=Zo;X.NumericString=Nb;Zo.NAME="NumericString";var Pb,Jo=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};Pb=Jo;X.PrintableString=Pb;Jo.NAME="PrintableString";var Ob,Qo=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};Ob=Qo;X.TeletexString=Ob;Qo.NAME="TeletexString";var Rb,ei=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};Rb=ei;X.VideotexString=Rb;ei.NAME="VideotexString";var Lb,ti=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};Lb=ti;X.IA5String=Lb;ti.NAME="IA5String";var Db,ri=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};Db=ri;X.GraphicString=Db;ri.NAME="GraphicString";var Ub,oo=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};Ub=oo;X.VisibleString=Ub;oo.NAME="VisibleString";var jb,ni=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};jb=ni;X.GeneralString=jb;ni.NAME="GeneralString";var Mb,oi=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};Mb=oi;X.CharacterString=Mb;oi.NAME="CharacterString";var Kb,io=class extends oo{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let o=0;o<e.length;o++)this.valueBlock.valueHexView[o]=e.charCodeAt(o)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,me.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=Ut(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Ut(this.month,2),t[2]=Ut(this.day,2),t[3]=Ut(this.hour,2),t[4]=Ut(this.minute,2),t[5]=Ut(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};Kb=io;X.UTCTime=Kb;io.NAME="UTCTime";var Hb,ii=class extends io{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,m=n.indexOf("+"),g="";if(m===-1&&(m=n.indexOf("-"),h=-1),m!==-1){if(g=n.substring(m+1),n=n.substring(0,m),g.length!==2&&g.length!==4)throw new Error("Wrong input string for conversion");let b=parseInt(g.substring(0,2),10);if(isNaN(b.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*b,g.length===4){if(b=parseInt(g.substring(2,4),10),isNaN(b.valueOf()))throw new Error("Wrong input string for conversion");c=h*b}}}let u=n.indexOf(".");if(u===-1&&(u=n.indexOf(",")),u!==-1){let h=new Number(`0${n.substring(u)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");i=h.valueOf(),o=n.substring(0,u)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,u!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*i;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=60*i;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,u!==-1){let h=1e3*i;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}let p=s.exec(o);if(p===null)throw new Error("Wrong input string for conversion");for(let h=1;h<p.length;h++)switch(h){case 1:this.year=parseInt(p[h],10);break;case 2:this.month=parseInt(p[h],10);break;case 3:this.day=parseInt(p[h],10);break;case 4:this.hour=parseInt(p[h],10)+a;break;case 5:this.minute=parseInt(p[h],10)+c;break;case 6:this.second=parseInt(p[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(Ut(this.year,4)),t.push(Ut(this.month,2)),t.push(Ut(this.day,2)),t.push(Ut(this.hour,2)),t.push(Ut(this.minute,2)),t.push(Ut(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Ut(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};Hb=ii;X.GeneralizedTime=Hb;ii.NAME="GeneralizedTime";var Vb,nc=class extends ar{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};Vb=nc;X.DATE=Vb;nc.NAME="DATE";var $b,oc=class extends ar{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};$b=oc;X.TimeOfDay=$b;oc.NAME="TimeOfDay";var Fb,ic=class extends ar{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};Fb=ic;X.DateTime=Fb;ic.NAME="DateTime";var Wb,sc=class extends ar{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};Wb=sc;X.Duration=Wb;sc.NAME="Duration";var qb,ac=class extends ar{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};qb=ac;X.TIME=qb;ac.NAME="TIME";var $r=class{constructor({name:e=jt,optional:t=!1}={}){this.name=e,this.optional=t}},ms=class extends $r{constructor({value:e=[],...t}={}){super(t),this.value=e}},si=class extends $r{constructor({value:e=new $r,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}},Yd=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=me.BufferSourceConverter.toUint8Array(e)}constructor({data:e=pf}={}){this.dataView=me.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let o=t+n;return this.dataView=me.BufferSourceConverter.toUint8Array(e).subarray(t,o),o}toBER(e){return this.dataView.slice().buffer}};function no(r,e,t){if(t instanceof ms){for(let i of t.value)if(no(r,e,i).verified)return{verified:!0,result:r};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(Xd)&&(i.name=t.name),i}}if(t instanceof $r)return t.hasOwnProperty(Xd)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(T_ in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(P_ in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(O_ in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(B_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(k_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(N_)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(I_ in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(fb in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&(r[t.name]=e)),t instanceof X.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof si&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let u=0;u<t.valueBlock.value.length;u++)c=c&&(t.valueBlock.value[u].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){let u={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&(delete r[t.name],u.name=t.name)),u}}else if(t.valueBlock.value[0]instanceof si){if(s=no(r,e.valueBlock.value[c],t.valueBlock.value[0].value),s.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&delete r[t.name]),s;if(Xd in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let u={};R_ in t.valueBlock.value[0]&&t.valueBlock.value[0].local?u=e:u=r,typeof u[t.valueBlock.value[0].name]>"u"&&(u[t.valueBlock.value[0].name]=[]),u[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=no(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),s.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&delete r[t.name]),s;if(s.verified===!1){let c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&fb in e.valueBlock){let i=ys(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,jt),t.name&&(delete r[t.name],s.name=t.name)),s}return no(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function M_(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=ys(me.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:no(t.result,t.result,e)}var A;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(A||(A={}));var d;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(d||(d={}));var Qd=jr(gn()),qr=class{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(Qd.BufferSourceConverter.isBufferSource(e))this.unusedBits=t,this.value=Qd.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Nr))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Nr({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Nr({name:e})}toNumber(){let e="",t=new Uint8Array(this.value);for(let n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;let o=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};var em=jr(gn()),oe=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):em.BufferSourceConverter.isBufferSource(e)?this.buffer=em.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof kr))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new kr({valueHex:this.buffer})}toSchema(e){return new kr({name:e})}};var K_={fromASN:r=>r instanceof Br?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Br;let e=An(r);if(e.result.error)throw new Error(e.result.error);return e.result}},H_={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new xn({value:+r})},V_={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Go({value:r})},ye={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new xn({valueHex:r})};var $_={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Nr({valueHex:r})},F_={fromASN:r=>r.valueBlock.toString(),toASN:r=>new zo({value:r})},W_={fromASN:r=>r.valueBlock.value,toASN:r=>new qo({value:r})},gs={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new kr({valueHex:r})},Gb={fromASN:r=>new oe(r.getValue()),toASN:r=>r.toASN()};function cr(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}var tm=cr(ar),q_=cr(Xo),G_=cr(Yo),z_=cr(Zo),X_=cr(Jo),Y_=cr(Qo),Z_=cr(ei),J_=cr(ti),Q_=cr(ri),eC=cr(oo),tC=cr(ni),rC=cr(oi),nC={fromASN:r=>r.toDate(),toASN:r=>new io({valueDate:r})},oC={fromASN:r=>r.toDate(),toASN:r=>new ii({valueDate:r})},iC={fromASN:()=>null,toASN:()=>new Br};function ws(r){switch(r){case d.Any:return K_;case d.BitString:return $_;case d.BmpString:return q_;case d.Boolean:return W_;case d.CharacterString:return rC;case d.Enumerated:return V_;case d.GeneralString:return tC;case d.GeneralizedTime:return oC;case d.GraphicString:return Q_;case d.IA5String:return J_;case d.Integer:return H_;case d.Null:return iC;case d.NumericString:return z_;case d.ObjectIdentifier:return F_;case d.OctetString:return gs;case d.PrintableString:return X_;case d.TeletexString:return Y_;case d.UTCTime:return nC;case d.UniversalString:return G_;case d.Utf8String:return tm;case d.VideotexString:return Z_;case d.VisibleString:return eC;default:return null}}function lr(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:lr(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function nm(r){var e;if(r){let t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:nm(t)}return!1}function zb(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}var hf=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:A.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=t?i:"",c;if(typeof s.type=="number"){let p=d[s.type],h=Wr[p];if(!h)throw new Error(`Cannot get ASN1 class by name '${p}'`);c=new h({name:a})}else lr(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===A.Choice?c=new $r({name:a}):(c=this.create(s.type,!1),c.name=a):c=new $r({name:a});let u=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let p=s.repeated==="set"?Kt:Mt;c=new p({name:"",value:[new si({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||lr(s.type)){let p=s.repeated?at:bn;o.push(new p({name:a,optional:u,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let p=!!s.repeated,h=p?c:this.get(s.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,o.push(new at({name:p?"":a,optional:u,idBlock:{tagClass:3,tagNumber:s.context},value:h}))}else o.push(new at({optional:u,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=u,o.push(c)}switch(n.type){case A.Sequence:return new Mt({value:o,name:""});case A.Set:return new Kt({value:o,name:""});case A.Choice:return new ms({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}};var Pt=new hf;var C=r=>e=>{let t;Pt.has(e)?t=Pt.get(e):(t=Pt.createDefault(e),Pt.set(e,t)),Object.assign(t,r)};var f=r=>(e,t)=>{let n;Pt.has(e.constructor)?n=Pt.get(e.constructor):(n=Pt.createDefault(e.constructor),Pt.set(e.constructor,n));let o=Object.assign({},r);if(typeof o.type=="number"&&!o.converter){let i=ws(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);o.converter=i}n.items[t]=o};var cc=class extends Error{constructor(){super(...arguments),this.schemas=[]}};var lc=class{static parse(e,t){let n=An(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(lr(t))return new t().fromASN(e);let o=Pt.get(t);Pt.cache(t);let i=o.schema;if(e.constructor===at&&o.type!==A.Choice){i=new at({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(let c in o.items)delete e[c]}let s=no({},e,i);if(!s.verified)throw new cc(`Data does not match to ${t.name} ASN1 schema. ${s.result.error}`);let a=new t;if(nm(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let c=o.itemType;if(typeof c=="number"){let u=ws(c);if(!u)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,p=>u.fromASN(p))}else return t.from(e.valueBlock.value,u=>this.fromASN(u,c))}for(let c in o.items){let u=s.result[c];if(!u)continue;let p=o.items[c],h=p.type;if(typeof h=="number"||lr(h)){let m=(n=p.converter)!==null&&n!==void 0?n:lr(h)?new h:null;if(!m)throw new Error("Converter is empty");if(p.repeated)if(p.implicit){let g=p.repeated==="sequence"?Mt:Kt,b=new g;b.valueBlock=u.valueBlock;let w=An(b.toBER(!1));if(w.offset===-1)throw new Error(`Cannot parse the child item. ${w.result.error}`);if(!("value"in w.result.valueBlock&&Array.isArray(w.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let y=w.result.valueBlock.value;a[c]=Array.from(y,S=>m.fromASN(S))}else a[c]=Array.from(u,g=>m.fromASN(g));else{let g=u;if(p.implicit){let b;if(lr(h))b=new h().toSchema("");else{let w=d[h],y=Wr[w];if(!y)throw new Error(`Cannot get '${w}' class from asn1js module`);b=new y}b.valueBlock=g.valueBlock,g=An(b.toBER(!1)).result}a[c]=m.fromASN(g)}}else if(p.repeated){if(!Array.isArray(u))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(u,m=>this.fromASN(m,h))}else a[c]=this.fromASN(u,h)}return a}catch(o){throw o instanceof cc&&o.schemas.push(t.name),o}}};var uc=class r{static serialize(e){return e instanceof tt?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&lr(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let t=e.constructor,n=Pt.get(t);Pt.cache(t);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=ws(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",t,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&zb(this.serialize(a.defaultValue),this.serialize(c)))continue;let u=r.toAsnItem(a,s,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||lr(a.type))){let p={};p.valueHex=u instanceof Br?u.valueBeforeDecodeView:u.valueBlock.toBER(),o.push(new bn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...p}))}else o.push(new at({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:u.valueBlock.value}));else o.push(new at({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else a.repeated?o=o.concat(u):o.push(u)}let i;switch(n.type){case A.Sequence:i=new Mt({value:o});break;case A.Set:i=new Kt({value:o});break;case A.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,t,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${t}' doesn't have converter for type ${d[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,u=>s.toASN(u)),c=e.repeated==="sequence"?Mt:Kt;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?Mt:Kt;i=new a({value:s})}else i=this.toASN(o);return i}};var re=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let t of e)this.push(t)}}};var om=jr(gn());var $=class r{static serialize(e){return uc.serialize(e)}static parse(e,t){return lc.parse(e,t)}static toString(e){let t=om.BufferSourceConverter.isBufferSource(e)?om.BufferSourceConverter.toArrayBuffer(e):r.serialize(e),n=An(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};function l(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var Xb=jr(gn()),fc=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");let n=t[0]?t[0].split(":"):[],o=t[1]?t[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=t.slice(0,n).join(":"),c=t.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[t,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(t)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){let t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){let n=t.length/2,o=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,u)=>c+(u.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(Xb.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}};var Yb=jr(gn()),im,sm,am,rt=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};l([f({type:d.TeletexString})],rt.prototype,"teletexString",void 0);l([f({type:d.PrintableString})],rt.prototype,"printableString",void 0);l([f({type:d.UniversalString})],rt.prototype,"universalString",void 0);l([f({type:d.Utf8String})],rt.prototype,"utf8String",void 0);l([f({type:d.BmpString})],rt.prototype,"bmpString",void 0);rt=l([C({type:A.Choice})],rt);var bs=class extends rt{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Yb.Convert.ToHex(this.anyValue):super.toString())}};l([f({type:d.IA5String})],bs.prototype,"ia5String",void 0);l([f({type:d.Any})],bs.prototype,"anyValue",void 0);bs=l([C({type:A.Choice})],bs);var ai=class{constructor(e={}){this.type="",this.value=new bs,Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],ai.prototype,"type",void 0);l([f({type:bs})],ai.prototype,"value",void 0);var so=im=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,im.prototype)}};so=im=l([C({type:A.Set,itemType:ai})],so);var cm=sm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,sm.prototype)}};cm=sm=l([C({type:A.Sequence,itemType:so})],cm);var Ne=am=class extends cm{constructor(e){super(e),Object.setPrototypeOf(this,am.prototype)}};Ne=am=l([C({type:A.Sequence})],Ne);var sC={fromASN:r=>fc.toString(gs.fromASN(r)),toASN:r=>gs.toASN(fc.fromString(r))},ao=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],ao.prototype,"typeId",void 0);l([f({type:d.Any,context:0})],ao.prototype,"value",void 0);var pc=class{constructor(e={}){this.partyName=new rt,Object.assign(this,e)}};l([f({type:rt,optional:!0,context:0,implicit:!0})],pc.prototype,"nameAssigner",void 0);l([f({type:rt,context:1,implicit:!0})],pc.prototype,"partyName",void 0);var ae=class{constructor(e={}){Object.assign(this,e)}};l([f({type:ao,context:0,implicit:!0})],ae.prototype,"otherName",void 0);l([f({type:d.IA5String,context:1,implicit:!0})],ae.prototype,"rfc822Name",void 0);l([f({type:d.IA5String,context:2,implicit:!0})],ae.prototype,"dNSName",void 0);l([f({type:d.Any,context:3,implicit:!0})],ae.prototype,"x400Address",void 0);l([f({type:Ne,context:4,implicit:!1})],ae.prototype,"directoryName",void 0);l([f({type:pc,context:5})],ae.prototype,"ediPartyName",void 0);l([f({type:d.IA5String,context:6,implicit:!0})],ae.prototype,"uniformResourceIdentifier",void 0);l([f({type:d.OctetString,context:7,implicit:!0,converter:sC})],ae.prototype,"iPAddress",void 0);l([f({type:d.ObjectIdentifier,context:8,implicit:!0})],ae.prototype,"registeredID",void 0);ae=l([C({type:A.Choice})],ae);var co="1.3.6.1.5.5.7",lo=`${co}.1`,Zb=`${co}.2`,ci=`${co}.3`,df=`${co}.48`,fO=`${Zb}.1`,pO=`${Zb}.2`,lm=`${df}.1`,um=`${df}.2`,fm=`${df}.3`,pm=`${df}.5`,pe="2.5.29";var hm,mf=`${lo}.1`,Sn=class{constructor(e={}){this.accessMethod="",this.accessLocation=new ae,Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Sn.prototype,"accessMethod",void 0);l([f({type:ae})],Sn.prototype,"accessLocation",void 0);var li=hm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,hm.prototype)}};li=hm=l([C({type:A.Sequence,itemType:Sn})],li);var yf=`${pe}.35`,ui=class extends oe{},Gr=class{constructor(e={}){e&&Object.assign(this,e)}};l([f({type:ui,context:0,optional:!0,implicit:!0})],Gr.prototype,"keyIdentifier",void 0);l([f({type:ae,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Gr.prototype,"authorityCertIssuer",void 0);l([f({type:d.Integer,context:2,optional:!0,implicit:!0,converter:ye})],Gr.prototype,"authorityCertSerialNumber",void 0);var gf=`${pe}.19`,fi=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};l([f({type:d.Boolean,defaultValue:!1})],fi.prototype,"cA",void 0);l([f({type:d.Integer,optional:!0})],fi.prototype,"pathLenConstraint",void 0);var dm,Ve=dm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,dm.prototype)}};Ve=dm=l([C({type:A.Sequence,itemType:ae})],Ve);var mm,aC=`${pe}.29`,Jb=mm=class extends Ve{constructor(e){super(e),Object.setPrototypeOf(this,mm.prototype)}};Jb=mm=l([C({type:A.Sequence})],Jb);var ym,bf=`${pe}.32`,FO=`${bf}.0`,En=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};l([f({type:d.IA5String})],En.prototype,"ia5String",void 0);l([f({type:d.VisibleString})],En.prototype,"visibleString",void 0);l([f({type:d.BmpString})],En.prototype,"bmpString",void 0);l([f({type:d.Utf8String})],En.prototype,"utf8String",void 0);En=l([C({type:A.Choice})],En);var hc=class{constructor(e={}){this.organization=new En,this.noticeNumbers=[],Object.assign(this,e)}};l([f({type:En})],hc.prototype,"organization",void 0);l([f({type:d.Integer,repeated:"sequence"})],hc.prototype,"noticeNumbers",void 0);var dc=class{constructor(e={}){Object.assign(this,e)}};l([f({type:hc,optional:!0})],dc.prototype,"noticeRef",void 0);l([f({type:En,optional:!0})],dc.prototype,"explicitText",void 0);var wf=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.IA5String})],wf.prototype,"cPSuri",void 0);l([f({type:dc})],wf.prototype,"userNotice",void 0);wf=l([C({type:A.Choice})],wf);var mc=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],mc.prototype,"policyQualifierId",void 0);l([f({type:d.Any})],mc.prototype,"qualifier",void 0);var pi=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],pi.prototype,"policyIdentifier",void 0);l([f({type:mc,repeated:"sequence",optional:!0})],pi.prototype,"policyQualifiers",void 0);var yc=ym=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,ym.prototype)}};yc=ym=l([C({type:A.Sequence,itemType:pi})],yc);var JO=`${pe}.20`,gc=class{constructor(e=0){this.value=e}};l([f({type:d.Integer})],gc.prototype,"value",void 0);gc=l([C({type:A.Choice})],gc);var iR=`${pe}.27`,Qb=class extends gc{};Qb=l([C({type:A.Choice})],Qb);var gm,xf=`${pe}.31`,Or;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(Or||(Or={}));var wc=class extends qr{toJSON(){let e=[],t=this.toNumber();return t&Or.aACompromise&&e.push("aACompromise"),t&Or.affiliationChanged&&e.push("affiliationChanged"),t&Or.cACompromise&&e.push("cACompromise"),t&Or.certificateHold&&e.push("certificateHold"),t&Or.cessationOfOperation&&e.push("cessationOfOperation"),t&Or.keyCompromise&&e.push("keyCompromise"),t&Or.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Or.superseded&&e.push("superseded"),t&Or.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}},_n=class{constructor(e={}){Object.assign(this,e)}};l([f({type:ae,context:0,repeated:"sequence",implicit:!0})],_n.prototype,"fullName",void 0);l([f({type:so,context:1,implicit:!0})],_n.prototype,"nameRelativeToCRLIssuer",void 0);_n=l([C({type:A.Choice})],_n);var zr=class{constructor(e={}){Object.assign(this,e)}};l([f({type:_n,context:0,optional:!0})],zr.prototype,"distributionPoint",void 0);l([f({type:wc,context:1,optional:!0,implicit:!0})],zr.prototype,"reasons",void 0);l([f({type:ae,context:2,optional:!0,repeated:"sequence",implicit:!0})],zr.prototype,"cRLIssuer",void 0);var uo=gm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,gm.prototype)}};uo=gm=l([C({type:A.Sequence,itemType:zr})],uo);var wm,xR=`${pe}.46`,ex=wm=class extends uo{constructor(e){super(e),Object.setPrototypeOf(this,wm.prototype)}};ex=wm=l([C({type:A.Sequence,itemType:zr})],ex);var TR=`${pe}.28`,Jt=class r{constructor(e={}){this.onlyContainsUserCerts=r.ONLY,this.onlyContainsCACerts=r.ONLY,this.indirectCRL=r.ONLY,this.onlyContainsAttributeCerts=r.ONLY,Object.assign(this,e)}};Jt.ONLY=!1;l([f({type:_n,context:0,optional:!0})],Jt.prototype,"distributionPoint",void 0);l([f({type:d.Boolean,context:1,defaultValue:Jt.ONLY,implicit:!0})],Jt.prototype,"onlyContainsUserCerts",void 0);l([f({type:d.Boolean,context:2,defaultValue:Jt.ONLY,implicit:!0})],Jt.prototype,"onlyContainsCACerts",void 0);l([f({type:wc,context:3,optional:!0,implicit:!0})],Jt.prototype,"onlySomeReasons",void 0);l([f({type:d.Boolean,context:4,defaultValue:Jt.ONLY,implicit:!0})],Jt.prototype,"indirectCRL",void 0);l([f({type:d.Boolean,context:5,defaultValue:Jt.ONLY,implicit:!0})],Jt.prototype,"onlyContainsAttributeCerts",void 0);var tx=`${pe}.21`,bc;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(bc||(bc={}));var xc=class{constructor(e=bc.unspecified){this.reason=bc.unspecified,this.reason=e}toJSON(){return bc[this.reason]}toString(){return this.toJSON()}};l([f({type:d.Enumerated})],xc.prototype,"reason",void 0);xc=l([C({type:A.Choice})],xc);var bm,vf=`${pe}.37`,vc=bm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,bm.prototype)}};vc=bm=l([C({type:A.Sequence,itemType:d.ObjectIdentifier})],vc);var MR=`${vf}.0`,rx=`${ci}.1`,nx=`${ci}.2`,ox=`${ci}.3`,ix=`${ci}.4`,sx=`${ci}.8`,ax=`${ci}.9`;var FR=`${pe}.54`,xm=class{constructor(e=new ArrayBuffer(0)){this.value=e}};l([f({type:d.Integer,converter:ye})],xm.prototype,"value",void 0);xm=l([C({type:A.Choice})],xm);var cx=`${pe}.24`,Ac=class{constructor(e){this.value=new Date,e&&(this.value=e)}};l([f({type:d.GeneralizedTime})],Ac.prototype,"value",void 0);Ac=l([C({type:A.Choice})],Ac);var vm,rL=`${pe}.18`,lx=vm=class extends Ve{constructor(e){super(e),Object.setPrototypeOf(this,vm.prototype)}};lx=vm=l([C({type:A.Sequence})],lx);var Af=`${pe}.15`,Rr;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(Rr||(Rr={}));var xs=class extends qr{toJSON(){let e=this.toNumber(),t=[];return e&Rr.cRLSign&&t.push("crlSign"),e&Rr.dataEncipherment&&t.push("dataEncipherment"),e&Rr.decipherOnly&&t.push("decipherOnly"),e&Rr.digitalSignature&&t.push("digitalSignature"),e&Rr.encipherOnly&&t.push("encipherOnly"),e&Rr.keyAgreement&&t.push("keyAgreement"),e&Rr.keyCertSign&&t.push("keyCertSign"),e&Rr.keyEncipherment&&t.push("keyEncipherment"),e&Rr.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}};var Am,pL=`${pe}.30`,vs=class{constructor(e={}){this.base=new ae,this.minimum=0,Object.assign(this,e)}};l([f({type:ae})],vs.prototype,"base",void 0);l([f({type:d.Integer,context:0,defaultValue:0,implicit:!0})],vs.prototype,"minimum",void 0);l([f({type:d.Integer,context:1,optional:!0,implicit:!0})],vs.prototype,"maximum",void 0);var Sf=Am=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Am.prototype)}};Sf=Am=l([C({type:A.Sequence,itemType:vs})],Sf);var Ef=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Sf,context:0,optional:!0,implicit:!0})],Ef.prototype,"permittedSubtrees",void 0);l([f({type:Sf,context:1,optional:!0,implicit:!0})],Ef.prototype,"excludedSubtrees",void 0);var wL=`${pe}.36`,_f=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.Integer,context:0,implicit:!0,optional:!0,converter:ye})],_f.prototype,"requireExplicitPolicy",void 0);l([f({type:d.Integer,context:1,implicit:!0,optional:!0,converter:ye})],_f.prototype,"inhibitPolicyMapping",void 0);var Sm,SL=`${pe}.33`,Sc=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Sc.prototype,"issuerDomainPolicy",void 0);l([f({type:d.ObjectIdentifier})],Sc.prototype,"subjectDomainPolicy",void 0);var ux=Sm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Sm.prototype)}};ux=Sm=l([C({type:A.Sequence,itemType:Sc})],ux);var Em,_m=`${pe}.17`,Cf=Em=class extends Ve{constructor(e){super(e),Object.setPrototypeOf(this,Em.prototype)}};Cf=Em=l([C({type:A.Sequence})],Cf);var dt=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],dt.prototype,"type",void 0);l([f({type:d.Any,repeated:"set"})],dt.prototype,"values",void 0);var Cm,ML=`${pe}.9`,fx=Cm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Cm.prototype)}};fx=Cm=l([C({type:A.Sequence,itemType:dt})],fx);var Im=`${pe}.14`,Ht=class extends ui{};var zL=`${pe}.16`,If=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.GeneralizedTime,context:0,implicit:!0,optional:!0})],If.prototype,"notBefore",void 0);l([f({type:d.GeneralizedTime,context:1,implicit:!0,optional:!0})],If.prototype,"notAfter",void 0);var Ec;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(Ec||(Ec={}));var Tf=class extends qr{toJSON(){let e=[],t=this.toNumber();return t&Ec.pKIXCertificate&&e.push("pKIXCertificate"),t&Ec.newExtensions&&e.push("newExtensions"),t&Ec.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}},Bf=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new Tf,Object.assign(this,e)}};l([f({type:d.GeneralString})],Bf.prototype,"entrustVers",void 0);l([f({type:Tf})],Bf.prototype,"entrustInfoFlags",void 0);var Tm,nD=`${lo}.11`,px=Tm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Tm.prototype)}};px=Tm=l([C({type:A.Sequence,itemType:Sn})],px);var hx=jr(gn()),j=class r{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof r&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&hx.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};l([f({type:d.ObjectIdentifier})],j.prototype,"algorithm",void 0);l([f({type:d.Any,optional:!0})],j.prototype,"parameters",void 0);var mt=class{constructor(e={}){this.algorithm=new j,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:j})],mt.prototype,"algorithm",void 0);l([f({type:d.BitString})],mt.prototype,"subjectPublicKey",void 0);var ze=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};l([f({type:d.UTCTime})],ze.prototype,"utcTime",void 0);l([f({type:d.GeneralizedTime})],ze.prototype,"generalTime",void 0);ze=l([C({type:A.Choice})],ze);var Cn=class{constructor(e){this.notBefore=new ze(new Date),this.notAfter=new ze(new Date),e&&(this.notBefore=new ze(e.notBefore),this.notAfter=new ze(e.notAfter))}};l([f({type:ze})],Cn.prototype,"notBefore",void 0);l([f({type:ze})],Cn.prototype,"notAfter",void 0);var Bm,yt=class r{constructor(e={}){this.extnID="",this.critical=r.CRITICAL,this.extnValue=new oe,Object.assign(this,e)}};yt.CRITICAL=!1;l([f({type:d.ObjectIdentifier})],yt.prototype,"extnID",void 0);l([f({type:d.Boolean,defaultValue:yt.CRITICAL})],yt.prototype,"critical",void 0);l([f({type:oe})],yt.prototype,"extnValue",void 0);var Qt=Bm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Bm.prototype)}};Qt=Bm=l([C({type:A.Sequence,itemType:yt})],Qt);var Xr;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(Xr||(Xr={}));var gt=class{constructor(e={}){this.version=Xr.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new j,this.issuer=new Ne,this.validity=new Cn,this.subject=new Ne,this.subjectPublicKeyInfo=new mt,Object.assign(this,e)}};l([f({type:d.Integer,context:0,defaultValue:Xr.v1})],gt.prototype,"version",void 0);l([f({type:d.Integer,converter:ye})],gt.prototype,"serialNumber",void 0);l([f({type:j})],gt.prototype,"signature",void 0);l([f({type:Ne})],gt.prototype,"issuer",void 0);l([f({type:Cn})],gt.prototype,"validity",void 0);l([f({type:Ne})],gt.prototype,"subject",void 0);l([f({type:mt})],gt.prototype,"subjectPublicKeyInfo",void 0);l([f({type:d.BitString,context:1,implicit:!0,optional:!0})],gt.prototype,"issuerUniqueID",void 0);l([f({type:d.BitString,context:2,implicit:!0,optional:!0})],gt.prototype,"subjectUniqueID",void 0);l([f({type:Qt,context:3,optional:!0})],gt.prototype,"extensions",void 0);var ur=class{constructor(e={}){this.tbsCertificate=new gt,this.signatureAlgorithm=new j,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:gt})],ur.prototype,"tbsCertificate",void 0);l([f({type:j})],ur.prototype,"signatureAlgorithm",void 0);l([f({type:d.BitString})],ur.prototype,"signatureValue",void 0);var hi=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new ze,Object.assign(this,e)}};l([f({type:d.Integer,converter:ye})],hi.prototype,"userCertificate",void 0);l([f({type:ze})],hi.prototype,"revocationDate",void 0);l([f({type:yt,optional:!0,repeated:"sequence"})],hi.prototype,"crlEntryExtensions",void 0);var er=class{constructor(e={}){this.signature=new j,this.issuer=new Ne,this.thisUpdate=new ze,Object.assign(this,e)}};l([f({type:d.Integer,optional:!0})],er.prototype,"version",void 0);l([f({type:j})],er.prototype,"signature",void 0);l([f({type:Ne})],er.prototype,"issuer",void 0);l([f({type:ze})],er.prototype,"thisUpdate",void 0);l([f({type:ze,optional:!0})],er.prototype,"nextUpdate",void 0);l([f({type:hi,repeated:"sequence",optional:!0})],er.prototype,"revokedCertificates",void 0);l([f({type:yt,optional:!0,context:0,repeated:"sequence"})],er.prototype,"crlExtensions",void 0);var di=class{constructor(e={}){this.tbsCertList=new er,this.signatureAlgorithm=new j,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:er})],di.prototype,"tbsCertList",void 0);l([f({type:j})],di.prototype,"signatureAlgorithm",void 0);l([f({type:d.BitString})],di.prototype,"signature",void 0);var H=jr(gn());var Lr=class{constructor(e={}){this.issuer=new Ne,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:Ne})],Lr.prototype,"issuer",void 0);l([f({type:d.Integer,converter:ye})],Lr.prototype,"serialNumber",void 0);var mi=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ht,context:0,implicit:!0})],mi.prototype,"subjectKeyIdentifier",void 0);l([f({type:Lr})],mi.prototype,"issuerAndSerialNumber",void 0);mi=l([C({type:A.Choice})],mi);var wt;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(wt||(wt={}));var yi=class extends j{};yi=l([C({type:A.Sequence})],yi);var _c=class extends j{};_c=l([C({type:A.Sequence})],_c);var Vt=class extends j{};Vt=l([C({type:A.Sequence})],Vt);var Cc=class extends j{};Cc=l([C({type:A.Sequence})],Cc);var mx=class extends j{};mx=l([C({type:A.Sequence})],mx);var kf=class extends j{};kf=l([C({type:A.Sequence})],kf);var Dr=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Dr.prototype,"attrType",void 0);l([f({type:d.Any,repeated:"set"})],Dr.prototype,"attrValues",void 0);var km,$t=class{constructor(e={}){this.version=wt.v0,this.sid=new mi,this.digestAlgorithm=new yi,this.signatureAlgorithm=new _c,this.signature=new oe,Object.assign(this,e)}};l([f({type:d.Integer})],$t.prototype,"version",void 0);l([f({type:mi})],$t.prototype,"sid",void 0);l([f({type:yi})],$t.prototype,"digestAlgorithm",void 0);l([f({type:Dr,repeated:"set",context:0,implicit:!0,optional:!0})],$t.prototype,"signedAttrs",void 0);l([f({type:_c})],$t.prototype,"signatureAlgorithm",void 0);l([f({type:oe})],$t.prototype,"signature",void 0);l([f({type:Dr,repeated:"set",context:1,implicit:!0,optional:!0})],$t.prototype,"unsignedAttrs",void 0);var Ic=km=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,km.prototype)}};Ic=km=l([C({type:A.Set,itemType:$t})],Ic);var yx=class extends ze{};yx=l([C({type:A.Choice})],yx);var gx=class extends $t{};gx=l([C({type:A.Sequence})],gx);var Tc=class{constructor(e={}){this.acIssuer=new ae,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};l([f({type:ae})],Tc.prototype,"acIssuer",void 0);l([f({type:d.Integer})],Tc.prototype,"acSerial",void 0);l([f({type:dt,repeated:"sequence"})],Tc.prototype,"attrs",void 0);var Nm,Bc=Nm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Nm.prototype)}};Bc=Nm=l([C({type:A.Sequence,itemType:d.ObjectIdentifier})],Bc);var As=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};l([f({type:d.Integer,optional:!0})],As.prototype,"pathLenConstraint",void 0);l([f({type:Bc,implicit:!0,context:0,optional:!0})],As.prototype,"permittedAttrs",void 0);l([f({type:Bc,implicit:!0,context:1,optional:!0})],As.prototype,"excludedAttrs",void 0);l([f({type:d.Boolean,defaultValue:!0})],As.prototype,"permitUnSpecified",void 0);var fr=class{constructor(e={}){this.issuer=new Ve,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:Ve})],fr.prototype,"issuer",void 0);l([f({type:d.Integer,converter:ye})],fr.prototype,"serial",void 0);l([f({type:d.BitString,optional:!0})],fr.prototype,"issuerUID",void 0);var Pm;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(Pm||(Pm={}));var pr=class{constructor(e={}){this.digestedObjectType=Pm.publicKey,this.digestAlgorithm=new j,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.Enumerated})],pr.prototype,"digestedObjectType",void 0);l([f({type:d.ObjectIdentifier,optional:!0})],pr.prototype,"otherObjectTypeID",void 0);l([f({type:j})],pr.prototype,"digestAlgorithm",void 0);l([f({type:d.BitString})],pr.prototype,"objectDigest",void 0);var gi=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ve,optional:!0})],gi.prototype,"issuerName",void 0);l([f({type:fr,context:0,implicit:!0,optional:!0})],gi.prototype,"baseCertificateID",void 0);l([f({type:pr,context:1,implicit:!0,optional:!0})],gi.prototype,"objectDigestInfo",void 0);var wi=class{constructor(e={}){Object.assign(this,e)}};l([f({type:ae,repeated:"sequence"})],wi.prototype,"v1Form",void 0);l([f({type:gi,context:0,implicit:!0})],wi.prototype,"v2Form",void 0);wi=l([C({type:A.Choice})],wi);var bi=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};l([f({type:d.GeneralizedTime})],bi.prototype,"notBeforeTime",void 0);l([f({type:d.GeneralizedTime})],bi.prototype,"notAfterTime",void 0);var fo=class{constructor(e={}){Object.assign(this,e)}};l([f({type:fr,implicit:!0,context:0,optional:!0})],fo.prototype,"baseCertificateID",void 0);l([f({type:Ve,implicit:!0,context:1,optional:!0})],fo.prototype,"entityName",void 0);l([f({type:pr,implicit:!0,context:2,optional:!0})],fo.prototype,"objectDigestInfo",void 0);var Om;(function(r){r[r.v2=1]="v2"})(Om||(Om={}));var Ft=class{constructor(e={}){this.version=Om.v2,this.holder=new fo,this.issuer=new wi,this.signature=new j,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new bi,this.attributes=[],Object.assign(this,e)}};l([f({type:d.Integer})],Ft.prototype,"version",void 0);l([f({type:fo})],Ft.prototype,"holder",void 0);l([f({type:wi})],Ft.prototype,"issuer",void 0);l([f({type:j})],Ft.prototype,"signature",void 0);l([f({type:d.Integer,converter:ye})],Ft.prototype,"serialNumber",void 0);l([f({type:bi})],Ft.prototype,"attrCertValidityPeriod",void 0);l([f({type:dt,repeated:"sequence"})],Ft.prototype,"attributes",void 0);l([f({type:d.BitString,optional:!0})],Ft.prototype,"issuerUniqueID",void 0);l([f({type:Qt,optional:!0})],Ft.prototype,"extensions",void 0);var xi=class{constructor(e={}){this.acinfo=new Ft,this.signatureAlgorithm=new j,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:Ft})],xi.prototype,"acinfo",void 0);l([f({type:j})],xi.prototype,"signatureAlgorithm",void 0);l([f({type:d.BitString})],xi.prototype,"signatureValue",void 0);var kc;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(kc||(kc={}));var Ss=class extends qr{};var Es=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier,implicit:!0,context:0})],Es.prototype,"type",void 0);l([f({type:d.Any,implicit:!0,context:1})],Es.prototype,"value",void 0);var Nc=class{constructor(e={}){this.policyId="",this.classList=new Ss(kc.unclassified),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Nc.prototype,"policyId",void 0);l([f({type:Ss,defaultValue:new Ss(kc.unclassified)})],Nc.prototype,"classList",void 0);l([f({type:Es,repeated:"set"})],Nc.prototype,"securityCategories",void 0);var _s=class{constructor(e={}){Object.assign(this,e)}};l([f({type:oe})],_s.prototype,"cotets",void 0);l([f({type:d.ObjectIdentifier})],_s.prototype,"oid",void 0);l([f({type:d.Utf8String})],_s.prototype,"string",void 0);var Nf=class{constructor(e={}){this.values=[],Object.assign(this,e)}};l([f({type:Ve,implicit:!0,context:0,optional:!0})],Nf.prototype,"policyAuthority",void 0);l([f({type:_s,repeated:"sequence"})],Nf.prototype,"values",void 0);var Uj=`${lo}.4`,jj=`${lo}.6`,Mj=`${lo}.10`,Kj=`${pe}.55`,Pc=`${co}.10`,Hj=`${Pc}.1`,Vj=`${Pc}.2`,$j=`${Pc}.3`,Fj=`${Pc}.4`,Wj=`${Pc}.6`,Rm="2.5.4",qj=`${Rm}.72`;var Lm,Cs=class{constructor(e={}){this.targetCertificate=new fr,Object.assign(this,e)}};l([f({type:fr})],Cs.prototype,"targetCertificate",void 0);l([f({type:ae,optional:!0})],Cs.prototype,"targetName",void 0);l([f({type:pr,optional:!0})],Cs.prototype,"certDigestInfo",void 0);var Is=class{constructor(e={}){Object.assign(this,e)}};l([f({type:ae,context:0,implicit:!0})],Is.prototype,"targetName",void 0);l([f({type:ae,context:1,implicit:!0})],Is.prototype,"targetGroup",void 0);l([f({type:Cs,context:2,implicit:!0})],Is.prototype,"targetCert",void 0);Is=l([C({type:A.Choice})],Is);var Pf=Lm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Lm.prototype)}};Pf=Lm=l([C({type:A.Sequence,itemType:Is})],Pf);var Dm,wx=Dm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Dm.prototype)}};wx=Dm=l([C({type:A.Sequence,itemType:Pf})],wx);var Of=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ve,implicit:!0,context:0,optional:!0})],Of.prototype,"roleAuthority",void 0);l([f({type:ae,implicit:!0,context:1})],Of.prototype,"roleName",void 0);var Oc=class{constructor(e={}){this.service=new ae,this.ident=new ae,Object.assign(this,e)}};l([f({type:ae})],Oc.prototype,"service",void 0);l([f({type:ae})],Oc.prototype,"ident",void 0);l([f({type:oe,optional:!0})],Oc.prototype,"authInfo",void 0);var Um,Rc=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Rc.prototype,"otherCertFormat",void 0);l([f({type:d.Any})],Rc.prototype,"otherCert",void 0);var vi=class{constructor(e={}){Object.assign(this,e)}};l([f({type:ur})],vi.prototype,"certificate",void 0);l([f({type:xi,context:2,implicit:!0})],vi.prototype,"v2AttrCert",void 0);l([f({type:Rc,context:3,implicit:!0})],vi.prototype,"other",void 0);vi=l([C({type:A.Choice})],vi);var Ai=Um=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Um.prototype)}};Ai=Um=l([C({type:A.Set,itemType:vi})],Ai);var hr=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],hr.prototype,"contentType",void 0);l([f({type:d.Any,context:0})],hr.prototype,"content",void 0);var Ts=class{constructor(e={}){Object.assign(this,e)}};l([f({type:oe})],Ts.prototype,"single",void 0);l([f({type:d.Any})],Ts.prototype,"any",void 0);Ts=l([C({type:A.Choice})],Ts);var Si=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Si.prototype,"eContentType",void 0);l([f({type:Ts,context:0,optional:!0})],Si.prototype,"eContent",void 0);var Lc=class{constructor(e={}){Object.assign(this,e)}};l([f({type:oe,context:0,implicit:!0,optional:!0})],Lc.prototype,"value",void 0);l([f({type:oe,converter:Gb,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Lc.prototype,"constructedValue",void 0);Lc=l([C({type:A.Choice})],Lc);var po=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Cc,Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],po.prototype,"contentType",void 0);l([f({type:Cc})],po.prototype,"contentEncryptionAlgorithm",void 0);l([f({type:Lc,optional:!0})],po.prototype,"encryptedContent",void 0);var ho=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],ho.prototype,"keyAttrId",void 0);l([f({type:d.Any,optional:!0})],ho.prototype,"keyAttr",void 0);var jm,Bs=class{constructor(e={}){this.subjectKeyIdentifier=new Ht,Object.assign(this,e)}};l([f({type:Ht})],Bs.prototype,"subjectKeyIdentifier",void 0);l([f({type:d.GeneralizedTime,optional:!0})],Bs.prototype,"date",void 0);l([f({type:ho,optional:!0})],Bs.prototype,"other",void 0);var ks=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Bs,context:0,implicit:!0,optional:!0})],ks.prototype,"rKeyId",void 0);l([f({type:Lr,optional:!0})],ks.prototype,"issuerAndSerialNumber",void 0);ks=l([C({type:A.Choice})],ks);var Dc=class{constructor(e={}){this.rid=new ks,this.encryptedKey=new oe,Object.assign(this,e)}};l([f({type:ks})],Dc.prototype,"rid",void 0);l([f({type:oe})],Dc.prototype,"encryptedKey",void 0);var Rf=jm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,jm.prototype)}};Rf=jm=l([C({type:A.Sequence,itemType:Dc})],Rf);var Uc=class{constructor(e={}){this.algorithm=new j,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:j})],Uc.prototype,"algorithm",void 0);l([f({type:d.BitString})],Uc.prototype,"publicKey",void 0);var Ei=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ht,context:0,implicit:!0,optional:!0})],Ei.prototype,"subjectKeyIdentifier",void 0);l([f({type:Uc,context:1,implicit:!0,optional:!0})],Ei.prototype,"originatorKey",void 0);l([f({type:Lr,optional:!0})],Ei.prototype,"issuerAndSerialNumber",void 0);Ei=l([C({type:A.Choice})],Ei);var In=class{constructor(e={}){this.version=wt.v3,this.originator=new Ei,this.keyEncryptionAlgorithm=new Vt,this.recipientEncryptedKeys=new Rf,Object.assign(this,e)}};l([f({type:d.Integer})],In.prototype,"version",void 0);l([f({type:Ei,context:0})],In.prototype,"originator",void 0);l([f({type:oe,context:1,optional:!0})],In.prototype,"ukm",void 0);l([f({type:Vt})],In.prototype,"keyEncryptionAlgorithm",void 0);l([f({type:Rf})],In.prototype,"recipientEncryptedKeys",void 0);var Ns=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ht,context:0,implicit:!0})],Ns.prototype,"subjectKeyIdentifier",void 0);l([f({type:Lr})],Ns.prototype,"issuerAndSerialNumber",void 0);Ns=l([C({type:A.Choice})],Ns);var mo=class{constructor(e={}){this.version=wt.v0,this.rid=new Ns,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new oe,Object.assign(this,e)}};l([f({type:d.Integer})],mo.prototype,"version",void 0);l([f({type:Ns})],mo.prototype,"rid",void 0);l([f({type:Vt})],mo.prototype,"keyEncryptionAlgorithm",void 0);l([f({type:oe})],mo.prototype,"encryptedKey",void 0);var _i=class{constructor(e={}){this.keyIdentifier=new oe,Object.assign(this,e)}};l([f({type:oe})],_i.prototype,"keyIdentifier",void 0);l([f({type:d.GeneralizedTime,optional:!0})],_i.prototype,"date",void 0);l([f({type:ho,optional:!0})],_i.prototype,"other",void 0);var yo=class{constructor(e={}){this.version=wt.v4,this.kekid=new _i,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new oe,Object.assign(this,e)}};l([f({type:d.Integer})],yo.prototype,"version",void 0);l([f({type:_i})],yo.prototype,"kekid",void 0);l([f({type:Vt})],yo.prototype,"keyEncryptionAlgorithm",void 0);l([f({type:oe})],yo.prototype,"encryptedKey",void 0);var go=class{constructor(e={}){this.version=wt.v0,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new oe,Object.assign(this,e)}};l([f({type:d.Integer})],go.prototype,"version",void 0);l([f({type:kf,context:0,optional:!0})],go.prototype,"keyDerivationAlgorithm",void 0);l([f({type:Vt})],go.prototype,"keyEncryptionAlgorithm",void 0);l([f({type:oe})],go.prototype,"encryptedKey",void 0);var jc=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],jc.prototype,"oriType",void 0);l([f({type:d.Any})],jc.prototype,"oriValue",void 0);var Tn=class{constructor(e={}){Object.assign(this,e)}};l([f({type:mo,optional:!0})],Tn.prototype,"ktri",void 0);l([f({type:In,context:1,implicit:!0,optional:!0})],Tn.prototype,"kari",void 0);l([f({type:yo,context:2,implicit:!0,optional:!0})],Tn.prototype,"kekri",void 0);l([f({type:go,context:3,implicit:!0,optional:!0})],Tn.prototype,"pwri",void 0);l([f({type:jc,context:4,implicit:!0,optional:!0})],Tn.prototype,"ori",void 0);Tn=l([C({type:A.Choice})],Tn);var Mm,Mc=Mm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Mm.prototype)}};Mc=Mm=l([C({type:A.Set,itemType:Tn})],Mc);var Km,bx=`${co}.16`,WK=`${bx}.2`,qK=`${bx}.4`,Ps=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Ps.prototype,"otherRevInfoFormat",void 0);l([f({type:d.Any})],Ps.prototype,"otherRevInfo",void 0);var Lf=class{constructor(e={}){this.other=new Ps,Object.assign(this,e)}};l([f({type:Ps,context:1,implicit:!0})],Lf.prototype,"other",void 0);Lf=l([C({type:A.Choice})],Lf);var Os=Km=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Km.prototype)}};Os=Km=l([C({type:A.Set,itemType:Lf})],Os);var Rs=class{constructor(e={}){Object.assign(this,e)}};l([f({type:Ai,context:0,implicit:!0,optional:!0})],Rs.prototype,"certs",void 0);l([f({type:Os,context:1,implicit:!0,optional:!0})],Rs.prototype,"crls",void 0);var Hm,Vm=Hm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Hm.prototype)}};Vm=Hm=l([C({type:A.Set,itemType:Dr})],Vm);var Ci=class{constructor(e={}){this.version=wt.v0,this.recipientInfos=new Mc,this.encryptedContentInfo=new po,Object.assign(this,e)}};l([f({type:d.Integer})],Ci.prototype,"version",void 0);l([f({type:Rs,context:0,implicit:!0,optional:!0})],Ci.prototype,"originatorInfo",void 0);l([f({type:Mc})],Ci.prototype,"recipientInfos",void 0);l([f({type:po})],Ci.prototype,"encryptedContentInfo",void 0);l([f({type:Vm,context:1,implicit:!0,optional:!0})],Ci.prototype,"unprotectedAttrs",void 0);var xx="1.2.840.113549.1.7.2";var $m,Df=$m=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,$m.prototype)}};Df=$m=l([C({type:A.Set,itemType:yi})],Df);var Bn=class{constructor(e={}){this.version=wt.v0,this.digestAlgorithms=new Df,this.encapContentInfo=new Si,this.signerInfos=new Ic,Object.assign(this,e)}};l([f({type:d.Integer})],Bn.prototype,"version",void 0);l([f({type:Df})],Bn.prototype,"digestAlgorithms",void 0);l([f({type:Si})],Bn.prototype,"encapContentInfo",void 0);l([f({type:Ai,context:0,implicit:!0,optional:!0})],Bn.prototype,"certificates",void 0);l([f({type:Os,context:1,implicit:!0,optional:!0})],Bn.prototype,"crls",void 0);l([f({type:Ic})],Bn.prototype,"signerInfos",void 0);var Ii="1.2.840.10045.2.1";var Kc="1.2.840.10045.4.1",Uf="1.2.840.10045.4.3.1",Hc="1.2.840.10045.4.3.2",Vc="1.2.840.10045.4.3.3",$c="1.2.840.10045.4.3.4";var Fm="1.2.840.10045.3.1.7";var Wm="1.3.132.0.34";var qm="1.3.132.0.35";function Fc(r){return new j({algorithm:r})}var Ax=Fc(Kc),VH=Fc(Uf),Sx=Fc(Hc),Ex=Fc(Vc),_x=Fc($c);var Wc=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Wc.prototype,"fieldType",void 0);l([f({type:d.Any})],Wc.prototype,"parameters",void 0);Wc=l([C({type:A.Sequence})],Wc);var Gm=class extends oe{};var Ls=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.OctetString})],Ls.prototype,"a",void 0);l([f({type:d.OctetString})],Ls.prototype,"b",void 0);l([f({type:d.BitString,optional:!0})],Ls.prototype,"seed",void 0);Ls=l([C({type:A.Sequence})],Ls);var zm;(function(r){r[r.ecpVer1=1]="ecpVer1"})(zm||(zm={}));var Yr=class{constructor(e={}){this.version=zm.ecpVer1,Object.assign(this,e)}};l([f({type:d.Integer})],Yr.prototype,"version",void 0);l([f({type:Wc})],Yr.prototype,"fieldID",void 0);l([f({type:Ls})],Yr.prototype,"curve",void 0);l([f({type:Gm})],Yr.prototype,"base",void 0);l([f({type:d.Integer,converter:ye})],Yr.prototype,"order",void 0);l([f({type:d.Integer,optional:!0})],Yr.prototype,"cofactor",void 0);Yr=l([C({type:A.Sequence})],Yr);var Zr=class{constructor(e={}){Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Zr.prototype,"namedCurve",void 0);l([f({type:d.Null})],Zr.prototype,"implicitCurve",void 0);l([f({type:Yr})],Zr.prototype,"specifiedCurve",void 0);Zr=l([C({type:A.Choice})],Zr);var Ds=class{constructor(e={}){this.version=1,this.privateKey=new oe,Object.assign(this,e)}};l([f({type:d.Integer})],Ds.prototype,"version",void 0);l([f({type:oe})],Ds.prototype,"privateKey",void 0);l([f({type:Zr,context:0,optional:!0})],Ds.prototype,"parameters",void 0);l([f({type:d.BitString,context:1,optional:!0})],Ds.prototype,"publicKey",void 0);var Ti=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.Integer,converter:ye})],Ti.prototype,"r",void 0);l([f({type:d.Integer,converter:ye})],Ti.prototype,"s",void 0);var Wt="1.2.840.113549.1.1",Jr=`${Wt}.1`,Cx=`${Wt}.7`,Ix=`${Wt}.9`,wo=`${Wt}.10`,Tx=`${Wt}.2`,Bx=`${Wt}.4`,Us=`${Wt}.5`,kx=`${Wt}.14`;var jf=`${Wt}.11`,js=`${Wt}.12`,Ms=`${Wt}.13`,Xm=`${Wt}.15`,Ym=`${Wt}.16`,Bi="1.3.14.3.2.26",Mf="2.16.840.1.101.3.4.2.4",ki="2.16.840.1.101.3.4.2.1",Ni="2.16.840.1.101.3.4.2.2",Pi="2.16.840.1.101.3.4.2.3",Nx="2.16.840.1.101.3.4.2.5",Px="2.16.840.1.101.3.4.2.6",Ox="1.2.840.113549.2.2",Rx="1.2.840.113549.2.5",bo=`${Wt}.8`;function ct(r){return new j({algorithm:r,parameters:null})}var y7=ct(Ox),g7=ct(Rx),kn=ct(Bi),w7=ct(Mf),b7=ct(ki),x7=ct(Ni),v7=ct(Pi),A7=ct(Nx),S7=ct(Px),Kf=new j({algorithm:bo,parameters:$.serialize(kn)}),Zm=new j({algorithm:Ix,parameters:$.serialize(gs.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))}),E7=ct(Jr),_7=ct(Tx),C7=ct(Bx),I7=ct(Us),T7=ct(Xm),B7=ct(Ym),k7=ct(js),N7=ct(Ms),P7=ct(Xm),O7=ct(Ym);var Ks=class{constructor(e={}){this.hashAlgorithm=new j(kn),this.maskGenAlgorithm=new j({algorithm:bo,parameters:$.serialize(kn)}),this.pSourceAlgorithm=new j(Zm),Object.assign(this,e)}};l([f({type:j,context:0,defaultValue:kn})],Ks.prototype,"hashAlgorithm",void 0);l([f({type:j,context:1,defaultValue:Kf})],Ks.prototype,"maskGenAlgorithm",void 0);l([f({type:j,context:2,defaultValue:Zm})],Ks.prototype,"pSourceAlgorithm",void 0);var K7=new j({algorithm:Cx,parameters:$.serialize(new Ks)});var Qr=class{constructor(e={}){this.hashAlgorithm=new j(kn),this.maskGenAlgorithm=new j({algorithm:bo,parameters:$.serialize(kn)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};l([f({type:j,context:0,defaultValue:kn})],Qr.prototype,"hashAlgorithm",void 0);l([f({type:j,context:1,defaultValue:Kf})],Qr.prototype,"maskGenAlgorithm",void 0);l([f({type:d.Integer,context:2,defaultValue:20})],Qr.prototype,"saltLength",void 0);l([f({type:d.Integer,context:3,defaultValue:1})],Qr.prototype,"trailerField",void 0);var G7=new j({algorithm:wo,parameters:$.serialize(new Qr)});var Oi=class{constructor(e={}){this.digestAlgorithm=new j,this.digest=new oe,Object.assign(this,e)}};l([f({type:j})],Oi.prototype,"digestAlgorithm",void 0);l([f({type:oe})],Oi.prototype,"digest",void 0);var Jm,Hs=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.Integer,converter:ye})],Hs.prototype,"prime",void 0);l([f({type:d.Integer,converter:ye})],Hs.prototype,"exponent",void 0);l([f({type:d.Integer,converter:ye})],Hs.prototype,"coefficient",void 0);var Hf=Jm=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Jm.prototype)}};Hf=Jm=l([C({type:A.Sequence,itemType:Hs})],Hf);var dr=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.Integer})],dr.prototype,"version",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"modulus",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"publicExponent",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"privateExponent",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"prime1",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"prime2",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"exponent1",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"exponent2",void 0);l([f({type:d.Integer,converter:ye})],dr.prototype,"coefficient",void 0);l([f({type:Hf,optional:!0})],dr.prototype,"otherPrimeInfos",void 0);var Vs=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.Integer,converter:ye})],Vs.prototype,"modulus",void 0);l([f({type:d.Integer,converter:ye})],Vs.prototype,"publicExponent",void 0);var Qm;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(Qm||(Qm={}));var bt=Qm;var rv=jr(tv(),1),{__extends:Fs,__assign:EV,__rest:hC,__decorate:_V,__param:CV,__metadata:IV,__awaiter:nv,__generator:ov,__exportStar:TV,__createBinding:BV,__values:qc,__read:Gc,__spread:Ur,__spreadArrays:kV,__await:NV,__asyncGenerator:PV,__asyncDelegator:OV,__asyncValues:RV,__makeTemplateObject:LV,__importStar:DV,__importDefault:UV,__classPrivateFieldGet:jV,__classPrivateFieldSet:MV}=rv.default;var dC="injectionTokens";function ty(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(dC,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function zc(r){return!!r.useClass}function Ws(r){return!!r.useFactory}var Ff=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},o=!1,i,s=function(){return o||(i=e(t.wrap()),o=!0),i};return new Proxy(n,this.createHandler(s))},r.prototype.createHandler=function(e){var t={},n=function(o){t[o]=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]=e();var a=Reflect[o];return a.apply(void 0,Ur(i))}};return this.reflectMethods.forEach(n),t},r}();function xo(r){return typeof r=="string"||typeof r=="symbol"}function ry(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function Wf(r){return typeof r=="object"&&"token"in r&&"transform"in r}function iv(r){return typeof r=="function"||r instanceof Ff}function Ri(r){return!!r.useToken}function Li(r){return r.useValue!=null}function sv(r){return zc(r)||Li(r)||Ri(r)||Ws(r)}var mC=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),Xc=mC;var yC=function(r){Fs(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Xc),av=yC;var gC=function(){function r(){this.scopedResolutions=new Map}return r}(),Yc=gC;function wC(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function bC(r,e,t){return t===void 0&&(t="    "),Ur([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function ny(r,e,t){var n=Gc(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),o=n[1],i=o===void 0?null:o,s=wC(i,e);return bC("Cannot inject the dependency "+s+' of "'+r.name+'" constructor. Reason:',t)}function cv(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var xC=function(r){Fs(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Xc);var vC=function(r){Fs(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Xc);var AC=function(){function r(){this.preResolution=new xC,this.postResolution=new vC}return r}(),lv=AC;var oy=new Map,SC=function(){function r(e){this.parent=e,this._registry=new av,this.interceptors=new lv,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:bt.Transient}),this.ensureNotDisposed();var o;if(sv(t)?o=t:o={useClass:t},Ri(o))for(var i=[e],s=o;s!=null;){var a=s.useToken;if(i.includes(a))throw new Error("Token registration cycle detected! "+Ur(i,[a]).join(" -> "));i.push(a);var c=this._registry.get(a);c&&Ri(c.provider)?s=c.provider:s=null}if((n.lifecycle===bt.Singleton||n.lifecycle==bt.ContainerScoped||n.lifecycle==bt.ResolutionScoped)&&(Li(o)||Ws(o)))throw new Error('Cannot use lifecycle "'+bt[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:o,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),xo(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),xo(e)){if(xo(t))return this.register(e,{useToken:t},{lifecycle:bt.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:bt.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!xo(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:bt.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new Yc),n===void 0&&(n=!1),this.ensureNotDisposed();var o=this.getRegistration(e);if(!o&&xo(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),o){var i=this.resolveRegistration(o,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(iv(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,o;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var s=qc(this.interceptors.preResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;c.options.frequency!="Once"&&i.push(c),c.callback(e,t)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,i)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var o,i;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var a=qc(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var u=c.value;u.options.frequency!="Once"&&s.push(u),u.callback(e,t,n)}}catch(p){o={error:p}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}this.interceptors.postResolution.setAll(e,s)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===bt.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===bt.Singleton,o=e.options.lifecycle===bt.ContainerScoped,i=n||o,s;return Li(e.provider)?s=e.provider.useValue:Ri(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):zc(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):Ws(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,t),e.options.lifecycle===bt.ResolutionScoped&&t.scopedResolutions.set(e,s),s},r.prototype.resolveAll=function(e,t,n){var o=this;t===void 0&&(t=new Yc),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&xo(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var s=i.map(function(c){return o.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=qc(this._registry.entries()),o=n.next();!o.done;o=n.next()){var i=Gc(o.value,2),s=i[0],a=i[1];this._registry.setAll(s,a.filter(function(c){return!Li(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var o=qc(this._registry.entries()),i=o.next();!i.done;i=o.next()){var s=Gc(i.value,2),a=s[0],c=s[1];c.some(function(u){var p=u.options;return p.lifecycle===bt.ContainerScoped})&&n._registry.setAll(a,c.map(function(u){return u.options.lifecycle===bt.ContainerScoped?{provider:u.provider,options:u.options}:u}))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return nv(this,void 0,void 0,function(){var e;return ov(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var o=n.dispose();o&&e.push(o)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof Ff)return e.createProxy(function(i){return n.resolve(i,t)});var o=function(){var i=oy.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var s=i.map(n.resolveParams(t,e));return new(e.bind.apply(e,Ur([void 0],s)))}();return cv(o)&&this.disposables.add(o),o},r.prototype.resolveParams=function(e,t){var n=this;return function(o,i){var s,a,c;try{return ry(o)?Wf(o)?o.multiple?(s=n.resolve(o.transform)).transform.apply(s,Ur([n.resolveAll(o.token,new Yc,o.isOptional)],o.transformArgs)):(a=n.resolve(o.transform)).transform.apply(a,Ur([n.resolve(o.token,e,o.isOptional)],o.transformArgs)):o.multiple?n.resolveAll(o.token,new Yc,o.isOptional):n.resolve(o.token,e,o.isOptional):Wf(o)?(c=n.resolve(o.transform,e)).transform.apply(c,Ur([n.resolve(o.token,e)],o.transformArgs)):n.resolve(o,e)}catch(u){throw new Error(ny(t,i,u))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),$e=new SC;function EC(){return function(r){oy.set(r,ty(r))}}var vo=EC;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var sy,Di=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};l([f({type:d.ObjectIdentifier})],Di.prototype,"attrId",void 0);l([f({type:d.Any,repeated:"set"})],Di.prototype,"attrValues",void 0);var uv=sy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,sy.prototype)}};uv=sy=l([C({type:A.Sequence,itemType:Di})],uv);var ay,fv=ay=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,ay.prototype)}};fv=ay=l([C({type:A.Sequence,itemType:hr})],fv);var _C="1.2.840.113549",CC=`${_C}.1`,pv=`${CC}.12`,qs=`${pv}.1`,XF=`${qs}.1`,YF=`${qs}.2`,ZF=`${qs}.3`,JF=`${qs}.4`,QF=`${qs}.5`,eW=`${qs}.6`,Ui=`${pv}.10.1`;var nW=`${Ui}.1`,oW=`${Ui}.2`,iW=`${Ui}.3`,sW=`${Ui}.4`,aW=`${Ui}.5`,cW=`${Ui}.6`,qf="1.2.840.113549.1.9";var Gf=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Gf.prototype,"certId",void 0);l([f({type:d.Any,context:0})],Gf.prototype,"certValue",void 0);var hv=`${qf}.22`,hW=`${hv}.1`,dW=`${hv}.2`;var zf=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],zf.prototype,"crlId",void 0);l([f({type:d.Any,context:0})],zf.prototype,"crltValue",void 0);var IC=`${qf}.23`,bW=`${IC}.1`;var Xf=class extends oe{},Ao=class{constructor(e={}){this.encryptionAlgorithm=new j,this.encryptedData=new Xf,Object.assign(this,e)}};l([f({type:j})],Ao.prototype,"encryptionAlgorithm",void 0);l([f({type:Xf})],Ao.prototype,"encryptedData",void 0);var cy,ly;(function(r){r[r.v1=0]="v1"})(ly||(ly={}));var Yf=class extends oe{},uy=cy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,cy.prototype)}};uy=cy=l([C({type:A.Sequence,itemType:dt})],uy);var So=class{constructor(e={}){this.version=ly.v1,this.privateKeyAlgorithm=new j,this.privateKey=new Yf,Object.assign(this,e)}};l([f({type:d.Integer})],So.prototype,"version",void 0);l([f({type:j})],So.prototype,"privateKeyAlgorithm",void 0);l([f({type:Yf})],So.prototype,"privateKey",void 0);l([f({type:uy,implicit:!0,context:0,optional:!0})],So.prototype,"attributes",void 0);var dv=class extends So{};dv=l([C({type:A.Sequence})],dv);var mv=class extends Ao{};mv=l([C({type:A.Sequence})],mv);var Zf=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Zf.prototype,"secretTypeId",void 0);l([f({type:d.Any,context:0})],Zf.prototype,"secretValue",void 0);var Eo=class{constructor(e={}){this.mac=new Oi,this.macSalt=new oe,this.iterations=1,Object.assign(this,e)}};l([f({type:Oi})],Eo.prototype,"mac",void 0);l([f({type:oe})],Eo.prototype,"macSalt",void 0);l([f({type:d.Integer,defaultValue:1})],Eo.prototype,"iterations",void 0);var ji=class{constructor(e={}){this.version=3,this.authSafe=new hr,this.macData=new Eo,Object.assign(this,e)}};l([f({type:d.Integer})],ji.prototype,"version",void 0);l([f({type:hr})],ji.prototype,"authSafe",void 0);l([f({type:Eo,optional:!0})],ji.prototype,"macData",void 0);var fy,Gs=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:d.ObjectIdentifier})],Gs.prototype,"bagId",void 0);l([f({type:d.Any,context:0})],Gs.prototype,"bagValue",void 0);l([f({type:Di,repeated:"set",optional:!0})],Gs.prototype,"bagAttributes",void 0);var yv=fy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,fy.prototype)}};yv=fy=l([C({type:A.Sequence,itemType:Gs})],yv);var py,hy,dy,Xe="1.2.840.113549.1.9",vq=`${Xe}.0`,kv=`${Xe}.24`,Jc=`${Xe}.25`,Nv=`${Xe}.26`,Pv=`${Xe}.27`,Aq=`${kv}.1`,Sq=`${kv}.2`,Eq=`${Xe}.1`,_q=`${Xe}.2`,Cq=`${Xe}.3`,Iq=`${Xe}.4`,Tq=`${Xe}.5`,Bq=`${Xe}.6`,Ay=`${Xe}.7`,kq=`${Xe}.8`,Nq=`${Xe}.9`,Pq=`${Xe}.13`,Qc=`${Xe}.14`,Oq=`${Xe}.15`,Rq=`${Xe}.20`,Lq=`${Xe}.21`;var Dq=`${Jc}.1`,Uq=`${Jc}.2`,jq=`${Jc}.3`,Mq=`${Jc}.4`,Kq=`${Jc}.5`,el="1.3.6.1.5.5.7.9",Hq=`${el}.1`,Vq=`${el}.2`,$q=`${el}.3`,Fq=`${el}.4`,Wq=`${el}.5`,qq=`${Nv}.1`,Gq=`${Nv}.2`,zq=`${Pv}.1`,Xq=`${Pv}.2`,Yq=`${Xe}.16`,Zq=`${Xe}.22`,Jq=`${Xe}.23`,Qq=`${Rm}.65`,Jf=class extends rt{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};l([f({type:d.IA5String})],Jf.prototype,"ia5String",void 0);Jf=l([C({type:A.Choice})],Jf);var gv=class extends hr{};gv=l([C({type:A.Sequence})],gv);var wv=class extends ji{};wv=l([C({type:A.Sequence})],wv);var bv=class extends Ao{};bv=l([C({type:A.Sequence})],bv);var my=class{constructor(e=""){this.value=e}toString(){return this.value}};l([f({type:d.IA5String})],my.prototype,"value",void 0);my=l([C({type:A.Choice})],my);var xv=class extends Jf{};xv=l([C({type:A.Choice})],xv);var vv=class extends rt{};vv=l([C({type:A.Choice})],vv);var yy=class{constructor(e=new Date){this.value=e}};l([f({type:d.GeneralizedTime})],yy.prototype,"value",void 0);yy=l([C({type:A.Choice})],yy);var Av=class extends rt{};Av=l([C({type:A.Choice})],Av);var gy=class{constructor(e="M"){this.value=e}toString(){return this.value}};l([f({type:d.PrintableString})],gy.prototype,"value",void 0);gy=l([C({type:A.Choice})],gy);var Qf=class{constructor(e=""){this.value=e}toString(){return this.value}};l([f({type:d.PrintableString})],Qf.prototype,"value",void 0);Qf=l([C({type:A.Choice})],Qf);var Sv=class extends Qf{};Sv=l([C({type:A.Choice})],Sv);var Ev=class extends rt{};Ev=l([C({type:A.Choice})],Ev);var wy=class{constructor(e=""){this.value=e}toString(){return this.value}};l([f({type:d.ObjectIdentifier})],wy.prototype,"value",void 0);wy=l([C({type:A.Choice})],wy);var _v=class extends ze{};_v=l([C({type:A.Choice})],_v);var by=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};l([f({type:d.Integer})],by.prototype,"value",void 0);by=l([C({type:A.Choice})],by);var Cv=class extends $t{};Cv=l([C({type:A.Sequence})],Cv);var Zc=class extends rt{};Zc=l([C({type:A.Choice})],Zc);var Iv=py=class extends Qt{constructor(e){super(e),Object.setPrototypeOf(this,py.prototype)}};Iv=py=l([C({type:A.Sequence})],Iv);var Tv=hy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,hy.prototype)}};Tv=hy=l([C({type:A.Set,itemType:Dr})],Tv);var xy=class{constructor(e=""){this.value=e}toString(){return this.value}};l([f({type:d.BmpString})],xy.prototype,"value",void 0);xy=l([C({type:A.Choice})],xy);var vy=class extends j{};vy=l([C({type:A.Sequence})],vy);var Bv=dy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,dy.prototype)}};Bv=dy=l([C({type:A.Sequence,itemType:vy})],Bv);var Sy,tl=Sy=class extends re{constructor(e){super(e),Object.setPrototypeOf(this,Sy.prototype)}};tl=Sy=l([C({type:A.Sequence,itemType:dt})],tl);var en=class{constructor(e={}){this.version=0,this.subject=new Ne,this.subjectPKInfo=new mt,this.attributes=new tl,Object.assign(this,e)}};l([f({type:d.Integer})],en.prototype,"version",void 0);l([f({type:Ne})],en.prototype,"subject",void 0);l([f({type:mt})],en.prototype,"subjectPKInfo",void 0);l([f({type:tl,implicit:!0,context:0})],en.prototype,"attributes",void 0);var _o=class{constructor(e={}){this.certificationRequestInfo=new en,this.signatureAlgorithm=new j,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};l([f({type:en})],_o.prototype,"certificationRequestInfo",void 0);l([f({type:j})],_o.prototype,"signatureAlgorithm",void 0);l([f({type:d.BitString})],_o.prototype,"signature",void 0);var al="crypto.algorithm",Oy=class{getAlgorithms(){return $e.resolveAll(al)}toAsnAlgorithm(e){({...e});for(let t of this.getAlgorithms()){let n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let t=new j({algorithm:e.name});if("parameters"in e){let n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},Mi="crypto.algorithmProvider";$e.registerSingleton(Mi,Oy);var np,zt="1.3.36.3.3.2.8.1.1",Ov=`${zt}.1`,Rv=`${zt}.2`,Lv=`${zt}.3`,Dv=`${zt}.4`,Uv=`${zt}.5`,jv=`${zt}.6`,Mv=`${zt}.7`,Kv=`${zt}.8`,Hv=`${zt}.9`,Vv=`${zt}.10`,$v=`${zt}.11`,Fv=`${zt}.12`,Wv=`${zt}.13`,qv=`${zt}.14`,Gv="brainpoolP160r1",zv="brainpoolP160t1",Xv="brainpoolP192r1",Yv="brainpoolP192t1",Zv="brainpoolP224r1",Jv="brainpoolP224t1",Qv="brainpoolP256r1",e1="brainpoolP256t1",t1="brainpoolP320r1",r1="brainpoolP320t1",n1="brainpoolP384r1",o1="brainpoolP384t1",i1="brainpoolP512r1",s1="brainpoolP512t1",Fe="ECDSA",nl=np=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Fe.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Ax;case"sha-256":return Sx;case"sha-384":return Ex;case"sha-512":return _x}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=Fm;break;case"K-256":t=np.SECP256K1;break;case"P-384":t=Wm;break;case"P-521":t=qm;break;case Gv:t=Ov;break;case zv:t=Rv;break;case Xv:t=Lv;break;case Yv:t=Dv;break;case Zv:t=Uv;break;case Jv:t=jv;break;case Qv:t=Mv;break;case e1:t=Kv;break;case t1:t=Hv;break;case r1:t=Vv;break;case n1:t=$v;break;case o1:t=Fv;break;case i1:t=Wv;break;case s1:t=qv;break}if(t)return new j({algorithm:Ii,parameters:$.serialize(new Zr({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Kc:return{name:Fe,hash:{name:"SHA-1"}};case Hc:return{name:Fe,hash:{name:"SHA-256"}};case Vc:return{name:Fe,hash:{name:"SHA-384"}};case $c:return{name:Fe,hash:{name:"SHA-512"}};case Ii:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch($.parse(e.parameters,Zr).namedCurve){case Fm:return{name:Fe,namedCurve:"P-256"};case np.SECP256K1:return{name:Fe,namedCurve:"K-256"};case Wm:return{name:Fe,namedCurve:"P-384"};case qm:return{name:Fe,namedCurve:"P-521"};case Ov:return{name:Fe,namedCurve:Gv};case Rv:return{name:Fe,namedCurve:zv};case Lv:return{name:Fe,namedCurve:Xv};case Dv:return{name:Fe,namedCurve:Yv};case Uv:return{name:Fe,namedCurve:Zv};case jv:return{name:Fe,namedCurve:Jv};case Mv:return{name:Fe,namedCurve:Qv};case Kv:return{name:Fe,namedCurve:e1};case Hv:return{name:Fe,namedCurve:t1};case Vv:return{name:Fe,namedCurve:r1};case $v:return{name:Fe,namedCurve:n1};case Fv:return{name:Fe,namedCurve:o1};case Wv:return{name:Fe,namedCurve:i1};case qv:return{name:Fe,namedCurve:s1}}}}return null}};nl.SECP256K1="1.3.132.0.10";nl=np=l([vo()],nl);$e.registerSingleton(al,nl);var g1=Symbol("name"),w1=Symbol("value"),Se=class{constructor(e,t={},n=""){this[g1]=e,this[w1]=n;for(let o in t)this[o]=t[o]}};Se.NAME=g1;Se.VALUE=w1;var Ry=class{static toTextObject(e){let t=new Se("Algorithm Identifier",{},rn.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Ii:{let n=new nl().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}},rn=class{static toString(e){let t=this.items[e];return t||e}};rn.items={[Bi]:"sha1",[Mf]:"sha224",[ki]:"sha256",[Ni]:"sha384",[Pi]:"sha512",[Jr]:"rsaEncryption",[Us]:"sha1WithRSAEncryption",[kx]:"sha224WithRSAEncryption",[jf]:"sha256WithRSAEncryption",[js]:"sha384WithRSAEncryption",[Ms]:"sha512WithRSAEncryption",[Ii]:"ecPublicKey",[Kc]:"ecdsaWithSHA1",[Uf]:"ecdsaWithSHA224",[Hc]:"ecdsaWithSHA256",[Vc]:"ecdsaWithSHA384",[$c]:"ecdsaWithSHA512",[rx]:"TLS WWW server authentication",[nx]:"TLS WWW client authentication",[ox]:"Code Signing",[ix]:"E-mail Protection",[sx]:"Time Stamping",[ax]:"OCSP Signing",[xx]:"Signed Data"};var Pn=class{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){let n=[],o=this.pad(t++),i="",s=e[Se.VALUE];s&&(i=` ${s}`),n.push(`${o}${e[Se.NAME]}:${i}`),o=this.pad(t);for(let a in e){if(typeof a=="symbol")continue;let c=e[a],u=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${o}${u}${c}`);else if(c instanceof Date)n.push(`${o}${u}${c.toUTCString()}`);else if(Array.isArray(c))for(let p of c)p[Se.NAME]=a,n.push(...this.serializeObj(p,t));else if(c instanceof Se)c[Se.NAME]=a,n.push(...this.serializeObj(c,t));else if(H.BufferSourceConverter.isBufferSource(c))a?(n.push(`${o}${u}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){let p=c.toTextObject();p[Se.NAME]=a,n.push(...this.serializeObj(p,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){let n=this.pad(t),o=H.BufferSourceConverter.toUint8Array(e),i=[];for(let s=0;s<o.length;){let a=[];for(let c=0;c<16&&s<o.length;c++){c===8&&a.push("");let u=o[s++].toString(16).padStart(2,"0");a.push(u)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}};Pn.oidSerializer=rn;Pn.algorithmSerializer=Ry;var Co=class r{constructor(...e){if(e.length===1){let t=e[0];this.rawData=$.serialize(t),this.onInit(t)}else{let t=$.parse(e[0],e[1]);this.rawData=H.BufferSourceConverter.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof r?(0,H.isEqual)(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return $.toString(this.rawData);case"text":return Pn.serialize(this.toTextObject());case"hex":return H.Convert.ToHex(this.rawData);case"base64":return H.Convert.ToBase64(this.rawData);case"base64url":return H.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new Se(this.getTextName(),{},e)}};Co.NAME="ASN";var yr=class r extends Co{constructor(...e){let t;H.BufferSourceConverter.isBufferSource(e[0])?t=H.BufferSourceConverter.toArrayBuffer(e[0]):t=$.serialize(new yt({extnID:e[0],critical:e[1],extnValue:new oe(H.BufferSourceConverter.toArrayBuffer(e[2]))})),super(t,yt)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[Se.NAME]===r.NAME&&(e[Se.NAME]=rn.toString(this.type)),e}},b1,ol=class r{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[b1]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(r.DEFAULT,crypto):typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle&&this.set(r.DEFAULT,globalThis.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=r.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(r.DEFAULT,e);return this}};b1=Symbol.toStringTag;ol.DEFAULT="default";var xt=new ol,NC=/^[0-2](?:\.[1-9][0-9]*)+$/;function PC(r){return new RegExp(NC).test(r)}var ip=class{constructor(e={}){this.items={};for(let t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return PC(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}},qt=new ip;qt.register("CN","2.5.4.3");qt.register("L","2.5.4.7");qt.register("ST","2.5.4.8");qt.register("O","2.5.4.10");qt.register("OU","2.5.4.11");qt.register("C","2.5.4.6");qt.register("DC","0.9.2342.19200300.100.1.25");qt.register("E","1.2.840.113549.1.9.1");qt.register("G","2.5.4.42");qt.register("I","2.5.4.43");qt.register("SN","2.5.4.4");qt.register("T","2.5.4.12");function OC(r,e){return`\\${H.Convert.ToHex(H.Convert.FromUtf8String(e)).toUpperCase()}`}function RC(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,OC)}var mr=class r{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new ip,this.asn=new Ne;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Ne?this.asn=e:H.BufferSourceConverter.isBufferSource(e)?this.asn=$.parse(e,Ne):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||qt.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||qt.get(e)}toString(){return this.asn.map(e=>e.map(t=>{let n=this.getName(t.type)||t.type,o=t.value.anyValue?`#${H.Convert.ToHex(t.value.anyValue)}`:RC(t.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${H.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(o)}return t}fromString(e){let t=new Ne,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let u=o[3];s=this.getTypeOid(s);let p=this.createAttribute(s,a);i==="+"?t[t.length-1].push(p):t.push(new so([p])),i=u}return t}fromJSON(e){let t=new Ne;for(let n of e){let o=new so;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let u=this.createAttribute(s,c);o.push(u)}}t.push(o)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let n=new ai({type:e});if(typeof t=="object")for(let o in t)switch(o){case"ia5String":n.value.ia5String=t[o];break;case"utf8String":n.value.utf8String=t[o];break;case"universalString":n.value.universalString=t[o];break;case"bmpString":n.value.bmpString=t[o];break;case"printableString":n.value.printableString=t[o];break}else if(t[0]==="#")n.value.anyValue=H.Convert.FromHex(t.slice(1));else{let o=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:r.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return $.serialize(this.asn)}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||xt.get()):n=e[0]||xt.get(),await n.subtle.digest(o,this.toArrayBuffer())}},x1="Cannot initialize GeneralName from ASN.1 data.",a1=`${x1} Unsupported string format in use.`,LC=`${x1} Value doesn't match to GUID regular expression.`,c1=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,l1="1.3.6.1.4.1.311.25.1",u1="1.3.6.1.4.1.311.20.2.3",Ey="dns",_y="dn",Cy="email",Iy="ip",Ty="url",By="guid",ky="upn",ep="id",tn=class extends Co{constructor(...e){let t;if(e.length===2)switch(e[0]){case _y:{let n=new mr(e[1]).toArrayBuffer(),o=$.parse(n,Ne);t=new ae({directoryName:o});break}case Ey:t=new ae({dNSName:e[1]});break;case Cy:t=new ae({rfc822Name:e[1]});break;case By:{let n=new RegExp(c1,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?H.Convert.ToHex(new Uint8Array(H.Convert.FromHex(i)).reverse()):i).join("");t=new ae({otherName:new ao({typeId:l1,value:$.serialize(new oe(H.Convert.FromHex(o)))})});break}case Iy:t=new ae({iPAddress:e[1]});break;case ep:t=new ae({registeredID:e[1]});break;case ky:{t=new ae({otherName:new ao({typeId:u1,value:$.serialize(tm.toASN(e[1]))})});break}case Ty:t=new ae({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else H.BufferSourceConverter.isBufferSource(e[0])?t=$.parse(e[0],ae):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=Ey,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Cy,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Iy,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=Ty,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=ep,this.value=e.registeredID;else if(e.directoryName!=null)this.type=_y,this.value=new mr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===l1){this.type=By;let t=$.parse(e.otherName.value,oe),n=new RegExp(c1,"i").exec(H.Convert.ToHex(t));if(!n)throw new Error(LC);this.value=n.slice(1).map((o,i)=>i<3?H.Convert.ToHex(new Uint8Array(H.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===u1)this.type=ky,this.value=$.parse(e.otherName.value,rt).toString();else throw new Error(a1);else throw new Error(a1)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case _y:case Ey:case By:case Iy:case ep:case ky:case Ty:e=this.type.toUpperCase();break;case Cy:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===ep&&(t=rn.toString(t)),new Se(e,void 0,t)}},Ki=class extends Co{constructor(e){let t;if(e instanceof Ve)t=e;else if(Array.isArray(e)){let n=[];for(let o of e)if(o instanceof ae)n.push(o);else{let i=$.parse(new tn(o.type,o.value).rawData,ae);n.push(i)}t=new Ve(n)}else if(H.BufferSourceConverter.isBufferSource(e))t=$.parse(e,Ve);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){let t=[];for(let n of e){let o=null;try{o=new tn(n)}catch{continue}t.push(o)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let t of this.items){let n=t.toTextObject(),o=e[n[Se.NAME]];Array.isArray(o)||(o=[],e[n[Se.NAME]]=o),o.push(n)}return e}};Ki.NAME="GeneralNames";var rl="-{5}",il="\\n",DC=`[^${il}]+`,UC=`${rl}BEGIN (${DC}(?=${rl}))${rl}`,jC=`${rl}END \\1${rl}`,zs="\\n",MC=`[^:${il}]+`,KC=`(?:[^${il}]+${zs}(?: +[^${il}]+${zs})*)`,HC="[a-zA-Z0-9=+/]+",VC=`(?:${HC}${zs})+`,f1=`${UC}${zs}(?:((?:${MC}: ${KC})+))?${zs}?(${VC})${jC}`,Ot=class{static isPem(e){return typeof e=="string"&&new RegExp(f1,"g").test(e)}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let t=new RegExp(f1,"g"),n=[],o=null;for(;o=t.exec(e);){let i=o[3].replace(new RegExp(`[${il}]+`,"g"),""),s={type:o[1],headers:[],rawData:H.Convert.FromBase64(i)},a=o[2];if(a){let c=a.split(new RegExp(zs,"g")),u=null;for(let p of c){let[h,m]=p.split(/:(.*)/);if(m===void 0){if(!u)throw new Error("Cannot parse PEM string. Incorrect header value");u.value+=h.trim()}else u&&s.headers.push(u),u={key:h,value:m.trim()}}u&&s.headers.push(u)}n.push(s)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){let t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){let n=new Array;return t?e.forEach(o=>{if(!H.BufferSourceConverter.isBufferSource(o))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:H.BufferSourceConverter.toArrayBuffer(o)}))}):e.forEach(o=>{if(!("type"in o))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(o))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:H.BufferSourceConverter.toArrayBuffer(e)})}}static encodeStruct(e){var t;let n=e.type.toLocaleUpperCase(),o=[];if(o.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(let u of e.headers)o.push(`${u.key}: ${u.value}`);o.push("")}let i=H.Convert.ToBase64(e.rawData),s,a=0,c=Array();for(;a<i.length&&(i.length-a<64?s=i.substring(a):(s=i.substring(a,a+64),a+=64),s.length!==0);)if(c.push(s),s.length<64)break;return o.push(...c),o.push(`-----END ${n}-----`),o.join(`
`)}};Ot.CertificateTag="CERTIFICATE";Ot.CrlTag="CRL";Ot.CertificateRequestTag="CERTIFICATE REQUEST";Ot.PublicKeyTag="PUBLIC KEY";Ot.PrivateKeyTag="PRIVATE KEY";var Io=class r extends Co{static isAsnEncoded(e){return H.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Ot.isPem(e))return Ot.decode(e)[0];if(H.Convert.isHex(e))return H.Convert.FromHex(e);if(H.Convert.isBase64(e))return H.Convert.FromBase64(e);if(H.Convert.isBase64Url(e))return H.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let t=H.Convert.ToBinary(e);return Ot.isPem(t)?Ot.decode(t)[0]:H.Convert.isHex(t)?H.Convert.FromHex(t):H.Convert.isBase64(t)?H.Convert.FromBase64(t):H.Convert.isBase64Url(t)?H.Convert.FromBase64Url(t):H.BufferSourceConverter.toArrayBuffer(e)}}constructor(...e){r.isAsnEncoded(e[0])?super(r.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Ot.encode(this.rawData,this.tag);default:return super.toString(e)}}},Nn=class r extends Io{static async create(e,t=xt.get()){if(e instanceof r)return e;if(ol.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let n=await t.subtle.exportKey("spki",e);return new r(n)}else{if(e.publicKey)return e.publicKey;if(H.BufferSourceConverter.isBufferSource(e))return new r(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Io.isAsnEncoded(e)?super(e,mt):super(e),this.tag=Ot.PublicKeyTag}async export(...e){let t,n=["verify"],o={hash:"SHA-256",...this.algorithm};e.length>1?(o=e[0]||o,n=e[1]||n,t=e[2]||xt.get()):t=e[0]||xt.get();let i=this.rawData,s=$.parse(this.rawData,mt);return s.algorithm.algorithm===wo&&(i=$C(s,i)),t.subtle.importKey("spki",i,o,!0,n)}onInit(e){let t=$e.resolve(Mi),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Jr:{let o=$.parse(e.subjectPublicKey,Vs),i=H.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=H.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||xt.get()):n=e[0]||xt.get(),await n.subtle.digest(o,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=xt.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=xt.get();let o=$.parse(this.rawData,mt);return await t.subtle.digest(n,o.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),t=$.parse(this.rawData,mt);switch(e.Algorithm=Pn.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Ii:e["EC Point"]=t.subjectPublicKey;break;case Jr:default:e["Raw Data"]=t.subjectPublicKey}return e}};function $C(r,e){return r.algorithm=new j({algorithm:Jr,parameters:null}),e=$.serialize(r),e}var sp=class r extends yr{static async create(e,t=!1,n=xt.get()){if("name"in e&&"serialNumber"in e)return new r(e,t);let i=await(await Nn.create(e,n)).getKeyIdentifier(n);return new r(H.Convert.ToHex(i),t)}constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){let t=new Gr({keyIdentifier:new ui(H.Convert.FromHex(e[0]))});super(yf,e[1],$.serialize(t))}else{let t=e[0],n=t.name instanceof Ki?$.parse(t.name.rawData,Ve):t.name,o=new Gr({authorityCertIssuer:n,authorityCertSerialNumber:H.Convert.FromHex(t.serialNumber)});super(yf,e[1],$.serialize(o))}}onInit(e){super.onInit(e);let t=$.parse(e.extnValue,Gr);t.keyIdentifier&&(this.keyId=H.Convert.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?H.Convert.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),t=$.parse(this.value,Gr);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Ki(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}};sp.NAME="Authority Key Identifier";var Xs=class extends yr{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=$.parse(this.value,fi);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{let t=new fi({cA:e[0],pathLenConstraint:e[1]});super(gf,e[2],$.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}};Xs.NAME="Basic Constraints";var p1;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(p1||(p1={}));var ap=class extends yr{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=$.parse(this.value,vc);this.usages=t.map(n=>n)}else{let t=new vc(e[0]);super(vf,e[1],$.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>rn.toString(t)).join(", "),e}};ap.NAME="Extended Key Usages";var h1;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(h1||(h1={}));var cp=class extends yr{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=$.parse(this.value,xs);this.usages=t.toNumber()}else{let t=new xs(e[0]);super(Af,e[1],$.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=$.parse(this.value,xs);return e[""]=t.toJSON().join(", "),e}};cp.NAME="Key Usages";var lp=class r extends yr{static async create(e,t=!1,n=xt.get()){let i=await(await Nn.create(e,n)).getKeyIdentifier(n);return new r(H.Convert.ToHex(i),t)}constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=$.parse(this.value,Ht);this.keyId=H.Convert.ToHex(t)}else{let t=typeof e[0]=="string"?H.Convert.FromHex(e[0]):e[0],n=new Ht(t);super(Im,e[1],$.serialize(n)),this.keyId=H.Convert.ToHex(t)}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=$.parse(this.value,Ht);return e[""]=t,e}};lp.NAME="Subject Key Identifier";var up=class extends yr{constructor(...e){H.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(_m,e[1],new Ki(e[0]||[]).rawData)}onInit(e){super.onInit(e);let t=$.parse(e.extnValue,Cf);this.names=new Ki(t)}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(let n in t)e[n]=t[n];return e}};up.NAME="Subject Alternative Name";var Gt=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new yr(e),n=this.items.get(t.type);return n?new n(e):t}};Gt.items=new Map;var fp=class extends yr{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let n=$.parse(this.value,yc);this.policies=n.map(o=>o.policyIdentifier)}else{let n=e[0],o=(t=e[1])!==null&&t!==void 0?t:!1,i=new yc(n.map(s=>new pi({policyIdentifier:s})));super(bf,o,$.serialize(i)),this.policies=n}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new Se("",{},rn.toString(t))),e}};fp.NAME="Certificate Policies";Gt.register(bf,fp);var pp=class extends yr{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){let o=e[0].map(s=>new zr({distributionPoint:new _n({fullName:[new ae({uniformResourceIdentifier:s})]})})),i=new uo(o);super(xf,e[1],$.serialize(i))}else{let n=new uo(e[0]);super(xf,e[1],$.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);let t=$.parse(e.extnValue,uo);this.distributionPoints=t}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;let o={};return t.distributionPoint&&(o[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new tn(i).toString()).join(", ")),t.reasons&&(o.Reasons=t.reasons.toString()),t.cRLIssuer&&(o["CRL Issuer"]=t.cRLIssuer.map(i=>i.toString()).join(", ")),o}),e}};pp.NAME="CRL Distribution Points";var hp=class extends yr{constructor(...e){var t,n,o,i;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof li){let s=new li(e[0]);super(mf,e[1],$.serialize(s))}else{let s=e[0],a=new li;rp(a,s,lm,"ocsp"),rp(a,s,um,"caIssuers"),rp(a,s,fm,"timeStamping"),rp(a,s,pm,"caRepository"),super(mf,e[1],$.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(o=this.timeStamping)!==null&&o!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],$.parse(e.extnValue,li).forEach(n=>{switch(n.accessMethod){case lm:this.ocsp.push(new tn(n.accessLocation));break;case um:this.caIssuers.push(new tn(n.accessLocation));break;case fm:this.timeStamping.push(new tn(n.accessLocation));break;case pm:this.caRepository.push(new tn(n.accessLocation));break}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&tp(e,"OCSP",this.ocsp),this.caIssuers.length&&tp(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&tp(e,"Time Stamping",this.timeStamping),this.caRepository.length&&tp(e,"CA Repository",this.caRepository),e}};hp.NAME="Authority Info Access";function tp(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{let n=new Se("");t.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[Se.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),r[e]=n}}function rp(r,e,t,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new tn("url",s)),r.push(new Sn({accessMethod:t,accessLocation:$.parse(s.rawData,ae)}))})}var Ys=class r extends Co{constructor(...e){let t;if(H.BufferSourceConverter.isBufferSource(e[0]))t=H.BufferSourceConverter.toArrayBuffer(e[0]);else{let n=e[0],o=Array.isArray(e[1])?e[1].map(i=>H.BufferSourceConverter.toArrayBuffer(i)):[];t=$.serialize(new dt({type:n,values:o}))}super(t,dt)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new Se("",{"":t})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[Se.NAME]===r.NAME&&(e[Se.NAME]=rn.toString(this.type)),e}};Ys.NAME="Attribute";var dp=class extends Ys{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=new Zc({printableString:e[0]});super(Ay,[$.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let t=$.parse(this.values[0],Zc);this.password=t.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[Se.VALUE]=this.password,e}};dp.NAME="Challenge Password";var sl=class extends Ys{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=e[0],o=new Qt;for(let i of n)o.push($.parse(i.rawData,yt));super(Qc,[$.serialize(o)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let t=$.parse(this.values[0],Qt);this.items=t.map(n=>Gt.create($.serialize(n)))}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(let n of t)e[n[Se.NAME]]=n;return e}};sl.NAME="Extensions";var Zs=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new Ys(e),n=this.items.get(t.type);return n?new n(e):t}};Zs.items=new Map;var cl="crypto.signatureFormatter",Ly=class{toAsnSignature(e,t){return H.BufferSourceConverter.toArrayBuffer(t)}toWebSignature(e,t){return H.BufferSourceConverter.toArrayBuffer(t)}},op,Dy=op=class{static createPssParams(e,t){let n=op.getHashAlgorithm(e);return n?new Qr({hashAlgorithm:n,maskGenAlgorithm:new j({algorithm:bo,parameters:$.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){let t=$e.resolve(Mi);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new j({algorithm:Us,parameters:null});case"sha-256":return new j({algorithm:jf,parameters:null});case"sha-384":return new j({algorithm:js,parameters:null});case"sha-512":return new j({algorithm:Ms,parameters:null})}}else return new j({algorithm:Jr,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let t=op.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new j({algorithm:wo,parameters:$.serialize(t)})}else return new j({algorithm:wo,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Jr:return{name:"RSASSA-PKCS1-v1_5"};case Us:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case jf:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case js:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Ms:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case wo:if(e.parameters){let t=$.parse(e.parameters,Qr);return{name:"RSA-PSS",hash:$e.resolve(Mi).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};Dy=op=l([vo()],Dy);$e.registerSingleton(al,Dy);var Uy=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new j({algorithm:Bi});case"sha-256":return new j({algorithm:ki});case"sha-384":return new j({algorithm:Ni});case"sha-512":return new j({algorithm:Pi})}return null}toWebAlgorithm(e){switch(e.algorithm){case Bi:return{name:"SHA-1"};case ki:return{name:"SHA-256"};case Ni:return{name:"SHA-384"};case Pi:return{name:"SHA-512"}}return null}};Uy=l([vo()],Uy);$e.registerSingleton(al,Uy);var On=class r{addPadding(e,t){let n=H.BufferSourceConverter.toUint8Array(t),o=new Uint8Array(e);return o.set(n,e-n.length),o}removePadding(e,t=!1){let n=H.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(t&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){let n=e.namedCurve,o=r.namedCurveSize.get(n)||r.defaultNamedCurveSize,i=new Ti,s=H.BufferSourceConverter.toUint8Array(t);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),$.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){let n=$.parse(t,Ti),o=e.namedCurve,i=r.namedCurveSize.get(o)||r.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return(0,H.combine)(s,a)}return null}};On.namedCurveSize=new Map;On.defaultNamedCurveSize=32;var Ny="1.3.101.110",d1="1.3.101.111",Py="1.3.101.112",m1="1.3.101.113",jy=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Py;break;case"x25519":t=Ny;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Py;break;case"ed448":t=m1;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Ny;break;case"x448":t=d1;break}}return t?new j({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Py:return{name:"Ed25519"};case m1:return{name:"EdDSA",namedCurve:"Ed448"};case Ny:return{name:"X25519"};case d1:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};jy=l([vo()],jy);$e.registerSingleton(al,jy);var My=class extends Io{constructor(e){Io.isAsnEncoded(e)?super(e,_o):super(e),this.tag=Ot.CertificateRequestTag}onInit(e){this.tbs=$.serialize(e.certificationRequestInfo),this.publicKey=new Nn(e.certificationRequestInfo.subjectPKInfo);let t=$e.resolve(Mi);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(o=>Zs.create($.serialize(o)));let n=this.getAttribute(Qc);this.extensions=[],n instanceof sl&&(this.extensions=n.items),this.subjectName=new mr(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(let t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(let t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=xt.get()){let t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),o=$e.resolveAll(cl).reverse(),i=null;for(let a of o)if(i=a.toWebSignature(t,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),t=$.parse(this.rawData,_o),n=t.certificationRequestInfo,o=new Se("",{Version:`${Xr[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let i=new Se("");for(let s of this.attributes){let a=s.toTextObject();i[a[Se.NAME]]=a}o.Attributes=i}return e.Data=o,e.Signature=new Se("",{Algorithm:Pn.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}};My.NAME="PKCS#10 Certificate Request";var Js=class extends Io{constructor(e){Io.isAsnEncoded(e)?super(e,ur):super(e),this.tag=Ot.CertificateTag}onInit(e){let t=e.tbsCertificate;this.tbs=$.serialize(t),this.serialNumber=H.Convert.ToHex(t.serialNumber),this.subjectName=new mr(t.subject),this.subject=new mr(t.subject).toString(),this.issuerName=new mr(t.issuer),this.issuer=this.issuerName.toString();let n=$e.resolve(Mi);this.signatureAlgorithm=n.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;let o=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!o)throw new Error("Cannot get 'notBefore' value");this.notBefore=o;let i=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!i)throw new Error("Cannot get 'notAfter' value");this.notAfter=i,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(s=>Gt.create($.serialize(s)))),this.publicKey=new Nn(t.subjectPublicKeyInfo)}getExtension(e){for(let t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=xt.get()){let n,o,i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},o=await this.publicKey.export(n,["verify"],t);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},o=await i.publicKey.export(n,["verify"],t);else if(i instanceof Nn)n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"],t);else if(H.BufferSourceConverter.isBufferSource(i)){let u=new Nn(i);n={...u.algorithm,...this.signatureAlgorithm},o=await u.export(n,["verify"],t)}else n={...i.algorithm,...this.signatureAlgorithm},o=i}catch{return!1}let s=$e.resolveAll(cl).reverse(),a=null;for(let u of s)if(a=u.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let c=await t.subtle.verify(this.signatureAlgorithm,o,a,this.tbs);if(e.signatureOnly)return c;{let p=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<p&&p<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=xt.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=xt.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),t=$.parse(this.rawData,ur),n=t.tbsCertificate,o=new Se("",{Version:`${Xr[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":Pn.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new Se("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(o["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(o["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){let i=new Se("");for(let s of this.extensions){let a=s.toTextObject();i[a[Se.NAME]]=a}o.Extensions=i}return e.Data=o,e.Signature=new Se("",{Algorithm:Pn.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}};Js.NAME="Certificate";var mp=class{static async createSelfSigned(e,t=xt.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=xt.get()){var n;let o;e.publicKey instanceof Nn?o=e.publicKey.rawData:"publicKey"in e.publicKey?o=e.publicKey.publicKey.rawData:H.BufferSourceConverter.isBufferSource(e.publicKey)?o=e.publicKey:o=await t.subtle.exportKey("spki",e.publicKey);let i=e.serialNumber?H.BufferSourceConverter.toUint8Array(H.Convert.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));i[0]>127&&(i[0]&=127),i.length>1&&i[0]===0&&(i[1]|=128);let s=e.notBefore||new Date,a=e.notAfter||new Date(s.getTime()+31536e6),c=new ur({tbsCertificate:new gt({version:Xr.v3,serialNumber:i,validity:new Cn({notBefore:s,notAfter:a}),extensions:new Qt(((n=e.extensions)===null||n===void 0?void 0:n.map(y=>$.parse(y.rawData,yt)))||[]),subjectPublicKeyInfo:$.parse(o,mt)})});if(e.subject){let y=e.subject instanceof mr?e.subject:new mr(e.subject);c.tbsCertificate.subject=$.parse(y.toArrayBuffer(),Ne)}if(e.issuer){let y=e.issuer instanceof mr?e.issuer:new mr(e.issuer);c.tbsCertificate.issuer=$.parse(y.toArrayBuffer(),Ne)}let u={hash:"SHA-256"},p="signingKey"in e?{...u,...e.signingAlgorithm,...e.signingKey.algorithm}:{...u,...e.signingAlgorithm},h=$e.resolve(Mi);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(p);let m=$.serialize(c.tbsCertificate),g="signingKey"in e?await t.subtle.sign(p,e.signingKey,m):e.signature,b=$e.resolveAll(cl).reverse(),w=null;for(let y of b)if(w=y.toAsnSignature(p,g),w)break;if(!w)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=w,new Js($.serialize(c))}},y1;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(y1||(y1={}));Gt.register(gf,Xs);Gt.register(vf,ap);Gt.register(Af,cp);Gt.register(Im,lp);Gt.register(yf,sp);Gt.register(_m,up);Gt.register(xf,pp);Gt.register(mf,hp);Zs.register(Ay,dp);Zs.register(Qc,sl);$e.registerSingleton(cl,Ly);$e.registerSingleton(cl,On);On.namedCurveSize.set("P-256",32);On.namedCurveSize.set("K-256",32);On.namedCurveSize.set("P-384",48);On.namedCurveSize.set("P-521",66);var Rn="/",v1=new TextEncoder().encode(Rn),yp=v1[0],ll=class r{_buf;constructor(e,t){if(typeof e=="string")this._buf=de(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==yp)throw new Error("Invalid key")}toString(e="utf8"){return le(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new r(e.join(Rn))}static random(){return new r(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new r(e):typeof e.uint8Array=="function"?new r(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=v1),this._buf[0]!==yp){let e=new Uint8Array(this._buf.byteLength+1);e.fill(yp,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===yp;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Rn).slice(1)}type(){return FC(this.baseNamespace())}name(){return WC(this.baseNamespace())}instance(e){return new r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Rn)||(e+=Rn),e+=this.type(),new r(e)}parent(){let e=this.list();return e.length===1?new r(Rn):new r(e.slice(0,-1).join(Rn))}child(e){return this.toString()===Rn?e:e.toString()===Rn?this:new r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return r.withNamespaces([...this.namespaces(),...qC(e.map(t=>t.namespaces()))])}};function FC(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function WC(r){let e=r.split(":");return e[e.length-1]}function qC(r){return[].concat(...r)}var gp=class extends Mn{async listen(){throw new Hu("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}};var wp=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Qs=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},bp=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},ul=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function xp(r){return r[Symbol.asyncIterator]!=null}function A1(r,e){if(r.byteLength>e)throw new Qs("Message length too long")}var Ap=r=>{let e=_e(r),t=Qe(e);return Lt(r,t),Ap.bytes=e,t};Ap.bytes=0;function S1(r,e){e=e??{};let t=e.lengthEncoder??Ap,n=e?.maxDataLength??4194304;function*o(i){A1(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return xp(r)?async function*(){for await(let i of r)yield*o(i)}():function*(){for(let i of r)yield*o(i)}()}S1.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??Ap,n=e?.maxDataLength??4194304;return A1(r,n),new fe(t(r.byteLength),r)};var Hi;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Hi||(Hi={}));var Ky=r=>{let e=kt(r);return Ky.bytes=_e(e),e};Ky.bytes=0;function fl(r,e){let t=new fe,n=Hi.LENGTH,o=-1,i=e?.lengthDecoder??Ky,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===Hi.LENGTH)try{if(o=i(t),o<0)throw new wp("Invalid message length");if(o>a)throw new Qs("Message length too long");let u=i.bytes;t.consume(u),e?.onLength!=null&&e.onLength(o),n=Hi.DATA}catch(u){if(u instanceof RangeError){if(t.byteLength>s)throw new bp("Message length length too long");break}throw u}if(n===Hi.DATA){if(t.byteLength<o)break;let u=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(u),yield u,n=Hi.LENGTH}}}return xp(r)?async function*(){for await(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new ul("Unexpected end of input")}():function*(){for(let u of r)t.append(u),yield*c();if(t.byteLength>0)throw new ul("Unexpected end of input")}()}fl.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:i,value:s}=await r.next(t);if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return fl(n,{...e??{},onLength:i=>{t=i}})};var Hy=class{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=Le(),this.haveNext=Le()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Le(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Le(),await It(this.readNext.promise,t?.signal,t)}};function E1(){return new Hy}var Sp=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};var Vy=class extends Error{code;constructor(e,t){super(e),this.code=t}},$y=class extends Vy{type;constructor(e){super(e,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}};function _1(r,e){let t=E1();r.sink(t).catch(async s=>{await t.end(s)}),r.sink=async s=>{for await(let a of s)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new fe;return{read:async(s,a)=>{a?.signal?.throwIfAborted();let c,u=new Promise((p,h)=>{c=()=>{h(new $y("Read aborted"))},a?.signal?.addEventListener("abort",c)});try{if(s==null){let{done:h,value:m}=await Promise.race([n.next(),u]);return h===!0?new fe:m}for(;o.byteLength<s;){let{value:h,done:m}=await Promise.race([n.next(),u]);if(m===!0)throw new Sp("unexpected end of input");o.append(h)}let p=o.sublist(0,s);return o.consume(s),p}finally{c!=null&&a?.signal?.removeEventListener("abort",c)}},write:async(s,a)=>{a?.signal?.throwIfAborted(),s instanceof Uint8Array?await t.push(s,a):await t.push(s.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let s=r.source;r.source=async function*(){e?.yieldBytes===!1?yield o:yield*o,yield*s}()}return r}}}var Ep=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},_p=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Cp=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function Fy(r,e={}){let t=_1(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=_e(e.maxDataLength));let n=e?.lengthDecoder??kt,o=e?.lengthEncoder??Lt;return{read:async s=>{let a=-1,c=new fe;for(;;){c.append(await t.read(1,s));try{a=n(c)}catch(u){if(u instanceof RangeError)continue;throw u}if(a<0)throw new Ep("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new Cp("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new _p("message length too long");return t.read(a,s)},write:async(s,a)=>{await t.write(new fe(o(s.byteLength),s),a)},writeV:async(s,a)=>{let c=new fe(...s.flatMap(u=>[o(u.byteLength),u]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function Wy(){let r=Le(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function C1(){let r=Wy(),e=Wy();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}function zC(r){return r[Symbol.asyncIterator]!=null}async function XC(r,e){try{await Promise.all(r.map(async t=>{for await(let n of t)await e.push(n)})),await e.end()}catch(t){await e.end(t).catch(()=>{})}}async function*YC(r){let e=Ru();XC(r,e).catch(()=>{}),yield*e}function*ZC(r){for(let e of r)yield*e}function JC(...r){let e=[];for(let t of r)zC(t)||e.push(t);return e.length===r.length?ZC(e):YC(r)}var I1=JC;function T1(r,...e){if(r==null)throw new Error("Empty pipeline");if(qy(r)){let n=r;r=()=>n.source}else if(k1(r)||B1(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&qy(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)qy(t[n])&&(t[n]=eI(t[n]));return QC(...t)}var QC=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},B1=r=>r?.[Symbol.asyncIterator]!=null,k1=r=>r?.[Symbol.iterator]!=null,qy=r=>r==null?!1:r.sink!=null&&r.source!=null,eI=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=us({objectMode:!0});t.then(()=>{n.end()},s=>{n.end(s)});let o,i=r.source;if(B1(i))o=async function*(){yield*i,n.end()};else if(k1(i))o=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return I1(n,o())}return r.source};var ea=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function Ip(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Gy(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Tt(r,...e){if(!Gy(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function zy(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function N1(r,e){Tt(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Xy(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}var Ln=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),P1=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),tI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!tI)throw new Error("Non little-endian hardware is not supported");function rI(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Tp(r){if(typeof r=="string")r=rI(r);else if(Gy(r))r=Bp(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function O1(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function R1(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}var Yy=(r,e)=>{function t(n,...o){if(Tt(n),r.nonceLength!==void 0){let p=o[0];if(!p)throw new Error("nonce / iv required");r.varSizeNonce?Tt(p):Tt(p,r.nonceLength)}let i=r.tagLength;i&&o[1]!==void 0&&Tt(o[1]);let s=e(n,...o),a=(p,h)=>{if(h!==void 0){if(p!==2)throw new Error("cipher output not supported");Tt(h)}},c=!1;return{encrypt(p,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Tt(p),a(s.encrypt.length,h),s.encrypt(p,h)},decrypt(p,h){if(Tt(p),i&&p.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(s.decrypt.length,h),s.decrypt(p,h)}}}return Object.assign(t,r),t};function Zy(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!nI(e))throw new Error("invalid output, must be aligned");return e}function Jy(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,u=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+u,a,n)}function nI(r){return r.byteOffset%4===0}function Bp(r){return Uint8Array.from(r)}function Dn(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}var D1=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),oI=D1("expand 16-byte k"),iI=D1("expand 32-byte k"),sI=Ln(oI),aI=Ln(iI);function Z(r,e){return r<<e|r>>>32-e}function Qy(r){return r.byteOffset%4===0}var kp=64,cI=16,U1=2**32-1,L1=new Uint32Array;function lI(r,e,t,n,o,i,s,a){let c=o.length,u=new Uint8Array(kp),p=Ln(u),h=Qy(o)&&Qy(i),m=h?Ln(o):L1,g=h?Ln(i):L1;for(let b=0;b<c;s++){if(r(e,t,n,p,s,a),s>=U1)throw new Error("arx: counter overflow");let w=Math.min(kp,c-b);if(h&&w===kp){let y=b/4;if(b%4!==0)throw new Error("arx: invalid block position");for(let S=0,T;S<cI;S++)T=y+S,g[T]=m[T]^p[S];b+=kp;continue}for(let y=0,S;y<w;y++)S=b+y,i[S]=o[S]^u[y];b+=w}}function eg(r,e){let{allowShortKeys:t,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=O1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Ip(o),Ip(s),Xy(i),Xy(t),(a,c,u,p,h=0)=>{Tt(a),Tt(c),Tt(u);let m=u.length;if(p===void 0&&(p=new Uint8Array(m)),Tt(p),Ip(h),h<0||h>=U1)throw new Error("arx: counter overflow");if(p.length<m)throw new Error(`arx: output (${p.length}) is shorter than data (${m})`);let g=[],b=a.length,w,y;if(b===32)g.push(w=Bp(a)),y=aI;else if(b===16&&t)w=new Uint8Array(32),w.set(a),w.set(a,16),y=sI,g.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${b}`);Qy(c)||g.push(c=Bp(c));let S=Ln(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(y,S,Ln(c.subarray(0,16)),S),c=c.subarray(16)}let T=16-o;if(T!==c.length)throw new Error(`arx: nonce must be ${T} or 16 bytes`);if(T!==12){let L=new Uint8Array(12);L.set(c,i?0:12-c.length),c=L,g.push(c)}let v=Ln(c);return lI(r,y,S,v,u,p,h,s),Dn(...g),p}}var vt=(r,e)=>r[e++]&255|(r[e++]&255)<<8,tg=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Tp(e),Tt(e,32);let t=vt(e,0),n=vt(e,2),o=vt(e,4),i=vt(e,6),s=vt(e,8),a=vt(e,10),c=vt(e,12),u=vt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let p=0;p<8;p++)this.pad[p]=vt(e,16+2*p)}process(e,t,n=!1){let o=n?0:2048,{h:i,r:s}=this,a=s[0],c=s[1],u=s[2],p=s[3],h=s[4],m=s[5],g=s[6],b=s[7],w=s[8],y=s[9],S=vt(e,t+0),T=vt(e,t+2),v=vt(e,t+4),L=vt(e,t+6),F=vt(e,t+8),K=vt(e,t+10),O=vt(e,t+12),M=vt(e,t+14),D=i[0]+(S&8191),ne=i[1]+((S>>>13|T<<3)&8191),G=i[2]+((T>>>10|v<<6)&8191),J=i[3]+((v>>>7|L<<9)&8191),ue=i[4]+((L>>>4|F<<12)&8191),R=i[5]+(F>>>1&8191),U=i[6]+((F>>>14|K<<2)&8191),I=i[7]+((K>>>11|O<<5)&8191),E=i[8]+((O>>>8|M<<8)&8191),N=i[9]+(M>>>5|o),B=0,W=B+D*a+ne*(5*y)+G*(5*w)+J*(5*b)+ue*(5*g);B=W>>>13,W&=8191,W+=R*(5*m)+U*(5*h)+I*(5*p)+E*(5*u)+N*(5*c),B+=W>>>13,W&=8191;let q=B+D*c+ne*a+G*(5*y)+J*(5*w)+ue*(5*b);B=q>>>13,q&=8191,q+=R*(5*g)+U*(5*m)+I*(5*h)+E*(5*p)+N*(5*u),B+=q>>>13,q&=8191;let P=B+D*u+ne*c+G*a+J*(5*y)+ue*(5*w);B=P>>>13,P&=8191,P+=R*(5*b)+U*(5*g)+I*(5*m)+E*(5*h)+N*(5*p),B+=P>>>13,P&=8191;let ie=B+D*p+ne*u+G*c+J*a+ue*(5*y);B=ie>>>13,ie&=8191,ie+=R*(5*w)+U*(5*b)+I*(5*g)+E*(5*m)+N*(5*h),B+=ie>>>13,ie&=8191;let ce=B+D*h+ne*p+G*u+J*c+ue*a;B=ce>>>13,ce&=8191,ce+=R*(5*y)+U*(5*w)+I*(5*b)+E*(5*g)+N*(5*m),B+=ce>>>13,ce&=8191;let ee=B+D*m+ne*h+G*p+J*u+ue*c;B=ee>>>13,ee&=8191,ee+=R*a+U*(5*y)+I*(5*w)+E*(5*b)+N*(5*g),B+=ee>>>13,ee&=8191;let xe=B+D*g+ne*m+G*h+J*p+ue*u;B=xe>>>13,xe&=8191,xe+=R*c+U*a+I*(5*y)+E*(5*w)+N*(5*b),B+=xe>>>13,xe&=8191;let Pe=B+D*b+ne*g+G*m+J*h+ue*p;B=Pe>>>13,Pe&=8191,Pe+=R*u+U*c+I*a+E*(5*y)+N*(5*w),B+=Pe>>>13,Pe&=8191;let Be=B+D*w+ne*b+G*g+J*m+ue*h;B=Be>>>13,Be&=8191,Be+=R*p+U*u+I*c+E*a+N*(5*y),B+=Be>>>13,Be&=8191;let De=B+D*y+ne*w+G*b+J*g+ue*m;B=De>>>13,De&=8191,De+=R*h+U*p+I*u+E*c+N*a,B+=De>>>13,De&=8191,B=(B<<2)+B|0,B=B+W|0,W=B&8191,B=B>>>13,q+=B,i[0]=W,i[1]=q,i[2]=P,i[3]=ie,i[4]=ce,i[5]=ee,i[6]=xe,i[7]=Pe,i[8]=Be,i[9]=De}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,n[0]=e[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(o^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535;Dn(n)}update(e){zy(this);let{buffer:t,blockLen:n}=this;e=Tp(e);let o=e.length;for(let i=0;i<o;){let s=Math.min(n-this.pos,o-i);if(s===n){for(;n<=o-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Dn(this.h,this.r,this.buffer,this.pad)}digestInto(e){zy(this),N1(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=n[s]>>>0,e[i++]=n[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function uI(r){let e=(n,o)=>r(o).update(Tp(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var j1=uI(r=>new tg(r));function H1(r,e,t,n,o,i=20){let s=r[0],a=r[1],c=r[2],u=r[3],p=e[0],h=e[1],m=e[2],g=e[3],b=e[4],w=e[5],y=e[6],S=e[7],T=o,v=t[0],L=t[1],F=t[2],K=s,O=a,M=c,D=u,ne=p,G=h,J=m,ue=g,R=b,U=w,I=y,E=S,N=T,B=v,W=L,q=F;for(let ie=0;ie<i;ie+=2)K=K+ne|0,N=Z(N^K,16),R=R+N|0,ne=Z(ne^R,12),K=K+ne|0,N=Z(N^K,8),R=R+N|0,ne=Z(ne^R,7),O=O+G|0,B=Z(B^O,16),U=U+B|0,G=Z(G^U,12),O=O+G|0,B=Z(B^O,8),U=U+B|0,G=Z(G^U,7),M=M+J|0,W=Z(W^M,16),I=I+W|0,J=Z(J^I,12),M=M+J|0,W=Z(W^M,8),I=I+W|0,J=Z(J^I,7),D=D+ue|0,q=Z(q^D,16),E=E+q|0,ue=Z(ue^E,12),D=D+ue|0,q=Z(q^D,8),E=E+q|0,ue=Z(ue^E,7),K=K+G|0,q=Z(q^K,16),I=I+q|0,G=Z(G^I,12),K=K+G|0,q=Z(q^K,8),I=I+q|0,G=Z(G^I,7),O=O+J|0,N=Z(N^O,16),E=E+N|0,J=Z(J^E,12),O=O+J|0,N=Z(N^O,8),E=E+N|0,J=Z(J^E,7),M=M+ue|0,B=Z(B^M,16),R=R+B|0,ue=Z(ue^R,12),M=M+ue|0,B=Z(B^M,8),R=R+B|0,ue=Z(ue^R,7),D=D+ne|0,W=Z(W^D,16),U=U+W|0,ne=Z(ne^U,12),D=D+ne|0,W=Z(W^D,8),U=U+W|0,ne=Z(ne^U,7);let P=0;n[P++]=s+K|0,n[P++]=a+O|0,n[P++]=c+M|0,n[P++]=u+D|0,n[P++]=p+ne|0,n[P++]=h+G|0,n[P++]=m+J|0,n[P++]=g+ue|0,n[P++]=b+R|0,n[P++]=w+U|0,n[P++]=y+I|0,n[P++]=S+E|0,n[P++]=T+N|0,n[P++]=v+B|0,n[P++]=L+W|0,n[P++]=F+q|0}function fI(r,e,t,n){let o=r[0],i=r[1],s=r[2],a=r[3],c=e[0],u=e[1],p=e[2],h=e[3],m=e[4],g=e[5],b=e[6],w=e[7],y=t[0],S=t[1],T=t[2],v=t[3];for(let F=0;F<20;F+=2)o=o+c|0,y=Z(y^o,16),m=m+y|0,c=Z(c^m,12),o=o+c|0,y=Z(y^o,8),m=m+y|0,c=Z(c^m,7),i=i+u|0,S=Z(S^i,16),g=g+S|0,u=Z(u^g,12),i=i+u|0,S=Z(S^i,8),g=g+S|0,u=Z(u^g,7),s=s+p|0,T=Z(T^s,16),b=b+T|0,p=Z(p^b,12),s=s+p|0,T=Z(T^s,8),b=b+T|0,p=Z(p^b,7),a=a+h|0,v=Z(v^a,16),w=w+v|0,h=Z(h^w,12),a=a+h|0,v=Z(v^a,8),w=w+v|0,h=Z(h^w,7),o=o+u|0,v=Z(v^o,16),b=b+v|0,u=Z(u^b,12),o=o+u|0,v=Z(v^o,8),b=b+v|0,u=Z(u^b,7),i=i+p|0,y=Z(y^i,16),w=w+y|0,p=Z(p^w,12),i=i+p|0,y=Z(y^i,8),w=w+y|0,p=Z(p^w,7),s=s+h|0,S=Z(S^s,16),m=m+S|0,h=Z(h^m,12),s=s+h|0,S=Z(S^s,8),m=m+S|0,h=Z(h^m,7),a=a+c|0,T=Z(T^a,16),g=g+T|0,c=Z(c^g,12),a=a+c|0,T=Z(T^a,8),g=g+T|0,c=Z(c^g,7);let L=0;n[L++]=o,n[L++]=i,n[L++]=s,n[L++]=a,n[L++]=y,n[L++]=S,n[L++]=T,n[L++]=v}var pI=eg(H1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),hI=eg(H1,{counterRight:!1,counterLength:8,extendNonceFn:fI,allowShortKeys:!1});var dI=new Uint8Array(16),M1=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(dI.subarray(t))},mI=new Uint8Array(32);function K1(r,e,t,n,o){let i=r(e,t,mI),s=j1.create(i);o&&M1(s,o),M1(s,n);let a=new Uint8Array(16),c=P1(a);Jy(c,0,BigInt(o?o.length:0),!0),Jy(c,8,BigInt(n.length),!0),s.update(a);let u=s.digest();return Dn(i,a),u}var V1=r=>(e,t,n)=>({encrypt(i,s){let a=i.length;s=Zy(a+16,s,!1),s.set(i);let c=s.subarray(0,-16);r(e,t,c,c,1);let u=K1(r,e,t,c,n);return s.set(u,a),Dn(u),s},decrypt(i,s){s=Zy(i.length-16,s,!1);let a=i.subarray(0,-16),c=i.subarray(-16),u=K1(r,e,t,a,n);if(!R1(c,u))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),r(e,t,s,s,1),Dn(u),s}}),rg=Yy({blockSize:64,nonceLength:12,tagLength:16},V1(pI)),uX=Yy({blockSize:64,nonceLength:24,tagLength:16},V1(hI));function F1(r,e,t){return ma(r),t===void 0&&(t=new Uint8Array(r.outputLen)),ns(r,$n(t),$n(e))}var ng=new Uint8Array([0]),$1=new Uint8Array;function W1(r,e,t,n=32){if(ma(r),Kl(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let o=Math.ceil(n/r.outputLen);t===void 0&&(t=$1);let i=new Uint8Array(o*r.outputLen),s=ns.create(r,e),a=s._cloneInto(),c=new Uint8Array(s.outputLen);for(let u=0;u<o;u++)ng[0]=u+1,a.update(u===0?$1:c).update(t).update(ng).digestInto(c),i.set(c,r.outputLen*u),s._cloneInto(a);return s.destroy(),a.destroy(),c.fill(0),ng.fill(0),i.slice(0,n)}var og={hashSHA256(r){return Kr(r.subarray())},getHKDF(r,e){let t=F1(Kr,e,r),o=W1(Kr,t,void 0,96),i=o.subarray(0,32),s=o.subarray(32,64),a=o.subarray(64,96);return[i,s,a]},generateX25519KeyPair(){let r=Aa.utils.randomPrivateKey();return{publicKey:Aa.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Aa.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Aa.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return rg(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,o){return rg(n,e,t).decrypt(r.subarray(),o)}};var q1=og;function G1(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var ta=r=>{let e=Qe(2);return e[0]=r>>8,e[1]=r,e};ta.bytes=2;var pl=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};pl.bytes=2;function z1(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function ig(r,e){!e.enabled||!ea||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${le(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${le(r.privateKey,"hex")}`)):e("Missing local static keys."))}function sg(r,e){!e.enabled||!ea||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${le(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${le(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function X1(r,e){!e.enabled||!ea||e(r?`REMOTE_STATIC_PUBLIC_KEY ${le(r.subarray(),"hex")}`:"Missing remote static public key.")}function ag(r,e){!e.enabled||!ea||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${le(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function cg(r,e,t){!t.enabled||!ea||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&le(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&le(e.k,"hex")}`))}var ra=class r extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var yI=0,gI=4294967295,wI="Cipherstate has reached maximum n, a new handshake must be performed",Np=class{n;bytes;view;constructor(e=yI){this.n=e,this.bytes=ot(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>gI)throw new Error(wI)}};var Vi=ot(0),na=class{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new Np(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();let o=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),o}},lg=class{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let n=de(t,"utf-8");this.h=bI(e,n),this.ck=this.h,this.cs=new na(e)}mixKey(e){let[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new na(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new fe(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,Vi);return[new na(this.crypto,e),new na(this.crypto,t)]}},ug=class{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:n,prologue:o,initiator:i,s,e:a,rs:c,re:u}=e;this.crypto=t,this.ss=new lg(t,n),this.ss.mixHash(o),this.initiator=i,this.s=s,this.e=a,this.rs=c,this.re=u}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");let o=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},hl=class extends ug{writeMessageA(e){return new fe(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new fe(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new fe(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new ra(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new ra(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new ra(`handshake stage 2 validation fail: ${t.message}`)}}};function bI(r,e){if(e.length<=32){let t=ot(32);return t.set(e),t}else return r.hash(e)}var Pp;(function(r){let e;r.codec=()=>(e==null&&(e=Tr((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(let i of t.streamMuxers)n.uint32(18),n.string(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={webtransportCerthashes:[],streamMuxers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new Ca('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&i.streamMuxers.length===o.limits.streamMuxers)throw new Ca('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ir(t,r.codec()),r.decode=(t,n)=>Cr(t,r.codec(),n)})(Pp||(Pp={}));var dl;(function(r){let e;r.codec=()=>(e==null&&(e=Tr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),Pp.codec().encode(t.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={identityKey:ot(0),identitySig:ot(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=Pp.codec().decode(t,t.uint32(),{limits:o.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ir(t,r.codec()),r.decode=(t,n)=>Cr(t,r.codec(),n)})(dl||(dl={}));async function fg(r,e,t){let n=await r.sign(Y1(e));return dl.encode({identityKey:Vn(r.publicKey),identitySig:n,extensions:t})}async function pg(r,e,t){try{let n=dl.decode(r),o=Pa(n.identityKey);if(t?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");let i=Y1(e);if(!await o.verify(i,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new Cl(n.message)}}function Y1(r){let e=de("noise-libp2p-static-key:");return r instanceof Uint8Array?it([e,r],e.length+r.length):(r.prepend(e),r)}async function Z1(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:u}=r,p=await fg(i,a.publicKey,u),h=new hl({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:s,s:a});ig(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(Vi),e),t.trace("Stage 0 - Initiator finished sending first message."),sg(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");let m=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),ag(h.re,t),X1(h.rs,t),t.trace("Initiator going to check remote's signature...");let g=await pg(m,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(p),e),t.trace("Stage 2 - Initiator sent message with signed payload.");let[b,w]=h.ss.split();return cg(b,w,t),{payload:g,encrypt:y=>b.encryptWithAd(Vi,y),decrypt:(y,S)=>w.decryptWithAd(Vi,y,S)}}async function J1(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:u}=r,p=await fg(i,a.publicKey,u),h=new hl({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:s,s:a});ig(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),ag(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(p),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),sg(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");let m=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");let g=await pg(m,h.rs,c),[b,w]=h.ss.split();return cg(b,w,t),{payload:g,encrypt:y=>w.encryptWithAd(Vi,y),decrypt:(y,S)=>b.decryptWithAd(Vi,y,S)}}var eA=16;function tA(r,e){return async function*(t){for await(let n of t)for(let o=0;o<n.length;o+=65519){let i=o+65519;i>n.length&&(i=n.length);let s;n instanceof Uint8Array?s=r.encrypt(n.subarray(o,i)):s=r.encrypt(n.sublist(o,i)),e?.encryptedPackets.increment(),yield new fe(ta(s.byteLength),s)}}}function rA(r,e){return async function*(t){for await(let n of t)for(let o=0;o<n.length;o+=65535){let i=o+65535;if(i>n.length&&(i=n.length),i-eA<o)throw new Error("Invalid chunk");let s=n.sublist(o,i),a=n.subarray(o,i-eA);try{let c=r.decrypt(s,a);e?.decryptedPackets.increment(),yield c}catch(c){throw e?.decryptErrors.increment(),c}}}}var Op=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:n,extensions:o,crypto:i,prologueBytes:s}=t,{metrics:a}=e;this.components=e;let c=i??q1;this.crypto=G1(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?z1(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=s??ot(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[Wi]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){let n=Fy(e,{lengthEncoder:ta,lengthDecoder:pl,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Pa(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:hd(s),streamMuxer:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(e==null)return;let t=this.components.upgrader.getStreamMuxers();if(t!=null)for(let n of e){let o=t.get(n);if(o!=null)return o}if(e.length)throw new Il("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){let n=Fy(e,{lengthEncoder:ta,lengthDecoder:pl,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Pa(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:hd(s),streamMuxer:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,n,o){let i;try{i=await Z1({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(s){throw this.metrics?.xxHandshakeErrors.increment(),s}return i}async performHandshakeResponder(e,t,n,o){let i;try{i=await J1({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:[...this.components.upgrader.getStreamMuxers().keys()],webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(s){throw this.metrics?.xxHandshakeErrors.increment(),s}return i}async createSecureConnection(e,t){let[n,o]=C1(),i=e.unwrap();return await T1(n,tA(t,this.metrics),i,s=>fl(s,{lengthDecoder:pl}),rA(t,this.metrics),n),o}};function nA(r={}){return e=>new Op(e,r)}var hg=Object.values(Po).map(r=>r.decoder).reduce((r,e)=>r.or(e)),xI=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function oA(r){return r?.match(xI)?.groups?.fingerprint}function dg(r){let t=r.stringTuples().filter(n=>n[0]===Bw).map(n=>n[1])[0];if(t===void 0||t==="")throw new ve(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function vI(r){return tr.decode(hg.decode(r))}function AI(r){let e=vI(dg(r)),t=SI(e.code),n=e.digest.reduce((i,s)=>i+s.toString(16).padStart(2,"0"),""),o=n.match(/.{1,2}/g);if(o==null)throw new Ku(n,r.toString());return`${t} ${o.join(":").toUpperCase()}`}function iA(r){let e=r.split(":").map(o=>parseInt(o,16)),t=Uint8Array.from(e),n=At(rr.code,t);return Hr(`/certhash/${No.encode(n.bytes)}`)}function SI(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new Vu(r)}}function sA(r,e){let{host:t,port:n,family:o}=r.toOptions(),i=AI(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${o} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${cs}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function aA(r,e){let{host:t,port:n,family:o}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
c=IN IP${o} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${cs}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function mg(r,e){if(r.sdp===void 0)throw new ve("Can't munge a missing SDP");let t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}var yg=de("libp2p-webrtc-noise:");function lA(r,e,t){let n=r.trim().toLowerCase().replaceAll(":",""),o=de(n,"hex"),i=At(rr.code,o),s=hg.decode(dg(e)),a=yg.byteLength+i.bytes.byteLength+s.byteLength;return t==="server"?it([yg,s,i.bytes],a):it([yg,i.bytes,s],a)}var EI=$a?"iceconnectionstatechange":"connectionstatechange";async function uA(r,e,t){let n=r.createDataChannel("",{negotiated:!0,id:0});if(t.role==="client"){t.log.trace("client creating local offer");let m=await r.createOffer();t.log.trace("client created local offer %s",m.sdp);let g=mg(m,e);t.log.trace("client setting local offer %s",g.sdp),await r.setLocalDescription(g);let b=sA(t.remoteAddr,e);t.log.trace("client setting server description %s",b.sdp),await r.setRemoteDescription(b)}else{let m=aA(t.remoteAddr,e);t.log.trace("server setting client %s %s",m.type,m.sdp),await r.setRemoteDescription(m),t.log.trace("server creating local answer");let g=await r.createAnswer();t.log.trace("server created local answer");let b=mg(g,e);t.log.trace("server setting local description %s",g.sdp),await r.setLocalDescription(b)}if(t.log.trace("%s wait for handshake channel to open",t.role),await Ga(n,"open",t.signal),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){let m=r.remoteFingerprint()?.value??"";t.remoteAddr=t.remoteAddr.encapsulate(iA(m))}let o=oA(r.localDescription?.sdp);if(o==null)throw new to("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);let i=lA(o,t.remoteAddr,t.role),s=nA({prologueBytes:i})(t),a=ps({channel:n,direction:"inbound",logger:t.logger,...t.dataChannel??{}}),c={...a,sink:a.sink.bind(a),source:async function*(){for await(let m of a.source)for(let g of m)yield g}()},u=new $o(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(EI,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":u.close().catch(m=>{t.log.error("error closing connection",m),u.abort(m)});break;default:break}}),t.events?.increment({peer_connection:!0});let p=new eo(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await s.secureInbound(c,{remotePeer:t.remotePeerId,signal:t.signal}),t.log.trace("%s upgrade outbound",t.role),t.upgrader.upgradeOutbound(u,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal});t.log.trace("%s secure outbound",t.role);let h=await s.secureOutbound(c,{remotePeer:t.remotePeerId,signal:t.signal});u.remoteAddr=u.remoteAddr.encapsulate(`/p2p/${h.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(u,{skipProtection:!0,skipEncryption:!0,muxerFactory:p,signal:t.signal})}async function fA(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));let o=typeof t=="function"?await t():t;return new RTCPeerConnection({...o??{},certificates:[n]})}async function pA(r){let e=await cu(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...le(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var Rp=class{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Mn,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new ve("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[_l]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[Wi]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){let n=await this._connect(e,t);return this.log("dialing address: %a",e),n}createListener(e){if(this.certificate==null)throw new Rl;return new gp(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(Sw.exactMatch)}dialFilter(e){return this.listenFilter(e)}async _connect(e,t){t.signal.throwIfAborted();let n,o=e.getPeerId();o!=null&&(n=os(o));let i=zw(),s=await fA("client",i,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await It(uA(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey}),t.signal)}catch(a){throw s.close(),a}}async getCertificate(e){if(_I(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:o}=await this.loadOrCreateCertificate(t,e);return{privateKey:await pA(t),pem:n,certhash:o}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;let e=this.init.certificateKeychainName??Uw,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Bo;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await tw("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n,o=new ll(this.init.certificateDatastoreKey??Dw),i=await cu(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Bo;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(o,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(o,i)}let s=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??Ld)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},s),{pem:n.toString("pem"),certhash:No.encode((await rr.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){let n=await this.components.datastore.get(e),o=new Js(n),i=o.notAfter.getTime()-(this.init.certificateRenewalThreshold??Ld);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new Bo;this.log("loaded certificate, expires in %d ms",i);let s=await o.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",s),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!Ge(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Bo;return this.log("loaded certificate, expiry time is %o",i),o}async createCertificate(e,t){let n=new Date,o=new Date(Date.now()+(this.init.certificateLifespan??jw));n.setMilliseconds(0),o.setMilliseconds(0);let i=await mp.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:o,keys:t,extensions:[new Xs(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,de(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}};function _I(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function CI(r){return e=>new Rp(e,r)}function II(r){return e=>new qu(e,r)}return xA(TI);})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

tslib/tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

pvutils/build/utils.es.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.es.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

@peculiar/x509/build/x509.es.js:
  (*!
   * MIT License
   * 
   * Copyright (c) Peculiar Ventures. All rights reserved.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return Libp2PWebrtc}));
